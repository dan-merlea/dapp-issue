import{a as v}from"./chunk-YTYNUTPN.js";import{a as O}from"./chunk-LCDZ37RC.js";import{a as y}from"./chunk-HDHHT2NH.js";import{a as I}from"./chunk-LPXTFZID.js";import{a as $}from"./chunk-MWOWDL5H.js";import{a as G}from"./chunk-JYRLELYC.js";import{c as x,d as h}from"./chunk-HXERYGOO.js";import{c as M,f as R}from"./chunk-V2DQWH6R.js";import{a as oe}from"./chunk-E37GJNPW.js";import{c as w,e as P,f as b}from"./chunk-K45F7SFK.js";import{a as ne}from"./chunk-MDICBPXF.js";import{a as E}from"./chunk-MP7NBSJV.js";import{b as B,c as te}from"./chunk-NPGLEYL5.js";import{k as ee}from"./chunk-P6M5SGWP.js";import{j as s,m as A}from"./chunk-HBP5N4FR.js";A();import{useEffect as re,useRef as q,useState as z}from"react";import{WalletConnectProvider as ie}from"@elrondnetwork/erdjs-wallet-connect-provider";te();oe();ee();ne();var Ue=({logoutRoute:T,callbackRoute:l,token:g,onLoginRedirect:F})=>{let c=x(),J=15e3,[W,N]=z(""),[u,U]=z(""),{provider:a}=$(),m=h(M),j=h(R),o=q(a),p=q(!0),f,S=Boolean(u),K=!S,Q=S?`${j}?wallet-connect=${encodeURIComponent(u)}`:"";re(()=>{k();let e=setInterval(()=>{k()},J);return()=>clearInterval(e)},[a]),v(()=>{D()},[g]),v(()=>{o.current=a},[a]);let L=()=>{O(T)},V=()=>{p.current=!1};function k(){return s(this,null,function*(){var i,t;if(a==null||!y("walletconnect")||!Boolean((t=(i=o.current)==null?void 0:i.walletConnector)==null?void 0:t.connected))return;let n={method:"heartbeat",params:{}};try{yield o.current.sendCustomMessage(n)}catch(r){console.error("Connection lost",r),L()}})}function X(){return s(this,null,function*(){var e;try{let n=o.current;if(I()||n==null||!y("walletconnect"))return;if(!p.current){try{yield(e=o.current)==null?void 0:e.logout()}catch(ce){console.warn("Unable to logout")}return}let t=yield n.getAddress();if(!t){console.warn("Login cancelled.");return}let r=yield n.getSignature(),d=Boolean(r),_={address:t,loginMethod:"walletconnect"},H={logoutRoute:T,loginType:"walletConnect",callbackRoute:l!=null?l:window.location.href};d?(c(w(H)),c(b(r))):c(w(H)),c(B(_)),n.walletConnector.on("heartbeat",()=>{clearInterval(f),f=setInterval(()=>{console.log("Maiar Wallet Connection Lost"),L(),clearInterval(f)},15e4)}),E(l,F)}catch(n){N("Invalid address"),console.error(n)}})}function Y(e=!0){return s(this,null,function*(){var r,d;let n=e&&!u;if(!m||((d=(r=o==null?void 0:o.current)==null?void 0:r.isInitialized)==null?void 0:d.call(r))&&!n)return;let i={onClientLogin:X,onClientLogout:L},t=new ie(m,i);yield t.init(),p.current=!0,G(t),o.current=t,e&&D()})}function D(){return s(this,null,function*(){var t;if(!m)return;let e=yield(t=o.current)==null?void 0:t.login();if(!Boolean(e))return;if(!g){U(e);return}let i=`${e}&token=${g}`;U(i),c(P({loginToken:g}))})}let C=Boolean(W),Z=I();return[Y,{error:W,loginFailed:C,isLoading:K&&!C,isLoggedIn:Z&&!C},{uriDeepLink:Q,walletConnectUri:u,cancelLogin:V}]};export{Ue as a};
//# sourceMappingURL=chunk-5CK75273.js.map
