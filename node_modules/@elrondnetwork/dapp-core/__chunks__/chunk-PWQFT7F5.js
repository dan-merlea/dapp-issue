import{a as j}from"./chunk-EDBOUBLR.js";import{a as H}from"./chunk-QXMQP34B.js";import{a as q}from"./chunk-6D5GT4OX.js";import{a as Z}from"./chunk-JRQCY6J5.js";import{a as X}from"./chunk-MWOWDL5H.js";import{b as F}from"./chunk-LY45FWEG.js";import{c as $,d as S}from"./chunk-HXERYGOO.js";import{f as B,k as V}from"./chunk-EUMYK45L.js";import{a as z}from"./chunk-P2H25ZZV.js";import{a as x}from"./chunk-X5TGO2UY.js";import{a as U}from"./chunk-HGGYZF27.js";import{a as cn}from"./chunk-E37GJNPW.js";import{c as D}from"./chunk-TIT7O6HR.js";import{h as L}from"./chunk-ABUY7RHS.js";import{e as W,j as R,k as m}from"./chunk-MD7XZQEH.js";import{l as G,s as an}from"./chunk-HEFMRSX3.js";import{a as k}from"./chunk-ZNRXHZ7I.js";import{a as P,b as g,c as w,d as _,e as O}from"./chunk-C32UB6VS.js";import{k as rn}from"./chunk-P6M5SGWP.js";import{j as E,m as C}from"./chunk-HBP5N4FR.js";C();an();import{useEffect as ln,useRef as un,useState as dn}from"react";import{ExtensionProvider as J}from"@elrondnetwork/erdjs-extension-provider";cn();rn();var Tn=(a,d)=>d.map((T,r)=>(T.setNonce(a+r),T)),Gn=()=>{let a=$(),d=un("/"),T=S(U),{provider:r}=X(),h=F(r),[K,N]=dn(null),t=S(V),Q=S(B),Y=Boolean(t==null?void 0:t.transactions),f=()=>{N(null),a(R(null))},M=n=>{f(),y(n)};j(M);function y(n){var o,s;let i=r instanceof J;a(W()),a(L(n)),a(D(k)),i&&(f(),(s=(o=J.getInstance())==null?void 0:o.cancelAction)==null||s.call(o))}let p=(n,i)=>{let o=n.includes(g);if(y(i),o){a(R(g));return}N(n)},nn=(n,i,o="")=>{let s={[G]:i},u=`${window.location.origin}${o}`,c=x({callbackUrl:u,urlParams:s});r.signTransactions(n,{callbackUrl:encodeURIComponent(c)})},sn=()=>E(void 0,null,function*(){var b;let{sessionId:n,transactions:i,callbackRoute:o,customTransactionInformation:s}=t,{redirectAfterSign:u}=s,c=o||window.location.pathname,I=window.location.pathname.includes(c),A=u&&!I;try{if(!(yield(b=r==null?void 0:r.init)==null?void 0:b.call(r)))return}catch(e){let l=(e==null?void 0:e.message)||e||_;console.error(l),p(l);return}try{let e=yield r.signTransactions(i);if(!H(e))return;let on=Object.values(e).map(en=>z(en)),v={sessionId:n,transactions:on,status:"signed"};A&&(v.redirectRoute=c),a(m(v))}catch(e){let l=(e==null?void 0:e.message)||e||w;console.error(l),a(m({sessionId:n,status:"cancelled"})),p(l.includes("cancel")?g:l,n)}}),tn=()=>E(void 0,null,function*(){if(!t)return;f();let{sessionId:n,transactions:i,callbackRoute:o}=t;if(!r){console.error(O);return}d.current=o||window.location.pathname;try{let s=yield Z(T);if(s==null)return;let u=h==="wallet",c=!["wallet","ledger","extra"].includes(h),I=q(s),A=Tn(I,i);u&&nn(A,n,o),c&&sn()}catch(s){let c=(s==null?void 0:s.message)||P;console.error(c),p(c,n),a(m({sessionId:n,status:"cancelled"})),console.error(c,s)}});return ln(()=>{tn()},[t]),{error:K,canceledTransactionsMessage:Q,onAbort:M,hasTransactions:Y,callbackRoute:d.current,sessionId:t==null?void 0:t.sessionId,transactions:t==null?void 0:t.transactions}};export{Gn as a};
//# sourceMappingURL=chunk-PWQFT7F5.js.map
