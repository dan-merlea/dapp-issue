import{a as q}from"./chunk-LPXTFZID.js";import{a as T}from"./chunk-JYRLELYC.js";import{d as j}from"./chunk-LY45FWEG.js";import{c as B,d as V}from"./chunk-HXERYGOO.js";import{g as $}from"./chunk-HGGYZF27.js";import{a as le}from"./chunk-E37GJNPW.js";import{g as S,h as _}from"./chunk-PV7M7QZ7.js";import{d as U,e as W}from"./chunk-K45F7SFK.js";import{a as ce}from"./chunk-MDICBPXF.js";import{a as y}from"./chunk-MP7NBSJV.js";import{b as w,c as de}from"./chunk-NPGLEYL5.js";import{a as l}from"./chunk-NCV4QGRH.js";import{g as O,h as ae}from"./chunk-C32UB6VS.js";import{k as ie}from"./chunk-P6M5SGWP.js";import{a as M,b as R,j as c,k as F,m as N}from"./chunk-HBP5N4FR.js";N();ae();import{useEffect as ge,useState as s}from"react";import{HWProvider as x}from"@elrondnetwork/erdjs-hw-provider";de();le();ie();ce();var d="Could not initialise ledger app, make sure Elrond app is open",ue=10;function be({callbackRoute:h,token:u,addressesPerPage:J=ue,onLoginRedirect:E}){let P=V($),i=B(),v=q(),[I,a]=s(""),[K,t]=s(!1),f=new x,[p,b]=s(0),[g,Q]=s([]),[k,X]=s(""),[C,Y]=s(!1),[r,L]=s(null),[Z,m]=s(!1);function H({provider:e,address:n,index:o,signature:G}){T(e),i(U({index:o,loginType:"ledger"})),G&&i(W({loginToken:String(u),signature:G})),i(w({address:n,loginMethod:"ledger"})),y(h,E)}let z=(e,n="")=>{let{errorMessage:o}=l(e);o&&a(`${o}.${n}`),t(!1),console.warn(e),i(S(null))};function ee(e){return c(this,null,function*(){if(r==null)return!1;let{index:n}=r;if(u)try{let o=yield e.tokenLogin({token:F.Buffer.from(`${u}{}`),addressIndex:n});H({address:o.address,provider:e,index:n,signature:o.signature.hex()})}catch(o){z(o,". Update Elrond App to continue.")}else try{let o=yield e.login({addressIndex:n});H({address:o,provider:e,index:n})}catch(o){return z(o),!1}return!0})}function ne(){return c(this,null,function*(){try{if(t(!0),r==null)return!1;i(P?_(r):S(R(M({},r),{version:k,hasContractDataEnabled:C})));let e=new x;if(!(yield e.init()))return a(d),console.warn(d),!1;t(!1),yield ee(e)}catch(e){let{errorMessage:n}=l(e);n&&a(n),console.warn(d,e)}finally{t(!1)}return m(!1),!0})}function D(){return c(this,null,function*(){try{if(t(!0),!(yield f.init())){a(d),console.warn(d),t(!1);return}let n=yield f.getAccounts(p,J),o=yield j(f);X(o.version),Y(o.dataEnabled),Q(n),t(!1)}catch(e){let{errorMessage:n,defaultErrorMessage:o}=l(e);a(n!=null?n:o),console.error("error",e),t(!1)}})}function oe(){return c(this,null,function*(){if(v)throw new Error(O);a("");try{if(t(!0),P!=null){let e=new x;if(!(yield e.init())||!r){console.warn(d);return}let o=yield e.login({addressIndex:r.index.valueOf()});if(T(e),!o){t(!1),console.warn("Login cancelled.");return}i(w({address:o,loginMethod:"ledger"})),y(h,E)}else(g==null?void 0:g.length)>0||(yield D()),m(!0)}catch(e){console.error("error ",e);let{defaultErrorMessage:n}=l();a(n)}finally{t(!1)}})}function te(e){L(e)}function re(){L(null),b(e=>e+1)}function se(){L(null),b(e=>e===0?0:e-1)}ge(()=>{D()},[p]);let A=Boolean(I);return[oe,{loginFailed:A,isLoggedIn:v&&!A,error:I,isLoading:K&&!A},{accounts:g,showAddressList:Z,startIndex:p,selectedAddress:r,version:k,contractDataEnabled:C,onGoToPrevPage:se,onGoToNextPage:re,onSelectAddress:te,onConfirmSelectedAddress:ne}]}export{be as a};
//# sourceMappingURL=chunk-UHMMC77F.js.map
