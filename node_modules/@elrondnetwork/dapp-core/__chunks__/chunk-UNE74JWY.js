import{a as W}from"./chunk-YTYNUTPN.js";import{a as F}from"./chunk-LCDZ37RC.js";import{a as z}from"./chunk-HDHHT2NH.js";import{a as P}from"./chunk-LPXTFZID.js";import{a as $,d as q}from"./chunk-JYRLELYC.js";import{c as O,d as u}from"./chunk-HXERYGOO.js";import{b,d as B,e as M,f as G}from"./chunk-V2DQWH6R.js";import{a as dn}from"./chunk-E37GJNPW.js";import{c as E,e as T,f as k}from"./chunk-K45F7SFK.js";import{a as gn}from"./chunk-MDICBPXF.js";import{a as H}from"./chunk-MP7NBSJV.js";import{b as j,c as ln}from"./chunk-NPGLEYL5.js";import{k as an}from"./chunk-P6M5SGWP.js";import{j as d,m as D}from"./chunk-HBP5N4FR.js";D();import{useRef as _,useState as S}from"react";import{WalletConnectV2Provider as un}from"@elrondnetwork/erdjs-wallet-connect-provider";ln();dn();an();gn();var pn=(c=>(c.invalidAddress="Invalid address",c.invalidConfig="Invalid WalletConnect setup",c.invalidTopic="Expired connection",c.sessionExpired="Unable to connect to existing session",c.connectError="Unable to connect",c.userRejected="User rejected connection proposal",c.userRejectedExisting="User rejected existing connection proposal",c.errorLogout="Unable to remove existing pairing",c))(pn||{}),kn=({callbackRoute:p,logoutRoute:x,token:a,onLoginRedirect:J})=>{let g=O(),[I,l]=S(""),[f,c]=S(""),[K,w]=S([]),C=q(),m=u(B),v=u(M),N=u(b),Q=u(G),o=_(C),L=_(!0),U=Boolean(f),V=["erd_cancelAction"],X=!U,Y=U?`${Q}?wallet-connect=${encodeURIComponent(f)}`:"";W(()=>{R()},[a]),W(()=>{o.current=C},[C]);let Z=()=>{F(x)},nn=n=>{console.log("wc2 session event: ",n)},en=()=>{L.current=!1};function on(){return d(this,null,function*(){var n;try{let e=o.current;if(P()||e==null||!z("walletconnectv2"))return;if(!L.current){try{yield(n=o.current)==null?void 0:n.logout()}catch(fn){console.warn("Unable to logout")}return}let t=yield e.getAddress();if(!t){console.warn("Login cancelled.");return}let i=yield e.getSignature(),s=Boolean(i),sn={address:t,loginMethod:"walletconnectv2"},A={logoutRoute:x,loginType:"walletconnectv2",callbackRoute:p!=null?p:window.location.href};s?(g(E(A)),g(k(i))):g(E(A)),g(j(sn)),H(p,J)}catch(e){l("Invalid address"),console.error(e)}})}function y(n=!0){return d(this,null,function*(){var i,s;let e=n&&!f;if(!v||!m||((s=(i=o==null?void 0:o.current)==null?void 0:i.isInitialized)==null?void 0:s.call(i))&&!e){l("Invalid WalletConnect setup");return}let r={onClientLogin:on,onClientLogout:Z,onClientEvent:nn},t=new un(r,N,m,v);yield t.init(),L.current=!0,$(t),w(t.pairings),o.current=t,n&&R()})}function tn(n){return d(this,null,function*(){var e,r,t;if(!m||!v){l("Invalid WalletConnect setup");return}if(!n||!n.topic){l("Expired connection");return}try{let{approval:i}=yield(e=o.current)==null?void 0:e.connect({topic:n.topic,methods:V});a&&g(T({loginToken:a}));try{yield(r=o.current)==null?void 0:r.login({approval:i,token:a})}catch(s){console.warn("User rejected existing connection proposal",s),yield y()}}catch(i){console.error("Unable to connect to existing session",i),l("Unable to connect to existing session")}finally{w((t=o.current)==null?void 0:t.pairings)}})}function rn(n){return d(this,null,function*(){var e,r;try{n&&(yield(e=o.current)==null?void 0:e.logout({topic:n}))}catch(t){console.error("Unable to remove existing pairing",t),l("Unable to remove existing pairing")}finally{w((r=o.current)==null?void 0:r.pairings)}})}function R(){return d(this,null,function*(){var n,e;if(!m||!v){l("Invalid WalletConnect setup");return}try{let{uri:r,approval:t}=yield(n=o.current)==null?void 0:n.connect({methods:V});if(!Boolean(r))return;c(r),a&&g(T({loginToken:a}));try{yield(e=o.current)==null?void 0:e.login({approval:t,token:a})}catch(s){console.warn("User rejected connection proposal",s),yield y()}}catch(r){console.error("Unable to connect",r)}})}let h=Boolean(I),cn=P();return[y,{error:I,loginFailed:h,isLoading:X&&!h,isLoggedIn:cn&&!h},{uriDeepLink:Y,walletConnectUri:f,cancelLogin:en,connectExisting:tn,removeExistingPairing:rn,wcPairings:K}]};export{pn as a,kn as b};
//# sourceMappingURL=chunk-UNE74JWY.js.map
