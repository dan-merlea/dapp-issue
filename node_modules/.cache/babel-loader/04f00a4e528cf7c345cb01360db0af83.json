{"ast":null,"code":"import _classCallCheck from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/createClass.js\";import{Constants,Entities,EventHandler}from'@krogan/common';import{Asset,getCacheAsset,loadMapAssets}from'images/textures';import*as PIXI from'pixi.js';import{aspectFillScale}from'utils/scaling';import{GameManager}from'./GameManager';import{MapManager,MapZINDEX}from'./MapManager';// We don't want to scale textures linearly because they would appear blurry.\nPIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;export var AppManager=/*#__PURE__*/function(){// Application\n// Sprites\n// Assets\n// Game Events\n// Map Data\n// LIFECYCLE\nfunction AppManager(){var _this=this;_classCallCheck(this,AppManager);this._app=void 0;this._mapManager=void 0;this._gameManager=void 0;this._background=void 0;this._assetsLoaded=false;this.eventHandler=new EventHandler();this.map=new Entities.Map(Constants.MAP_SIZE,Constants.MAP_SIZE);this.start=function(renderView){return new Promise(function(resolve,reject){if(_this._assetsLoaded)return reject(new Error('Already loaded'));_this._assetsLoaded=true;console.log('Loading assets');loadMapAssets(function(){renderView.oncontextmenu=function(e){e.preventDefault();e.stopPropagation();};renderView.appendChild(_this.app.view);_this.app.start();_this.loadMapBackground();_this.mapManager.start();_this.gameManager.assetsLoaded();resolve();});});};this.stop=function(){_this.app.ticker.stop();_this.app.stop();};this.setScreenSize=function(){_this.app.renderer.resize(window.innerWidth,window.innerHeight);_this.mapManager.setScreenSize(window.innerWidth,window.innerHeight);_this.gameManager.setScreenSize(window.innerWidth,window.innerHeight);};this.loadMapBackground=function(){var screenWidth=window.innerWidth;var screenHeight=window.innerHeight;var background=new PIXI.Sprite(getCacheAsset(Asset.MapBackground));aspectFillScale(background,screenWidth,screenHeight);_this.app.stage.addChild(background);background.zIndex=MapZINDEX.BACKGROUND;_this._background=background;};var _screenWidth=window.innerWidth;var _screenHeight=window.innerHeight;// App\nthis._app=new PIXI.Application({width:_screenWidth,height:_screenHeight,antialias:false,backgroundColor:PIXI.utils.string2hex(Constants.BACKGROUND_COLOR),autoDensity:true,resolution:window.devicePixelRatio});this.app.stage.sortableChildren=true;this.app.stage.interactive=true;this.app.stage.hitArea=new PIXI.Rectangle(0,0,Constants.ZOOM_MAP_RADIUS*2,Constants.ZOOM_MAP_RADIUS*2);// Managers\nthis._mapManager=new MapManager(this.app,this.map,this.eventHandler);this._gameManager=new GameManager(this.app,this.map,this.eventHandler);this._gameManager.hideAll();// Resize listener\nwindow.addEventListener('resize',this.setScreenSize.bind(this));}_createClass(AppManager,[{key:\"app\",get:// GETTERS & SETTERS\nfunction get(){return this._app;}},{key:\"mapManager\",get:function get(){return this._mapManager;}},{key:\"gameManager\",get:function get(){return this._gameManager;}},{key:\"startSpaceshipControl\",value:// IAPPManager\nfunction startSpaceshipControl(){this._mapManager.hideAll();this._gameManager.showAll();if(this._background)this._background.visible=false;}},{key:\"stopSpaceshipControl\",value:function stopSpaceshipControl(){this._gameManager.leaveGameRoom();if(this._background)this._background.visible=true;}},{key:\"setZoomLevel\",value:function setZoomLevel(level){if(this._background){this._background.visible=[0,1].includes(level);}if(level==0){this._mapManager.hideAll();this._gameManager.hideAll();this._mapManager.show(MapZINDEX.MAP);}if(level==1){this._mapManager.hideAll();this._gameManager.hideAll();this._mapManager.show(MapZINDEX.HEX);}if(level==2){this.startSpaceshipControl();}}}]);return AppManager;}();","map":null,"metadata":{},"sourceType":"module"}