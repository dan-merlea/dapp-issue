{"ast":null,"code":"import _assertThisInitialized from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _toConsumableArray from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _inherits from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _regeneratorRuntime from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _createForOfIteratorHelper from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _defineProperty from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _objectSpread from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _classCallCheck from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport le from \"pino\";\nimport Nt from \"@walletconnect/keyvaluestorage\";\nimport { HEARTBEAT_EVENTS as X, HeartBeat as Lt } from \"@walletconnect/heartbeat\";\nimport { generateChildLogger as v, getLoggerContext as w, getDefaultLoggerOptions as de } from \"@walletconnect/logger\";\nimport { IMessageTracker as Ut, IPublisher as Ft, ISubscriber as Mt, IRelayer as $t, IStore as Kt, IJsonRpcHistory as kt, IExpirer as Bt, ICore as jt } from \"@walletconnect/types\";\nimport { safeJsonStringify as Vt, safeJsonParse as qt } from \"@walletconnect/safe-json\";\nimport * as j from \"@walletconnect/relay-auth\";\nimport { getInternalError as c, mapToObj as ge, objToMap as pe, generateKeyPair as Gt, generateRandomBytes32 as W, deriveSymKey as Yt, hashKey as Jt, validateEncoding as Ht, isTypeOneEnvelope as De, encrypt as Xt, validateDecoding as Wt, decrypt as Zt, deserialize as Qt, decodeTypeByte as ei, hashMessage as V, getRelayProtocolName as Z, getRelayProtocolApi as Q, isUndefined as ee, getSdkError as M, formatRelayRpcUrl as ti, isProposalStruct as ii, isSessionStruct as si, TYPE_1 as ri, calcExpiry as te, formatUri as ni, parseUri as ai, createDelayedPromise as oi, engineEvent as ie, isExpired as ye, isValidParams as se, isValidUrl as hi, isValidString as ci, parseExpirerTarget as ui, formatTopicTarget as li, formatIdTarget as di } from \"@walletconnect/utils\";\nimport { ONE_DAY as L, SIX_HOURS as gi, ONE_SECOND as pi, THIRTY_DAYS as re, FIVE_SECONDS as Di, THIRTY_SECONDS as fe, Watch as yi, toMiliseconds as me, FIVE_MINUTES as be } from \"@walletconnect/time\";\nimport { JsonRpcProvider as fi } from \"@walletconnect/jsonrpc-provider\";\nimport { isJsonRpcRequest as Ee, formatJsonRpcResult as ve, formatJsonRpcRequest as we, formatJsonRpcError as mi, isJsonRpcResult as bi, isJsonRpcError as _e, isJsonRpcResponse as Ei } from \"@walletconnect/jsonrpc-utils\";\nimport vi from \"@walletconnect/jsonrpc-ws-connection\";\nimport wi from \"lodash.isequal\";\nfunction p() {\n  this._events = this._events || {}, this._maxListeners = this._maxListeners || void 0;\n}\nvar z = p;\np.EventEmitter = p, p.prototype._events = void 0, p.prototype._maxListeners = void 0, p.defaultMaxListeners = 10, p.prototype.setMaxListeners = function (r) {\n  if (!_i(r) || r < 0 || isNaN(r)) throw TypeError(\"n must be a positive number\");\n  return this._maxListeners = r, this;\n}, p.prototype.emit = function (r) {\n  var e, t, i, s, n, a;\n  if (this._events || (this._events = {}), r === \"error\" && (!this._events.error || $(this._events.error) && !this._events.error.length)) {\n    if (e = arguments[1], e instanceof Error) throw e;\n    var o = new Error('Uncaught, unspecified \"error\" event. (' + e + \")\");\n    throw o.context = e, o;\n  }\n  if (t = this._events[r], Ie(t)) return !1;\n  if (T(t)) switch (arguments.length) {\n    case 1:\n      t.call(this);\n      break;\n    case 2:\n      t.call(this, arguments[1]);\n      break;\n    case 3:\n      t.call(this, arguments[1], arguments[2]);\n      break;\n    default:\n      s = Array.prototype.slice.call(arguments, 1), t.apply(this, s);\n  } else if ($(t)) for (s = Array.prototype.slice.call(arguments, 1), a = t.slice(), i = a.length, n = 0; n < i; n++) {\n    a[n].apply(this, s);\n  }\n  return !0;\n}, p.prototype.addListener = function (r, e) {\n  var t;\n  if (!T(e)) throw TypeError(\"listener must be a function\");\n  return this._events || (this._events = {}), this._events.newListener && this.emit(\"newListener\", r, T(e.listener) ? e.listener : e), this._events[r] ? $(this._events[r]) ? this._events[r].push(e) : this._events[r] = [this._events[r], e] : this._events[r] = e, $(this._events[r]) && !this._events[r].warned && (Ie(this._maxListeners) ? t = p.defaultMaxListeners : t = this._maxListeners, t && t > 0 && this._events[r].length > t && (this._events[r].warned = !0, console.error(\"(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.\", this._events[r].length), typeof console.trace == \"function\" && console.trace())), this;\n}, p.prototype.on = p.prototype.addListener, p.prototype.once = function (r, e) {\n  if (!T(e)) throw TypeError(\"listener must be a function\");\n  var t = !1;\n  function i() {\n    this.removeListener(r, i), t || (t = !0, e.apply(this, arguments));\n  }\n  return i.listener = e, this.on(r, i), this;\n}, p.prototype.removeListener = function (r, e) {\n  var t, i, s, n;\n  if (!T(e)) throw TypeError(\"listener must be a function\");\n  if (!this._events || !this._events[r]) return this;\n  if (t = this._events[r], s = t.length, i = -1, t === e || T(t.listener) && t.listener === e) delete this._events[r], this._events.removeListener && this.emit(\"removeListener\", r, e);else if ($(t)) {\n    for (n = s; n-- > 0;) {\n      if (t[n] === e || t[n].listener && t[n].listener === e) {\n        i = n;\n        break;\n      }\n    }\n    if (i < 0) return this;\n    t.length === 1 ? (t.length = 0, delete this._events[r]) : t.splice(i, 1), this._events.removeListener && this.emit(\"removeListener\", r, e);\n  }\n  return this;\n}, p.prototype.removeAllListeners = function (r) {\n  var e, t;\n  if (!this._events) return this;\n  if (!this._events.removeListener) return arguments.length === 0 ? this._events = {} : this._events[r] && delete this._events[r], this;\n  if (arguments.length === 0) {\n    for (e in this._events) {\n      e !== \"removeListener\" && this.removeAllListeners(e);\n    }\n    return this.removeAllListeners(\"removeListener\"), this._events = {}, this;\n  }\n  if (t = this._events[r], T(t)) this.removeListener(r, t);else if (t) for (; t.length;) {\n    this.removeListener(r, t[t.length - 1]);\n  }\n  return delete this._events[r], this;\n}, p.prototype.listeners = function (r) {\n  var e;\n  return !this._events || !this._events[r] ? e = [] : T(this._events[r]) ? e = [this._events[r]] : e = this._events[r].slice(), e;\n}, p.prototype.listenerCount = function (r) {\n  if (this._events) {\n    var e = this._events[r];\n    if (T(e)) return 1;\n    if (e) return e.length;\n  }\n  return 0;\n}, p.listenerCount = function (r, e) {\n  return r.listenerCount(e);\n};\nfunction T(r) {\n  return typeof r == \"function\";\n}\nfunction _i(r) {\n  return typeof r == \"number\";\n}\nfunction $(r) {\n  return typeof r == \"object\" && r !== null;\n}\nfunction Ie(r) {\n  return r === void 0;\n}\nfunction Ii(r, e) {\n  if (r.length >= 255) throw new TypeError(\"Alphabet too long\");\n  for (var t = new Uint8Array(256), i = 0; i < t.length; i++) {\n    t[i] = 255;\n  }\n  for (var s = 0; s < r.length; s++) {\n    var n = r.charAt(s),\n      a = n.charCodeAt(0);\n    if (t[a] !== 255) throw new TypeError(n + \" is ambiguous\");\n    t[a] = s;\n  }\n  var o = r.length,\n    h = r.charAt(0),\n    l = Math.log(o) / Math.log(256),\n    d = Math.log(256) / Math.log(o);\n  function g(u) {\n    if (u instanceof Uint8Array || (ArrayBuffer.isView(u) ? u = new Uint8Array(u.buffer, u.byteOffset, u.byteLength) : Array.isArray(u) && (u = Uint8Array.from(u))), !(u instanceof Uint8Array)) throw new TypeError(\"Expected Uint8Array\");\n    if (u.length === 0) return \"\";\n    for (var y = 0, A = 0, b = 0, I = u.length; b !== I && u[b] === 0;) {\n      b++, y++;\n    }\n    for (var C = (I - b) * d + 1 >>> 0, f = new Uint8Array(C); b !== I;) {\n      for (var R = u[b], P = 0, E = C - 1; (R !== 0 || P < A) && E !== -1; E--, P++) {\n        R += 256 * f[E] >>> 0, f[E] = R % o >>> 0, R = R / o >>> 0;\n      }\n      if (R !== 0) throw new Error(\"Non-zero carry\");\n      A = P, b++;\n    }\n    for (var S = C - A; S !== C && f[S] === 0;) {\n      S++;\n    }\n    for (var B = h.repeat(y); S < C; ++S) {\n      B += r.charAt(f[S]);\n    }\n    return B;\n  }\n  function k(u) {\n    if (typeof u != \"string\") throw new TypeError(\"Expected String\");\n    if (u.length === 0) return new Uint8Array();\n    var y = 0;\n    if (u[y] !== \" \") {\n      for (var A = 0, b = 0; u[y] === h;) {\n        A++, y++;\n      }\n      for (var I = (u.length - y) * l + 1 >>> 0, C = new Uint8Array(I); u[y];) {\n        var f = t[u.charCodeAt(y)];\n        if (f === 255) return;\n        for (var R = 0, P = I - 1; (f !== 0 || R < b) && P !== -1; P--, R++) {\n          f += o * C[P] >>> 0, C[P] = f % 256 >>> 0, f = f / 256 >>> 0;\n        }\n        if (f !== 0) throw new Error(\"Non-zero carry\");\n        b = R, y++;\n      }\n      if (u[y] !== \" \") {\n        for (var E = I - b; E !== I && C[E] === 0;) {\n          E++;\n        }\n        for (var S = new Uint8Array(A + (I - E)), B = A; E !== I;) {\n          S[B++] = C[E++];\n        }\n        return S;\n      }\n    }\n  }\n  function H(u) {\n    var y = k(u);\n    if (y) return y;\n    throw new Error(\"Non-\".concat(e, \" character\"));\n  }\n  return {\n    encode: g,\n    decodeUnsafe: k,\n    decode: H\n  };\n}\nvar Ci = Ii,\n  Ri = Ci;\nvar Ce = function Ce(r) {\n    if (r instanceof Uint8Array && r.constructor.name === \"Uint8Array\") return r;\n    if (r instanceof ArrayBuffer) return new Uint8Array(r);\n    if (ArrayBuffer.isView(r)) return new Uint8Array(r.buffer, r.byteOffset, r.byteLength);\n    throw new Error(\"Unknown type, must be binary type\");\n  },\n  Si = function Si(r) {\n    return new TextEncoder().encode(r);\n  },\n  Ti = function Ti(r) {\n    return new TextDecoder().decode(r);\n  };\nvar xi = /*#__PURE__*/function () {\n  function xi(e, t, i) {\n    _classCallCheck(this, xi);\n    this.name = e, this.prefix = t, this.baseEncode = i;\n  }\n  _createClass(xi, [{\n    key: \"encode\",\n    value: function encode(e) {\n      if (e instanceof Uint8Array) return \"\".concat(this.prefix).concat(this.baseEncode(e));\n      throw Error(\"Unknown type, must be binary type\");\n    }\n  }]);\n  return xi;\n}();\nvar Pi = /*#__PURE__*/function () {\n  function Pi(e, t, i) {\n    _classCallCheck(this, Pi);\n    if (this.name = e, this.prefix = t, t.codePointAt(0) === void 0) throw new Error(\"Invalid prefix character\");\n    this.prefixCodePoint = t.codePointAt(0), this.baseDecode = i;\n  }\n  _createClass(Pi, [{\n    key: \"decode\",\n    value: function decode(e) {\n      if (typeof e == \"string\") {\n        if (e.codePointAt(0) !== this.prefixCodePoint) throw Error(\"Unable to decode multibase string \".concat(JSON.stringify(e), \", \").concat(this.name, \" decoder only supports inputs prefixed with \").concat(this.prefix));\n        return this.baseDecode(e.slice(this.prefix.length));\n      } else throw Error(\"Can only multibase decode strings\");\n    }\n  }, {\n    key: \"or\",\n    value: function or(e) {\n      return Re(this, e);\n    }\n  }]);\n  return Pi;\n}();\nvar Oi = /*#__PURE__*/function () {\n  function Oi(e) {\n    _classCallCheck(this, Oi);\n    this.decoders = e;\n  }\n  _createClass(Oi, [{\n    key: \"or\",\n    value: function or(e) {\n      return Re(this, e);\n    }\n  }, {\n    key: \"decode\",\n    value: function decode(e) {\n      var t = e[0],\n        i = this.decoders[t];\n      if (i) return i.decode(e);\n      throw RangeError(\"Unable to decode multibase string \".concat(JSON.stringify(e), \", only inputs prefixed with \").concat(Object.keys(this.decoders), \" are supported\"));\n    }\n  }]);\n  return Oi;\n}();\nvar Re = function Re(r, e) {\n  return new Oi(_objectSpread(_objectSpread({}, r.decoders || _defineProperty({}, r.prefix, r)), e.decoders || _defineProperty({}, e.prefix, e)));\n};\nvar Ai = /*#__PURE__*/function () {\n  function Ai(e, t, i, s) {\n    _classCallCheck(this, Ai);\n    this.name = e, this.prefix = t, this.baseEncode = i, this.baseDecode = s, this.encoder = new xi(e, t, i), this.decoder = new Pi(e, t, s);\n  }\n  _createClass(Ai, [{\n    key: \"encode\",\n    value: function encode(e) {\n      return this.encoder.encode(e);\n    }\n  }, {\n    key: \"decode\",\n    value: function decode(e) {\n      return this.decoder.decode(e);\n    }\n  }]);\n  return Ai;\n}();\nvar q = function q(_ref3) {\n    var r = _ref3.name,\n      e = _ref3.prefix,\n      t = _ref3.encode,\n      i = _ref3.decode;\n    return new Ai(r, e, t, i);\n  },\n  K = function K(_ref4) {\n    var r = _ref4.prefix,\n      e = _ref4.name,\n      t = _ref4.alphabet;\n    var _Ri = Ri(t, e),\n      i = _Ri.encode,\n      s = _Ri.decode;\n    return q({\n      prefix: r,\n      name: e,\n      encode: i,\n      decode: function decode(n) {\n        return Ce(s(n));\n      }\n    });\n  },\n  zi = function zi(r, e, t, i) {\n    var s = {};\n    for (var d = 0; d < e.length; ++d) {\n      s[e[d]] = d;\n    }\n    var n = r.length;\n    for (; r[n - 1] === \"=\";) {\n      --n;\n    }\n    var a = new Uint8Array(n * t / 8 | 0);\n    var o = 0,\n      h = 0,\n      l = 0;\n    for (var _d = 0; _d < n; ++_d) {\n      var g = s[r[_d]];\n      if (g === void 0) throw new SyntaxError(\"Non-\".concat(i, \" character\"));\n      h = h << t | g, o += t, o >= 8 && (o -= 8, a[l++] = 255 & h >> o);\n    }\n    if (o >= t || 255 & h << 8 - o) throw new SyntaxError(\"Unexpected end of data\");\n    return a;\n  },\n  Ni = function Ni(r, e, t) {\n    var i = e[e.length - 1] === \"=\",\n      s = (1 << t) - 1;\n    var n = \"\",\n      a = 0,\n      o = 0;\n    for (var h = 0; h < r.length; ++h) {\n      for (o = o << 8 | r[h], a += 8; a > t;) {\n        a -= t, n += e[s & o >> a];\n      }\n    }\n    if (a && (n += e[s & o << t - a]), i) for (; n.length * t & 7;) {\n      n += \"=\";\n    }\n    return n;\n  },\n  D = function D(_ref5) {\n    var r = _ref5.name,\n      e = _ref5.prefix,\n      t = _ref5.bitsPerChar,\n      i = _ref5.alphabet;\n    return q({\n      prefix: e,\n      name: r,\n      encode: function encode(s) {\n        return Ni(s, i, t);\n      },\n      decode: function decode(s) {\n        return zi(s, i, t, r);\n      }\n    });\n  },\n  Li = q({\n    prefix: \"\\0\",\n    name: \"identity\",\n    encode: function encode(r) {\n      return Ti(r);\n    },\n    decode: function decode(r) {\n      return Si(r);\n    }\n  });\nvar Ui = Object.freeze({\n  __proto__: null,\n  identity: Li\n});\nvar Fi = D({\n  prefix: \"0\",\n  name: \"base2\",\n  alphabet: \"01\",\n  bitsPerChar: 1\n});\nvar Mi = Object.freeze({\n  __proto__: null,\n  base2: Fi\n});\nvar $i = D({\n  prefix: \"7\",\n  name: \"base8\",\n  alphabet: \"01234567\",\n  bitsPerChar: 3\n});\nvar Ki = Object.freeze({\n  __proto__: null,\n  base8: $i\n});\nvar ki = K({\n  prefix: \"9\",\n  name: \"base10\",\n  alphabet: \"0123456789\"\n});\nvar Bi = Object.freeze({\n  __proto__: null,\n  base10: ki\n});\nvar ji = D({\n    prefix: \"f\",\n    name: \"base16\",\n    alphabet: \"0123456789abcdef\",\n    bitsPerChar: 4\n  }),\n  Vi = D({\n    prefix: \"F\",\n    name: \"base16upper\",\n    alphabet: \"0123456789ABCDEF\",\n    bitsPerChar: 4\n  });\nvar qi = Object.freeze({\n  __proto__: null,\n  base16: ji,\n  base16upper: Vi\n});\nvar Gi = D({\n    prefix: \"b\",\n    name: \"base32\",\n    alphabet: \"abcdefghijklmnopqrstuvwxyz234567\",\n    bitsPerChar: 5\n  }),\n  Yi = D({\n    prefix: \"B\",\n    name: \"base32upper\",\n    alphabet: \"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567\",\n    bitsPerChar: 5\n  }),\n  Ji = D({\n    prefix: \"c\",\n    name: \"base32pad\",\n    alphabet: \"abcdefghijklmnopqrstuvwxyz234567=\",\n    bitsPerChar: 5\n  }),\n  Hi = D({\n    prefix: \"C\",\n    name: \"base32padupper\",\n    alphabet: \"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=\",\n    bitsPerChar: 5\n  }),\n  Xi = D({\n    prefix: \"v\",\n    name: \"base32hex\",\n    alphabet: \"0123456789abcdefghijklmnopqrstuv\",\n    bitsPerChar: 5\n  }),\n  Wi = D({\n    prefix: \"V\",\n    name: \"base32hexupper\",\n    alphabet: \"0123456789ABCDEFGHIJKLMNOPQRSTUV\",\n    bitsPerChar: 5\n  }),\n  Zi = D({\n    prefix: \"t\",\n    name: \"base32hexpad\",\n    alphabet: \"0123456789abcdefghijklmnopqrstuv=\",\n    bitsPerChar: 5\n  }),\n  Qi = D({\n    prefix: \"T\",\n    name: \"base32hexpadupper\",\n    alphabet: \"0123456789ABCDEFGHIJKLMNOPQRSTUV=\",\n    bitsPerChar: 5\n  }),\n  es = D({\n    prefix: \"h\",\n    name: \"base32z\",\n    alphabet: \"ybndrfg8ejkmcpqxot1uwisza345h769\",\n    bitsPerChar: 5\n  });\nvar ts = Object.freeze({\n  __proto__: null,\n  base32: Gi,\n  base32upper: Yi,\n  base32pad: Ji,\n  base32padupper: Hi,\n  base32hex: Xi,\n  base32hexupper: Wi,\n  base32hexpad: Zi,\n  base32hexpadupper: Qi,\n  base32z: es\n});\nvar is = K({\n    prefix: \"k\",\n    name: \"base36\",\n    alphabet: \"0123456789abcdefghijklmnopqrstuvwxyz\"\n  }),\n  ss = K({\n    prefix: \"K\",\n    name: \"base36upper\",\n    alphabet: \"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n  });\nvar rs = Object.freeze({\n  __proto__: null,\n  base36: is,\n  base36upper: ss\n});\nvar ns = K({\n    name: \"base58btc\",\n    prefix: \"z\",\n    alphabet: \"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz\"\n  }),\n  as = K({\n    name: \"base58flickr\",\n    prefix: \"Z\",\n    alphabet: \"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ\"\n  });\nvar os = Object.freeze({\n  __proto__: null,\n  base58btc: ns,\n  base58flickr: as\n});\nvar hs = D({\n    prefix: \"m\",\n    name: \"base64\",\n    alphabet: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",\n    bitsPerChar: 6\n  }),\n  cs = D({\n    prefix: \"M\",\n    name: \"base64pad\",\n    alphabet: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n    bitsPerChar: 6\n  }),\n  us = D({\n    prefix: \"u\",\n    name: \"base64url\",\n    alphabet: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_\",\n    bitsPerChar: 6\n  }),\n  ls = D({\n    prefix: \"U\",\n    name: \"base64urlpad\",\n    alphabet: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=\",\n    bitsPerChar: 6\n  });\nvar ds = Object.freeze({\n  __proto__: null,\n  base64: hs,\n  base64pad: cs,\n  base64url: us,\n  base64urlpad: ls\n});\nvar Se = Array.from(\"\\uD83D\\uDE80\\uD83E\\uDE90\\u2604\\uD83D\\uDEF0\\uD83C\\uDF0C\\uD83C\\uDF11\\uD83C\\uDF12\\uD83C\\uDF13\\uD83C\\uDF14\\uD83C\\uDF15\\uD83C\\uDF16\\uD83C\\uDF17\\uD83C\\uDF18\\uD83C\\uDF0D\\uD83C\\uDF0F\\uD83C\\uDF0E\\uD83D\\uDC09\\u2600\\uD83D\\uDCBB\\uD83D\\uDDA5\\uD83D\\uDCBE\\uD83D\\uDCBF\\uD83D\\uDE02\\u2764\\uD83D\\uDE0D\\uD83E\\uDD23\\uD83D\\uDE0A\\uD83D\\uDE4F\\uD83D\\uDC95\\uD83D\\uDE2D\\uD83D\\uDE18\\uD83D\\uDC4D\\uD83D\\uDE05\\uD83D\\uDC4F\\uD83D\\uDE01\\uD83D\\uDD25\\uD83E\\uDD70\\uD83D\\uDC94\\uD83D\\uDC96\\uD83D\\uDC99\\uD83D\\uDE22\\uD83E\\uDD14\\uD83D\\uDE06\\uD83D\\uDE44\\uD83D\\uDCAA\\uD83D\\uDE09\\u263A\\uD83D\\uDC4C\\uD83E\\uDD17\\uD83D\\uDC9C\\uD83D\\uDE14\\uD83D\\uDE0E\\uD83D\\uDE07\\uD83C\\uDF39\\uD83E\\uDD26\\uD83C\\uDF89\\uD83D\\uDC9E\\u270C\\u2728\\uD83E\\uDD37\\uD83D\\uDE31\\uD83D\\uDE0C\\uD83C\\uDF38\\uD83D\\uDE4C\\uD83D\\uDE0B\\uD83D\\uDC97\\uD83D\\uDC9A\\uD83D\\uDE0F\\uD83D\\uDC9B\\uD83D\\uDE42\\uD83D\\uDC93\\uD83E\\uDD29\\uD83D\\uDE04\\uD83D\\uDE00\\uD83D\\uDDA4\\uD83D\\uDE03\\uD83D\\uDCAF\\uD83D\\uDE48\\uD83D\\uDC47\\uD83C\\uDFB6\\uD83D\\uDE12\\uD83E\\uDD2D\\u2763\\uD83D\\uDE1C\\uD83D\\uDC8B\\uD83D\\uDC40\\uD83D\\uDE2A\\uD83D\\uDE11\\uD83D\\uDCA5\\uD83D\\uDE4B\\uD83D\\uDE1E\\uD83D\\uDE29\\uD83D\\uDE21\\uD83E\\uDD2A\\uD83D\\uDC4A\\uD83E\\uDD73\\uD83D\\uDE25\\uD83E\\uDD24\\uD83D\\uDC49\\uD83D\\uDC83\\uD83D\\uDE33\\u270B\\uD83D\\uDE1A\\uD83D\\uDE1D\\uD83D\\uDE34\\uD83C\\uDF1F\\uD83D\\uDE2C\\uD83D\\uDE43\\uD83C\\uDF40\\uD83C\\uDF37\\uD83D\\uDE3B\\uD83D\\uDE13\\u2B50\\u2705\\uD83E\\uDD7A\\uD83C\\uDF08\\uD83D\\uDE08\\uD83E\\uDD18\\uD83D\\uDCA6\\u2714\\uD83D\\uDE23\\uD83C\\uDFC3\\uD83D\\uDC90\\u2639\\uD83C\\uDF8A\\uD83D\\uDC98\\uD83D\\uDE20\\u261D\\uD83D\\uDE15\\uD83C\\uDF3A\\uD83C\\uDF82\\uD83C\\uDF3B\\uD83D\\uDE10\\uD83D\\uDD95\\uD83D\\uDC9D\\uD83D\\uDE4A\\uD83D\\uDE39\\uD83D\\uDDE3\\uD83D\\uDCAB\\uD83D\\uDC80\\uD83D\\uDC51\\uD83C\\uDFB5\\uD83E\\uDD1E\\uD83D\\uDE1B\\uD83D\\uDD34\\uD83D\\uDE24\\uD83C\\uDF3C\\uD83D\\uDE2B\\u26BD\\uD83E\\uDD19\\u2615\\uD83C\\uDFC6\\uD83E\\uDD2B\\uD83D\\uDC48\\uD83D\\uDE2E\\uD83D\\uDE46\\uD83C\\uDF7B\\uD83C\\uDF43\\uD83D\\uDC36\\uD83D\\uDC81\\uD83D\\uDE32\\uD83C\\uDF3F\\uD83E\\uDDE1\\uD83C\\uDF81\\u26A1\\uD83C\\uDF1E\\uD83C\\uDF88\\u274C\\u270A\\uD83D\\uDC4B\\uD83D\\uDE30\\uD83E\\uDD28\\uD83D\\uDE36\\uD83E\\uDD1D\\uD83D\\uDEB6\\uD83D\\uDCB0\\uD83C\\uDF53\\uD83D\\uDCA2\\uD83E\\uDD1F\\uD83D\\uDE41\\uD83D\\uDEA8\\uD83D\\uDCA8\\uD83E\\uDD2C\\u2708\\uD83C\\uDF80\\uD83C\\uDF7A\\uD83E\\uDD13\\uD83D\\uDE19\\uD83D\\uDC9F\\uD83C\\uDF31\\uD83D\\uDE16\\uD83D\\uDC76\\uD83E\\uDD74\\u25B6\\u27A1\\u2753\\uD83D\\uDC8E\\uD83D\\uDCB8\\u2B07\\uD83D\\uDE28\\uD83C\\uDF1A\\uD83E\\uDD8B\\uD83D\\uDE37\\uD83D\\uDD7A\\u26A0\\uD83D\\uDE45\\uD83D\\uDE1F\\uD83D\\uDE35\\uD83D\\uDC4E\\uD83E\\uDD32\\uD83E\\uDD20\\uD83E\\uDD27\\uD83D\\uDCCC\\uD83D\\uDD35\\uD83D\\uDC85\\uD83E\\uDDD0\\uD83D\\uDC3E\\uD83C\\uDF52\\uD83D\\uDE17\\uD83E\\uDD11\\uD83C\\uDF0A\\uD83E\\uDD2F\\uD83D\\uDC37\\u260E\\uD83D\\uDCA7\\uD83D\\uDE2F\\uD83D\\uDC86\\uD83D\\uDC46\\uD83C\\uDFA4\\uD83D\\uDE47\\uD83C\\uDF51\\u2744\\uD83C\\uDF34\\uD83D\\uDCA3\\uD83D\\uDC38\\uD83D\\uDC8C\\uD83D\\uDCCD\\uD83E\\uDD40\\uD83E\\uDD22\\uD83D\\uDC45\\uD83D\\uDCA1\\uD83D\\uDCA9\\uD83D\\uDC50\\uD83D\\uDCF8\\uD83D\\uDC7B\\uD83E\\uDD10\\uD83E\\uDD2E\\uD83C\\uDFBC\\uD83E\\uDD75\\uD83D\\uDEA9\\uD83C\\uDF4E\\uD83C\\uDF4A\\uD83D\\uDC7C\\uD83D\\uDC8D\\uD83D\\uDCE3\\uD83E\\uDD42\"),\n  gs = Se.reduce(function (r, e, t) {\n    return r[t] = e, r;\n  }, []),\n  ps = Se.reduce(function (r, e, t) {\n    return r[e.codePointAt(0)] = t, r;\n  }, []);\nfunction Ds(r) {\n  return r.reduce(function (e, t) {\n    return e += gs[t], e;\n  }, \"\");\n}\nfunction ys(r) {\n  var e = [];\n  var _iterator = _createForOfIteratorHelper(r),\n    _step;\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var t = _step.value;\n      var i = ps[t.codePointAt(0)];\n      if (i === void 0) throw new Error(\"Non-base256emoji character: \".concat(t));\n      e.push(i);\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n  return new Uint8Array(e);\n}\nvar fs = q({\n  prefix: \"\\uD83D\\uDE80\",\n  name: \"base256emoji\",\n  encode: Ds,\n  decode: ys\n});\nvar ms = Object.freeze({\n    __proto__: null,\n    base256emoji: fs\n  }),\n  bs = xe,\n  Te = 128,\n  Es = 127,\n  vs = ~Es,\n  ws = Math.pow(2, 31);\nfunction xe(r, e, t) {\n  e = e || [], t = t || 0;\n  for (var i = t; r >= ws;) {\n    e[t++] = r & 255 | Te, r /= 128;\n  }\n  for (; r & vs;) {\n    e[t++] = r & 255 | Te, r >>>= 7;\n  }\n  return e[t] = r | 0, xe.bytes = t - i + 1, e;\n}\nvar _s = ne,\n  Is = 128,\n  Pe = 127;\nfunction ne(r, i) {\n  var t = 0,\n    i = i || 0,\n    s = 0,\n    n = i,\n    a,\n    o = r.length;\n  do {\n    if (n >= o) throw ne.bytes = 0, new RangeError(\"Could not decode varint\");\n    a = r[n++], t += s < 28 ? (a & Pe) << s : (a & Pe) * Math.pow(2, s), s += 7;\n  } while (a >= Is);\n  return ne.bytes = n - i, t;\n}\nvar Cs = Math.pow(2, 7),\n  Rs = Math.pow(2, 14),\n  Ss = Math.pow(2, 21),\n  Ts = Math.pow(2, 28),\n  xs = Math.pow(2, 35),\n  Ps = Math.pow(2, 42),\n  Os = Math.pow(2, 49),\n  As = Math.pow(2, 56),\n  zs = Math.pow(2, 63),\n  Ns = function Ns(r) {\n    return r < Cs ? 1 : r < Rs ? 2 : r < Ss ? 3 : r < Ts ? 4 : r < xs ? 5 : r < Ps ? 6 : r < Os ? 7 : r < As ? 8 : r < zs ? 9 : 10;\n  },\n  Ls = {\n    encode: bs,\n    decode: _s,\n    encodingLength: Ns\n  },\n  Oe = Ls;\nvar Ae = function Ae(r, e) {\n    var t = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    return Oe.encode(r, e, t), e;\n  },\n  ze = function ze(r) {\n    return Oe.encodingLength(r);\n  },\n  ae = function ae(r, e) {\n    var t = e.byteLength,\n      i = ze(r),\n      s = i + ze(t),\n      n = new Uint8Array(s + t);\n    return Ae(r, n, 0), Ae(t, n, i), n.set(e, s), new Us(r, t, e, n);\n  };\nvar Us = /*#__PURE__*/_createClass(function Us(e, t, i, s) {\n  _classCallCheck(this, Us);\n  this.code = e, this.size = t, this.digest = i, this.bytes = s;\n});\nvar Ne = function Ne(_ref6) {\n  var r = _ref6.name,\n    e = _ref6.code,\n    t = _ref6.encode;\n  return new Fs(r, e, t);\n};\nvar Fs = /*#__PURE__*/function () {\n  function Fs(e, t, i) {\n    _classCallCheck(this, Fs);\n    this.name = e, this.code = t, this.encode = i;\n  }\n  _createClass(Fs, [{\n    key: \"digest\",\n    value: function digest(e) {\n      var _this = this;\n      if (e instanceof Uint8Array) {\n        var t = this.encode(e);\n        return t instanceof Uint8Array ? ae(this.code, t) : t.then(function (i) {\n          return ae(_this.code, i);\n        });\n      } else throw Error(\"Unknown type, must be binary type\");\n    }\n  }]);\n  return Fs;\n}();\nvar Le = function Le(r) {\n    return /*#__PURE__*/function () {\n      var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(e) {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.t0 = Uint8Array;\n                _context.next = 3;\n                return crypto.subtle.digest(r, e);\n              case 3:\n                _context.t1 = _context.sent;\n                return _context.abrupt(\"return\", new _context.t0(_context.t1));\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return function (_x) {\n        return _ref7.apply(this, arguments);\n      };\n    }();\n  },\n  Ms = Ne({\n    name: \"sha2-256\",\n    code: 18,\n    encode: Le(\"SHA-256\")\n  }),\n  $s = Ne({\n    name: \"sha2-512\",\n    code: 19,\n    encode: Le(\"SHA-512\")\n  });\nvar Ks = Object.freeze({\n  __proto__: null,\n  sha256: Ms,\n  sha512: $s\n});\nvar Ue = 0,\n  ks = \"identity\",\n  Fe = Ce,\n  Bs = function Bs(r) {\n    return ae(Ue, Fe(r));\n  },\n  js = {\n    code: Ue,\n    name: ks,\n    encode: Fe,\n    digest: Bs\n  };\nvar Vs = Object.freeze({\n  __proto__: null,\n  identity: js\n});\nnew TextEncoder(), new TextDecoder();\nvar Me = _objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({}, Ui), Mi), Ki), Bi), qi), ts), rs), os), ds), ms);\n_objectSpread(_objectSpread({}, Ks), Vs);\nfunction qs() {\n  var r = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n  return globalThis.Buffer != null && globalThis.Buffer.allocUnsafe != null ? globalThis.Buffer.allocUnsafe(r) : new Uint8Array(r);\n}\nfunction $e(r, e, t, i) {\n  return {\n    name: r,\n    prefix: e,\n    encoder: {\n      name: r,\n      prefix: e,\n      encode: t\n    },\n    decoder: {\n      decode: i\n    }\n  };\n}\nvar Ke = $e(\"utf8\", \"u\", function (r) {\n    var e = new TextDecoder(\"utf8\");\n    return \"u\" + e.decode(r);\n  }, function (r) {\n    return new TextEncoder().encode(r.substring(1));\n  }),\n  oe = $e(\"ascii\", \"a\", function (r) {\n    var e = \"a\";\n    for (var t = 0; t < r.length; t++) {\n      e += String.fromCharCode(r[t]);\n    }\n    return e;\n  }, function (r) {\n    r = r.substring(1);\n    var e = qs(r.length);\n    for (var t = 0; t < r.length; t++) {\n      e[t] = r.charCodeAt(t);\n    }\n    return e;\n  }),\n  Gs = _objectSpread({\n    utf8: Ke,\n    \"utf-8\": Ke,\n    hex: Me.base16,\n    latin1: oe,\n    ascii: oe,\n    binary: oe\n  }, Me);\nfunction Ys(r) {\n  var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"utf8\";\n  var t = Gs[e];\n  if (!t) throw new Error(\"Unsupported encoding \\\"\".concat(e, \"\\\"\"));\n  return (e === \"utf8\" || e === \"utf-8\") && globalThis.Buffer != null && globalThis.Buffer.from != null ? globalThis.Buffer.from(r, \"utf8\") : t.decoder.decode(\"\".concat(t.prefix).concat(r));\n}\nvar he = \"wc\",\n  ke = 2,\n  G = \"core\",\n  x = \"\".concat(he, \"@\", 2, \":\").concat(G, \":\"),\n  Be = {\n    name: G,\n    logger: \"error\"\n  },\n  je = {\n    database: \":memory:\"\n  },\n  Ve = \"crypto\",\n  ce = \"client_ed25519_seed\",\n  qe = L,\n  Ge = \"keychain\",\n  Ye = \"0.3\",\n  Je = \"messages\",\n  He = \"0.3\",\n  Xe = gi,\n  We = \"publisher\",\n  Ze = \"irn\",\n  Qe = \"error\",\n  et = \"wss://relay.walletconnect.com\",\n  tt = \"relayer\",\n  U = {\n    message: \"relayer_message\",\n    connect: \"relayer_connect\",\n    disconnect: \"relayer_disconnect\",\n    error: \"relayer_error\"\n  },\n  it = \"_subscription\",\n  N = {\n    payload: \"payload\",\n    connect: \"connect\",\n    disconnect: \"disconnect\",\n    error: \"error\"\n  },\n  st = pi,\n  Js = {\n    database: \":memory:\"\n  },\n  rt = \"2.0.0\",\n  nt = \"0.3\",\n  O = {\n    created: \"subscription_created\",\n    deleted: \"subscription_deleted\",\n    expired: \"subscription_expired\",\n    disabled: \"subscription_disabled\",\n    sync: \"subscription_sync\"\n  },\n  Hs = re,\n  at = \"subscription\",\n  ot = \"0.3\",\n  ht = Di * 1e3,\n  ct = \"pairing\",\n  ut = \"0.3\",\n  Xs = re,\n  F = {\n    wc_pairingDelete: {\n      req: {\n        ttl: L,\n        prompt: !1,\n        tag: 1e3\n      },\n      res: {\n        ttl: L,\n        prompt: !1,\n        tag: 1001\n      }\n    },\n    wc_pairingPing: {\n      req: {\n        ttl: fe,\n        prompt: !1,\n        tag: 1002\n      },\n      res: {\n        ttl: fe,\n        prompt: !1,\n        tag: 1003\n      }\n    },\n    unregistered_method: {\n      req: {\n        ttl: L,\n        prompt: !1,\n        tag: 0\n      },\n      res: {\n        ttl: L,\n        prompt: !1,\n        tag: 0\n      }\n    }\n  },\n  _ = {\n    created: \"history_created\",\n    updated: \"history_updated\",\n    deleted: \"history_deleted\",\n    sync: \"history_sync\"\n  },\n  lt = \"history\",\n  dt = \"0.3\",\n  gt = \"expirer\",\n  m = {\n    created: \"expirer_created\",\n    deleted: \"expirer_deleted\",\n    expired: \"expirer_expired\",\n    sync: \"expirer_sync\"\n  },\n  pt = \"0.3\",\n  Ws = L;\nvar Dt = /*#__PURE__*/function () {\n  function Dt(e, t) {\n    var _this2 = this;\n    _classCallCheck(this, Dt);\n    this.core = e, this.logger = t, this.keychain = new Map(), this.name = Ge, this.version = Ye, this.initialized = !1, this.storagePrefix = x, this.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n      var i;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (_this2.initialized) {\n                _context2.next = 5;\n                break;\n              }\n              _context2.next = 3;\n              return _this2.getKeyChain();\n            case 3:\n              i = _context2.sent;\n              typeof i < \"u\" && (_this2.keychain = i), _this2.initialized = !0;\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })), this.has = function (i) {\n      return _this2.isInitialized(), _this2.keychain.has(i);\n    }, this.set = /*#__PURE__*/function () {\n      var _ref9 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(i, s) {\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _this2.isInitialized();\n                _this2.keychain.set(i, s);\n                _context3.next = 4;\n                return _this2.persist();\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n      return function (_x2, _x3) {\n        return _ref9.apply(this, arguments);\n      };\n    }(), this.get = function (i) {\n      _this2.isInitialized();\n      var s = _this2.keychain.get(i);\n      if (typeof s > \"u\") {\n        var _c = c(\"NO_MATCHING_KEY\", \"\".concat(_this2.name, \": \").concat(i)),\n          n = _c.message;\n        throw new Error(n);\n      }\n      return s;\n    }, this.del = /*#__PURE__*/function () {\n      var _ref10 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(i) {\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _this2.isInitialized();\n                _this2.keychain.delete(i);\n                _context4.next = 4;\n                return _this2.persist();\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n      return function (_x4) {\n        return _ref10.apply(this, arguments);\n      };\n    }(), this.core = e, this.logger = v(t, this.name);\n  }\n  _createClass(Dt, [{\n    key: \"context\",\n    get: function get() {\n      return w(this.logger);\n    }\n  }, {\n    key: \"storageKey\",\n    get: function get() {\n      return this.storagePrefix + this.version + \"//\" + this.name;\n    }\n  }, {\n    key: \"setKeyChain\",\n    value: function () {\n      var _setKeyChain = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5(e) {\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return this.core.storage.setItem(this.storageKey, ge(e));\n              case 2:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n      function setKeyChain(_x5) {\n        return _setKeyChain.apply(this, arguments);\n      }\n      return setKeyChain;\n    }()\n  }, {\n    key: \"getKeyChain\",\n    value: function () {\n      var _getKeyChain = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n        var e;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.next = 2;\n                return this.core.storage.getItem(this.storageKey);\n              case 2:\n                e = _context6.sent;\n                return _context6.abrupt(\"return\", typeof e < \"u\" ? pe(e) : void 0);\n              case 4:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n      function getKeyChain() {\n        return _getKeyChain.apply(this, arguments);\n      }\n      return getKeyChain;\n    }()\n  }, {\n    key: \"persist\",\n    value: function () {\n      var _persist = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return this.setKeyChain(this.keychain);\n              case 2:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n      function persist() {\n        return _persist.apply(this, arguments);\n      }\n      return persist;\n    }()\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c2 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c2.message;\n        throw new Error(e);\n      }\n    }\n  }]);\n  return Dt;\n}();\nvar yt = /*#__PURE__*/function () {\n  function yt(e, t, i) {\n    var _this3 = this;\n    _classCallCheck(this, yt);\n    this.core = e, this.logger = t, this.name = Ve, this.initialized = !1, this.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8() {\n      return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              _context8.t0 = _this3.initialized;\n              if (_context8.t0) {\n                _context8.next = 5;\n                break;\n              }\n              _context8.next = 4;\n              return _this3.keychain.init();\n            case 4:\n              _this3.initialized = !0;\n            case 5:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee8);\n    })), this.hasKeys = function (s) {\n      return _this3.isInitialized(), _this3.keychain.has(s);\n    }, this.getClientId = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee9() {\n      var s, n;\n      return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n        while (1) {\n          switch (_context9.prev = _context9.next) {\n            case 0:\n              _this3.isInitialized();\n              _context9.next = 3;\n              return _this3.getClientSeed();\n            case 3:\n              s = _context9.sent;\n              n = j.generateKeyPair(s);\n              return _context9.abrupt(\"return\", j.encodeIss(n.publicKey));\n            case 6:\n            case \"end\":\n              return _context9.stop();\n          }\n        }\n      }, _callee9);\n    })), this.generateKeyPair = function () {\n      _this3.isInitialized();\n      var s = Gt();\n      return _this3.setPrivateKey(s.publicKey, s.privateKey);\n    }, this.signJWT = /*#__PURE__*/function () {\n      var _ref13 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee10(s) {\n        var n, a, o, h;\n        return _regeneratorRuntime().wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                _this3.isInitialized();\n                _context10.next = 3;\n                return _this3.getClientSeed();\n              case 3:\n                n = _context10.sent;\n                a = j.generateKeyPair(n);\n                o = W();\n                h = qe;\n                _context10.next = 9;\n                return j.signJWT(o, s, h, a);\n              case 9:\n                return _context10.abrupt(\"return\", _context10.sent);\n              case 10:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10);\n      }));\n      return function (_x6) {\n        return _ref13.apply(this, arguments);\n      };\n    }(), this.generateSharedKey = function (s, n, a) {\n      _this3.isInitialized();\n      var o = _this3.getPrivateKey(s),\n        h = Yt(o, n);\n      return _this3.setSymKey(h, a);\n    }, this.setSymKey = /*#__PURE__*/function () {\n      var _ref14 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee11(s, n) {\n        var a;\n        return _regeneratorRuntime().wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                _this3.isInitialized();\n                a = n || Jt(s);\n                _context11.next = 4;\n                return _this3.keychain.set(a, s);\n              case 4:\n                return _context11.abrupt(\"return\", a);\n              case 5:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11);\n      }));\n      return function (_x7, _x8) {\n        return _ref14.apply(this, arguments);\n      };\n    }(), this.deleteKeyPair = /*#__PURE__*/function () {\n      var _ref15 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee12(s) {\n        return _regeneratorRuntime().wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                _this3.isInitialized();\n                _context12.next = 3;\n                return _this3.keychain.del(s);\n              case 3:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12);\n      }));\n      return function (_x9) {\n        return _ref15.apply(this, arguments);\n      };\n    }(), this.deleteSymKey = /*#__PURE__*/function () {\n      var _ref16 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee13(s) {\n        return _regeneratorRuntime().wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                _this3.isInitialized();\n                _context13.next = 3;\n                return _this3.keychain.del(s);\n              case 3:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13);\n      }));\n      return function (_x10) {\n        return _ref16.apply(this, arguments);\n      };\n    }(), this.encode = /*#__PURE__*/function () {\n      var _ref17 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee14(s, n, a) {\n        var o, h, k, H, l, d, g;\n        return _regeneratorRuntime().wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                _this3.isInitialized();\n                o = Ht(a), h = Vt(n);\n                if (!De(o)) {\n                  _context14.next = 7;\n                  break;\n                }\n                k = o.senderPublicKey, H = o.receiverPublicKey;\n                _context14.next = 6;\n                return _this3.generateSharedKey(k, H);\n              case 6:\n                s = _context14.sent;\n              case 7:\n                l = _this3.getSymKey(s), d = o.type, g = o.senderPublicKey;\n                return _context14.abrupt(\"return\", Xt({\n                  type: d,\n                  symKey: l,\n                  message: h,\n                  senderPublicKey: g\n                }));\n              case 9:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14);\n      }));\n      return function (_x11, _x12, _x13) {\n        return _ref17.apply(this, arguments);\n      };\n    }(), this.decode = /*#__PURE__*/function () {\n      var _ref18 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee15(s, n, a) {\n        var o, d, g, h, l;\n        return _regeneratorRuntime().wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                _this3.isInitialized();\n                o = Wt(n, a);\n                if (!De(o)) {\n                  _context15.next = 7;\n                  break;\n                }\n                d = o.receiverPublicKey, g = o.senderPublicKey;\n                _context15.next = 6;\n                return _this3.generateSharedKey(d, g);\n              case 6:\n                s = _context15.sent;\n              case 7:\n                h = _this3.getSymKey(s), l = Zt({\n                  symKey: h,\n                  encoded: n\n                });\n                return _context15.abrupt(\"return\", qt(l));\n              case 9:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15);\n      }));\n      return function (_x14, _x15, _x16) {\n        return _ref18.apply(this, arguments);\n      };\n    }(), this.core = e, this.logger = v(t, this.name), this.keychain = i || new Dt(this.core, this.logger);\n  }\n  _createClass(yt, [{\n    key: \"context\",\n    get: function get() {\n      return w(this.logger);\n    }\n  }, {\n    key: \"getPayloadType\",\n    value: function getPayloadType(e) {\n      var t = Qt(e);\n      return ei(t.type);\n    }\n  }, {\n    key: \"setPrivateKey\",\n    value: function () {\n      var _setPrivateKey = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee16(e, t) {\n        return _regeneratorRuntime().wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                _context16.next = 2;\n                return this.keychain.set(e, t);\n              case 2:\n                return _context16.abrupt(\"return\", e);\n              case 3:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16, this);\n      }));\n      function setPrivateKey(_x17, _x18) {\n        return _setPrivateKey.apply(this, arguments);\n      }\n      return setPrivateKey;\n    }()\n  }, {\n    key: \"getPrivateKey\",\n    value: function getPrivateKey(e) {\n      return this.keychain.get(e);\n    }\n  }, {\n    key: \"getClientSeed\",\n    value: function () {\n      var _getClientSeed = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee17() {\n        var e;\n        return _regeneratorRuntime().wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                e = \"\";\n                _context17.prev = 1;\n                e = this.keychain.get(ce);\n                _context17.next = 10;\n                break;\n              case 5:\n                _context17.prev = 5;\n                _context17.t0 = _context17[\"catch\"](1);\n                e = W();\n                _context17.next = 10;\n                return this.keychain.set(ce, e);\n              case 10:\n                return _context17.abrupt(\"return\", Ys(e, \"base16\"));\n              case 11:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17, this, [[1, 5]]);\n      }));\n      function getClientSeed() {\n        return _getClientSeed.apply(this, arguments);\n      }\n      return getClientSeed;\n    }()\n  }, {\n    key: \"getSymKey\",\n    value: function getSymKey(e) {\n      return this.keychain.get(e);\n    }\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c3 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c3.message;\n        throw new Error(e);\n      }\n    }\n  }]);\n  return yt;\n}();\nvar ft = /*#__PURE__*/function (_Ut) {\n  _inherits(ft, _Ut);\n  var _super = _createSuper(ft);\n  function ft(e, t) {\n    var _this4;\n    _classCallCheck(this, ft);\n    _this4 = _super.call(this, e, t), _this4.logger = e, _this4.core = t, _this4.messages = new Map(), _this4.name = Je, _this4.version = He, _this4.initialized = !1, _this4.storagePrefix = x, _this4.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee18() {\n      var i;\n      return _regeneratorRuntime().wrap(function _callee18$(_context18) {\n        while (1) {\n          switch (_context18.prev = _context18.next) {\n            case 0:\n              if (_this4.initialized) {\n                _context18.next = 15;\n                break;\n              }\n              _this4.logger.trace(\"Initialized\");\n              _context18.prev = 2;\n              _context18.next = 5;\n              return _this4.getRelayerMessages();\n            case 5:\n              i = _context18.sent;\n              typeof i < \"u\" && (_this4.messages = i), _this4.logger.debug(\"Successfully Restored records for \".concat(_this4.name)), _this4.logger.trace({\n                type: \"method\",\n                method: \"restore\",\n                size: _this4.messages.size\n              });\n              _context18.next = 12;\n              break;\n            case 9:\n              _context18.prev = 9;\n              _context18.t0 = _context18[\"catch\"](2);\n              _this4.logger.debug(\"Failed to Restore records for \".concat(_this4.name)), _this4.logger.error(_context18.t0);\n            case 12:\n              _context18.prev = 12;\n              _this4.initialized = !0;\n              return _context18.finish(12);\n            case 15:\n            case \"end\":\n              return _context18.stop();\n          }\n        }\n      }, _callee18, null, [[2, 9, 12, 15]]);\n    })), _this4.set = /*#__PURE__*/function () {\n      var _ref20 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee19(i, s) {\n        var n, a;\n        return _regeneratorRuntime().wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                _this4.isInitialized();\n                n = V(s);\n                a = _this4.messages.get(i);\n                typeof a > \"u\" && (a = {});\n                _context19.t0 = typeof a[n] < \"u\";\n                if (_context19.t0) {\n                  _context19.next = 10;\n                  break;\n                }\n                a[n] = s;\n                _this4.messages.set(i, a);\n                _context19.next = 10;\n                return _this4.persist();\n              case 10:\n                return _context19.abrupt(\"return\", n);\n              case 11:\n              case \"end\":\n                return _context19.stop();\n            }\n          }\n        }, _callee19);\n      }));\n      return function (_x19, _x20) {\n        return _ref20.apply(this, arguments);\n      };\n    }(), _this4.get = function (i) {\n      _this4.isInitialized();\n      var s = _this4.messages.get(i);\n      return typeof s > \"u\" && (s = {}), s;\n    }, _this4.has = function (i, s) {\n      _this4.isInitialized();\n      var n = _this4.get(i),\n        a = V(s);\n      return typeof n[a] < \"u\";\n    }, _this4.del = /*#__PURE__*/function () {\n      var _ref21 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee20(i) {\n        return _regeneratorRuntime().wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                _this4.isInitialized();\n                _this4.messages.delete(i);\n                _context20.next = 4;\n                return _this4.persist();\n              case 4:\n              case \"end\":\n                return _context20.stop();\n            }\n          }\n        }, _callee20);\n      }));\n      return function (_x21) {\n        return _ref21.apply(this, arguments);\n      };\n    }(), _this4.logger = v(e, _this4.name), _this4.core = t;\n    return _this4;\n  }\n  _createClass(ft, [{\n    key: \"context\",\n    get: function get() {\n      return w(this.logger);\n    }\n  }, {\n    key: \"storageKey\",\n    get: function get() {\n      return this.storagePrefix + this.version + \"//\" + this.name;\n    }\n  }, {\n    key: \"setRelayerMessages\",\n    value: function () {\n      var _setRelayerMessages = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee21(e) {\n        return _regeneratorRuntime().wrap(function _callee21$(_context21) {\n          while (1) {\n            switch (_context21.prev = _context21.next) {\n              case 0:\n                _context21.next = 2;\n                return this.core.storage.setItem(this.storageKey, ge(e));\n              case 2:\n              case \"end\":\n                return _context21.stop();\n            }\n          }\n        }, _callee21, this);\n      }));\n      function setRelayerMessages(_x22) {\n        return _setRelayerMessages.apply(this, arguments);\n      }\n      return setRelayerMessages;\n    }()\n  }, {\n    key: \"getRelayerMessages\",\n    value: function () {\n      var _getRelayerMessages = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee22() {\n        var e;\n        return _regeneratorRuntime().wrap(function _callee22$(_context22) {\n          while (1) {\n            switch (_context22.prev = _context22.next) {\n              case 0:\n                _context22.next = 2;\n                return this.core.storage.getItem(this.storageKey);\n              case 2:\n                e = _context22.sent;\n                return _context22.abrupt(\"return\", typeof e < \"u\" ? pe(e) : void 0);\n              case 4:\n              case \"end\":\n                return _context22.stop();\n            }\n          }\n        }, _callee22, this);\n      }));\n      function getRelayerMessages() {\n        return _getRelayerMessages.apply(this, arguments);\n      }\n      return getRelayerMessages;\n    }()\n  }, {\n    key: \"persist\",\n    value: function () {\n      var _persist2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee23() {\n        return _regeneratorRuntime().wrap(function _callee23$(_context23) {\n          while (1) {\n            switch (_context23.prev = _context23.next) {\n              case 0:\n                _context23.next = 2;\n                return this.setRelayerMessages(this.messages);\n              case 2:\n              case \"end\":\n                return _context23.stop();\n            }\n          }\n        }, _callee23, this);\n      }));\n      function persist() {\n        return _persist2.apply(this, arguments);\n      }\n      return persist;\n    }()\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c4 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c4.message;\n        throw new Error(e);\n      }\n    }\n  }]);\n  return ft;\n}(Ut);\nvar Zs = /*#__PURE__*/function (_Ft) {\n  _inherits(Zs, _Ft);\n  var _super2 = _createSuper(Zs);\n  function Zs(e, t) {\n    var _this5;\n    _classCallCheck(this, Zs);\n    _this5 = _super2.call(this, e, t), _this5.relayer = e, _this5.logger = t, _this5.events = new z.EventEmitter(), _this5.name = We, _this5.queue = new Map(), _this5.publish = /*#__PURE__*/function () {\n      var _ref22 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee24(i, s, n) {\n        var a, o, h, l, d, g;\n        return _regeneratorRuntime().wrap(function _callee24$(_context24) {\n          while (1) {\n            switch (_context24.prev = _context24.next) {\n              case 0:\n                _this5.logger.debug(\"Publishing Payload\"), _this5.logger.trace({\n                  type: \"method\",\n                  method: \"publish\",\n                  params: {\n                    topic: i,\n                    message: s,\n                    opts: n\n                  }\n                });\n                _context24.prev = 1;\n                a = (n === null || n === void 0 ? void 0 : n.ttl) || Xe, o = Z(n), h = (n === null || n === void 0 ? void 0 : n.prompt) || !1, l = (n === null || n === void 0 ? void 0 : n.tag) || 0, d = {\n                  topic: i,\n                  message: s,\n                  opts: {\n                    ttl: a,\n                    relay: o,\n                    prompt: h,\n                    tag: l\n                  }\n                }, g = V(s);\n                _this5.queue.set(g, d);\n                _context24.next = 6;\n                return _this5.rpcPublish(i, s, a, o, h, l);\n              case 6:\n                _this5.onPublish(g, d);\n                _this5.logger.debug(\"Successfully Published Payload\");\n                _this5.logger.trace({\n                  type: \"method\",\n                  method: \"publish\",\n                  params: {\n                    topic: i,\n                    message: s,\n                    opts: n\n                  }\n                });\n                _context24.next = 14;\n                break;\n              case 11:\n                _context24.prev = 11;\n                _context24.t0 = _context24[\"catch\"](1);\n                throw _this5.logger.debug(\"Failed to Publish Payload\"), _this5.logger.error(_context24.t0), _context24.t0;\n              case 14:\n              case \"end\":\n                return _context24.stop();\n            }\n          }\n        }, _callee24, null, [[1, 11]]);\n      }));\n      return function (_x23, _x24, _x25) {\n        return _ref22.apply(this, arguments);\n      };\n    }(), _this5.on = function (i, s) {\n      _this5.events.on(i, s);\n    }, _this5.once = function (i, s) {\n      _this5.events.once(i, s);\n    }, _this5.off = function (i, s) {\n      _this5.events.off(i, s);\n    }, _this5.removeListener = function (i, s) {\n      _this5.events.removeListener(i, s);\n    }, _this5.relayer = e, _this5.logger = v(t, _this5.name), _this5.registerEventListeners();\n    return _this5;\n  }\n  _createClass(Zs, [{\n    key: \"context\",\n    get: function get() {\n      return w(this.logger);\n    }\n  }, {\n    key: \"rpcPublish\",\n    value: function rpcPublish(e, t, i, s, n, a) {\n      var o, h, l, d;\n      var g = {\n        method: Q(s.protocol).publish,\n        params: {\n          topic: e,\n          message: t,\n          ttl: i,\n          prompt: n,\n          tag: a\n        }\n      };\n      return ee((o = g.params) == null ? void 0 : o.prompt) && ((h = g.params) == null || delete h.prompt), ee((l = g.params) == null ? void 0 : l.tag) && ((d = g.params) == null || delete d.tag), this.logger.debug(\"Outgoing Relay Payload\"), this.logger.trace({\n        type: \"message\",\n        direction: \"outgoing\",\n        request: g\n      }), this.relayer.provider.request(g);\n    }\n  }, {\n    key: \"onPublish\",\n    value: function onPublish(e, t) {\n      this.queue.delete(e);\n    }\n  }, {\n    key: \"checkQueue\",\n    value: function checkQueue() {\n      var _this6 = this;\n      this.queue.forEach( /*#__PURE__*/function () {\n        var _ref23 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee25(e) {\n          var t, i, _e$opts, s, n, a, o, h;\n          return _regeneratorRuntime().wrap(function _callee25$(_context25) {\n            while (1) {\n              switch (_context25.prev = _context25.next) {\n                case 0:\n                  t = e.topic, i = e.message, _e$opts = e.opts, s = _e$opts.ttl, n = _e$opts.relay, a = _e$opts.prompt, o = _e$opts.tag, h = V(i);\n                  _context25.next = 3;\n                  return _this6.rpcPublish(t, i, s, n, a, o);\n                case 3:\n                  _this6.onPublish(h, e);\n                case 4:\n                case \"end\":\n                  return _context25.stop();\n              }\n            }\n          }, _callee25);\n        }));\n        return function (_x26) {\n          return _ref23.apply(this, arguments);\n        };\n      }());\n    }\n  }, {\n    key: \"registerEventListeners\",\n    value: function registerEventListeners() {\n      var _this7 = this;\n      this.relayer.core.heartbeat.on(X.pulse, function () {\n        _this7.checkQueue();\n      });\n    }\n  }]);\n  return Zs;\n}(Ft);\nvar Qs = /*#__PURE__*/function () {\n  function Qs() {\n    var _this8 = this;\n    _classCallCheck(this, Qs);\n    this.map = new Map(), this.set = function (e, t) {\n      var i = _this8.get(e);\n      _this8.exists(e, t) || _this8.map.set(e, [].concat(_toConsumableArray(i), [t]));\n    }, this.get = function (e) {\n      return _this8.map.get(e) || [];\n    }, this.exists = function (e, t) {\n      return _this8.get(e).includes(t);\n    }, this.delete = function (e, t) {\n      if (typeof t > \"u\") {\n        _this8.map.delete(e);\n        return;\n      }\n      if (!_this8.map.has(e)) return;\n      var i = _this8.get(e);\n      if (!_this8.exists(e, t)) return;\n      var s = i.filter(function (n) {\n        return n !== t;\n      });\n      if (!s.length) {\n        _this8.map.delete(e);\n        return;\n      }\n      _this8.map.set(e, s);\n    }, this.clear = function () {\n      _this8.map.clear();\n    };\n  }\n  _createClass(Qs, [{\n    key: \"topics\",\n    get: function get() {\n      return Array.from(this.map.keys());\n    }\n  }]);\n  return Qs;\n}();\nvar er = Object.defineProperty,\n  tr = Object.defineProperties,\n  ir = Object.getOwnPropertyDescriptors,\n  mt = Object.getOwnPropertySymbols,\n  sr = Object.prototype.hasOwnProperty,\n  rr = Object.prototype.propertyIsEnumerable,\n  bt = function bt(r, e, t) {\n    return e in r ? er(r, e, {\n      enumerable: !0,\n      configurable: !0,\n      writable: !0,\n      value: t\n    }) : r[e] = t;\n  },\n  Y = function Y(r, e) {\n    for (var t in e || (e = {})) {\n      sr.call(e, t) && bt(r, t, e[t]);\n    }\n    if (mt) {\n      var _iterator2 = _createForOfIteratorHelper(mt(e)),\n        _step2;\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var t = _step2.value;\n          rr.call(e, t) && bt(r, t, e[t]);\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n    }\n    return r;\n  },\n  ue = function ue(r, e) {\n    return tr(r, ir(e));\n  };\nvar Et = /*#__PURE__*/function (_Mt) {\n  _inherits(Et, _Mt);\n  var _super3 = _createSuper(Et);\n  function Et(e, t) {\n    var _this9;\n    _classCallCheck(this, Et);\n    _this9 = _super3.call(this, e, t), _this9.relayer = e, _this9.logger = t, _this9.subscriptions = new Map(), _this9.topicMap = new Qs(), _this9.events = new z.EventEmitter(), _this9.name = at, _this9.version = ot, _this9.pending = new Map(), _this9.cached = [], _this9.initialized = !1, _this9.pendingSubscriptionWatchLabel = \"pending_sub_watch_label\", _this9.pendingSubInterval = 20, _this9.storagePrefix = x, _this9.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee26() {\n      return _regeneratorRuntime().wrap(function _callee26$(_context26) {\n        while (1) {\n          switch (_context26.prev = _context26.next) {\n            case 0:\n              _context26.t0 = _this9.initialized;\n              if (_context26.t0) {\n                _context26.next = 9;\n                break;\n              }\n              _this9.logger.trace(\"Initialized\");\n              _context26.next = 5;\n              return _this9.restore();\n            case 5:\n              _context26.next = 7;\n              return _this9.reset();\n            case 7:\n              _this9.registerEventListeners();\n              _this9.onEnable();\n            case 9:\n            case \"end\":\n              return _context26.stop();\n          }\n        }\n      }, _callee26);\n    })), _this9.subscribe = /*#__PURE__*/function () {\n      var _ref25 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee27(i, s) {\n        var n, a, o;\n        return _regeneratorRuntime().wrap(function _callee27$(_context27) {\n          while (1) {\n            switch (_context27.prev = _context27.next) {\n              case 0:\n                _this9.isInitialized(), _this9.logger.debug(\"Subscribing Topic\"), _this9.logger.trace({\n                  type: \"method\",\n                  method: \"subscribe\",\n                  params: {\n                    topic: i,\n                    opts: s\n                  }\n                });\n                _context27.prev = 1;\n                n = Z(s), a = {\n                  topic: i,\n                  relay: n\n                };\n                _this9.pending.set(i, a);\n                _context27.next = 6;\n                return _this9.rpcSubscribe(i, n);\n              case 6:\n                o = _context27.sent;\n                return _context27.abrupt(\"return\", (_this9.onSubscribe(o, a), _this9.logger.debug(\"Successfully Subscribed Topic\"), _this9.logger.trace({\n                  type: \"method\",\n                  method: \"subscribe\",\n                  params: {\n                    topic: i,\n                    opts: s\n                  }\n                }), o));\n              case 10:\n                _context27.prev = 10;\n                _context27.t0 = _context27[\"catch\"](1);\n                throw _this9.logger.debug(\"Failed to Subscribe Topic\"), _this9.logger.error(_context27.t0), _context27.t0;\n              case 13:\n              case \"end\":\n                return _context27.stop();\n            }\n          }\n        }, _callee27, null, [[1, 10]]);\n      }));\n      return function (_x27, _x28) {\n        return _ref25.apply(this, arguments);\n      };\n    }(), _this9.unsubscribe = /*#__PURE__*/function () {\n      var _ref26 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee28(i, s) {\n        return _regeneratorRuntime().wrap(function _callee28$(_context28) {\n          while (1) {\n            switch (_context28.prev = _context28.next) {\n              case 0:\n                _this9.isInitialized();\n                if (!(typeof (s === null || s === void 0 ? void 0 : s.id) < \"u\")) {\n                  _context28.next = 6;\n                  break;\n                }\n                _context28.next = 4;\n                return _this9.unsubscribeById(i, s.id, s);\n              case 4:\n                _context28.next = 8;\n                break;\n              case 6:\n                _context28.next = 8;\n                return _this9.unsubscribeByTopic(i, s);\n              case 8:\n              case \"end\":\n                return _context28.stop();\n            }\n          }\n        }, _callee28);\n      }));\n      return function (_x29, _x30) {\n        return _ref26.apply(this, arguments);\n      };\n    }(), _this9.isSubscribed = /*#__PURE__*/function () {\n      var _ref27 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee29(i) {\n        return _regeneratorRuntime().wrap(function _callee29$(_context29) {\n          while (1) {\n            switch (_context29.prev = _context29.next) {\n              case 0:\n                if (!_this9.topics.includes(i)) {\n                  _context29.next = 4;\n                  break;\n                }\n                _context29.t0 = !0;\n                _context29.next = 7;\n                break;\n              case 4:\n                _context29.next = 6;\n                return new Promise(function (s, n) {\n                  var a = new yi();\n                  a.start(_this9.pendingSubscriptionWatchLabel);\n                  var o = setInterval(function () {\n                    !_this9.pending.has(i) && _this9.topics.includes(i) && (clearInterval(o), a.stop(_this9.pendingSubscriptionWatchLabel), s(!0)), a.elapsed(_this9.pendingSubscriptionWatchLabel) >= ht && (clearInterval(o), a.stop(_this9.pendingSubscriptionWatchLabel), n(!1));\n                  }, _this9.pendingSubInterval);\n                });\n              case 6:\n                _context29.t0 = _context29.sent;\n              case 7:\n                return _context29.abrupt(\"return\", _context29.t0);\n              case 8:\n              case \"end\":\n                return _context29.stop();\n            }\n          }\n        }, _callee29);\n      }));\n      return function (_x31) {\n        return _ref27.apply(this, arguments);\n      };\n    }(), _this9.on = function (i, s) {\n      _this9.events.on(i, s);\n    }, _this9.once = function (i, s) {\n      _this9.events.once(i, s);\n    }, _this9.off = function (i, s) {\n      _this9.events.off(i, s);\n    }, _this9.removeListener = function (i, s) {\n      _this9.events.removeListener(i, s);\n    }, _this9.relayer = e, _this9.logger = v(t, _this9.name);\n    return _this9;\n  }\n  _createClass(Et, [{\n    key: \"context\",\n    get: function get() {\n      return w(this.logger);\n    }\n  }, {\n    key: \"storageKey\",\n    get: function get() {\n      return this.storagePrefix + this.version + \"//\" + this.name;\n    }\n  }, {\n    key: \"length\",\n    get: function get() {\n      return this.subscriptions.size;\n    }\n  }, {\n    key: \"ids\",\n    get: function get() {\n      return Array.from(this.subscriptions.keys());\n    }\n  }, {\n    key: \"values\",\n    get: function get() {\n      return Array.from(this.subscriptions.values());\n    }\n  }, {\n    key: \"topics\",\n    get: function get() {\n      return this.topicMap.topics;\n    }\n  }, {\n    key: \"hasSubscription\",\n    value: function hasSubscription(e, t) {\n      var i = !1;\n      try {\n        i = this.getSubscription(e).topic === t;\n      } catch (_unused2) {}\n      return i;\n    }\n  }, {\n    key: \"onEnable\",\n    value: function onEnable() {\n      this.cached = [], this.initialized = !0;\n    }\n  }, {\n    key: \"onDisable\",\n    value: function onDisable() {\n      this.cached = this.values, this.subscriptions.clear(), this.topicMap.clear(), this.initialized = !1;\n    }\n  }, {\n    key: \"unsubscribeByTopic\",\n    value: function () {\n      var _unsubscribeByTopic = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee31(e, t) {\n        var _this10 = this;\n        var i;\n        return _regeneratorRuntime().wrap(function _callee31$(_context31) {\n          while (1) {\n            switch (_context31.prev = _context31.next) {\n              case 0:\n                i = this.topicMap.get(e);\n                _context31.next = 3;\n                return Promise.all(i.map( /*#__PURE__*/function () {\n                  var _ref28 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee30(s) {\n                    return _regeneratorRuntime().wrap(function _callee30$(_context30) {\n                      while (1) {\n                        switch (_context30.prev = _context30.next) {\n                          case 0:\n                            _context30.next = 2;\n                            return _this10.unsubscribeById(e, s, t);\n                          case 2:\n                            return _context30.abrupt(\"return\", _context30.sent);\n                          case 3:\n                          case \"end\":\n                            return _context30.stop();\n                        }\n                      }\n                    }, _callee30);\n                  }));\n                  return function (_x34) {\n                    return _ref28.apply(this, arguments);\n                  };\n                }()));\n              case 3:\n              case \"end\":\n                return _context31.stop();\n            }\n          }\n        }, _callee31, this);\n      }));\n      function unsubscribeByTopic(_x32, _x33) {\n        return _unsubscribeByTopic.apply(this, arguments);\n      }\n      return unsubscribeByTopic;\n    }()\n  }, {\n    key: \"unsubscribeById\",\n    value: function () {\n      var _unsubscribeById = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee32(e, t, i) {\n        var s, n;\n        return _regeneratorRuntime().wrap(function _callee32$(_context32) {\n          while (1) {\n            switch (_context32.prev = _context32.next) {\n              case 0:\n                this.logger.debug(\"Unsubscribing Topic\"), this.logger.trace({\n                  type: \"method\",\n                  method: \"unsubscribe\",\n                  params: {\n                    topic: e,\n                    id: t,\n                    opts: i\n                  }\n                });\n                _context32.prev = 1;\n                s = Z(i);\n                _context32.next = 5;\n                return this.rpcUnsubscribe(e, t, s);\n              case 5:\n                n = M(\"USER_DISCONNECTED\", \"\".concat(this.name, \", \").concat(e));\n                _context32.next = 8;\n                return this.onUnsubscribe(e, t, n);\n              case 8:\n                this.logger.debug(\"Successfully Unsubscribed Topic\");\n                this.logger.trace({\n                  type: \"method\",\n                  method: \"unsubscribe\",\n                  params: {\n                    topic: e,\n                    id: t,\n                    opts: i\n                  }\n                });\n                _context32.next = 15;\n                break;\n              case 12:\n                _context32.prev = 12;\n                _context32.t0 = _context32[\"catch\"](1);\n                throw this.logger.debug(\"Failed to Unsubscribe Topic\"), this.logger.error(_context32.t0), _context32.t0;\n              case 15:\n              case \"end\":\n                return _context32.stop();\n            }\n          }\n        }, _callee32, this, [[1, 12]]);\n      }));\n      function unsubscribeById(_x35, _x36, _x37) {\n        return _unsubscribeById.apply(this, arguments);\n      }\n      return unsubscribeById;\n    }()\n  }, {\n    key: \"rpcSubscribe\",\n    value: function () {\n      var _rpcSubscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee33(e, t) {\n        var i;\n        return _regeneratorRuntime().wrap(function _callee33$(_context33) {\n          while (1) {\n            switch (_context33.prev = _context33.next) {\n              case 0:\n                i = {\n                  method: Q(t.protocol).subscribe,\n                  params: {\n                    topic: e\n                  }\n                };\n                this.logger.debug(\"Outgoing Relay Payload\");\n                this.logger.trace({\n                  type: \"payload\",\n                  direction: \"outgoing\",\n                  request: i\n                });\n                _context33.next = 5;\n                return this.relayer.provider.request(i);\n              case 5:\n                return _context33.abrupt(\"return\", _context33.sent);\n              case 6:\n              case \"end\":\n                return _context33.stop();\n            }\n          }\n        }, _callee33, this);\n      }));\n      function rpcSubscribe(_x38, _x39) {\n        return _rpcSubscribe.apply(this, arguments);\n      }\n      return rpcSubscribe;\n    }()\n  }, {\n    key: \"rpcUnsubscribe\",\n    value: function rpcUnsubscribe(e, t, i) {\n      var s = {\n        method: Q(i.protocol).unsubscribe,\n        params: {\n          topic: e,\n          id: t\n        }\n      };\n      return this.logger.debug(\"Outgoing Relay Payload\"), this.logger.trace({\n        type: \"payload\",\n        direction: \"outgoing\",\n        request: s\n      }), this.relayer.provider.request(s);\n    }\n  }, {\n    key: \"onSubscribe\",\n    value: function onSubscribe(e, t) {\n      this.setSubscription(e, ue(Y({}, t), {\n        id: e\n      })), this.pending.delete(t.topic);\n    }\n  }, {\n    key: \"onResubscribe\",\n    value: function onResubscribe(e, t) {\n      this.addSubscription(e, ue(Y({}, t), {\n        id: e\n      })), this.pending.delete(t.topic);\n    }\n  }, {\n    key: \"onUnsubscribe\",\n    value: function () {\n      var _onUnsubscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee34(e, t, i) {\n        return _regeneratorRuntime().wrap(function _callee34$(_context34) {\n          while (1) {\n            switch (_context34.prev = _context34.next) {\n              case 0:\n                this.events.removeAllListeners(t);\n                this.hasSubscription(t, e) && this.deleteSubscription(t, i);\n                _context34.next = 4;\n                return this.relayer.messages.del(e);\n              case 4:\n              case \"end\":\n                return _context34.stop();\n            }\n          }\n        }, _callee34, this);\n      }));\n      function onUnsubscribe(_x40, _x41, _x42) {\n        return _onUnsubscribe.apply(this, arguments);\n      }\n      return onUnsubscribe;\n    }()\n  }, {\n    key: \"setRelayerSubscriptions\",\n    value: function () {\n      var _setRelayerSubscriptions = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee35(e) {\n        return _regeneratorRuntime().wrap(function _callee35$(_context35) {\n          while (1) {\n            switch (_context35.prev = _context35.next) {\n              case 0:\n                _context35.next = 2;\n                return this.relayer.core.storage.setItem(this.storageKey, e);\n              case 2:\n              case \"end\":\n                return _context35.stop();\n            }\n          }\n        }, _callee35, this);\n      }));\n      function setRelayerSubscriptions(_x43) {\n        return _setRelayerSubscriptions.apply(this, arguments);\n      }\n      return setRelayerSubscriptions;\n    }()\n  }, {\n    key: \"getRelayerSubscriptions\",\n    value: function () {\n      var _getRelayerSubscriptions = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee36() {\n        return _regeneratorRuntime().wrap(function _callee36$(_context36) {\n          while (1) {\n            switch (_context36.prev = _context36.next) {\n              case 0:\n                _context36.next = 2;\n                return this.relayer.core.storage.getItem(this.storageKey);\n              case 2:\n                return _context36.abrupt(\"return\", _context36.sent);\n              case 3:\n              case \"end\":\n                return _context36.stop();\n            }\n          }\n        }, _callee36, this);\n      }));\n      function getRelayerSubscriptions() {\n        return _getRelayerSubscriptions.apply(this, arguments);\n      }\n      return getRelayerSubscriptions;\n    }()\n  }, {\n    key: \"setSubscription\",\n    value: function setSubscription(e, t) {\n      this.subscriptions.has(e) || (this.logger.debug(\"Setting subscription\"), this.logger.trace({\n        type: \"method\",\n        method: \"setSubscription\",\n        id: e,\n        subscription: t\n      }), this.addSubscription(e, t));\n    }\n  }, {\n    key: \"addSubscription\",\n    value: function addSubscription(e, t) {\n      this.subscriptions.set(e, Y({}, t)), this.topicMap.set(t.topic, e), this.events.emit(O.created, t);\n    }\n  }, {\n    key: \"getSubscription\",\n    value: function getSubscription(e) {\n      this.logger.debug(\"Getting subscription\"), this.logger.trace({\n        type: \"method\",\n        method: \"getSubscription\",\n        id: e\n      });\n      var t = this.subscriptions.get(e);\n      if (!t) {\n        var _c5 = c(\"NO_MATCHING_KEY\", \"\".concat(this.name, \": \").concat(e)),\n          i = _c5.message;\n        throw new Error(i);\n      }\n      return t;\n    }\n  }, {\n    key: \"deleteSubscription\",\n    value: function deleteSubscription(e, t) {\n      this.logger.debug(\"Deleting subscription\"), this.logger.trace({\n        type: \"method\",\n        method: \"deleteSubscription\",\n        id: e,\n        reason: t\n      });\n      var i = this.getSubscription(e);\n      this.subscriptions.delete(e), this.topicMap.delete(i.topic, e), this.events.emit(O.deleted, ue(Y({}, i), {\n        reason: t\n      }));\n    }\n  }, {\n    key: \"persist\",\n    value: function () {\n      var _persist3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee37() {\n        return _regeneratorRuntime().wrap(function _callee37$(_context37) {\n          while (1) {\n            switch (_context37.prev = _context37.next) {\n              case 0:\n                _context37.next = 2;\n                return this.setRelayerSubscriptions(this.values);\n              case 2:\n                this.events.emit(O.sync);\n              case 3:\n              case \"end\":\n                return _context37.stop();\n            }\n          }\n        }, _callee37, this);\n      }));\n      function persist() {\n        return _persist3.apply(this, arguments);\n      }\n      return persist;\n    }()\n  }, {\n    key: \"reset\",\n    value: function () {\n      var _reset = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee39() {\n        var _this11 = this;\n        return _regeneratorRuntime().wrap(function _callee39$(_context39) {\n          while (1) {\n            switch (_context39.prev = _context39.next) {\n              case 0:\n                _context39.t0 = !this.cached.length;\n                if (_context39.t0) {\n                  _context39.next = 4;\n                  break;\n                }\n                _context39.next = 4;\n                return Promise.all(this.cached.map( /*#__PURE__*/function () {\n                  var _ref29 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee38(e) {\n                    return _regeneratorRuntime().wrap(function _callee38$(_context38) {\n                      while (1) {\n                        switch (_context38.prev = _context38.next) {\n                          case 0:\n                            _context38.next = 2;\n                            return _this11.resubscribe(e);\n                          case 2:\n                            return _context38.abrupt(\"return\", _context38.sent);\n                          case 3:\n                          case \"end\":\n                            return _context38.stop();\n                        }\n                      }\n                    }, _callee38);\n                  }));\n                  return function (_x44) {\n                    return _ref29.apply(this, arguments);\n                  };\n                }()));\n              case 4:\n              case \"end\":\n                return _context39.stop();\n            }\n          }\n        }, _callee39, this);\n      }));\n      function reset() {\n        return _reset.apply(this, arguments);\n      }\n      return reset;\n    }()\n  }, {\n    key: \"restore\",\n    value: function () {\n      var _restore = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee40() {\n        var e, _c6, t;\n        return _regeneratorRuntime().wrap(function _callee40$(_context40) {\n          while (1) {\n            switch (_context40.prev = _context40.next) {\n              case 0:\n                _context40.prev = 0;\n                _context40.next = 3;\n                return this.getRelayerSubscriptions();\n              case 3:\n                e = _context40.sent;\n                if (!(typeof e > \"u\" || !e.length)) {\n                  _context40.next = 6;\n                  break;\n                }\n                return _context40.abrupt(\"return\");\n              case 6:\n                if (!this.subscriptions.size) {\n                  _context40.next = 9;\n                  break;\n                }\n                _c6 = c(\"RESTORE_WILL_OVERRIDE\", this.name), t = _c6.message;\n                throw this.logger.error(t), new Error(t);\n              case 9:\n                this.cached = e, this.logger.debug(\"Successfully Restored subscriptions for \".concat(this.name)), this.logger.trace({\n                  type: \"method\",\n                  method: \"restore\",\n                  subscriptions: this.values\n                });\n                _context40.next = 15;\n                break;\n              case 12:\n                _context40.prev = 12;\n                _context40.t0 = _context40[\"catch\"](0);\n                this.logger.debug(\"Failed to Restore subscriptions for \".concat(this.name)), this.logger.error(_context40.t0);\n              case 15:\n              case \"end\":\n                return _context40.stop();\n            }\n          }\n        }, _callee40, this, [[0, 12]]);\n      }));\n      function restore() {\n        return _restore.apply(this, arguments);\n      }\n      return restore;\n    }()\n  }, {\n    key: \"resubscribe\",\n    value: function () {\n      var _resubscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee41(e) {\n        var t, i, s, n;\n        return _regeneratorRuntime().wrap(function _callee41$(_context41) {\n          while (1) {\n            switch (_context41.prev = _context41.next) {\n              case 0:\n                if (this.ids.includes(e.id)) {\n                  _context41.next = 7;\n                  break;\n                }\n                t = e.topic, i = e.relay, s = {\n                  topic: t,\n                  relay: i\n                };\n                this.pending.set(s.topic, s);\n                _context41.next = 5;\n                return this.rpcSubscribe(s.topic, s.relay);\n              case 5:\n                n = _context41.sent;\n                this.onResubscribe(n, s);\n              case 7:\n              case \"end\":\n                return _context41.stop();\n            }\n          }\n        }, _callee41, this);\n      }));\n      function resubscribe(_x45) {\n        return _resubscribe.apply(this, arguments);\n      }\n      return resubscribe;\n    }()\n  }, {\n    key: \"onConnect\",\n    value: function () {\n      var _onConnect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee42() {\n        return _regeneratorRuntime().wrap(function _callee42$(_context42) {\n          while (1) {\n            switch (_context42.prev = _context42.next) {\n              case 0:\n                _context42.next = 2;\n                return this.reset();\n              case 2:\n                this.onEnable();\n              case 3:\n              case \"end\":\n                return _context42.stop();\n            }\n          }\n        }, _callee42, this);\n      }));\n      function onConnect() {\n        return _onConnect.apply(this, arguments);\n      }\n      return onConnect;\n    }()\n  }, {\n    key: \"onDisconnect\",\n    value: function onDisconnect() {\n      this.onDisable();\n    }\n  }, {\n    key: \"checkPending\",\n    value: function checkPending() {\n      var _this12 = this;\n      this.pending.forEach( /*#__PURE__*/function () {\n        var _ref30 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee43(e) {\n          var t;\n          return _regeneratorRuntime().wrap(function _callee43$(_context43) {\n            while (1) {\n              switch (_context43.prev = _context43.next) {\n                case 0:\n                  _context43.next = 2;\n                  return _this12.rpcSubscribe(e.topic, e.relay);\n                case 2:\n                  t = _context43.sent;\n                  _this12.onSubscribe(t, e);\n                case 4:\n                case \"end\":\n                  return _context43.stop();\n              }\n            }\n          }, _callee43);\n        }));\n        return function (_x46) {\n          return _ref30.apply(this, arguments);\n        };\n      }());\n    }\n  }, {\n    key: \"registerEventListeners\",\n    value: function registerEventListeners() {\n      var _this13 = this;\n      this.relayer.core.heartbeat.on(X.pulse, function () {\n        _this13.checkPending();\n      }), this.relayer.provider.on(N.connect, /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee44() {\n        return _regeneratorRuntime().wrap(function _callee44$(_context44) {\n          while (1) {\n            switch (_context44.prev = _context44.next) {\n              case 0:\n                _context44.next = 2;\n                return _this13.onConnect();\n              case 2:\n              case \"end\":\n                return _context44.stop();\n            }\n          }\n        }, _callee44);\n      }))), this.relayer.provider.on(N.disconnect, function () {\n        _this13.onDisconnect();\n      }), this.events.on(O.created, /*#__PURE__*/function () {\n        var _ref32 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee45(e) {\n          var t;\n          return _regeneratorRuntime().wrap(function _callee45$(_context45) {\n            while (1) {\n              switch (_context45.prev = _context45.next) {\n                case 0:\n                  t = O.created;\n                  _this13.logger.info(\"Emitting \".concat(t));\n                  _this13.logger.debug({\n                    type: \"event\",\n                    event: t,\n                    data: e\n                  });\n                  _context45.next = 5;\n                  return _this13.persist();\n                case 5:\n                case \"end\":\n                  return _context45.stop();\n              }\n            }\n          }, _callee45);\n        }));\n        return function (_x47) {\n          return _ref32.apply(this, arguments);\n        };\n      }()), this.events.on(O.deleted, /*#__PURE__*/function () {\n        var _ref33 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee46(e) {\n          var t;\n          return _regeneratorRuntime().wrap(function _callee46$(_context46) {\n            while (1) {\n              switch (_context46.prev = _context46.next) {\n                case 0:\n                  t = O.deleted;\n                  _this13.logger.info(\"Emitting \".concat(t));\n                  _this13.logger.debug({\n                    type: \"event\",\n                    event: t,\n                    data: e\n                  });\n                  _context46.next = 5;\n                  return _this13.persist();\n                case 5:\n                case \"end\":\n                  return _context46.stop();\n              }\n            }\n          }, _callee46);\n        }));\n        return function (_x48) {\n          return _ref33.apply(this, arguments);\n        };\n      }());\n    }\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c7 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c7.message;\n        throw new Error(e);\n      }\n    }\n  }]);\n  return Et;\n}(Mt);\nvar nr = Object.defineProperty,\n  vt = Object.getOwnPropertySymbols,\n  ar = Object.prototype.hasOwnProperty,\n  or = Object.prototype.propertyIsEnumerable,\n  wt = function wt(r, e, t) {\n    return e in r ? nr(r, e, {\n      enumerable: !0,\n      configurable: !0,\n      writable: !0,\n      value: t\n    }) : r[e] = t;\n  },\n  hr = function hr(r, e) {\n    for (var t in e || (e = {})) {\n      ar.call(e, t) && wt(r, t, e[t]);\n    }\n    if (vt) {\n      var _iterator3 = _createForOfIteratorHelper(vt(e)),\n        _step3;\n      try {\n        for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n          var t = _step3.value;\n          or.call(e, t) && wt(r, t, e[t]);\n        }\n      } catch (err) {\n        _iterator3.e(err);\n      } finally {\n        _iterator3.f();\n      }\n    }\n    return r;\n  };\nvar _t = /*#__PURE__*/function (_$t) {\n  _inherits(_t, _$t);\n  var _super4 = _createSuper(_t);\n  function _t(e) {\n    var _this14;\n    _classCallCheck(this, _t);\n    _this14 = _super4.call(this, e), _this14.protocol = \"wc\", _this14.version = 2, _this14.events = new z.EventEmitter(), _this14.name = tt, _this14.initialized = !1, _this14.core = e.core, _this14.logger = typeof e.logger < \"u\" && typeof e.logger != \"string\" ? v(e.logger, _this14.name) : le(de({\n      level: e.logger || Qe\n    })), _this14.messages = new ft(_this14.logger, e.core), _this14.subscriber = new Et(_assertThisInitialized(_this14), _this14.logger), _this14.publisher = new Zs(_assertThisInitialized(_this14), _this14.logger), _this14.relayUrl = (e === null || e === void 0 ? void 0 : e.relayUrl) || et, _this14.projectId = e.projectId, _this14.provider = {};\n    return _this14;\n  }\n  _createClass(_t, [{\n    key: \"init\",\n    value: function () {\n      var _init = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee47() {\n        var e;\n        return _regeneratorRuntime().wrap(function _callee47$(_context47) {\n          while (1) {\n            switch (_context47.prev = _context47.next) {\n              case 0:\n                this.logger.trace(\"Initialized\");\n                _context47.next = 3;\n                return this.core.crypto.signJWT(this.relayUrl);\n              case 3:\n                e = _context47.sent;\n                this.provider = this.createProvider(e);\n                _context47.next = 7;\n                return Promise.all([this.messages.init(), this.provider.connect(), this.subscriber.init()]);\n              case 7:\n                this.registerEventListeners();\n                this.initialized = !0;\n              case 9:\n              case \"end\":\n                return _context47.stop();\n            }\n          }\n        }, _callee47, this);\n      }));\n      function init() {\n        return _init.apply(this, arguments);\n      }\n      return init;\n    }()\n  }, {\n    key: \"context\",\n    get: function get() {\n      return w(this.logger);\n    }\n  }, {\n    key: \"connected\",\n    get: function get() {\n      return this.provider.connection.connected;\n    }\n  }, {\n    key: \"connecting\",\n    get: function get() {\n      return this.provider.connection.connecting;\n    }\n  }, {\n    key: \"publish\",\n    value: function () {\n      var _publish = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee48(e, t, i) {\n        return _regeneratorRuntime().wrap(function _callee48$(_context48) {\n          while (1) {\n            switch (_context48.prev = _context48.next) {\n              case 0:\n                this.isInitialized();\n                _context48.next = 3;\n                return this.publisher.publish(e, t, i);\n              case 3:\n                _context48.next = 5;\n                return this.recordMessageEvent({\n                  topic: e,\n                  message: t\n                });\n              case 5:\n              case \"end\":\n                return _context48.stop();\n            }\n          }\n        }, _callee48, this);\n      }));\n      function publish(_x49, _x50, _x51) {\n        return _publish.apply(this, arguments);\n      }\n      return publish;\n    }()\n  }, {\n    key: \"subscribe\",\n    value: function () {\n      var _subscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee49(e, t) {\n        return _regeneratorRuntime().wrap(function _callee49$(_context49) {\n          while (1) {\n            switch (_context49.prev = _context49.next) {\n              case 0:\n                this.isInitialized();\n                _context49.next = 3;\n                return this.subscriber.subscribe(e, t);\n              case 3:\n                return _context49.abrupt(\"return\", _context49.sent);\n              case 4:\n              case \"end\":\n                return _context49.stop();\n            }\n          }\n        }, _callee49, this);\n      }));\n      function subscribe(_x52, _x53) {\n        return _subscribe.apply(this, arguments);\n      }\n      return subscribe;\n    }()\n  }, {\n    key: \"unsubscribe\",\n    value: function () {\n      var _unsubscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee50(e, t) {\n        return _regeneratorRuntime().wrap(function _callee50$(_context50) {\n          while (1) {\n            switch (_context50.prev = _context50.next) {\n              case 0:\n                this.isInitialized();\n                _context50.next = 3;\n                return this.subscriber.unsubscribe(e, t);\n              case 3:\n              case \"end\":\n                return _context50.stop();\n            }\n          }\n        }, _callee50, this);\n      }));\n      function unsubscribe(_x54, _x55) {\n        return _unsubscribe.apply(this, arguments);\n      }\n      return unsubscribe;\n    }()\n  }, {\n    key: \"on\",\n    value: function on(e, t) {\n      this.events.on(e, t);\n    }\n  }, {\n    key: \"once\",\n    value: function once(e, t) {\n      this.events.once(e, t);\n    }\n  }, {\n    key: \"off\",\n    value: function off(e, t) {\n      this.events.off(e, t);\n    }\n  }, {\n    key: \"removeListener\",\n    value: function removeListener(e, t) {\n      this.events.removeListener(e, t);\n    }\n  }, {\n    key: \"createProvider\",\n    value: function createProvider(e) {\n      return new fi(new vi(ti({\n        sdkVersion: rt,\n        protocol: this.protocol,\n        version: this.version,\n        relayUrl: this.relayUrl,\n        projectId: this.projectId,\n        auth: e\n      })));\n    }\n  }, {\n    key: \"recordMessageEvent\",\n    value: function () {\n      var _recordMessageEvent = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee51(e) {\n        var t, i;\n        return _regeneratorRuntime().wrap(function _callee51$(_context51) {\n          while (1) {\n            switch (_context51.prev = _context51.next) {\n              case 0:\n                t = e.topic, i = e.message;\n                _context51.next = 3;\n                return this.messages.set(t, i);\n              case 3:\n              case \"end\":\n                return _context51.stop();\n            }\n          }\n        }, _callee51, this);\n      }));\n      function recordMessageEvent(_x56) {\n        return _recordMessageEvent.apply(this, arguments);\n      }\n      return recordMessageEvent;\n    }()\n  }, {\n    key: \"shouldIgnoreMessageEvent\",\n    value: function () {\n      var _shouldIgnoreMessageEvent = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee52(e) {\n        var t, i;\n        return _regeneratorRuntime().wrap(function _callee52$(_context52) {\n          while (1) {\n            switch (_context52.prev = _context52.next) {\n              case 0:\n                t = e.topic, i = e.message;\n                _context52.next = 3;\n                return this.subscriber.isSubscribed(t);\n              case 3:\n                if (!_context52.sent) {\n                  _context52.next = 7;\n                  break;\n                }\n                _context52.t0 = this.messages.has(t, i);\n                _context52.next = 8;\n                break;\n              case 7:\n                _context52.t0 = !0;\n              case 8:\n                return _context52.abrupt(\"return\", _context52.t0);\n              case 9:\n              case \"end\":\n                return _context52.stop();\n            }\n          }\n        }, _callee52, this);\n      }));\n      function shouldIgnoreMessageEvent(_x57) {\n        return _shouldIgnoreMessageEvent.apply(this, arguments);\n      }\n      return shouldIgnoreMessageEvent;\n    }()\n  }, {\n    key: \"onProviderPayload\",\n    value: function () {\n      var _onProviderPayload = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee53(e) {\n        var t, _t$data, i, s, n;\n        return _regeneratorRuntime().wrap(function _callee53$(_context53) {\n          while (1) {\n            switch (_context53.prev = _context53.next) {\n              case 0:\n                if (!(this.logger.debug(\"Incoming Relay Payload\"), this.logger.trace({\n                  type: \"payload\",\n                  direction: \"incoming\",\n                  payload: e\n                }), Ee(e))) {\n                  _context53.next = 11;\n                  break;\n                }\n                if (e.method.endsWith(it)) {\n                  _context53.next = 3;\n                  break;\n                }\n                return _context53.abrupt(\"return\");\n              case 3:\n                t = e.params, _t$data = t.data, i = _t$data.topic, s = _t$data.message, n = {\n                  topic: i,\n                  message: s\n                };\n                this.logger.debug(\"Emitting Relayer Payload\");\n                this.logger.trace(hr({\n                  type: \"event\",\n                  event: t.id\n                }, n));\n                this.events.emit(t.id, n);\n                _context53.next = 9;\n                return this.acknowledgePayload(e);\n              case 9:\n                _context53.next = 11;\n                return this.onMessageEvent(n);\n              case 11:\n              case \"end\":\n                return _context53.stop();\n            }\n          }\n        }, _callee53, this);\n      }));\n      function onProviderPayload(_x58) {\n        return _onProviderPayload.apply(this, arguments);\n      }\n      return onProviderPayload;\n    }()\n  }, {\n    key: \"onMessageEvent\",\n    value: function () {\n      var _onMessageEvent = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee54(e) {\n        return _regeneratorRuntime().wrap(function _callee54$(_context54) {\n          while (1) {\n            switch (_context54.prev = _context54.next) {\n              case 0:\n                _context54.next = 2;\n                return this.shouldIgnoreMessageEvent(e);\n              case 2:\n                _context54.t0 = _context54.sent;\n                if (_context54.t0) {\n                  _context54.next = 7;\n                  break;\n                }\n                this.events.emit(U.message, e);\n                _context54.next = 7;\n                return this.recordMessageEvent(e);\n              case 7:\n              case \"end\":\n                return _context54.stop();\n            }\n          }\n        }, _callee54, this);\n      }));\n      function onMessageEvent(_x59) {\n        return _onMessageEvent.apply(this, arguments);\n      }\n      return onMessageEvent;\n    }()\n  }, {\n    key: \"acknowledgePayload\",\n    value: function () {\n      var _acknowledgePayload = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee55(e) {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee55$(_context55) {\n          while (1) {\n            switch (_context55.prev = _context55.next) {\n              case 0:\n                t = ve(e.id, !0);\n                _context55.next = 3;\n                return this.provider.connection.send(t);\n              case 3:\n              case \"end\":\n                return _context55.stop();\n            }\n          }\n        }, _callee55, this);\n      }));\n      function acknowledgePayload(_x60) {\n        return _acknowledgePayload.apply(this, arguments);\n      }\n      return acknowledgePayload;\n    }()\n  }, {\n    key: \"registerEventListeners\",\n    value: function registerEventListeners() {\n      var _this15 = this;\n      this.provider.on(N.payload, function (e) {\n        return _this15.onProviderPayload(e);\n      }), this.provider.on(N.connect, function () {\n        _this15.events.emit(U.connect);\n      }), this.provider.on(N.disconnect, function () {\n        _this15.events.emit(U.disconnect), setTimeout(function () {\n          _this15.provider.connect();\n        }, me(st));\n      }), this.provider.on(N.error, function (e) {\n        return _this15.events.emit(U.error, e);\n      });\n    }\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c8 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c8.message;\n        throw new Error(e);\n      }\n    }\n  }]);\n  return _t;\n}($t);\nvar cr = Object.defineProperty,\n  It = Object.getOwnPropertySymbols,\n  ur = Object.prototype.hasOwnProperty,\n  lr = Object.prototype.propertyIsEnumerable,\n  Ct = function Ct(r, e, t) {\n    return e in r ? cr(r, e, {\n      enumerable: !0,\n      configurable: !0,\n      writable: !0,\n      value: t\n    }) : r[e] = t;\n  },\n  Rt = function Rt(r, e) {\n    for (var t in e || (e = {})) {\n      ur.call(e, t) && Ct(r, t, e[t]);\n    }\n    if (It) {\n      var _iterator4 = _createForOfIteratorHelper(It(e)),\n        _step4;\n      try {\n        for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n          var t = _step4.value;\n          lr.call(e, t) && Ct(r, t, e[t]);\n        }\n      } catch (err) {\n        _iterator4.e(err);\n      } finally {\n        _iterator4.f();\n      }\n    }\n    return r;\n  };\nvar St = /*#__PURE__*/function (_Kt) {\n  _inherits(St, _Kt);\n  var _super5 = _createSuper(St);\n  function St(e, t, i) {\n    var _this16;\n    var s = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : x;\n    var n = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : void 0;\n    _classCallCheck(this, St);\n    _this16 = _super5.call(this, e, t, i, s), _this16.core = e, _this16.logger = t, _this16.name = i, _this16.map = new Map(), _this16.version = nt, _this16.cached = [], _this16.initialized = !1, _this16.storagePrefix = x, _this16.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee56() {\n      return _regeneratorRuntime().wrap(function _callee56$(_context56) {\n        while (1) {\n          switch (_context56.prev = _context56.next) {\n            case 0:\n              _context56.t0 = _this16.initialized;\n              if (_context56.t0) {\n                _context56.next = 8;\n                break;\n              }\n              _this16.logger.trace(\"Initialized\");\n              _context56.next = 5;\n              return _this16.restore();\n            case 5:\n              _this16.cached.forEach(function (a) {\n                ii(a) ? _this16.map.set(a.id, a) : si(a) ? _this16.map.set(a.topic, a) : _this16.getKey && a !== null && !ee(a) && _this16.map.set(_this16.getKey(a), a);\n              });\n              _this16.cached = [];\n              _this16.initialized = !0;\n            case 8:\n            case \"end\":\n              return _context56.stop();\n          }\n        }\n      }, _callee56);\n    })), _this16.set = /*#__PURE__*/function () {\n      var _ref35 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee57(a, o) {\n        return _regeneratorRuntime().wrap(function _callee57$(_context57) {\n          while (1) {\n            switch (_context57.prev = _context57.next) {\n              case 0:\n                _this16.isInitialized();\n                if (!_this16.map.has(a)) {\n                  _context57.next = 6;\n                  break;\n                }\n                _context57.next = 4;\n                return _this16.update(a, o);\n              case 4:\n                _context57.next = 11;\n                break;\n              case 6:\n                _this16.logger.debug(\"Setting value\");\n                _this16.logger.trace({\n                  type: \"method\",\n                  method: \"set\",\n                  key: a,\n                  value: o\n                });\n                _this16.map.set(a, o);\n                _context57.next = 11;\n                return _this16.persist();\n              case 11:\n              case \"end\":\n                return _context57.stop();\n            }\n          }\n        }, _callee57);\n      }));\n      return function (_x61, _x62) {\n        return _ref35.apply(this, arguments);\n      };\n    }(), _this16.get = function (a) {\n      return _this16.isInitialized(), _this16.logger.debug(\"Getting value\"), _this16.logger.trace({\n        type: \"method\",\n        method: \"get\",\n        key: a\n      }), _this16.getData(a);\n    }, _this16.getAll = function (a) {\n      return _this16.isInitialized(), a ? _this16.values.filter(function (o) {\n        return Object.keys(a).every(function (h) {\n          return wi(o[h], a[h]);\n        });\n      }) : _this16.values;\n    }, _this16.update = /*#__PURE__*/function () {\n      var _ref36 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee58(a, o) {\n        var h;\n        return _regeneratorRuntime().wrap(function _callee58$(_context58) {\n          while (1) {\n            switch (_context58.prev = _context58.next) {\n              case 0:\n                _this16.isInitialized(), _this16.logger.debug(\"Updating value\"), _this16.logger.trace({\n                  type: \"method\",\n                  method: \"update\",\n                  key: a,\n                  update: o\n                });\n                h = Rt(Rt({}, _this16.getData(a)), o);\n                _this16.map.set(a, h);\n                _context58.next = 5;\n                return _this16.persist();\n              case 5:\n              case \"end\":\n                return _context58.stop();\n            }\n          }\n        }, _callee58);\n      }));\n      return function (_x63, _x64) {\n        return _ref36.apply(this, arguments);\n      };\n    }(), _this16.delete = /*#__PURE__*/function () {\n      var _ref37 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee59(a, o) {\n        return _regeneratorRuntime().wrap(function _callee59$(_context59) {\n          while (1) {\n            switch (_context59.prev = _context59.next) {\n              case 0:\n                _this16.isInitialized();\n                _context59.t0 = _this16.map.has(a);\n                if (!_context59.t0) {\n                  _context59.next = 8;\n                  break;\n                }\n                _this16.logger.debug(\"Deleting value\");\n                _this16.logger.trace({\n                  type: \"method\",\n                  method: \"delete\",\n                  key: a,\n                  reason: o\n                });\n                _this16.map.delete(a);\n                _context59.next = 8;\n                return _this16.persist();\n              case 8:\n              case \"end\":\n                return _context59.stop();\n            }\n          }\n        }, _callee59);\n      }));\n      return function (_x65, _x66) {\n        return _ref37.apply(this, arguments);\n      };\n    }(), _this16.logger = v(t, _this16.name), _this16.storagePrefix = s, _this16.getKey = n;\n    return _this16;\n  }\n  _createClass(St, [{\n    key: \"context\",\n    get: function get() {\n      return w(this.logger);\n    }\n  }, {\n    key: \"storageKey\",\n    get: function get() {\n      return this.storagePrefix + this.version + \"//\" + this.name;\n    }\n  }, {\n    key: \"length\",\n    get: function get() {\n      return this.map.size;\n    }\n  }, {\n    key: \"keys\",\n    get: function get() {\n      return Array.from(this.map.keys());\n    }\n  }, {\n    key: \"values\",\n    get: function get() {\n      return Array.from(this.map.values());\n    }\n  }, {\n    key: \"setDataStore\",\n    value: function () {\n      var _setDataStore = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee60(e) {\n        return _regeneratorRuntime().wrap(function _callee60$(_context60) {\n          while (1) {\n            switch (_context60.prev = _context60.next) {\n              case 0:\n                _context60.next = 2;\n                return this.core.storage.setItem(this.storageKey, e);\n              case 2:\n              case \"end\":\n                return _context60.stop();\n            }\n          }\n        }, _callee60, this);\n      }));\n      function setDataStore(_x67) {\n        return _setDataStore.apply(this, arguments);\n      }\n      return setDataStore;\n    }()\n  }, {\n    key: \"getDataStore\",\n    value: function () {\n      var _getDataStore = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee61() {\n        return _regeneratorRuntime().wrap(function _callee61$(_context61) {\n          while (1) {\n            switch (_context61.prev = _context61.next) {\n              case 0:\n                _context61.next = 2;\n                return this.core.storage.getItem(this.storageKey);\n              case 2:\n                return _context61.abrupt(\"return\", _context61.sent);\n              case 3:\n              case \"end\":\n                return _context61.stop();\n            }\n          }\n        }, _callee61, this);\n      }));\n      function getDataStore() {\n        return _getDataStore.apply(this, arguments);\n      }\n      return getDataStore;\n    }()\n  }, {\n    key: \"getData\",\n    value: function getData(e) {\n      var t = this.map.get(e);\n      if (!t) {\n        var _c9 = c(\"NO_MATCHING_KEY\", \"\".concat(this.name, \": \").concat(e)),\n          i = _c9.message;\n        throw this.logger.error(i), new Error(i);\n      }\n      return t;\n    }\n  }, {\n    key: \"persist\",\n    value: function () {\n      var _persist4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee62() {\n        return _regeneratorRuntime().wrap(function _callee62$(_context62) {\n          while (1) {\n            switch (_context62.prev = _context62.next) {\n              case 0:\n                _context62.next = 2;\n                return this.setDataStore(this.values);\n              case 2:\n              case \"end\":\n                return _context62.stop();\n            }\n          }\n        }, _callee62, this);\n      }));\n      function persist() {\n        return _persist4.apply(this, arguments);\n      }\n      return persist;\n    }()\n  }, {\n    key: \"restore\",\n    value: function () {\n      var _restore2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee63() {\n        var e, _c10, t;\n        return _regeneratorRuntime().wrap(function _callee63$(_context63) {\n          while (1) {\n            switch (_context63.prev = _context63.next) {\n              case 0:\n                _context63.prev = 0;\n                _context63.next = 3;\n                return this.getDataStore();\n              case 3:\n                e = _context63.sent;\n                if (!(typeof e > \"u\" || !e.length)) {\n                  _context63.next = 6;\n                  break;\n                }\n                return _context63.abrupt(\"return\");\n              case 6:\n                if (!this.map.size) {\n                  _context63.next = 9;\n                  break;\n                }\n                _c10 = c(\"RESTORE_WILL_OVERRIDE\", this.name), t = _c10.message;\n                throw this.logger.error(t), new Error(t);\n              case 9:\n                this.cached = e, this.logger.debug(\"Successfully Restored value for \".concat(this.name)), this.logger.trace({\n                  type: \"method\",\n                  method: \"restore\",\n                  value: this.values\n                });\n                _context63.next = 15;\n                break;\n              case 12:\n                _context63.prev = 12;\n                _context63.t0 = _context63[\"catch\"](0);\n                this.logger.debug(\"Failed to Restore value for \".concat(this.name)), this.logger.error(_context63.t0);\n              case 15:\n              case \"end\":\n                return _context63.stop();\n            }\n          }\n        }, _callee63, this, [[0, 12]]);\n      }));\n      function restore() {\n        return _restore2.apply(this, arguments);\n      }\n      return restore;\n    }()\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c11 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c11.message;\n        throw new Error(e);\n      }\n    }\n  }]);\n  return St;\n}(Kt);\nvar Tt = /*#__PURE__*/function () {\n  function Tt(e, t) {\n    var _this17 = this;\n    _classCallCheck(this, Tt);\n    this.core = e, this.logger = t, this.name = ct, this.version = ut, this.events = new z(), this.initialized = !1, this.storagePrefix = x, this.ignoredPayloadTypes = [ri], this.registeredMethods = [], this.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee64() {\n      return _regeneratorRuntime().wrap(function _callee64$(_context64) {\n        while (1) {\n          switch (_context64.prev = _context64.next) {\n            case 0:\n              _context64.t0 = _this17.initialized;\n              if (_context64.t0) {\n                _context64.next = 10;\n                break;\n              }\n              _context64.next = 4;\n              return _this17.pairings.init();\n            case 4:\n              _context64.next = 6;\n              return _this17.cleanup();\n            case 6:\n              _this17.registerRelayerEvents();\n              _this17.registerExpirerEvents();\n              _this17.initialized = !0;\n              _this17.logger.trace(\"Initialized\");\n            case 10:\n            case \"end\":\n              return _context64.stop();\n          }\n        }\n      }, _callee64);\n    })), this.register = function (_ref39) {\n      var i = _ref39.methods;\n      _this17.isInitialized(), _this17.registeredMethods = _toConsumableArray(new Set([].concat(_toConsumableArray(_this17.registeredMethods), _toConsumableArray(i))));\n    }, this.create = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee65() {\n      var i, s, n, a, o, h;\n      return _regeneratorRuntime().wrap(function _callee65$(_context65) {\n        while (1) {\n          switch (_context65.prev = _context65.next) {\n            case 0:\n              _this17.isInitialized();\n              i = W();\n              _context65.next = 4;\n              return _this17.core.crypto.setSymKey(i);\n            case 4:\n              s = _context65.sent;\n              n = te(be);\n              a = {\n                protocol: Ze\n              };\n              o = {\n                topic: s,\n                expiry: n,\n                relay: a,\n                active: !1\n              };\n              h = ni({\n                protocol: _this17.core.protocol,\n                version: _this17.core.version,\n                topic: s,\n                symKey: i,\n                relay: a\n              });\n              _context65.next = 11;\n              return _this17.pairings.set(s, o);\n            case 11:\n              _context65.next = 13;\n              return _this17.core.relayer.subscribe(s);\n            case 13:\n              _this17.core.expirer.set(s, n);\n              return _context65.abrupt(\"return\", {\n                topic: s,\n                uri: h\n              });\n            case 15:\n            case \"end\":\n              return _context65.stop();\n          }\n        }\n      }, _callee65);\n    })), this.pair = /*#__PURE__*/function () {\n      var _ref41 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee66(i) {\n        var _ai, s, n, a, o, h;\n        return _regeneratorRuntime().wrap(function _callee66$(_context66) {\n          while (1) {\n            switch (_context66.prev = _context66.next) {\n              case 0:\n                _this17.isInitialized(), _this17.isValidPair(i);\n                _ai = ai(i.uri), s = _ai.topic, n = _ai.symKey, a = _ai.relay, o = te(be), h = {\n                  topic: s,\n                  relay: a,\n                  expiry: o,\n                  active: !1\n                };\n                _context66.next = 4;\n                return _this17.pairings.set(s, h);\n              case 4:\n                _context66.next = 6;\n                return _this17.core.crypto.setSymKey(n, s);\n              case 6:\n                _context66.next = 8;\n                return _this17.core.relayer.subscribe(s, {\n                  relay: a\n                });\n              case 8:\n                _this17.core.expirer.set(s, o);\n                _context66.t0 = i.activatePairing;\n                if (!_context66.t0) {\n                  _context66.next = 13;\n                  break;\n                }\n                _context66.next = 13;\n                return _this17.activate({\n                  topic: s\n                });\n              case 13:\n                return _context66.abrupt(\"return\", h);\n              case 14:\n              case \"end\":\n                return _context66.stop();\n            }\n          }\n        }, _callee66);\n      }));\n      return function (_x68) {\n        return _ref41.apply(this, arguments);\n      };\n    }(), this.activate = /*#__PURE__*/function () {\n      var _ref43 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee67(_ref42) {\n        var i, s;\n        return _regeneratorRuntime().wrap(function _callee67$(_context67) {\n          while (1) {\n            switch (_context67.prev = _context67.next) {\n              case 0:\n                i = _ref42.topic;\n                _this17.isInitialized();\n                s = te(re);\n                _context67.next = 5;\n                return _this17.pairings.update(i, {\n                  active: !0,\n                  expiry: s\n                });\n              case 5:\n                _this17.core.expirer.set(i, s);\n              case 6:\n              case \"end\":\n                return _context67.stop();\n            }\n          }\n        }, _callee67);\n      }));\n      return function (_x69) {\n        return _ref43.apply(this, arguments);\n      };\n    }(), this.ping = /*#__PURE__*/function () {\n      var _ref44 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee68(i) {\n        var s, n, _oi, a, o, h;\n        return _regeneratorRuntime().wrap(function _callee68$(_context68) {\n          while (1) {\n            switch (_context68.prev = _context68.next) {\n              case 0:\n                _this17.isInitialized();\n                _context68.next = 3;\n                return _this17.isValidPing(i);\n              case 3:\n                s = i.topic;\n                if (!_this17.pairings.keys.includes(s)) {\n                  _context68.next = 15;\n                  break;\n                }\n                _context68.next = 7;\n                return _this17.sendRequest(s, \"wc_pairingPing\", {});\n              case 7:\n                n = _context68.sent;\n                _oi = oi();\n                a = _oi.done;\n                o = _oi.resolve;\n                h = _oi.reject;\n                _this17.events.once(ie(\"pairing_ping\", n), function (_ref45) {\n                  var l = _ref45.error;\n                  l ? h(l) : o();\n                });\n                _context68.next = 15;\n                return a();\n              case 15:\n              case \"end\":\n                return _context68.stop();\n            }\n          }\n        }, _callee68);\n      }));\n      return function (_x70) {\n        return _ref44.apply(this, arguments);\n      };\n    }(), this.updateExpiry = /*#__PURE__*/function () {\n      var _ref47 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee69(_ref46) {\n        var i, s;\n        return _regeneratorRuntime().wrap(function _callee69$(_context69) {\n          while (1) {\n            switch (_context69.prev = _context69.next) {\n              case 0:\n                i = _ref46.topic, s = _ref46.expiry;\n                _this17.isInitialized();\n                _context69.next = 4;\n                return _this17.pairings.update(i, {\n                  expiry: s\n                });\n              case 4:\n              case \"end\":\n                return _context69.stop();\n            }\n          }\n        }, _callee69);\n      }));\n      return function (_x71) {\n        return _ref47.apply(this, arguments);\n      };\n    }(), this.updateMetadata = /*#__PURE__*/function () {\n      var _ref49 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee70(_ref48) {\n        var i, s;\n        return _regeneratorRuntime().wrap(function _callee70$(_context70) {\n          while (1) {\n            switch (_context70.prev = _context70.next) {\n              case 0:\n                i = _ref48.topic, s = _ref48.metadata;\n                _this17.isInitialized();\n                _context70.next = 4;\n                return _this17.pairings.update(i, {\n                  peerMetadata: s\n                });\n              case 4:\n              case \"end\":\n                return _context70.stop();\n            }\n          }\n        }, _callee70);\n      }));\n      return function (_x72) {\n        return _ref49.apply(this, arguments);\n      };\n    }(), this.getPairings = function () {\n      return _this17.isInitialized(), _this17.pairings.values;\n    }, this.disconnect = /*#__PURE__*/function () {\n      var _ref50 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee71(i) {\n        var s;\n        return _regeneratorRuntime().wrap(function _callee71$(_context71) {\n          while (1) {\n            switch (_context71.prev = _context71.next) {\n              case 0:\n                _this17.isInitialized();\n                _context71.next = 3;\n                return _this17.isValidDisconnect(i);\n              case 3:\n                s = i.topic;\n                _context71.t0 = _this17.pairings.keys.includes(s);\n                if (!_context71.t0) {\n                  _context71.next = 10;\n                  break;\n                }\n                _context71.next = 8;\n                return _this17.sendRequest(s, \"wc_pairingDelete\", M(\"USER_DISCONNECTED\"));\n              case 8:\n                _context71.next = 10;\n                return _this17.deletePairing(s);\n              case 10:\n              case \"end\":\n                return _context71.stop();\n            }\n          }\n        }, _callee71);\n      }));\n      return function (_x73) {\n        return _ref50.apply(this, arguments);\n      };\n    }(), this.sendRequest = /*#__PURE__*/function () {\n      var _ref51 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee72(i, s, n) {\n        var a, o, h;\n        return _regeneratorRuntime().wrap(function _callee72$(_context72) {\n          while (1) {\n            switch (_context72.prev = _context72.next) {\n              case 0:\n                a = we(s, n);\n                _context72.next = 3;\n                return _this17.core.crypto.encode(i, a);\n              case 3:\n                o = _context72.sent;\n                h = F[s].req;\n                _this17.core.history.set(i, a);\n                _context72.next = 8;\n                return _this17.core.relayer.publish(i, o, h);\n              case 8:\n                return _context72.abrupt(\"return\", a.id);\n              case 9:\n              case \"end\":\n                return _context72.stop();\n            }\n          }\n        }, _callee72);\n      }));\n      return function (_x74, _x75, _x76) {\n        return _ref51.apply(this, arguments);\n      };\n    }(), this.sendResult = /*#__PURE__*/function () {\n      var _ref52 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee73(i, s, n) {\n        var a, o, h, l;\n        return _regeneratorRuntime().wrap(function _callee73$(_context73) {\n          while (1) {\n            switch (_context73.prev = _context73.next) {\n              case 0:\n                a = ve(i, n);\n                _context73.next = 3;\n                return _this17.core.crypto.encode(s, a);\n              case 3:\n                o = _context73.sent;\n                _context73.next = 6;\n                return _this17.core.history.get(s, i);\n              case 6:\n                h = _context73.sent;\n                l = F[h.request.method].res;\n                _context73.next = 10;\n                return _this17.core.relayer.publish(s, o, l);\n              case 10:\n                _context73.next = 12;\n                return _this17.core.history.resolve(a);\n              case 12:\n              case \"end\":\n                return _context73.stop();\n            }\n          }\n        }, _callee73);\n      }));\n      return function (_x77, _x78, _x79) {\n        return _ref52.apply(this, arguments);\n      };\n    }(), this.sendError = /*#__PURE__*/function () {\n      var _ref53 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee74(i, s, n) {\n        var a, o, h, l;\n        return _regeneratorRuntime().wrap(function _callee74$(_context74) {\n          while (1) {\n            switch (_context74.prev = _context74.next) {\n              case 0:\n                a = mi(i, n);\n                _context74.next = 3;\n                return _this17.core.crypto.encode(s, a);\n              case 3:\n                o = _context74.sent;\n                _context74.next = 6;\n                return _this17.core.history.get(s, i);\n              case 6:\n                h = _context74.sent;\n                l = F[h.request.method] ? F[h.request.method].res : F.unregistered_method.res;\n                _context74.next = 10;\n                return _this17.core.relayer.publish(s, o, l);\n              case 10:\n                _context74.next = 12;\n                return _this17.core.history.resolve(a);\n              case 12:\n              case \"end\":\n                return _context74.stop();\n            }\n          }\n        }, _callee74);\n      }));\n      return function (_x80, _x81, _x82) {\n        return _ref53.apply(this, arguments);\n      };\n    }(), this.deletePairing = /*#__PURE__*/function () {\n      var _ref54 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee75(i, s) {\n        return _regeneratorRuntime().wrap(function _callee75$(_context75) {\n          while (1) {\n            switch (_context75.prev = _context75.next) {\n              case 0:\n                _context75.next = 2;\n                return _this17.core.relayer.unsubscribe(i);\n              case 2:\n                _context75.next = 4;\n                return Promise.all([_this17.pairings.delete(i, M(\"USER_DISCONNECTED\")), _this17.core.crypto.deleteSymKey(i), s ? Promise.resolve() : _this17.core.expirer.del(i)]);\n              case 4:\n              case \"end\":\n                return _context75.stop();\n            }\n          }\n        }, _callee75);\n      }));\n      return function (_x83, _x84) {\n        return _ref54.apply(this, arguments);\n      };\n    }(), this.cleanup = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee76() {\n      var i;\n      return _regeneratorRuntime().wrap(function _callee76$(_context76) {\n        while (1) {\n          switch (_context76.prev = _context76.next) {\n            case 0:\n              i = _this17.pairings.getAll().filter(function (s) {\n                return ye(s.expiry);\n              });\n              _context76.next = 3;\n              return Promise.all(i.map(function (s) {\n                return _this17.deletePairing(s.topic);\n              }));\n            case 3:\n            case \"end\":\n              return _context76.stop();\n          }\n        }\n      }, _callee76);\n    })), this.onRelayEventRequest = function (i) {\n      var s = i.topic,\n        n = i.payload;\n      switch (n.method) {\n        case \"wc_pairingPing\":\n          return _this17.onPairingPingRequest(s, n);\n        case \"wc_pairingDelete\":\n          return _this17.onPairingDeleteRequest(s, n);\n        default:\n          return _this17.onUnknownRpcMethodRequest(s, n);\n      }\n    }, this.onRelayEventResponse = /*#__PURE__*/function () {\n      var _ref56 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee77(i) {\n        var s, n, a;\n        return _regeneratorRuntime().wrap(function _callee77$(_context77) {\n          while (1) {\n            switch (_context77.prev = _context77.next) {\n              case 0:\n                s = i.topic;\n                n = i.payload;\n                _context77.next = 4;\n                return _this17.core.history.get(s, n.id);\n              case 4:\n                a = _context77.sent.request.method;\n                _context77.t0 = a;\n                _context77.next = _context77.t0 === \"wc_pairingPing\" ? 8 : 9;\n                break;\n              case 8:\n                return _context77.abrupt(\"return\", _this17.onPairingPingResponse(s, n));\n              case 9:\n                return _context77.abrupt(\"return\", _this17.onUnknownRpcMethodResponse(a));\n              case 10:\n              case \"end\":\n                return _context77.stop();\n            }\n          }\n        }, _callee77);\n      }));\n      return function (_x85) {\n        return _ref56.apply(this, arguments);\n      };\n    }(), this.onPairingPingRequest = /*#__PURE__*/function () {\n      var _ref57 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee78(i, s) {\n        var n;\n        return _regeneratorRuntime().wrap(function _callee78$(_context78) {\n          while (1) {\n            switch (_context78.prev = _context78.next) {\n              case 0:\n                n = s.id;\n                _context78.prev = 1;\n                _this17.isValidPing({\n                  topic: i\n                });\n                _context78.next = 5;\n                return _this17.sendResult(n, i, !0);\n              case 5:\n                _this17.events.emit(\"pairing_ping\", {\n                  id: n,\n                  topic: i\n                });\n                _context78.next = 13;\n                break;\n              case 8:\n                _context78.prev = 8;\n                _context78.t0 = _context78[\"catch\"](1);\n                _context78.next = 12;\n                return _this17.sendError(n, i, _context78.t0);\n              case 12:\n                _this17.logger.error(_context78.t0);\n              case 13:\n              case \"end\":\n                return _context78.stop();\n            }\n          }\n        }, _callee78, null, [[1, 8]]);\n      }));\n      return function (_x86, _x87) {\n        return _ref57.apply(this, arguments);\n      };\n    }(), this.onPairingPingResponse = function (i, s) {\n      var n = s.id;\n      setTimeout(function () {\n        bi(s) ? _this17.events.emit(ie(\"pairing_ping\", n), {}) : _e(s) && _this17.events.emit(ie(\"pairing_ping\", n), {\n          error: s.error\n        });\n      }, 500);\n    }, this.onPairingDeleteRequest = /*#__PURE__*/function () {\n      var _ref58 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee79(i, s) {\n        var n;\n        return _regeneratorRuntime().wrap(function _callee79$(_context79) {\n          while (1) {\n            switch (_context79.prev = _context79.next) {\n              case 0:\n                n = s.id;\n                _context79.prev = 1;\n                _this17.isValidDisconnect({\n                  topic: i\n                });\n                _context79.next = 5;\n                return _this17.sendResult(n, i, !0);\n              case 5:\n                _context79.next = 7;\n                return _this17.deletePairing(i);\n              case 7:\n                _this17.events.emit(\"pairing_delete\", {\n                  id: n,\n                  topic: i\n                });\n                _context79.next = 15;\n                break;\n              case 10:\n                _context79.prev = 10;\n                _context79.t0 = _context79[\"catch\"](1);\n                _context79.next = 14;\n                return _this17.sendError(n, i, _context79.t0);\n              case 14:\n                _this17.logger.error(_context79.t0);\n              case 15:\n              case \"end\":\n                return _context79.stop();\n            }\n          }\n        }, _callee79, null, [[1, 10]]);\n      }));\n      return function (_x88, _x89) {\n        return _ref58.apply(this, arguments);\n      };\n    }(), this.onUnknownRpcMethodRequest = /*#__PURE__*/function () {\n      var _ref59 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee80(i, s) {\n        var n, a, o;\n        return _regeneratorRuntime().wrap(function _callee80$(_context80) {\n          while (1) {\n            switch (_context80.prev = _context80.next) {\n              case 0:\n                n = s.id, a = s.method;\n                _context80.prev = 1;\n                if (!_this17.registeredMethods.includes(a)) {\n                  _context80.next = 4;\n                  break;\n                }\n                return _context80.abrupt(\"return\");\n              case 4:\n                o = M(\"WC_METHOD_UNSUPPORTED\", a);\n                _context80.next = 7;\n                return _this17.sendError(n, i, o);\n              case 7:\n                _this17.logger.error(o);\n                _context80.next = 15;\n                break;\n              case 10:\n                _context80.prev = 10;\n                _context80.t0 = _context80[\"catch\"](1);\n                _context80.next = 14;\n                return _this17.sendError(n, i, _context80.t0);\n              case 14:\n                _this17.logger.error(_context80.t0);\n              case 15:\n              case \"end\":\n                return _context80.stop();\n            }\n          }\n        }, _callee80, null, [[1, 10]]);\n      }));\n      return function (_x90, _x91) {\n        return _ref59.apply(this, arguments);\n      };\n    }(), this.onUnknownRpcMethodResponse = function (i) {\n      _this17.registeredMethods.includes(i) || _this17.logger.error(M(\"WC_METHOD_UNSUPPORTED\", i));\n    }, this.isValidPair = function (i) {\n      if (!se(i)) {\n        var _c12 = c(\"MISSING_OR_INVALID\", \"pair() params: \".concat(i)),\n          s = _c12.message;\n        throw new Error(s);\n      }\n      if (!hi(i.uri)) {\n        var _c13 = c(\"MISSING_OR_INVALID\", \"pair() uri: \".concat(i.uri)),\n          _s2 = _c13.message;\n        throw new Error(_s2);\n      }\n    }, this.isValidPing = /*#__PURE__*/function () {\n      var _ref60 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee81(i) {\n        var _c14, n, s;\n        return _regeneratorRuntime().wrap(function _callee81$(_context81) {\n          while (1) {\n            switch (_context81.prev = _context81.next) {\n              case 0:\n                if (se(i)) {\n                  _context81.next = 3;\n                  break;\n                }\n                _c14 = c(\"MISSING_OR_INVALID\", \"ping() params: \".concat(i)), n = _c14.message;\n                throw new Error(n);\n              case 3:\n                s = i.topic;\n                _context81.next = 6;\n                return _this17.isValidPairingTopic(s);\n              case 6:\n              case \"end\":\n                return _context81.stop();\n            }\n          }\n        }, _callee81);\n      }));\n      return function (_x92) {\n        return _ref60.apply(this, arguments);\n      };\n    }(), this.isValidDisconnect = /*#__PURE__*/function () {\n      var _ref61 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee82(i) {\n        var _c15, n, s;\n        return _regeneratorRuntime().wrap(function _callee82$(_context82) {\n          while (1) {\n            switch (_context82.prev = _context82.next) {\n              case 0:\n                if (se(i)) {\n                  _context82.next = 3;\n                  break;\n                }\n                _c15 = c(\"MISSING_OR_INVALID\", \"disconnect() params: \".concat(i)), n = _c15.message;\n                throw new Error(n);\n              case 3:\n                s = i.topic;\n                _context82.next = 6;\n                return _this17.isValidPairingTopic(s);\n              case 6:\n              case \"end\":\n                return _context82.stop();\n            }\n          }\n        }, _callee82);\n      }));\n      return function (_x93) {\n        return _ref61.apply(this, arguments);\n      };\n    }(), this.isValidPairingTopic = /*#__PURE__*/function () {\n      var _ref62 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee83(i) {\n        var _c16, s, _c17, _s3, _c18, _s4;\n        return _regeneratorRuntime().wrap(function _callee83$(_context83) {\n          while (1) {\n            switch (_context83.prev = _context83.next) {\n              case 0:\n                if (ci(i, !1)) {\n                  _context83.next = 3;\n                  break;\n                }\n                _c16 = c(\"MISSING_OR_INVALID\", \"pairing topic should be a string: \".concat(i)), s = _c16.message;\n                throw new Error(s);\n              case 3:\n                if (_this17.pairings.keys.includes(i)) {\n                  _context83.next = 6;\n                  break;\n                }\n                _c17 = c(\"NO_MATCHING_KEY\", \"pairing topic doesn't exist: \".concat(i)), _s3 = _c17.message;\n                throw new Error(_s3);\n              case 6:\n                if (!ye(_this17.pairings.get(i).expiry)) {\n                  _context83.next = 11;\n                  break;\n                }\n                _context83.next = 9;\n                return _this17.deletePairing(i);\n              case 9:\n                _c18 = c(\"EXPIRED\", \"pairing topic: \".concat(i)), _s4 = _c18.message;\n                throw new Error(_s4);\n              case 11:\n              case \"end\":\n                return _context83.stop();\n            }\n          }\n        }, _callee83);\n      }));\n      return function (_x94) {\n        return _ref62.apply(this, arguments);\n      };\n    }(), this.core = e, this.logger = v(t, this.name), this.pairings = new St(this.core, this.logger, this.name, this.storagePrefix);\n  }\n  _createClass(Tt, [{\n    key: \"context\",\n    get: function get() {\n      return w(this.logger);\n    }\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c19 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c19.message;\n        throw new Error(e);\n      }\n    }\n  }, {\n    key: \"registerRelayerEvents\",\n    value: function registerRelayerEvents() {\n      var _this18 = this;\n      this.core.relayer.on(U.message, /*#__PURE__*/function () {\n        var _ref63 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee84(e) {\n          var t, i, s;\n          return _regeneratorRuntime().wrap(function _callee84$(_context84) {\n            while (1) {\n              switch (_context84.prev = _context84.next) {\n                case 0:\n                  t = e.topic, i = e.message;\n                  if (!_this18.ignoredPayloadTypes.includes(_this18.core.crypto.getPayloadType(i))) {\n                    _context84.next = 3;\n                    break;\n                  }\n                  return _context84.abrupt(\"return\");\n                case 3:\n                  _context84.next = 5;\n                  return _this18.core.crypto.decode(t, i);\n                case 5:\n                  s = _context84.sent;\n                  if (!Ee(s)) {\n                    _context84.next = 10;\n                    break;\n                  }\n                  _this18.core.history.set(t, s), _this18.onRelayEventRequest({\n                    topic: t,\n                    payload: s\n                  });\n                  _context84.next = 15;\n                  break;\n                case 10:\n                  _context84.t0 = Ei(s);\n                  if (!_context84.t0) {\n                    _context84.next = 15;\n                    break;\n                  }\n                  _context84.next = 14;\n                  return _this18.core.history.resolve(s);\n                case 14:\n                  _this18.onRelayEventResponse({\n                    topic: t,\n                    payload: s\n                  });\n                case 15:\n                case \"end\":\n                  return _context84.stop();\n              }\n            }\n          }, _callee84);\n        }));\n        return function (_x95) {\n          return _ref63.apply(this, arguments);\n        };\n      }());\n    }\n  }, {\n    key: \"registerExpirerEvents\",\n    value: function registerExpirerEvents() {\n      var _this19 = this;\n      this.core.expirer.on(m.expired, /*#__PURE__*/function () {\n        var _ref64 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee85(e) {\n          var _ui, t;\n          return _regeneratorRuntime().wrap(function _callee85$(_context85) {\n            while (1) {\n              switch (_context85.prev = _context85.next) {\n                case 0:\n                  _ui = ui(e.target), t = _ui.topic;\n                  _context85.t0 = t && _this19.pairings.keys.includes(t);\n                  if (!_context85.t0) {\n                    _context85.next = 6;\n                    break;\n                  }\n                  _context85.next = 5;\n                  return _this19.deletePairing(t, !0);\n                case 5:\n                  _this19.events.emit(\"pairing_expire\", {\n                    topic: t\n                  });\n                case 6:\n                case \"end\":\n                  return _context85.stop();\n              }\n            }\n          }, _callee85);\n        }));\n        return function (_x96) {\n          return _ref64.apply(this, arguments);\n        };\n      }());\n    }\n  }]);\n  return Tt;\n}();\nvar xt = /*#__PURE__*/function (_kt) {\n  _inherits(xt, _kt);\n  var _super6 = _createSuper(xt);\n  function xt(e, t) {\n    var _this20;\n    _classCallCheck(this, xt);\n    _this20 = _super6.call(this, e, t), _this20.core = e, _this20.logger = t, _this20.records = new Map(), _this20.events = new z.EventEmitter(), _this20.name = lt, _this20.version = dt, _this20.cached = [], _this20.initialized = !1, _this20.storagePrefix = x, _this20.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee86() {\n      return _regeneratorRuntime().wrap(function _callee86$(_context86) {\n        while (1) {\n          switch (_context86.prev = _context86.next) {\n            case 0:\n              _context86.t0 = _this20.initialized;\n              if (_context86.t0) {\n                _context86.next = 9;\n                break;\n              }\n              _this20.logger.trace(\"Initialized\");\n              _context86.next = 5;\n              return _this20.restore();\n            case 5:\n              _this20.cached.forEach(function (i) {\n                return _this20.records.set(i.id, i);\n              });\n              _this20.cached = [];\n              _this20.registerEventListeners();\n              _this20.initialized = !0;\n            case 9:\n            case \"end\":\n              return _context86.stop();\n          }\n        }\n      }, _callee86);\n    })), _this20.set = function (i, s, n) {\n      if (_this20.isInitialized(), _this20.logger.debug(\"Setting JSON-RPC request history record\"), _this20.logger.trace({\n        type: \"method\",\n        method: \"set\",\n        topic: i,\n        request: s,\n        chainId: n\n      }), _this20.records.has(s.id)) return;\n      var a = {\n        id: s.id,\n        topic: i,\n        request: {\n          method: s.method,\n          params: s.params || null\n        },\n        chainId: n\n      };\n      _this20.records.set(a.id, a), _this20.events.emit(_.created, a);\n    }, _this20.resolve = /*#__PURE__*/function () {\n      var _ref66 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee87(i) {\n        var s;\n        return _regeneratorRuntime().wrap(function _callee87$(_context87) {\n          while (1) {\n            switch (_context87.prev = _context87.next) {\n              case 0:\n                if (!(_this20.isInitialized(), _this20.logger.debug(\"Updating JSON-RPC response history record\"), _this20.logger.trace({\n                  type: \"method\",\n                  method: \"update\",\n                  response: i\n                }), !_this20.records.has(i.id))) {\n                  _context87.next = 2;\n                  break;\n                }\n                return _context87.abrupt(\"return\");\n              case 2:\n                _context87.next = 4;\n                return _this20.getRecord(i.id);\n              case 4:\n                s = _context87.sent;\n                typeof s.response > \"u\" && (s.response = _e(i) ? {\n                  error: i.error\n                } : {\n                  result: i.result\n                }, _this20.records.set(s.id, s), _this20.events.emit(_.updated, s));\n              case 6:\n              case \"end\":\n                return _context87.stop();\n            }\n          }\n        }, _callee87);\n      }));\n      return function (_x97) {\n        return _ref66.apply(this, arguments);\n      };\n    }(), _this20.get = /*#__PURE__*/function () {\n      var _ref67 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee88(i, s) {\n        return _regeneratorRuntime().wrap(function _callee88$(_context88) {\n          while (1) {\n            switch (_context88.prev = _context88.next) {\n              case 0:\n                _this20.isInitialized();\n                _this20.logger.debug(\"Getting record\");\n                _this20.logger.trace({\n                  type: \"method\",\n                  method: \"get\",\n                  topic: i,\n                  id: s\n                });\n                _context88.next = 5;\n                return _this20.getRecord(s);\n              case 5:\n                return _context88.abrupt(\"return\", _context88.sent);\n              case 6:\n              case \"end\":\n                return _context88.stop();\n            }\n          }\n        }, _callee88);\n      }));\n      return function (_x98, _x99) {\n        return _ref67.apply(this, arguments);\n      };\n    }(), _this20.delete = function (i, s) {\n      _this20.isInitialized(), _this20.logger.debug(\"Deleting record\"), _this20.logger.trace({\n        type: \"method\",\n        method: \"delete\",\n        id: s\n      }), _this20.values.forEach(function (n) {\n        if (n.topic === i) {\n          if (typeof s < \"u\" && n.id !== s) return;\n          _this20.records.delete(n.id), _this20.events.emit(_.deleted, n);\n        }\n      });\n    }, _this20.exists = /*#__PURE__*/function () {\n      var _ref68 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee89(i, s) {\n        return _regeneratorRuntime().wrap(function _callee89$(_context89) {\n          while (1) {\n            switch (_context89.prev = _context89.next) {\n              case 0:\n                _this20.isInitialized();\n                if (!_this20.records.has(s)) {\n                  _context89.next = 9;\n                  break;\n                }\n                _context89.next = 4;\n                return _this20.getRecord(s);\n              case 4:\n                _context89.t1 = _context89.sent.topic;\n                _context89.t2 = i;\n                _context89.t0 = _context89.t1 === _context89.t2;\n                _context89.next = 10;\n                break;\n              case 9:\n                _context89.t0 = !1;\n              case 10:\n                return _context89.abrupt(\"return\", _context89.t0);\n              case 11:\n              case \"end\":\n                return _context89.stop();\n            }\n          }\n        }, _callee89);\n      }));\n      return function (_x100, _x101) {\n        return _ref68.apply(this, arguments);\n      };\n    }(), _this20.on = function (i, s) {\n      _this20.events.on(i, s);\n    }, _this20.once = function (i, s) {\n      _this20.events.once(i, s);\n    }, _this20.off = function (i, s) {\n      _this20.events.off(i, s);\n    }, _this20.removeListener = function (i, s) {\n      _this20.events.removeListener(i, s);\n    }, _this20.logger = v(t, _this20.name);\n    return _this20;\n  }\n  _createClass(xt, [{\n    key: \"context\",\n    get: function get() {\n      return w(this.logger);\n    }\n  }, {\n    key: \"storageKey\",\n    get: function get() {\n      return this.storagePrefix + this.version + \"//\" + this.name;\n    }\n  }, {\n    key: \"size\",\n    get: function get() {\n      return this.records.size;\n    }\n  }, {\n    key: \"keys\",\n    get: function get() {\n      return Array.from(this.records.keys());\n    }\n  }, {\n    key: \"values\",\n    get: function get() {\n      return Array.from(this.records.values());\n    }\n  }, {\n    key: \"pending\",\n    get: function get() {\n      var e = [];\n      return this.values.forEach(function (t) {\n        if (typeof t.response < \"u\") return;\n        var i = {\n          topic: t.topic,\n          request: we(t.request.method, t.request.params, t.id),\n          chainId: t.chainId\n        };\n        return e.push(i);\n      }), e;\n    }\n  }, {\n    key: \"setJsonRpcRecords\",\n    value: function () {\n      var _setJsonRpcRecords = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee90(e) {\n        return _regeneratorRuntime().wrap(function _callee90$(_context90) {\n          while (1) {\n            switch (_context90.prev = _context90.next) {\n              case 0:\n                _context90.next = 2;\n                return this.core.storage.setItem(this.storageKey, e);\n              case 2:\n              case \"end\":\n                return _context90.stop();\n            }\n          }\n        }, _callee90, this);\n      }));\n      function setJsonRpcRecords(_x102) {\n        return _setJsonRpcRecords.apply(this, arguments);\n      }\n      return setJsonRpcRecords;\n    }()\n  }, {\n    key: \"getJsonRpcRecords\",\n    value: function () {\n      var _getJsonRpcRecords = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee91() {\n        return _regeneratorRuntime().wrap(function _callee91$(_context91) {\n          while (1) {\n            switch (_context91.prev = _context91.next) {\n              case 0:\n                _context91.next = 2;\n                return this.core.storage.getItem(this.storageKey);\n              case 2:\n                return _context91.abrupt(\"return\", _context91.sent);\n              case 3:\n              case \"end\":\n                return _context91.stop();\n            }\n          }\n        }, _callee91, this);\n      }));\n      function getJsonRpcRecords() {\n        return _getJsonRpcRecords.apply(this, arguments);\n      }\n      return getJsonRpcRecords;\n    }()\n  }, {\n    key: \"getRecord\",\n    value: function getRecord(e) {\n      this.isInitialized();\n      var t = this.records.get(e);\n      if (!t) {\n        var _c20 = c(\"NO_MATCHING_KEY\", \"\".concat(this.name, \": \").concat(e)),\n          i = _c20.message;\n        throw new Error(i);\n      }\n      return t;\n    }\n  }, {\n    key: \"persist\",\n    value: function () {\n      var _persist5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee92() {\n        return _regeneratorRuntime().wrap(function _callee92$(_context92) {\n          while (1) {\n            switch (_context92.prev = _context92.next) {\n              case 0:\n                _context92.next = 2;\n                return this.setJsonRpcRecords(this.values);\n              case 2:\n                this.events.emit(_.sync);\n              case 3:\n              case \"end\":\n                return _context92.stop();\n            }\n          }\n        }, _callee92, this);\n      }));\n      function persist() {\n        return _persist5.apply(this, arguments);\n      }\n      return persist;\n    }()\n  }, {\n    key: \"restore\",\n    value: function () {\n      var _restore3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee93() {\n        var e, _c21, t;\n        return _regeneratorRuntime().wrap(function _callee93$(_context93) {\n          while (1) {\n            switch (_context93.prev = _context93.next) {\n              case 0:\n                _context93.prev = 0;\n                _context93.next = 3;\n                return this.getJsonRpcRecords();\n              case 3:\n                e = _context93.sent;\n                if (!(typeof e > \"u\" || !e.length)) {\n                  _context93.next = 6;\n                  break;\n                }\n                return _context93.abrupt(\"return\");\n              case 6:\n                if (!this.records.size) {\n                  _context93.next = 9;\n                  break;\n                }\n                _c21 = c(\"RESTORE_WILL_OVERRIDE\", this.name), t = _c21.message;\n                throw this.logger.error(t), new Error(t);\n              case 9:\n                this.cached = e, this.logger.debug(\"Successfully Restored records for \".concat(this.name)), this.logger.trace({\n                  type: \"method\",\n                  method: \"restore\",\n                  records: this.values\n                });\n                _context93.next = 15;\n                break;\n              case 12:\n                _context93.prev = 12;\n                _context93.t0 = _context93[\"catch\"](0);\n                this.logger.debug(\"Failed to Restore records for \".concat(this.name)), this.logger.error(_context93.t0);\n              case 15:\n              case \"end\":\n                return _context93.stop();\n            }\n          }\n        }, _callee93, this, [[0, 12]]);\n      }));\n      function restore() {\n        return _restore3.apply(this, arguments);\n      }\n      return restore;\n    }()\n  }, {\n    key: \"registerEventListeners\",\n    value: function registerEventListeners() {\n      var _this21 = this;\n      this.events.on(_.created, function (e) {\n        var t = _.created;\n        _this21.logger.info(\"Emitting \".concat(t)), _this21.logger.debug({\n          type: \"event\",\n          event: t,\n          record: e\n        }), _this21.persist();\n      }), this.events.on(_.updated, function (e) {\n        var t = _.updated;\n        _this21.logger.info(\"Emitting \".concat(t)), _this21.logger.debug({\n          type: \"event\",\n          event: t,\n          record: e\n        }), _this21.persist();\n      }), this.events.on(_.deleted, function (e) {\n        var t = _.deleted;\n        _this21.logger.info(\"Emitting \".concat(t)), _this21.logger.debug({\n          type: \"event\",\n          event: t,\n          record: e\n        }), _this21.persist();\n      });\n    }\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c22 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c22.message;\n        throw new Error(e);\n      }\n    }\n  }]);\n  return xt;\n}(kt);\nvar Pt = /*#__PURE__*/function (_Bt) {\n  _inherits(Pt, _Bt);\n  var _super7 = _createSuper(Pt);\n  function Pt(e, t) {\n    var _this22;\n    _classCallCheck(this, Pt);\n    _this22 = _super7.call(this, e, t), _this22.core = e, _this22.logger = t, _this22.expirations = new Map(), _this22.events = new z.EventEmitter(), _this22.name = gt, _this22.version = pt, _this22.cached = [], _this22.initialized = !1, _this22.storagePrefix = x, _this22.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee94() {\n      return _regeneratorRuntime().wrap(function _callee94$(_context94) {\n        while (1) {\n          switch (_context94.prev = _context94.next) {\n            case 0:\n              _context94.t0 = _this22.initialized;\n              if (_context94.t0) {\n                _context94.next = 9;\n                break;\n              }\n              _this22.logger.trace(\"Initialized\");\n              _context94.next = 5;\n              return _this22.restore();\n            case 5:\n              _this22.cached.forEach(function (i) {\n                return _this22.expirations.set(i.target, i);\n              });\n              _this22.cached = [];\n              _this22.registerEventListeners();\n              _this22.initialized = !0;\n            case 9:\n            case \"end\":\n              return _context94.stop();\n          }\n        }\n      }, _callee94);\n    })), _this22.has = function (i) {\n      try {\n        var s = _this22.formatTarget(i);\n        return typeof _this22.getExpiration(s) < \"u\";\n      } catch (_unused3) {\n        return !1;\n      }\n    }, _this22.set = function (i, s) {\n      _this22.isInitialized();\n      var n = _this22.formatTarget(i),\n        a = {\n          target: n,\n          expiry: s\n        };\n      _this22.expirations.set(n, a), _this22.checkExpiry(n, a), _this22.events.emit(m.created, {\n        target: n,\n        expiration: a\n      });\n    }, _this22.get = function (i) {\n      _this22.isInitialized();\n      var s = _this22.formatTarget(i);\n      return _this22.getExpiration(s);\n    }, _this22.del = function (i) {\n      _this22.isInitialized();\n      var s = _this22.formatTarget(i);\n      if (_this22.has(s)) {\n        var n = _this22.getExpiration(s);\n        _this22.expirations.delete(s), _this22.events.emit(m.deleted, {\n          target: s,\n          expiration: n\n        });\n      }\n    }, _this22.on = function (i, s) {\n      _this22.events.on(i, s);\n    }, _this22.once = function (i, s) {\n      _this22.events.once(i, s);\n    }, _this22.off = function (i, s) {\n      _this22.events.off(i, s);\n    }, _this22.removeListener = function (i, s) {\n      _this22.events.removeListener(i, s);\n    }, _this22.logger = v(t, _this22.name);\n    return _this22;\n  }\n  _createClass(Pt, [{\n    key: \"context\",\n    get: function get() {\n      return w(this.logger);\n    }\n  }, {\n    key: \"storageKey\",\n    get: function get() {\n      return this.storagePrefix + this.version + \"//\" + this.name;\n    }\n  }, {\n    key: \"length\",\n    get: function get() {\n      return this.expirations.size;\n    }\n  }, {\n    key: \"keys\",\n    get: function get() {\n      return Array.from(this.expirations.keys());\n    }\n  }, {\n    key: \"values\",\n    get: function get() {\n      return Array.from(this.expirations.values());\n    }\n  }, {\n    key: \"formatTarget\",\n    value: function formatTarget(e) {\n      if (typeof e == \"string\") return li(e);\n      if (typeof e == \"number\") return di(e);\n      var _c23 = c(\"UNKNOWN_TYPE\", \"Target type: \".concat(typeof e)),\n        t = _c23.message;\n      throw new Error(t);\n    }\n  }, {\n    key: \"setExpirations\",\n    value: function () {\n      var _setExpirations = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee95(e) {\n        return _regeneratorRuntime().wrap(function _callee95$(_context95) {\n          while (1) {\n            switch (_context95.prev = _context95.next) {\n              case 0:\n                _context95.next = 2;\n                return this.core.storage.setItem(this.storageKey, e);\n              case 2:\n              case \"end\":\n                return _context95.stop();\n            }\n          }\n        }, _callee95, this);\n      }));\n      function setExpirations(_x103) {\n        return _setExpirations.apply(this, arguments);\n      }\n      return setExpirations;\n    }()\n  }, {\n    key: \"getExpirations\",\n    value: function () {\n      var _getExpirations = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee96() {\n        return _regeneratorRuntime().wrap(function _callee96$(_context96) {\n          while (1) {\n            switch (_context96.prev = _context96.next) {\n              case 0:\n                _context96.next = 2;\n                return this.core.storage.getItem(this.storageKey);\n              case 2:\n                return _context96.abrupt(\"return\", _context96.sent);\n              case 3:\n              case \"end\":\n                return _context96.stop();\n            }\n          }\n        }, _callee96, this);\n      }));\n      function getExpirations() {\n        return _getExpirations.apply(this, arguments);\n      }\n      return getExpirations;\n    }()\n  }, {\n    key: \"persist\",\n    value: function () {\n      var _persist6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee97() {\n        return _regeneratorRuntime().wrap(function _callee97$(_context97) {\n          while (1) {\n            switch (_context97.prev = _context97.next) {\n              case 0:\n                _context97.next = 2;\n                return this.setExpirations(this.values);\n              case 2:\n                this.events.emit(m.sync);\n              case 3:\n              case \"end\":\n                return _context97.stop();\n            }\n          }\n        }, _callee97, this);\n      }));\n      function persist() {\n        return _persist6.apply(this, arguments);\n      }\n      return persist;\n    }()\n  }, {\n    key: \"restore\",\n    value: function () {\n      var _restore4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee98() {\n        var e, _c24, t;\n        return _regeneratorRuntime().wrap(function _callee98$(_context98) {\n          while (1) {\n            switch (_context98.prev = _context98.next) {\n              case 0:\n                _context98.prev = 0;\n                _context98.next = 3;\n                return this.getExpirations();\n              case 3:\n                e = _context98.sent;\n                if (!(typeof e > \"u\" || !e.length)) {\n                  _context98.next = 6;\n                  break;\n                }\n                return _context98.abrupt(\"return\");\n              case 6:\n                if (!this.expirations.size) {\n                  _context98.next = 9;\n                  break;\n                }\n                _c24 = c(\"RESTORE_WILL_OVERRIDE\", this.name), t = _c24.message;\n                throw this.logger.error(t), new Error(t);\n              case 9:\n                this.cached = e, this.logger.debug(\"Successfully Restored expirations for \".concat(this.name)), this.logger.trace({\n                  type: \"method\",\n                  method: \"restore\",\n                  expirations: this.values\n                });\n                _context98.next = 15;\n                break;\n              case 12:\n                _context98.prev = 12;\n                _context98.t0 = _context98[\"catch\"](0);\n                this.logger.debug(\"Failed to Restore expirations for \".concat(this.name)), this.logger.error(_context98.t0);\n              case 15:\n              case \"end\":\n                return _context98.stop();\n            }\n          }\n        }, _callee98, this, [[0, 12]]);\n      }));\n      function restore() {\n        return _restore4.apply(this, arguments);\n      }\n      return restore;\n    }()\n  }, {\n    key: \"getExpiration\",\n    value: function getExpiration(e) {\n      var t = this.expirations.get(e);\n      if (!t) {\n        var _c25 = c(\"NO_MATCHING_KEY\", \"\".concat(this.name, \": \").concat(e)),\n          i = _c25.message;\n        throw this.logger.error(i), new Error(i);\n      }\n      return t;\n    }\n  }, {\n    key: \"checkExpiry\",\n    value: function checkExpiry(e, t) {\n      var i = t.expiry;\n      me(i) - Date.now() <= 0 && this.expire(e, t);\n    }\n  }, {\n    key: \"expire\",\n    value: function expire(e, t) {\n      this.expirations.delete(e), this.events.emit(m.expired, {\n        target: e,\n        expiration: t\n      });\n    }\n  }, {\n    key: \"checkExpirations\",\n    value: function checkExpirations() {\n      var _this23 = this;\n      this.expirations.forEach(function (e, t) {\n        return _this23.checkExpiry(t, e);\n      });\n    }\n  }, {\n    key: \"registerEventListeners\",\n    value: function registerEventListeners() {\n      var _this24 = this;\n      this.core.heartbeat.on(X.pulse, function () {\n        return _this24.checkExpirations();\n      }), this.events.on(m.created, function (e) {\n        var t = m.created;\n        _this24.logger.info(\"Emitting \".concat(t)), _this24.logger.debug({\n          type: \"event\",\n          event: t,\n          data: e\n        }), _this24.persist();\n      }), this.events.on(m.expired, function (e) {\n        var t = m.expired;\n        _this24.logger.info(\"Emitting \".concat(t)), _this24.logger.debug({\n          type: \"event\",\n          event: t,\n          data: e\n        }), _this24.persist();\n      }), this.events.on(m.deleted, function (e) {\n        var t = m.deleted;\n        _this24.logger.info(\"Emitting \".concat(t)), _this24.logger.debug({\n          type: \"event\",\n          event: t,\n          data: e\n        }), _this24.persist();\n      });\n    }\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c26 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c26.message;\n        throw new Error(e);\n      }\n    }\n  }]);\n  return Pt;\n}(Bt);\nvar dr = Object.defineProperty,\n  Ot = Object.getOwnPropertySymbols,\n  gr = Object.prototype.hasOwnProperty,\n  pr = Object.prototype.propertyIsEnumerable,\n  At = function At(r, e, t) {\n    return e in r ? dr(r, e, {\n      enumerable: !0,\n      configurable: !0,\n      writable: !0,\n      value: t\n    }) : r[e] = t;\n  },\n  zt = function zt(r, e) {\n    for (var t in e || (e = {})) {\n      gr.call(e, t) && At(r, t, e[t]);\n    }\n    if (Ot) {\n      var _iterator5 = _createForOfIteratorHelper(Ot(e)),\n        _step5;\n      try {\n        for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n          var t = _step5.value;\n          pr.call(e, t) && At(r, t, e[t]);\n        }\n      } catch (err) {\n        _iterator5.e(err);\n      } finally {\n        _iterator5.f();\n      }\n    }\n    return r;\n  };\nvar J = /*#__PURE__*/function (_jt) {\n  _inherits(J, _jt);\n  var _super8 = _createSuper(J);\n  function J(e) {\n    var _this25;\n    _classCallCheck(this, J);\n    _this25 = _super8.call(this, e), _this25.protocol = he, _this25.version = ke, _this25.name = G, _this25.events = new z.EventEmitter(), _this25.initialized = !1, _this25.on = function (i, s) {\n      return _this25.events.on(i, s);\n    }, _this25.once = function (i, s) {\n      return _this25.events.once(i, s);\n    }, _this25.off = function (i, s) {\n      return _this25.events.off(i, s);\n    }, _this25.removeListener = function (i, s) {\n      return _this25.events.removeListener(i, s);\n    }, _this25.projectId = e === null || e === void 0 ? void 0 : e.projectId;\n    var t = typeof (e === null || e === void 0 ? void 0 : e.logger) < \"u\" && typeof (e === null || e === void 0 ? void 0 : e.logger) != \"string\" ? e.logger : le(de({\n      level: (e === null || e === void 0 ? void 0 : e.logger) || Be.logger\n    }));\n    _this25.logger = v(t, _this25.name), _this25.heartbeat = new Lt(), _this25.crypto = new yt(_assertThisInitialized(_this25), _this25.logger, e === null || e === void 0 ? void 0 : e.keychain), _this25.history = new xt(_assertThisInitialized(_this25), _this25.logger), _this25.expirer = new Pt(_assertThisInitialized(_this25), _this25.logger), _this25.storage = e != null && e.storage ? e.storage : new Nt(zt(zt({}, je), e === null || e === void 0 ? void 0 : e.storageOptions)), _this25.relayer = new _t({\n      core: _assertThisInitialized(_this25),\n      logger: _this25.logger,\n      relayUrl: e === null || e === void 0 ? void 0 : e.relayUrl,\n      projectId: _this25.projectId\n    }), _this25.pairing = new Tt(_assertThisInitialized(_this25), _this25.logger);\n    return _this25;\n  }\n  _createClass(J, [{\n    key: \"context\",\n    get: function get() {\n      return w(this.logger);\n    }\n  }, {\n    key: \"start\",\n    value: function () {\n      var _start = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee99() {\n        return _regeneratorRuntime().wrap(function _callee99$(_context99) {\n          while (1) {\n            switch (_context99.prev = _context99.next) {\n              case 0:\n                _context99.t0 = this.initialized;\n                if (_context99.t0) {\n                  _context99.next = 4;\n                  break;\n                }\n                _context99.next = 4;\n                return this.initialize();\n              case 4:\n              case \"end\":\n                return _context99.stop();\n            }\n          }\n        }, _callee99, this);\n      }));\n      function start() {\n        return _start.apply(this, arguments);\n      }\n      return start;\n    }()\n  }, {\n    key: \"initialize\",\n    value: function () {\n      var _initialize = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee100() {\n        return _regeneratorRuntime().wrap(function _callee100$(_context100) {\n          while (1) {\n            switch (_context100.prev = _context100.next) {\n              case 0:\n                this.logger.trace(\"Initialized\");\n                _context100.prev = 1;\n                _context100.next = 4;\n                return this.crypto.init();\n              case 4:\n                _context100.next = 6;\n                return this.history.init();\n              case 6:\n                _context100.next = 8;\n                return this.expirer.init();\n              case 8:\n                _context100.next = 10;\n                return this.relayer.init();\n              case 10:\n                _context100.next = 12;\n                return this.heartbeat.init();\n              case 12:\n                _context100.next = 14;\n                return this.pairing.init();\n              case 14:\n                this.initialized = !0;\n                this.logger.info(\"Core Initilization Success\");\n                _context100.next = 21;\n                break;\n              case 18:\n                _context100.prev = 18;\n                _context100.t0 = _context100[\"catch\"](1);\n                throw this.logger.warn(\"Core Initilization Failure at epoch \".concat(Date.now()), _context100.t0), this.logger.error(_context100.t0.message), _context100.t0;\n              case 21:\n              case \"end\":\n                return _context100.stop();\n            }\n          }\n        }, _callee100, this, [[1, 18]]);\n      }));\n      function initialize() {\n        return _initialize.apply(this, arguments);\n      }\n      return initialize;\n    }()\n  }], [{\n    key: \"init\",\n    value: function () {\n      var _init2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee101(e) {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee101$(_context101) {\n          while (1) {\n            switch (_context101.prev = _context101.next) {\n              case 0:\n                t = new J(e);\n                _context101.next = 3;\n                return t.initialize();\n              case 3:\n                return _context101.abrupt(\"return\", t);\n              case 4:\n              case \"end\":\n                return _context101.stop();\n            }\n          }\n        }, _callee101);\n      }));\n      function init(_x104) {\n        return _init2.apply(this, arguments);\n      }\n      return init;\n    }()\n  }]);\n  return J;\n}(jt);\nvar Dr = J;\nexport { G as CORE_CONTEXT, Be as CORE_DEFAULT, he as CORE_PROTOCOL, je as CORE_STORAGE_OPTIONS, x as CORE_STORAGE_PREFIX, ke as CORE_VERSION, ce as CRYPTO_CLIENT_SEED, Ve as CRYPTO_CONTEXT, qe as CRYPTO_JWT_TTL, Dr as Core, yt as Crypto, gt as EXPIRER_CONTEXT, Ws as EXPIRER_DEFAULT_TTL, m as EXPIRER_EVENTS, pt as EXPIRER_STORAGE_VERSION, Pt as Expirer, lt as HISTORY_CONTEXT, _ as HISTORY_EVENTS, dt as HISTORY_STORAGE_VERSION, xt as JsonRpcHistory, Ge as KEYCHAIN_CONTEXT, Ye as KEYCHAIN_STORAGE_VERSION, Dt as KeyChain, Je as MESSAGES_CONTEXT, He as MESSAGES_STORAGE_VERSION, ft as MessageTracker, ct as PAIRING_CONTEXT, Xs as PAIRING_DEFAULT_TTL, F as PAIRING_RPC_OPTS, ut as PAIRING_STORAGE_VERSION, ht as PENDING_SUB_RESOLUTION_TIMEOUT, We as PUBLISHER_CONTEXT, Xe as PUBLISHER_DEFAULT_TTL, Tt as Pairing, tt as RELAYER_CONTEXT, Qe as RELAYER_DEFAULT_LOGGER, Ze as RELAYER_DEFAULT_PROTOCOL, et as RELAYER_DEFAULT_RELAY_URL, U as RELAYER_EVENTS, N as RELAYER_PROVIDER_EVENTS, st as RELAYER_RECONNECT_TIMEOUT, rt as RELAYER_SDK_VERSION, Js as RELAYER_STORAGE_OPTIONS, it as RELAYER_SUBSCRIBER_SUFFIX, _t as Relayer, nt as STORE_STORAGE_VERSION, at as SUBSCRIBER_CONTEXT, Hs as SUBSCRIBER_DEFAULT_TTL, O as SUBSCRIBER_EVENTS, ot as SUBSCRIBER_STORAGE_VERSION, St as Store, Et as Subscriber, J as default };","map":{"version":3,"mappings":"","names":[],"sources":[],"sourcesContent":["import le from\"pino\";import Nt from\"@walletconnect/keyvaluestorage\";import{HEARTBEAT_EVENTS as X,HeartBeat as Lt}from\"@walletconnect/heartbeat\";import{generateChildLogger as v,getLoggerContext as w,getDefaultLoggerOptions as de}from\"@walletconnect/logger\";import{IMessageTracker as Ut,IPublisher as Ft,ISubscriber as Mt,IRelayer as $t,IStore as Kt,IJsonRpcHistory as kt,IExpirer as Bt,ICore as jt}from\"@walletconnect/types\";import{safeJsonStringify as Vt,safeJsonParse as qt}from\"@walletconnect/safe-json\";import*as j from\"@walletconnect/relay-auth\";import{getInternalError as c,mapToObj as ge,objToMap as pe,generateKeyPair as Gt,generateRandomBytes32 as W,deriveSymKey as Yt,hashKey as Jt,validateEncoding as Ht,isTypeOneEnvelope as De,encrypt as Xt,validateDecoding as Wt,decrypt as Zt,deserialize as Qt,decodeTypeByte as ei,hashMessage as V,getRelayProtocolName as Z,getRelayProtocolApi as Q,isUndefined as ee,getSdkError as M,formatRelayRpcUrl as ti,isProposalStruct as ii,isSessionStruct as si,TYPE_1 as ri,calcExpiry as te,formatUri as ni,parseUri as ai,createDelayedPromise as oi,engineEvent as ie,isExpired as ye,isValidParams as se,isValidUrl as hi,isValidString as ci,parseExpirerTarget as ui,formatTopicTarget as li,formatIdTarget as di}from\"@walletconnect/utils\";import{ONE_DAY as L,SIX_HOURS as gi,ONE_SECOND as pi,THIRTY_DAYS as re,FIVE_SECONDS as Di,THIRTY_SECONDS as fe,Watch as yi,toMiliseconds as me,FIVE_MINUTES as be}from\"@walletconnect/time\";import{JsonRpcProvider as fi}from\"@walletconnect/jsonrpc-provider\";import{isJsonRpcRequest as Ee,formatJsonRpcResult as ve,formatJsonRpcRequest as we,formatJsonRpcError as mi,isJsonRpcResult as bi,isJsonRpcError as _e,isJsonRpcResponse as Ei}from\"@walletconnect/jsonrpc-utils\";import vi from\"@walletconnect/jsonrpc-ws-connection\";import wi from\"lodash.isequal\";function p(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}var z=p;p.EventEmitter=p,p.prototype._events=void 0,p.prototype._maxListeners=void 0,p.defaultMaxListeners=10,p.prototype.setMaxListeners=function(r){if(!_i(r)||r<0||isNaN(r))throw TypeError(\"n must be a positive number\");return this._maxListeners=r,this},p.prototype.emit=function(r){var e,t,i,s,n,a;if(this._events||(this._events={}),r===\"error\"&&(!this._events.error||$(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var o=new Error('Uncaught, unspecified \"error\" event. ('+e+\")\");throw o.context=e,o}if(t=this._events[r],Ie(t))return!1;if(T(t))switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),t.apply(this,s)}else if($(t))for(s=Array.prototype.slice.call(arguments,1),a=t.slice(),i=a.length,n=0;n<i;n++)a[n].apply(this,s);return!0},p.prototype.addListener=function(r,e){var t;if(!T(e))throw TypeError(\"listener must be a function\");return this._events||(this._events={}),this._events.newListener&&this.emit(\"newListener\",r,T(e.listener)?e.listener:e),this._events[r]?$(this._events[r])?this._events[r].push(e):this._events[r]=[this._events[r],e]:this._events[r]=e,$(this._events[r])&&!this._events[r].warned&&(Ie(this._maxListeners)?t=p.defaultMaxListeners:t=this._maxListeners,t&&t>0&&this._events[r].length>t&&(this._events[r].warned=!0,console.error(\"(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.\",this._events[r].length),typeof console.trace==\"function\"&&console.trace())),this},p.prototype.on=p.prototype.addListener,p.prototype.once=function(r,e){if(!T(e))throw TypeError(\"listener must be a function\");var t=!1;function i(){this.removeListener(r,i),t||(t=!0,e.apply(this,arguments))}return i.listener=e,this.on(r,i),this},p.prototype.removeListener=function(r,e){var t,i,s,n;if(!T(e))throw TypeError(\"listener must be a function\");if(!this._events||!this._events[r])return this;if(t=this._events[r],s=t.length,i=-1,t===e||T(t.listener)&&t.listener===e)delete this._events[r],this._events.removeListener&&this.emit(\"removeListener\",r,e);else if($(t)){for(n=s;n-- >0;)if(t[n]===e||t[n].listener&&t[n].listener===e){i=n;break}if(i<0)return this;t.length===1?(t.length=0,delete this._events[r]):t.splice(i,1),this._events.removeListener&&this.emit(\"removeListener\",r,e)}return this},p.prototype.removeAllListeners=function(r){var e,t;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[r]&&delete this._events[r],this;if(arguments.length===0){for(e in this._events)e!==\"removeListener\"&&this.removeAllListeners(e);return this.removeAllListeners(\"removeListener\"),this._events={},this}if(t=this._events[r],T(t))this.removeListener(r,t);else if(t)for(;t.length;)this.removeListener(r,t[t.length-1]);return delete this._events[r],this},p.prototype.listeners=function(r){var e;return!this._events||!this._events[r]?e=[]:T(this._events[r])?e=[this._events[r]]:e=this._events[r].slice(),e},p.prototype.listenerCount=function(r){if(this._events){var e=this._events[r];if(T(e))return 1;if(e)return e.length}return 0},p.listenerCount=function(r,e){return r.listenerCount(e)};function T(r){return typeof r==\"function\"}function _i(r){return typeof r==\"number\"}function $(r){return typeof r==\"object\"&&r!==null}function Ie(r){return r===void 0}function Ii(r,e){if(r.length>=255)throw new TypeError(\"Alphabet too long\");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),a=n.charCodeAt(0);if(t[a]!==255)throw new TypeError(n+\" is ambiguous\");t[a]=s}var o=r.length,h=r.charAt(0),l=Math.log(o)/Math.log(256),d=Math.log(256)/Math.log(o);function g(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError(\"Expected Uint8Array\");if(u.length===0)return\"\";for(var y=0,A=0,b=0,I=u.length;b!==I&&u[b]===0;)b++,y++;for(var C=(I-b)*d+1>>>0,f=new Uint8Array(C);b!==I;){for(var R=u[b],P=0,E=C-1;(R!==0||P<A)&&E!==-1;E--,P++)R+=256*f[E]>>>0,f[E]=R%o>>>0,R=R/o>>>0;if(R!==0)throw new Error(\"Non-zero carry\");A=P,b++}for(var S=C-A;S!==C&&f[S]===0;)S++;for(var B=h.repeat(y);S<C;++S)B+=r.charAt(f[S]);return B}function k(u){if(typeof u!=\"string\")throw new TypeError(\"Expected String\");if(u.length===0)return new Uint8Array;var y=0;if(u[y]!==\" \"){for(var A=0,b=0;u[y]===h;)A++,y++;for(var I=(u.length-y)*l+1>>>0,C=new Uint8Array(I);u[y];){var f=t[u.charCodeAt(y)];if(f===255)return;for(var R=0,P=I-1;(f!==0||R<b)&&P!==-1;P--,R++)f+=o*C[P]>>>0,C[P]=f%256>>>0,f=f/256>>>0;if(f!==0)throw new Error(\"Non-zero carry\");b=R,y++}if(u[y]!==\" \"){for(var E=I-b;E!==I&&C[E]===0;)E++;for(var S=new Uint8Array(A+(I-E)),B=A;E!==I;)S[B++]=C[E++];return S}}}function H(u){var y=k(u);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:g,decodeUnsafe:k,decode:H}}var Ci=Ii,Ri=Ci;const Ce=r=>{if(r instanceof Uint8Array&&r.constructor.name===\"Uint8Array\")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error(\"Unknown type, must be binary type\")},Si=r=>new TextEncoder().encode(r),Ti=r=>new TextDecoder().decode(r);class xi{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error(\"Unknown type, must be binary type\")}}class Pi{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error(\"Invalid prefix character\");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e==\"string\"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error(\"Can only multibase decode strings\")}or(e){return Re(this,e)}}class Oi{constructor(e){this.decoders=e}or(e){return Re(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Re=(r,e)=>new Oi({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class Ai{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new xi(e,t,i),this.decoder=new Pi(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const q=({name:r,prefix:e,encode:t,decode:i})=>new Ai(r,e,t,i),K=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=Ri(t,e);return q({prefix:r,name:e,encode:i,decode:n=>Ce(s(n))})},zi=(r,e,t,i)=>{const s={};for(let d=0;d<e.length;++d)s[e[d]]=d;let n=r.length;for(;r[n-1]===\"=\";)--n;const a=new Uint8Array(n*t/8|0);let o=0,h=0,l=0;for(let d=0;d<n;++d){const g=s[r[d]];if(g===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<t|g,o+=t,o>=8&&(o-=8,a[l++]=255&h>>o)}if(o>=t||255&h<<8-o)throw new SyntaxError(\"Unexpected end of data\");return a},Ni=(r,e,t)=>{const i=e[e.length-1]===\"=\",s=(1<<t)-1;let n=\"\",a=0,o=0;for(let h=0;h<r.length;++h)for(o=o<<8|r[h],a+=8;a>t;)a-=t,n+=e[s&o>>a];if(a&&(n+=e[s&o<<t-a]),i)for(;n.length*t&7;)n+=\"=\";return n},D=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>q({prefix:e,name:r,encode(s){return Ni(s,i,t)},decode(s){return zi(s,i,t,r)}}),Li=q({prefix:\"\\0\",name:\"identity\",encode:r=>Ti(r),decode:r=>Si(r)});var Ui=Object.freeze({__proto__:null,identity:Li});const Fi=D({prefix:\"0\",name:\"base2\",alphabet:\"01\",bitsPerChar:1});var Mi=Object.freeze({__proto__:null,base2:Fi});const $i=D({prefix:\"7\",name:\"base8\",alphabet:\"01234567\",bitsPerChar:3});var Ki=Object.freeze({__proto__:null,base8:$i});const ki=K({prefix:\"9\",name:\"base10\",alphabet:\"0123456789\"});var Bi=Object.freeze({__proto__:null,base10:ki});const ji=D({prefix:\"f\",name:\"base16\",alphabet:\"0123456789abcdef\",bitsPerChar:4}),Vi=D({prefix:\"F\",name:\"base16upper\",alphabet:\"0123456789ABCDEF\",bitsPerChar:4});var qi=Object.freeze({__proto__:null,base16:ji,base16upper:Vi});const Gi=D({prefix:\"b\",name:\"base32\",alphabet:\"abcdefghijklmnopqrstuvwxyz234567\",bitsPerChar:5}),Yi=D({prefix:\"B\",name:\"base32upper\",alphabet:\"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567\",bitsPerChar:5}),Ji=D({prefix:\"c\",name:\"base32pad\",alphabet:\"abcdefghijklmnopqrstuvwxyz234567=\",bitsPerChar:5}),Hi=D({prefix:\"C\",name:\"base32padupper\",alphabet:\"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=\",bitsPerChar:5}),Xi=D({prefix:\"v\",name:\"base32hex\",alphabet:\"0123456789abcdefghijklmnopqrstuv\",bitsPerChar:5}),Wi=D({prefix:\"V\",name:\"base32hexupper\",alphabet:\"0123456789ABCDEFGHIJKLMNOPQRSTUV\",bitsPerChar:5}),Zi=D({prefix:\"t\",name:\"base32hexpad\",alphabet:\"0123456789abcdefghijklmnopqrstuv=\",bitsPerChar:5}),Qi=D({prefix:\"T\",name:\"base32hexpadupper\",alphabet:\"0123456789ABCDEFGHIJKLMNOPQRSTUV=\",bitsPerChar:5}),es=D({prefix:\"h\",name:\"base32z\",alphabet:\"ybndrfg8ejkmcpqxot1uwisza345h769\",bitsPerChar:5});var ts=Object.freeze({__proto__:null,base32:Gi,base32upper:Yi,base32pad:Ji,base32padupper:Hi,base32hex:Xi,base32hexupper:Wi,base32hexpad:Zi,base32hexpadupper:Qi,base32z:es});const is=K({prefix:\"k\",name:\"base36\",alphabet:\"0123456789abcdefghijklmnopqrstuvwxyz\"}),ss=K({prefix:\"K\",name:\"base36upper\",alphabet:\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\"});var rs=Object.freeze({__proto__:null,base36:is,base36upper:ss});const ns=K({name:\"base58btc\",prefix:\"z\",alphabet:\"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz\"}),as=K({name:\"base58flickr\",prefix:\"Z\",alphabet:\"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ\"});var os=Object.freeze({__proto__:null,base58btc:ns,base58flickr:as});const hs=D({prefix:\"m\",name:\"base64\",alphabet:\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",bitsPerChar:6}),cs=D({prefix:\"M\",name:\"base64pad\",alphabet:\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",bitsPerChar:6}),us=D({prefix:\"u\",name:\"base64url\",alphabet:\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_\",bitsPerChar:6}),ls=D({prefix:\"U\",name:\"base64urlpad\",alphabet:\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=\",bitsPerChar:6});var ds=Object.freeze({__proto__:null,base64:hs,base64pad:cs,base64url:us,base64urlpad:ls});const Se=Array.from(\"\\u{1F680}\\u{1FA90}\\u2604\\u{1F6F0}\\u{1F30C}\\u{1F311}\\u{1F312}\\u{1F313}\\u{1F314}\\u{1F315}\\u{1F316}\\u{1F317}\\u{1F318}\\u{1F30D}\\u{1F30F}\\u{1F30E}\\u{1F409}\\u2600\\u{1F4BB}\\u{1F5A5}\\u{1F4BE}\\u{1F4BF}\\u{1F602}\\u2764\\u{1F60D}\\u{1F923}\\u{1F60A}\\u{1F64F}\\u{1F495}\\u{1F62D}\\u{1F618}\\u{1F44D}\\u{1F605}\\u{1F44F}\\u{1F601}\\u{1F525}\\u{1F970}\\u{1F494}\\u{1F496}\\u{1F499}\\u{1F622}\\u{1F914}\\u{1F606}\\u{1F644}\\u{1F4AA}\\u{1F609}\\u263A\\u{1F44C}\\u{1F917}\\u{1F49C}\\u{1F614}\\u{1F60E}\\u{1F607}\\u{1F339}\\u{1F926}\\u{1F389}\\u{1F49E}\\u270C\\u2728\\u{1F937}\\u{1F631}\\u{1F60C}\\u{1F338}\\u{1F64C}\\u{1F60B}\\u{1F497}\\u{1F49A}\\u{1F60F}\\u{1F49B}\\u{1F642}\\u{1F493}\\u{1F929}\\u{1F604}\\u{1F600}\\u{1F5A4}\\u{1F603}\\u{1F4AF}\\u{1F648}\\u{1F447}\\u{1F3B6}\\u{1F612}\\u{1F92D}\\u2763\\u{1F61C}\\u{1F48B}\\u{1F440}\\u{1F62A}\\u{1F611}\\u{1F4A5}\\u{1F64B}\\u{1F61E}\\u{1F629}\\u{1F621}\\u{1F92A}\\u{1F44A}\\u{1F973}\\u{1F625}\\u{1F924}\\u{1F449}\\u{1F483}\\u{1F633}\\u270B\\u{1F61A}\\u{1F61D}\\u{1F634}\\u{1F31F}\\u{1F62C}\\u{1F643}\\u{1F340}\\u{1F337}\\u{1F63B}\\u{1F613}\\u2B50\\u2705\\u{1F97A}\\u{1F308}\\u{1F608}\\u{1F918}\\u{1F4A6}\\u2714\\u{1F623}\\u{1F3C3}\\u{1F490}\\u2639\\u{1F38A}\\u{1F498}\\u{1F620}\\u261D\\u{1F615}\\u{1F33A}\\u{1F382}\\u{1F33B}\\u{1F610}\\u{1F595}\\u{1F49D}\\u{1F64A}\\u{1F639}\\u{1F5E3}\\u{1F4AB}\\u{1F480}\\u{1F451}\\u{1F3B5}\\u{1F91E}\\u{1F61B}\\u{1F534}\\u{1F624}\\u{1F33C}\\u{1F62B}\\u26BD\\u{1F919}\\u2615\\u{1F3C6}\\u{1F92B}\\u{1F448}\\u{1F62E}\\u{1F646}\\u{1F37B}\\u{1F343}\\u{1F436}\\u{1F481}\\u{1F632}\\u{1F33F}\\u{1F9E1}\\u{1F381}\\u26A1\\u{1F31E}\\u{1F388}\\u274C\\u270A\\u{1F44B}\\u{1F630}\\u{1F928}\\u{1F636}\\u{1F91D}\\u{1F6B6}\\u{1F4B0}\\u{1F353}\\u{1F4A2}\\u{1F91F}\\u{1F641}\\u{1F6A8}\\u{1F4A8}\\u{1F92C}\\u2708\\u{1F380}\\u{1F37A}\\u{1F913}\\u{1F619}\\u{1F49F}\\u{1F331}\\u{1F616}\\u{1F476}\\u{1F974}\\u25B6\\u27A1\\u2753\\u{1F48E}\\u{1F4B8}\\u2B07\\u{1F628}\\u{1F31A}\\u{1F98B}\\u{1F637}\\u{1F57A}\\u26A0\\u{1F645}\\u{1F61F}\\u{1F635}\\u{1F44E}\\u{1F932}\\u{1F920}\\u{1F927}\\u{1F4CC}\\u{1F535}\\u{1F485}\\u{1F9D0}\\u{1F43E}\\u{1F352}\\u{1F617}\\u{1F911}\\u{1F30A}\\u{1F92F}\\u{1F437}\\u260E\\u{1F4A7}\\u{1F62F}\\u{1F486}\\u{1F446}\\u{1F3A4}\\u{1F647}\\u{1F351}\\u2744\\u{1F334}\\u{1F4A3}\\u{1F438}\\u{1F48C}\\u{1F4CD}\\u{1F940}\\u{1F922}\\u{1F445}\\u{1F4A1}\\u{1F4A9}\\u{1F450}\\u{1F4F8}\\u{1F47B}\\u{1F910}\\u{1F92E}\\u{1F3BC}\\u{1F975}\\u{1F6A9}\\u{1F34E}\\u{1F34A}\\u{1F47C}\\u{1F48D}\\u{1F4E3}\\u{1F942}\"),gs=Se.reduce((r,e,t)=>(r[t]=e,r),[]),ps=Se.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Ds(r){return r.reduce((e,t)=>(e+=gs[t],e),\"\")}function ys(r){const e=[];for(const t of r){const i=ps[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const fs=q({prefix:\"\\u{1F680}\",name:\"base256emoji\",encode:Ds,decode:ys});var ms=Object.freeze({__proto__:null,base256emoji:fs}),bs=xe,Te=128,Es=127,vs=~Es,ws=Math.pow(2,31);function xe(r,e,t){e=e||[],t=t||0;for(var i=t;r>=ws;)e[t++]=r&255|Te,r/=128;for(;r&vs;)e[t++]=r&255|Te,r>>>=7;return e[t]=r|0,xe.bytes=t-i+1,e}var _s=ne,Is=128,Pe=127;function ne(r,i){var t=0,i=i||0,s=0,n=i,a,o=r.length;do{if(n>=o)throw ne.bytes=0,new RangeError(\"Could not decode varint\");a=r[n++],t+=s<28?(a&Pe)<<s:(a&Pe)*Math.pow(2,s),s+=7}while(a>=Is);return ne.bytes=n-i,t}var Cs=Math.pow(2,7),Rs=Math.pow(2,14),Ss=Math.pow(2,21),Ts=Math.pow(2,28),xs=Math.pow(2,35),Ps=Math.pow(2,42),Os=Math.pow(2,49),As=Math.pow(2,56),zs=Math.pow(2,63),Ns=function(r){return r<Cs?1:r<Rs?2:r<Ss?3:r<Ts?4:r<xs?5:r<Ps?6:r<Os?7:r<As?8:r<zs?9:10},Ls={encode:bs,decode:_s,encodingLength:Ns},Oe=Ls;const Ae=(r,e,t=0)=>(Oe.encode(r,e,t),e),ze=r=>Oe.encodingLength(r),ae=(r,e)=>{const t=e.byteLength,i=ze(r),s=i+ze(t),n=new Uint8Array(s+t);return Ae(r,n,0),Ae(t,n,i),n.set(e,s),new Us(r,t,e,n)};class Us{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const Ne=({name:r,code:e,encode:t})=>new Fs(r,e,t);class Fs{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?ae(this.code,t):t.then(i=>ae(this.code,i))}else throw Error(\"Unknown type, must be binary type\")}}const Le=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Ms=Ne({name:\"sha2-256\",code:18,encode:Le(\"SHA-256\")}),$s=Ne({name:\"sha2-512\",code:19,encode:Le(\"SHA-512\")});var Ks=Object.freeze({__proto__:null,sha256:Ms,sha512:$s});const Ue=0,ks=\"identity\",Fe=Ce,Bs=r=>ae(Ue,Fe(r)),js={code:Ue,name:ks,encode:Fe,digest:Bs};var Vs=Object.freeze({__proto__:null,identity:js});new TextEncoder,new TextDecoder;const Me={...Ui,...Mi,...Ki,...Bi,...qi,...ts,...rs,...os,...ds,...ms};({...Ks,...Vs});function qs(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function $e(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Ke=$e(\"utf8\",\"u\",r=>{const e=new TextDecoder(\"utf8\");return\"u\"+e.decode(r)},r=>new TextEncoder().encode(r.substring(1))),oe=$e(\"ascii\",\"a\",r=>{let e=\"a\";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=qs(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Gs={utf8:Ke,\"utf-8\":Ke,hex:Me.base16,latin1:oe,ascii:oe,binary:oe,...Me};function Ys(r,e=\"utf8\"){const t=Gs[e];if(!t)throw new Error(`Unsupported encoding \"${e}\"`);return(e===\"utf8\"||e===\"utf-8\")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,\"utf8\"):t.decoder.decode(`${t.prefix}${r}`)}const he=\"wc\",ke=2,G=\"core\",x=`${he}@${2}:${G}:`,Be={name:G,logger:\"error\"},je={database:\":memory:\"},Ve=\"crypto\",ce=\"client_ed25519_seed\",qe=L,Ge=\"keychain\",Ye=\"0.3\",Je=\"messages\",He=\"0.3\",Xe=gi,We=\"publisher\",Ze=\"irn\",Qe=\"error\",et=\"wss://relay.walletconnect.com\",tt=\"relayer\",U={message:\"relayer_message\",connect:\"relayer_connect\",disconnect:\"relayer_disconnect\",error:\"relayer_error\"},it=\"_subscription\",N={payload:\"payload\",connect:\"connect\",disconnect:\"disconnect\",error:\"error\"},st=pi,Js={database:\":memory:\"},rt=\"2.0.0\",nt=\"0.3\",O={created:\"subscription_created\",deleted:\"subscription_deleted\",expired:\"subscription_expired\",disabled:\"subscription_disabled\",sync:\"subscription_sync\"},Hs=re,at=\"subscription\",ot=\"0.3\",ht=Di*1e3,ct=\"pairing\",ut=\"0.3\",Xs=re,F={wc_pairingDelete:{req:{ttl:L,prompt:!1,tag:1e3},res:{ttl:L,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:fe,prompt:!1,tag:1002},res:{ttl:fe,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:L,prompt:!1,tag:0},res:{ttl:L,prompt:!1,tag:0}}},_={created:\"history_created\",updated:\"history_updated\",deleted:\"history_deleted\",sync:\"history_sync\"},lt=\"history\",dt=\"0.3\",gt=\"expirer\",m={created:\"expirer_created\",deleted:\"expirer_deleted\",expired:\"expirer_expired\",sync:\"expirer_sync\"},pt=\"0.3\",Ws=L;class Dt{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=Ge,this.version=Ye,this.initialized=!1,this.storagePrefix=x,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<\"u\"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()},this.get=i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>\"u\"){const{message:n}=c(\"NO_MATCHING_KEY\",`${this.name}: ${i}`);throw new Error(n)}return s},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=v(t,this.name)}get context(){return w(this.logger)}get storageKey(){return this.storagePrefix+this.version+\"//\"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,ge(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<\"u\"?pe(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}}class yt{constructor(e,t,i){this.core=e,this.logger=t,this.name=Ve,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),n=j.generateKeyPair(s);return j.encodeIss(n.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=Gt();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const n=await this.getClientSeed(),a=j.generateKeyPair(n),o=W(),h=qe;return await j.signJWT(o,s,h,a)},this.generateSharedKey=(s,n,a)=>{this.isInitialized();const o=this.getPrivateKey(s),h=Yt(o,n);return this.setSymKey(h,a)},this.setSymKey=async(s,n)=>{this.isInitialized();const a=n||Jt(s);return await this.keychain.set(a,s),a},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,n,a)=>{this.isInitialized();const o=Ht(a),h=Vt(n);if(De(o)){const k=o.senderPublicKey,H=o.receiverPublicKey;s=await this.generateSharedKey(k,H)}const l=this.getSymKey(s),{type:d,senderPublicKey:g}=o;return Xt({type:d,symKey:l,message:h,senderPublicKey:g})},this.decode=async(s,n,a)=>{this.isInitialized();const o=Wt(n,a);if(De(o)){const d=o.receiverPublicKey,g=o.senderPublicKey;s=await this.generateSharedKey(d,g)}const h=this.getSymKey(s),l=Zt({symKey:h,encoded:n});return qt(l)},this.core=e,this.logger=v(t,this.name),this.keychain=i||new Dt(this.core,this.logger)}get context(){return w(this.logger)}getPayloadType(e){const t=Qt(e);return ei(t.type)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e=\"\";try{e=this.keychain.get(ce)}catch{e=W(),await this.keychain.set(ce,e)}return Ys(e,\"base16\")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}}class ft extends Ut{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=Je,this.version=He,this.initialized=!1,this.storagePrefix=x,this.init=async()=>{if(!this.initialized){this.logger.trace(\"Initialized\");try{const i=await this.getRelayerMessages();typeof i<\"u\"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:\"method\",method:\"restore\",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,s)=>{this.isInitialized();const n=V(s);let a=this.messages.get(i);return typeof a>\"u\"&&(a={}),typeof a[n]<\"u\"||(a[n]=s,this.messages.set(i,a),await this.persist()),n},this.get=i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>\"u\"&&(s={}),s},this.has=(i,s)=>{this.isInitialized();const n=this.get(i),a=V(s);return typeof n[a]<\"u\"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=v(e,this.name),this.core=t}get context(){return w(this.logger)}get storageKey(){return this.storagePrefix+this.version+\"//\"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,ge(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<\"u\"?pe(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}}class Zs extends Ft{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new z.EventEmitter,this.name=We,this.queue=new Map,this.publish=async(i,s,n)=>{this.logger.debug(\"Publishing Payload\"),this.logger.trace({type:\"method\",method:\"publish\",params:{topic:i,message:s,opts:n}});try{const a=n?.ttl||Xe,o=Z(n),h=n?.prompt||!1,l=n?.tag||0,d={topic:i,message:s,opts:{ttl:a,relay:o,prompt:h,tag:l}},g=V(s);this.queue.set(g,d),await this.rpcPublish(i,s,a,o,h,l),this.onPublish(g,d),this.logger.debug(\"Successfully Published Payload\"),this.logger.trace({type:\"method\",method:\"publish\",params:{topic:i,message:s,opts:n}})}catch(a){throw this.logger.debug(\"Failed to Publish Payload\"),this.logger.error(a),a}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.relayer=e,this.logger=v(t,this.name),this.registerEventListeners()}get context(){return w(this.logger)}rpcPublish(e,t,i,s,n,a){var o,h,l,d;const g={method:Q(s.protocol).publish,params:{topic:e,message:t,ttl:i,prompt:n,tag:a}};return ee((o=g.params)==null?void 0:o.prompt)&&((h=g.params)==null||delete h.prompt),ee((l=g.params)==null?void 0:l.tag)&&((d=g.params)==null||delete d.tag),this.logger.debug(\"Outgoing Relay Payload\"),this.logger.trace({type:\"message\",direction:\"outgoing\",request:g}),this.relayer.provider.request(g)}onPublish(e,t){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:i,opts:{ttl:s,relay:n,prompt:a,tag:o}}=e,h=V(i);await this.rpcPublish(t,i,s,n,a,o),this.onPublish(h,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(X.pulse,()=>{this.checkQueue()})}}class Qs{constructor(){this.map=new Map,this.set=(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>\"u\"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(n=>n!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var er=Object.defineProperty,tr=Object.defineProperties,ir=Object.getOwnPropertyDescriptors,mt=Object.getOwnPropertySymbols,sr=Object.prototype.hasOwnProperty,rr=Object.prototype.propertyIsEnumerable,bt=(r,e,t)=>e in r?er(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Y=(r,e)=>{for(var t in e||(e={}))sr.call(e,t)&&bt(r,t,e[t]);if(mt)for(var t of mt(e))rr.call(e,t)&&bt(r,t,e[t]);return r},ue=(r,e)=>tr(r,ir(e));class Et extends Mt{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new Qs,this.events=new z.EventEmitter,this.name=at,this.version=ot,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel=\"pending_sub_watch_label\",this.pendingSubInterval=20,this.storagePrefix=x,this.init=async()=>{this.initialized||(this.logger.trace(\"Initialized\"),await this.restore(),await this.reset(),this.registerEventListeners(),this.onEnable())},this.subscribe=async(i,s)=>{this.isInitialized(),this.logger.debug(\"Subscribing Topic\"),this.logger.trace({type:\"method\",method:\"subscribe\",params:{topic:i,opts:s}});try{const n=Z(s),a={topic:i,relay:n};this.pending.set(i,a);const o=await this.rpcSubscribe(i,n);return this.onSubscribe(o,a),this.logger.debug(\"Successfully Subscribed Topic\"),this.logger.trace({type:\"method\",method:\"subscribe\",params:{topic:i,opts:s}}),o}catch(n){throw this.logger.debug(\"Failed to Subscribe Topic\"),this.logger.error(n),n}},this.unsubscribe=async(i,s)=>{this.isInitialized(),typeof s?.id<\"u\"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((s,n)=>{const a=new yi;a.start(this.pendingSubscriptionWatchLabel);const o=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(o),a.stop(this.pendingSubscriptionWatchLabel),s(!0)),a.elapsed(this.pendingSubscriptionWatchLabel)>=ht&&(clearInterval(o),a.stop(this.pendingSubscriptionWatchLabel),n(!1))},this.pendingSubInterval)}),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.relayer=e,this.logger=v(t,this.name)}get context(){return w(this.logger)}get storageKey(){return this.storagePrefix+this.version+\"//\"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,i){this.logger.debug(\"Unsubscribing Topic\"),this.logger.trace({type:\"method\",method:\"unsubscribe\",params:{topic:e,id:t,opts:i}});try{const s=Z(i);await this.rpcUnsubscribe(e,t,s);const n=M(\"USER_DISCONNECTED\",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug(\"Successfully Unsubscribed Topic\"),this.logger.trace({type:\"method\",method:\"unsubscribe\",params:{topic:e,id:t,opts:i}})}catch(s){throw this.logger.debug(\"Failed to Unsubscribe Topic\"),this.logger.error(s),s}}async rpcSubscribe(e,t){const i={method:Q(t.protocol).subscribe,params:{topic:e}};return this.logger.debug(\"Outgoing Relay Payload\"),this.logger.trace({type:\"payload\",direction:\"outgoing\",request:i}),await this.relayer.provider.request(i)}rpcUnsubscribe(e,t,i){const s={method:Q(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug(\"Outgoing Relay Payload\"),this.logger.trace({type:\"payload\",direction:\"outgoing\",request:s}),this.relayer.provider.request(s)}onSubscribe(e,t){this.setSubscription(e,ue(Y({},t),{id:e})),this.pending.delete(t.topic)}onResubscribe(e,t){this.addSubscription(e,ue(Y({},t),{id:e})),this.pending.delete(t.topic)}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug(\"Setting subscription\"),this.logger.trace({type:\"method\",method:\"setSubscription\",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,Y({},t)),this.topicMap.set(t.topic,e),this.events.emit(O.created,t)}getSubscription(e){this.logger.debug(\"Getting subscription\"),this.logger.trace({type:\"method\",method:\"getSubscription\",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=c(\"NO_MATCHING_KEY\",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug(\"Deleting subscription\"),this.logger.trace({type:\"method\",method:\"deleteSubscription\",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(O.deleted,ue(Y({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(O.sync)}async reset(){!this.cached.length||await Promise.all(this.cached.map(async e=>await this.resubscribe(e)))}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>\"u\"||!e.length)return;if(this.subscriptions.size){const{message:t}=c(\"RESTORE_WILL_OVERRIDE\",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:\"method\",method:\"restore\",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async resubscribe(e){if(!this.ids.includes(e.id)){const{topic:t,relay:i}=e,s={topic:t,relay:i};this.pending.set(s.topic,s);const n=await this.rpcSubscribe(s.topic,s.relay);this.onResubscribe(n,s)}}async onConnect(){await this.reset(),this.onEnable()}onDisconnect(){this.onDisable()}checkPending(){this.pending.forEach(async e=>{const t=await this.rpcSubscribe(e.topic,e.relay);this.onSubscribe(t,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(X.pulse,()=>{this.checkPending()}),this.relayer.provider.on(N.connect,async()=>{await this.onConnect()}),this.relayer.provider.on(N.disconnect,()=>{this.onDisconnect()}),this.events.on(O.created,async e=>{const t=O.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:\"event\",event:t,data:e}),await this.persist()}),this.events.on(O.deleted,async e=>{const t=O.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:\"event\",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}}var nr=Object.defineProperty,vt=Object.getOwnPropertySymbols,ar=Object.prototype.hasOwnProperty,or=Object.prototype.propertyIsEnumerable,wt=(r,e,t)=>e in r?nr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,hr=(r,e)=>{for(var t in e||(e={}))ar.call(e,t)&&wt(r,t,e[t]);if(vt)for(var t of vt(e))or.call(e,t)&&wt(r,t,e[t]);return r};class _t extends $t{constructor(e){super(e),this.protocol=\"wc\",this.version=2,this.events=new z.EventEmitter,this.name=tt,this.initialized=!1,this.core=e.core,this.logger=typeof e.logger<\"u\"&&typeof e.logger!=\"string\"?v(e.logger,this.name):le(de({level:e.logger||Qe})),this.messages=new ft(this.logger,e.core),this.subscriber=new Et(this,this.logger),this.publisher=new Zs(this,this.logger),this.relayUrl=e?.relayUrl||et,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace(\"Initialized\");const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=this.createProvider(e),await Promise.all([this.messages.init(),this.provider.connect(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return w(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t})}async subscribe(e,t){return this.isInitialized(),await this.subscriber.subscribe(e,t)}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}createProvider(e){return new fi(new vi(ti({sdkVersion:rt,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e})))}async recordMessageEvent(e){const{topic:t,message:i}=e;await this.messages.set(t,i)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;return await this.subscriber.isSubscribed(t)?this.messages.has(t,i):!0}async onProviderPayload(e){if(this.logger.debug(\"Incoming Relay Payload\"),this.logger.trace({type:\"payload\",direction:\"incoming\",payload:e}),Ee(e)){if(!e.method.endsWith(it))return;const t=e.params,{topic:i,message:s}=t.data,n={topic:i,message:s};this.logger.debug(\"Emitting Relayer Payload\"),this.logger.trace(hr({type:\"event\",event:t.id},n)),this.events.emit(t.id,n),await this.acknowledgePayload(e),await this.onMessageEvent(n)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(U.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=ve(e.id,!0);await this.provider.connection.send(t)}registerEventListeners(){this.provider.on(N.payload,e=>this.onProviderPayload(e)),this.provider.on(N.connect,()=>{this.events.emit(U.connect)}),this.provider.on(N.disconnect,()=>{this.events.emit(U.disconnect),setTimeout(()=>{this.provider.connect()},me(st))}),this.provider.on(N.error,e=>this.events.emit(U.error,e))}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}}var cr=Object.defineProperty,It=Object.getOwnPropertySymbols,ur=Object.prototype.hasOwnProperty,lr=Object.prototype.propertyIsEnumerable,Ct=(r,e,t)=>e in r?cr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Rt=(r,e)=>{for(var t in e||(e={}))ur.call(e,t)&&Ct(r,t,e[t]);if(It)for(var t of It(e))lr.call(e,t)&&Ct(r,t,e[t]);return r};class St extends Kt{constructor(e,t,i,s=x,n=void 0){super(e,t,i,s),this.core=e,this.logger=t,this.name=i,this.map=new Map,this.version=nt,this.cached=[],this.initialized=!1,this.storagePrefix=x,this.init=async()=>{this.initialized||(this.logger.trace(\"Initialized\"),await this.restore(),this.cached.forEach(a=>{ii(a)?this.map.set(a.id,a):si(a)?this.map.set(a.topic,a):this.getKey&&a!==null&&!ee(a)&&this.map.set(this.getKey(a),a)}),this.cached=[],this.initialized=!0)},this.set=async(a,o)=>{this.isInitialized(),this.map.has(a)?await this.update(a,o):(this.logger.debug(\"Setting value\"),this.logger.trace({type:\"method\",method:\"set\",key:a,value:o}),this.map.set(a,o),await this.persist())},this.get=a=>(this.isInitialized(),this.logger.debug(\"Getting value\"),this.logger.trace({type:\"method\",method:\"get\",key:a}),this.getData(a)),this.getAll=a=>(this.isInitialized(),a?this.values.filter(o=>Object.keys(a).every(h=>wi(o[h],a[h]))):this.values),this.update=async(a,o)=>{this.isInitialized(),this.logger.debug(\"Updating value\"),this.logger.trace({type:\"method\",method:\"update\",key:a,update:o});const h=Rt(Rt({},this.getData(a)),o);this.map.set(a,h),await this.persist()},this.delete=async(a,o)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug(\"Deleting value\"),this.logger.trace({type:\"method\",method:\"delete\",key:a,reason:o}),this.map.delete(a),await this.persist())},this.logger=v(t,this.name),this.storagePrefix=s,this.getKey=n}get context(){return w(this.logger)}get storageKey(){return this.storagePrefix+this.version+\"//\"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:i}=c(\"NO_MATCHING_KEY\",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>\"u\"||!e.length)return;if(this.map.size){const{message:t}=c(\"RESTORE_WILL_OVERRIDE\",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:\"method\",method:\"restore\",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}}class Tt{constructor(e,t){this.core=e,this.logger=t,this.name=ct,this.version=ut,this.events=new z,this.initialized=!1,this.storagePrefix=x,this.ignoredPayloadTypes=[ri],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace(\"Initialized\"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=W(),s=await this.core.crypto.setSymKey(i),n=te(be),a={protocol:Ze},o={topic:s,expiry:n,relay:a,active:!1},h=ni({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a});return await this.pairings.set(s,o),await this.core.relayer.subscribe(s),this.core.expirer.set(s,n),{topic:s,uri:h}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:s,symKey:n,relay:a}=ai(i.uri),o=te(be),h={topic:s,relay:a,expiry:o,active:!1};return await this.pairings.set(s,h),await this.core.crypto.setSymKey(n,s),await this.core.relayer.subscribe(s,{relay:a}),this.core.expirer.set(s,o),i.activatePairing&&await this.activate({topic:s}),h},this.activate=async({topic:i})=>{this.isInitialized();const s=te(re);await this.pairings.update(i,{active:!0,expiry:s}),this.core.expirer.set(i,s)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,\"wc_pairingPing\",{}),{done:a,resolve:o,reject:h}=oi();this.events.once(ie(\"pairing_ping\",n),({error:l})=>{l?h(l):o()}),await a()}},this.updateExpiry=async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})},this.updateMetadata=async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,\"wc_pairingDelete\",M(\"USER_DISCONNECTED\")),await this.deletePairing(s))},this.sendRequest=async(i,s,n)=>{const a=we(s,n),o=await this.core.crypto.encode(i,a),h=F[s].req;return this.core.history.set(i,a),await this.core.relayer.publish(i,o,h),a.id},this.sendResult=async(i,s,n)=>{const a=ve(i,n),o=await this.core.crypto.encode(s,a),h=await this.core.history.get(s,i),l=F[h.request.method].res;await this.core.relayer.publish(s,o,l),await this.core.history.resolve(a)},this.sendError=async(i,s,n)=>{const a=mi(i,n),o=await this.core.crypto.encode(s,a),h=await this.core.history.get(s,i),l=F[h.request.method]?F[h.request.method].res:F.unregistered_method.res;await this.core.relayer.publish(s,o,l),await this.core.history.resolve(a)},this.deletePairing=async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,M(\"USER_DISCONNECTED\")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(s=>ye(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=i=>{const{topic:s,payload:n}=i;switch(n.method){case\"wc_pairingPing\":return this.onPairingPingRequest(s,n);case\"wc_pairingDelete\":return this.onPairingDeleteRequest(s,n);default:return this.onUnknownRpcMethodRequest(s,n)}},this.onRelayEventResponse=async i=>{const{topic:s,payload:n}=i,a=(await this.core.history.get(s,n.id)).request.method;switch(a){case\"wc_pairingPing\":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(a)}},this.onPairingPingRequest=async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit(\"pairing_ping\",{id:n,topic:i})}catch(a){await this.sendError(n,i,a),this.logger.error(a)}},this.onPairingPingResponse=(i,s)=>{const{id:n}=s;setTimeout(()=>{bi(s)?this.events.emit(ie(\"pairing_ping\",n),{}):_e(s)&&this.events.emit(ie(\"pairing_ping\",n),{error:s.error})},500)},this.onPairingDeleteRequest=async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.sendResult(n,i,!0),await this.deletePairing(i),this.events.emit(\"pairing_delete\",{id:n,topic:i})}catch(a){await this.sendError(n,i,a),this.logger.error(a)}},this.onUnknownRpcMethodRequest=async(i,s)=>{const{id:n,method:a}=s;try{if(this.registeredMethods.includes(a))return;const o=M(\"WC_METHOD_UNSUPPORTED\",a);await this.sendError(n,i,o),this.logger.error(o)}catch(o){await this.sendError(n,i,o),this.logger.error(o)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(M(\"WC_METHOD_UNSUPPORTED\",i))},this.isValidPair=i=>{if(!se(i)){const{message:s}=c(\"MISSING_OR_INVALID\",`pair() params: ${i}`);throw new Error(s)}if(!hi(i.uri)){const{message:s}=c(\"MISSING_OR_INVALID\",`pair() uri: ${i.uri}`);throw new Error(s)}},this.isValidPing=async i=>{if(!se(i)){const{message:n}=c(\"MISSING_OR_INVALID\",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidDisconnect=async i=>{if(!se(i)){const{message:n}=c(\"MISSING_OR_INVALID\",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async i=>{if(!ci(i,!1)){const{message:s}=c(\"MISSING_OR_INVALID\",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=c(\"NO_MATCHING_KEY\",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(ye(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=c(\"EXPIRED\",`pairing topic: ${i}`);throw new Error(s)}},this.core=e,this.logger=v(t,this.name),this.pairings=new St(this.core,this.logger,this.name,this.storagePrefix)}get context(){return w(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(U.message,async e=>{const{topic:t,message:i}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const s=await this.core.crypto.decode(t,i);Ee(s)?(this.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):Ei(s)&&(await this.core.history.resolve(s),this.onRelayEventResponse({topic:t,payload:s}))})}registerExpirerEvents(){this.core.expirer.on(m.expired,async e=>{const{topic:t}=ui(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(\"pairing_expire\",{topic:t}))})}}class xt extends kt{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new z.EventEmitter,this.name=lt,this.version=dt,this.cached=[],this.initialized=!1,this.storagePrefix=x,this.init=async()=>{this.initialized||(this.logger.trace(\"Initialized\"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,s,n)=>{if(this.isInitialized(),this.logger.debug(\"Setting JSON-RPC request history record\"),this.logger.trace({type:\"method\",method:\"set\",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const a={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n};this.records.set(a.id,a),this.events.emit(_.created,a)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug(\"Updating JSON-RPC response history record\"),this.logger.trace({type:\"method\",method:\"update\",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>\"u\"&&(s.response=_e(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.events.emit(_.updated,s))},this.get=async(i,s)=>(this.isInitialized(),this.logger.debug(\"Getting record\"),this.logger.trace({type:\"method\",method:\"get\",topic:i,id:s}),await this.getRecord(s)),this.delete=(i,s)=>{this.isInitialized(),this.logger.debug(\"Deleting record\"),this.logger.trace({type:\"method\",method:\"delete\",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<\"u\"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(_.deleted,n)}})},this.exists=async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=v(t,this.name)}get context(){return w(this.logger)}get storageKey(){return this.storagePrefix+this.version+\"//\"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<\"u\")return;const i={topic:t.topic,request:we(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=c(\"NO_MATCHING_KEY\",`${this.name}: ${e}`);throw new Error(i)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(_.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>\"u\"||!e.length)return;if(this.records.size){const{message:t}=c(\"RESTORE_WILL_OVERRIDE\",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:\"method\",method:\"restore\",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(_.created,e=>{const t=_.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:\"event\",event:t,record:e}),this.persist()}),this.events.on(_.updated,e=>{const t=_.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:\"event\",event:t,record:e}),this.persist()}),this.events.on(_.deleted,e=>{const t=_.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:\"event\",event:t,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}}class Pt extends Bt{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new z.EventEmitter,this.name=gt,this.version=pt,this.cached=[],this.initialized=!1,this.storagePrefix=x,this.init=async()=>{this.initialized||(this.logger.trace(\"Initialized\"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<\"u\"}catch{return!1}},this.set=(i,s)=>{this.isInitialized();const n=this.formatTarget(i),a={target:n,expiry:s};this.expirations.set(n,a),this.checkExpiry(n,a),this.events.emit(m.created,{target:n,expiration:a})},this.get=i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)},this.del=i=>{this.isInitialized();const s=this.formatTarget(i);if(this.has(s)){const n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(m.deleted,{target:s,expiration:n})}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=v(t,this.name)}get context(){return w(this.logger)}get storageKey(){return this.storagePrefix+this.version+\"//\"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e==\"string\")return li(e);if(typeof e==\"number\")return di(e);const{message:t}=c(\"UNKNOWN_TYPE\",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(m.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>\"u\"||!e.length)return;if(this.expirations.size){const{message:t}=c(\"RESTORE_WILL_OVERRIDE\",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:\"method\",method:\"restore\",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=c(\"NO_MATCHING_KEY\",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;me(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(m.expired,{target:e,expiration:t})}checkExpirations(){this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(X.pulse,()=>this.checkExpirations()),this.events.on(m.created,e=>{const t=m.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:\"event\",event:t,data:e}),this.persist()}),this.events.on(m.expired,e=>{const t=m.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:\"event\",event:t,data:e}),this.persist()}),this.events.on(m.deleted,e=>{const t=m.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:\"event\",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}}var dr=Object.defineProperty,Ot=Object.getOwnPropertySymbols,gr=Object.prototype.hasOwnProperty,pr=Object.prototype.propertyIsEnumerable,At=(r,e,t)=>e in r?dr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,zt=(r,e)=>{for(var t in e||(e={}))gr.call(e,t)&&At(r,t,e[t]);if(Ot)for(var t of Ot(e))pr.call(e,t)&&At(r,t,e[t]);return r};class J extends jt{constructor(e){super(e),this.protocol=he,this.version=ke,this.name=G,this.events=new z.EventEmitter,this.initialized=!1,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.projectId=e?.projectId;const t=typeof e?.logger<\"u\"&&typeof e?.logger!=\"string\"?e.logger:le(de({level:e?.logger||Be.logger}));this.logger=v(t,this.name),this.heartbeat=new Lt,this.crypto=new yt(this,this.logger,e?.keychain),this.history=new xt(this,this.logger),this.expirer=new Pt(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Nt(zt(zt({},je),e?.storageOptions)),this.relayer=new _t({core:this,logger:this.logger,relayUrl:e?.relayUrl,projectId:this.projectId}),this.pairing=new Tt(this,this.logger)}static async init(e){const t=new J(e);return await t.initialize(),t}get context(){return w(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace(\"Initialized\");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info(\"Core Initilization Success\")}catch(e){throw this.logger.warn(`Core Initilization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const Dr=J;export{G as CORE_CONTEXT,Be as CORE_DEFAULT,he as CORE_PROTOCOL,je as CORE_STORAGE_OPTIONS,x as CORE_STORAGE_PREFIX,ke as CORE_VERSION,ce as CRYPTO_CLIENT_SEED,Ve as CRYPTO_CONTEXT,qe as CRYPTO_JWT_TTL,Dr as Core,yt as Crypto,gt as EXPIRER_CONTEXT,Ws as EXPIRER_DEFAULT_TTL,m as EXPIRER_EVENTS,pt as EXPIRER_STORAGE_VERSION,Pt as Expirer,lt as HISTORY_CONTEXT,_ as HISTORY_EVENTS,dt as HISTORY_STORAGE_VERSION,xt as JsonRpcHistory,Ge as KEYCHAIN_CONTEXT,Ye as KEYCHAIN_STORAGE_VERSION,Dt as KeyChain,Je as MESSAGES_CONTEXT,He as MESSAGES_STORAGE_VERSION,ft as MessageTracker,ct as PAIRING_CONTEXT,Xs as PAIRING_DEFAULT_TTL,F as PAIRING_RPC_OPTS,ut as PAIRING_STORAGE_VERSION,ht as PENDING_SUB_RESOLUTION_TIMEOUT,We as PUBLISHER_CONTEXT,Xe as PUBLISHER_DEFAULT_TTL,Tt as Pairing,tt as RELAYER_CONTEXT,Qe as RELAYER_DEFAULT_LOGGER,Ze as RELAYER_DEFAULT_PROTOCOL,et as RELAYER_DEFAULT_RELAY_URL,U as RELAYER_EVENTS,N as RELAYER_PROVIDER_EVENTS,st as RELAYER_RECONNECT_TIMEOUT,rt as RELAYER_SDK_VERSION,Js as RELAYER_STORAGE_OPTIONS,it as RELAYER_SUBSCRIBER_SUFFIX,_t as Relayer,nt as STORE_STORAGE_VERSION,at as SUBSCRIBER_CONTEXT,Hs as SUBSCRIBER_DEFAULT_TTL,O as SUBSCRIBER_EVENTS,ot as SUBSCRIBER_STORAGE_VERSION,St as Store,Et as Subscriber,J as default};\n//# sourceMappingURL=index.es.js.map\n"]},"metadata":{},"sourceType":"module"}