{"ast":null,"code":"import _assertThisInitialized from \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _toConsumableArray from \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _regeneratorRuntime from \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _createForOfIteratorHelper from \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport { RELAYER_DEFAULT_PROTOCOL as Z, RELAYER_EVENTS as me, Store as j, Core as we } from \"@walletconnect/core\";\nimport { generateChildLogger as J, getLoggerContext as Y, getDefaultLoggerOptions as ye } from \"@walletconnect/logger\";\nimport { IEngine as Ee, IExpirer as _e, IJsonRpcHistory as fe, ISignClient as ve } from \"@walletconnect/types\";\nimport { createDelayedPromise as T, engineEvent as p, getInternalError as c, calcExpiry as f, parseUri as Ie, getSdkError as v, isSessionCompatible as Re, isExpired as O, isValidParams as u, isUndefined as Se, isValidRequiredNamespaces as Ne, isValidRelays as xe, isValidUrl as Pe, isValidNamespaces as X, isConformingNamespaces as B, isValidString as C, isValidErrorReason as Te, isValidRelay as Oe, isValidController as Ve, isValidNamespacesChainId as Q, isValidRequest as qe, isValidNamespacesRequest as Le, isValidResponse as De, isValidEvent as be, isValidNamespacesEvent as Ae, generateRandomBytes32 as Ce, formatUri as $e, parseExpirerTarget as Ge, isValidId as ze, formatTopicTarget as Me, formatIdTarget as Ke, getAppMetadata as Ue } from \"@walletconnect/utils\";\nimport ke from \"pino\";\nimport { ONE_DAY as I, THIRTY_DAYS as ee, SEVEN_DAYS as je, THIRTY_SECONDS as $, FIVE_MINUTES as m, toMiliseconds as Je } from \"@walletconnect/time\";\nimport { isJsonRpcResult as x, isJsonRpcError as R, formatJsonRpcRequest as te, formatJsonRpcResult as Ye, formatJsonRpcError as Xe, isJsonRpcRequest as He, isJsonRpcResponse as Fe } from \"@walletconnect/jsonrpc-utils\";\nimport { HEARTBEAT_EVENTS as We } from \"@walletconnect/heartbeat\";\nfunction d() {\n  this._events = this._events || {}, this._maxListeners = this._maxListeners || void 0;\n}\nvar G = d;\nd.EventEmitter = d, d.prototype._events = void 0, d.prototype._maxListeners = void 0, d.defaultMaxListeners = 10, d.prototype.setMaxListeners = function (o) {\n  if (!Ze(o) || o < 0 || isNaN(o)) throw TypeError(\"n must be a positive number\");\n  return this._maxListeners = o, this;\n}, d.prototype.emit = function (o) {\n  var i, e, t, s, r, n;\n  if (this._events || (this._events = {}), o === \"error\" && (!this._events.error || D(this._events.error) && !this._events.error.length)) {\n    if (i = arguments[1], i instanceof Error) throw i;\n    var a = new Error('Uncaught, unspecified \"error\" event. (' + i + \")\");\n    throw a.context = i, a;\n  }\n  if (e = this._events[o], se(e)) return !1;\n  if (S(e)) switch (arguments.length) {\n    case 1:\n      e.call(this);\n      break;\n    case 2:\n      e.call(this, arguments[1]);\n      break;\n    case 3:\n      e.call(this, arguments[1], arguments[2]);\n      break;\n    default:\n      s = Array.prototype.slice.call(arguments, 1), e.apply(this, s);\n  } else if (D(e)) for (s = Array.prototype.slice.call(arguments, 1), n = e.slice(), t = n.length, r = 0; r < t; r++) {\n    n[r].apply(this, s);\n  }\n  return !0;\n}, d.prototype.addListener = function (o, i) {\n  var e;\n  if (!S(i)) throw TypeError(\"listener must be a function\");\n  return this._events || (this._events = {}), this._events.newListener && this.emit(\"newListener\", o, S(i.listener) ? i.listener : i), this._events[o] ? D(this._events[o]) ? this._events[o].push(i) : this._events[o] = [this._events[o], i] : this._events[o] = i, D(this._events[o]) && !this._events[o].warned && (se(this._maxListeners) ? e = d.defaultMaxListeners : e = this._maxListeners, e && e > 0 && this._events[o].length > e && (this._events[o].warned = !0, console.error(\"(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.\", this._events[o].length), typeof console.trace == \"function\" && console.trace())), this;\n}, d.prototype.on = d.prototype.addListener, d.prototype.once = function (o, i) {\n  if (!S(i)) throw TypeError(\"listener must be a function\");\n  var e = !1;\n  function t() {\n    this.removeListener(o, t), e || (e = !0, i.apply(this, arguments));\n  }\n  return t.listener = i, this.on(o, t), this;\n}, d.prototype.removeListener = function (o, i) {\n  var e, t, s, r;\n  if (!S(i)) throw TypeError(\"listener must be a function\");\n  if (!this._events || !this._events[o]) return this;\n  if (e = this._events[o], s = e.length, t = -1, e === i || S(e.listener) && e.listener === i) delete this._events[o], this._events.removeListener && this.emit(\"removeListener\", o, i);else if (D(e)) {\n    for (r = s; r-- > 0;) {\n      if (e[r] === i || e[r].listener && e[r].listener === i) {\n        t = r;\n        break;\n      }\n    }\n    if (t < 0) return this;\n    e.length === 1 ? (e.length = 0, delete this._events[o]) : e.splice(t, 1), this._events.removeListener && this.emit(\"removeListener\", o, i);\n  }\n  return this;\n}, d.prototype.removeAllListeners = function (o) {\n  var i, e;\n  if (!this._events) return this;\n  if (!this._events.removeListener) return arguments.length === 0 ? this._events = {} : this._events[o] && delete this._events[o], this;\n  if (arguments.length === 0) {\n    for (i in this._events) {\n      i !== \"removeListener\" && this.removeAllListeners(i);\n    }\n    return this.removeAllListeners(\"removeListener\"), this._events = {}, this;\n  }\n  if (e = this._events[o], S(e)) this.removeListener(o, e);else if (e) for (; e.length;) {\n    this.removeListener(o, e[e.length - 1]);\n  }\n  return delete this._events[o], this;\n}, d.prototype.listeners = function (o) {\n  var i;\n  return !this._events || !this._events[o] ? i = [] : S(this._events[o]) ? i = [this._events[o]] : i = this._events[o].slice(), i;\n}, d.prototype.listenerCount = function (o) {\n  if (this._events) {\n    var i = this._events[o];\n    if (S(i)) return 1;\n    if (i) return i.length;\n  }\n  return 0;\n}, d.listenerCount = function (o, i) {\n  return o.listenerCount(i);\n};\nfunction S(o) {\n  return typeof o == \"function\";\n}\nfunction Ze(o) {\n  return typeof o == \"number\";\n}\nfunction D(o) {\n  return typeof o == \"object\" && o !== null;\n}\nfunction se(o) {\n  return o === void 0;\n}\nvar H = \"wc\",\n  F = 2,\n  W = \"client\",\n  V = \"\".concat(H, \"@\").concat(F, \":\").concat(W, \":\"),\n  z = {\n    name: W,\n    logger: \"error\",\n    controller: !1,\n    relayUrl: \"wss://relay.walletconnect.com\"\n  },\n  Be = {\n    session_proposal: \"session_proposal\",\n    session_update: \"session_update\",\n    session_extend: \"session_extend\",\n    session_ping: \"session_ping\",\n    pairing_ping: \"pairing_ping\",\n    session_delete: \"session_delete\",\n    session_expire: \"session_expire\",\n    pairing_delete: \"pairing_delete\",\n    pairing_expire: \"pairing_expire\",\n    session_request: \"session_request\",\n    session_event: \"session_event\",\n    proposal_expire: \"proposal_expire\"\n  },\n  Qe = {\n    database: \":memory:\"\n  },\n  ie = \"expirer\",\n  w = {\n    created: \"expirer_created\",\n    deleted: \"expirer_deleted\",\n    expired: \"expirer_expired\",\n    sync: \"expirer_sync\"\n  },\n  re = \"0.3\",\n  et = I,\n  _ = {\n    created: \"history_created\",\n    updated: \"history_updated\",\n    deleted: \"history_deleted\",\n    sync: \"history_sync\"\n  },\n  ne = \"history\",\n  oe = \"0.3\",\n  ae = \"pairing\",\n  tt = ee,\n  ce = \"proposal\",\n  he = ee,\n  le = \"session\",\n  b = je,\n  pe = \"engine\",\n  M = {\n    wc_pairingDelete: {\n      req: {\n        ttl: I,\n        prompt: !1,\n        tag: 1e3\n      },\n      res: {\n        ttl: I,\n        prompt: !1,\n        tag: 1001\n      }\n    },\n    wc_pairingPing: {\n      req: {\n        ttl: $,\n        prompt: !1,\n        tag: 1002\n      },\n      res: {\n        ttl: $,\n        prompt: !1,\n        tag: 1003\n      }\n    },\n    wc_sessionPropose: {\n      req: {\n        ttl: m,\n        prompt: !0,\n        tag: 1100\n      },\n      res: {\n        ttl: m,\n        prompt: !1,\n        tag: 1101\n      }\n    },\n    wc_sessionSettle: {\n      req: {\n        ttl: m,\n        prompt: !1,\n        tag: 1102\n      },\n      res: {\n        ttl: m,\n        prompt: !1,\n        tag: 1103\n      }\n    },\n    wc_sessionUpdate: {\n      req: {\n        ttl: I,\n        prompt: !1,\n        tag: 1104\n      },\n      res: {\n        ttl: I,\n        prompt: !1,\n        tag: 1105\n      }\n    },\n    wc_sessionExtend: {\n      req: {\n        ttl: I,\n        prompt: !1,\n        tag: 1106\n      },\n      res: {\n        ttl: I,\n        prompt: !1,\n        tag: 1107\n      }\n    },\n    wc_sessionRequest: {\n      req: {\n        ttl: m,\n        prompt: !0,\n        tag: 1108\n      },\n      res: {\n        ttl: m,\n        prompt: !1,\n        tag: 1109\n      }\n    },\n    wc_sessionEvent: {\n      req: {\n        ttl: m,\n        prompt: !0,\n        tag: 1110\n      },\n      res: {\n        ttl: m,\n        prompt: !1,\n        tag: 1111\n      }\n    },\n    wc_sessionDelete: {\n      req: {\n        ttl: I,\n        prompt: !1,\n        tag: 1112\n      },\n      res: {\n        ttl: I,\n        prompt: !1,\n        tag: 1113\n      }\n    },\n    wc_sessionPing: {\n      req: {\n        ttl: $,\n        prompt: !1,\n        tag: 1114\n      },\n      res: {\n        ttl: $,\n        prompt: !1,\n        tag: 1115\n      }\n    }\n  };\nvar st = Object.defineProperty,\n  it = Object.defineProperties,\n  rt = Object.getOwnPropertyDescriptors,\n  de = Object.getOwnPropertySymbols,\n  nt = Object.prototype.hasOwnProperty,\n  ot = Object.prototype.propertyIsEnumerable,\n  ge = function ge(o, i, e) {\n    return i in o ? st(o, i, {\n      enumerable: !0,\n      configurable: !0,\n      writable: !0,\n      value: e\n    }) : o[i] = e;\n  },\n  P = function P(o, i) {\n    for (var e in i || (i = {})) {\n      nt.call(i, e) && ge(o, e, i[e]);\n    }\n    if (de) {\n      var _iterator = _createForOfIteratorHelper(de(i)),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var e = _step.value;\n          ot.call(i, e) && ge(o, e, i[e]);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    }\n    return o;\n  },\n  ue = function ue(o, i) {\n    return it(o, rt(i));\n  };\nvar at = /*#__PURE__*/function (_Ee) {\n  _inherits(at, _Ee);\n  var _super = _createSuper(at);\n  function at(i) {\n    var _this;\n    _classCallCheck(this, at);\n    _this = _super.call(this, i), _this.events = new G(), _this.initialized = !1, _this.name = pe, _this.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.t0 = _this.initialized;\n              if (_context.t0) {\n                _context.next = 7;\n                break;\n              }\n              _context.next = 4;\n              return _this.cleanup();\n            case 4:\n              _this.registerRelayerEvents();\n              _this.registerExpirerEvents();\n              _this.initialized = !0;\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })), _this.connect = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(e) {\n        var t, s, r, n, a, h, _yield$_this$createPa, N, g, l, y, _T, E, q, U, _c, _N, A, k;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _this.isInitialized();\n                _context3.next = 3;\n                return _this.isValidConnect(e);\n              case 3:\n                t = e.pairingTopic, s = e.requiredNamespaces, r = e.relays;\n                n = t, h = !1;\n                if (!(n && (h = _this.client.pairing.get(n).active), !n || !h)) {\n                  _context3.next = 12;\n                  break;\n                }\n                _context3.next = 8;\n                return _this.createPairing();\n              case 8:\n                _yield$_this$createPa = _context3.sent;\n                N = _yield$_this$createPa.topic;\n                g = _yield$_this$createPa.uri;\n                n = N, a = g;\n              case 12:\n                _context3.next = 14;\n                return _this.client.core.crypto.generateKeyPair();\n              case 14:\n                l = _context3.sent;\n                y = {\n                  requiredNamespaces: s,\n                  relays: r !== null && r !== void 0 ? r : [{\n                    protocol: Z\n                  }],\n                  proposer: {\n                    publicKey: l,\n                    metadata: _this.client.metadata\n                  }\n                };\n                _T = T();\n                E = _T.reject;\n                q = _T.resolve;\n                U = _T.done;\n                if (!(_this.events.once(p(\"session_connect\"), /*#__PURE__*/function () {\n                  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(_ref3) {\n                    var N, g, L;\n                    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n                      while (1) {\n                        switch (_context2.prev = _context2.next) {\n                          case 0:\n                            N = _ref3.error, g = _ref3.session;\n                            if (!N) {\n                              _context2.next = 5;\n                              break;\n                            }\n                            E(N);\n                            _context2.next = 17;\n                            break;\n                          case 5:\n                            if (!g) {\n                              _context2.next = 17;\n                              break;\n                            }\n                            g.self.publicKey = l;\n                            L = ue(P({}, g), {\n                              requiredNamespaces: s\n                            });\n                            _context2.next = 10;\n                            return _this.client.session.set(g.topic, L);\n                          case 10:\n                            _context2.next = 12;\n                            return _this.setExpiry(g.topic, g.expiry);\n                          case 12:\n                            _context2.t0 = n;\n                            if (!_context2.t0) {\n                              _context2.next = 16;\n                              break;\n                            }\n                            _context2.next = 16;\n                            return _this.client.pairing.update(n, {\n                              peerMetadata: g.peer.metadata\n                            });\n                          case 16:\n                            q(L);\n                          case 17:\n                          case \"end\":\n                            return _context2.stop();\n                        }\n                      }\n                    }, _callee2);\n                  }));\n                  return function (_x2) {\n                    return _ref4.apply(this, arguments);\n                  };\n                }()), !n)) {\n                  _context3.next = 23;\n                  break;\n                }\n                _c = c(\"NO_MATCHING_KEY\", \"connect() pairing topic: \".concat(n)), _N = _c.message;\n                throw new Error(_N);\n              case 23:\n                _context3.next = 25;\n                return _this.sendRequest(n, \"wc_sessionPropose\", y);\n              case 25:\n                A = _context3.sent;\n                k = f(m);\n                _context3.next = 29;\n                return _this.setProposal(A, P({\n                  id: A,\n                  expiry: k\n                }, y));\n              case 29:\n                return _context3.abrupt(\"return\", {\n                  uri: a,\n                  approval: U\n                });\n              case 30:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }(), _this.pair = /*#__PURE__*/function () {\n      var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(e) {\n        var _Ie, t, s, r, n, a;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _this.isInitialized(), _this.isValidPair(e);\n                _Ie = Ie(e.uri), t = _Ie.topic, s = _Ie.symKey, r = _Ie.relay, n = f(m), a = {\n                  topic: t,\n                  relay: r,\n                  expiry: n,\n                  active: !1\n                };\n                _context4.next = 4;\n                return _this.client.pairing.set(t, a);\n              case 4:\n                _context4.next = 6;\n                return _this.client.core.crypto.setSymKey(s, t);\n              case 6:\n                _context4.next = 8;\n                return _this.client.core.relayer.subscribe(t, {\n                  relay: r\n                });\n              case 8:\n                _context4.next = 10;\n                return _this.setExpiry(t, n);\n              case 10:\n                return _context4.abrupt(\"return\", a);\n              case 11:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n      return function (_x3) {\n        return _ref5.apply(this, arguments);\n      };\n    }(), _this.approve = /*#__PURE__*/function () {\n      var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5(e) {\n        var t, s, r, _this$client$proposal, n, a, h, l, y, E, q, U, _T2, A, k, N, g;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _this.isInitialized();\n                _context5.next = 3;\n                return _this.isValidApprove(e);\n              case 3:\n                t = e.id;\n                s = e.relayProtocol;\n                r = e.namespaces;\n                _this$client$proposal = _this.client.proposal.get(t);\n                n = _this$client$proposal.pairingTopic;\n                a = _this$client$proposal.proposer;\n                h = _this$client$proposal.requiredNamespaces;\n                _context5.next = 12;\n                return _this.client.core.crypto.generateKeyPair();\n              case 12:\n                l = _context5.sent;\n                y = a.publicKey;\n                _context5.next = 16;\n                return _this.client.core.crypto.generateSharedKey(l, y);\n              case 16:\n                E = _context5.sent;\n                q = {\n                  relay: {\n                    protocol: s !== null && s !== void 0 ? s : \"irn\"\n                  },\n                  namespaces: r,\n                  requiredNamespaces: h,\n                  controller: {\n                    publicKey: l,\n                    metadata: _this.client.metadata\n                  },\n                  expiry: f(b)\n                };\n                _context5.next = 20;\n                return _this.client.core.relayer.subscribe(E);\n              case 20:\n                _context5.next = 22;\n                return _this.sendRequest(E, \"wc_sessionSettle\", q);\n              case 22:\n                U = _context5.sent;\n                _T2 = T();\n                A = _T2.done;\n                k = _T2.resolve;\n                N = _T2.reject;\n                _this.events.once(p(\"session_approve\", U), function (_ref7) {\n                  var L = _ref7.error;\n                  L ? N(L) : k(_this.client.session.get(E));\n                });\n                g = ue(P({}, q), {\n                  topic: E,\n                  acknowledged: !1,\n                  self: q.controller,\n                  peer: {\n                    publicKey: a.publicKey,\n                    metadata: a.metadata\n                  },\n                  controller: l\n                });\n                _context5.next = 31;\n                return _this.client.session.set(E, g);\n              case 31:\n                _context5.next = 33;\n                return _this.setExpiry(E, f(b));\n              case 33:\n                _context5.t0 = n;\n                if (!_context5.t0) {\n                  _context5.next = 37;\n                  break;\n                }\n                _context5.next = 37;\n                return _this.client.pairing.update(n, {\n                  peerMetadata: g.peer.metadata\n                });\n              case 37:\n                _context5.t1 = n && t;\n                if (!_context5.t1) {\n                  _context5.next = 45;\n                  break;\n                }\n                _context5.next = 41;\n                return _this.sendResult(t, n, {\n                  relay: {\n                    protocol: s !== null && s !== void 0 ? s : \"irn\"\n                  },\n                  responderPublicKey: l\n                });\n              case 41:\n                _context5.next = 43;\n                return _this.client.proposal.delete(t, v(\"USER_DISCONNECTED\"));\n              case 43:\n                _context5.next = 45;\n                return _this.activatePairing(n);\n              case 45:\n                return _context5.abrupt(\"return\", {\n                  topic: E,\n                  acknowledged: A\n                });\n              case 46:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }));\n      return function (_x4) {\n        return _ref6.apply(this, arguments);\n      };\n    }(), _this.reject = /*#__PURE__*/function () {\n      var _ref8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6(e) {\n        var t, s, _this$client$proposal2, r;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _this.isInitialized();\n                _context6.next = 3;\n                return _this.isValidReject(e);\n              case 3:\n                t = e.id, s = e.reason, _this$client$proposal2 = _this.client.proposal.get(t), r = _this$client$proposal2.pairingTopic;\n                _context6.t0 = r;\n                if (!_context6.t0) {\n                  _context6.next = 10;\n                  break;\n                }\n                _context6.next = 8;\n                return _this.sendError(t, r, s);\n              case 8:\n                _context6.next = 10;\n                return _this.client.proposal.delete(t, v(\"USER_DISCONNECTED\"));\n              case 10:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6);\n      }));\n      return function (_x5) {\n        return _ref8.apply(this, arguments);\n      };\n    }(), _this.update = /*#__PURE__*/function () {\n      var _ref9 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7(e) {\n        var t, s, r, _T3, n, a, h;\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _this.isInitialized();\n                _context7.next = 3;\n                return _this.isValidUpdate(e);\n              case 3:\n                t = e.topic;\n                s = e.namespaces;\n                _context7.next = 7;\n                return _this.sendRequest(t, \"wc_sessionUpdate\", {\n                  namespaces: s\n                });\n              case 7:\n                r = _context7.sent;\n                _T3 = T();\n                n = _T3.done;\n                a = _T3.resolve;\n                h = _T3.reject;\n                _this.events.once(p(\"session_update\", r), function (_ref10) {\n                  var l = _ref10.error;\n                  l ? h(l) : a();\n                });\n                _context7.next = 15;\n                return _this.client.session.update(t, {\n                  namespaces: s\n                });\n              case 15:\n                return _context7.abrupt(\"return\", {\n                  acknowledged: n\n                });\n              case 16:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7);\n      }));\n      return function (_x6) {\n        return _ref9.apply(this, arguments);\n      };\n    }(), _this.extend = /*#__PURE__*/function () {\n      var _ref11 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8(e) {\n        var t, s, _T4, r, n, a;\n        return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _this.isInitialized();\n                _context8.next = 3;\n                return _this.isValidExtend(e);\n              case 3:\n                t = e.topic;\n                _context8.next = 6;\n                return _this.sendRequest(t, \"wc_sessionExtend\", {});\n              case 6:\n                s = _context8.sent;\n                _T4 = T();\n                r = _T4.done;\n                n = _T4.resolve;\n                a = _T4.reject;\n                _this.events.once(p(\"session_extend\", s), function (_ref12) {\n                  var h = _ref12.error;\n                  h ? a(h) : n();\n                });\n                _context8.next = 14;\n                return _this.setExpiry(t, f(b));\n              case 14:\n                return _context8.abrupt(\"return\", {\n                  acknowledged: r\n                });\n              case 15:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8);\n      }));\n      return function (_x7) {\n        return _ref11.apply(this, arguments);\n      };\n    }(), _this.request = /*#__PURE__*/function () {\n      var _ref13 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee9(e) {\n        var t, s, r, n, _T5, a, h, l;\n        return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _this.isInitialized();\n                _context9.next = 3;\n                return _this.isValidRequest(e);\n              case 3:\n                t = e.chainId;\n                s = e.request;\n                r = e.topic;\n                _context9.next = 8;\n                return _this.sendRequest(r, \"wc_sessionRequest\", {\n                  request: s,\n                  chainId: t\n                });\n              case 8:\n                n = _context9.sent;\n                _T5 = T();\n                a = _T5.done;\n                h = _T5.resolve;\n                l = _T5.reject;\n                _this.events.once(p(\"session_request\", n), function (_ref14) {\n                  var y = _ref14.error,\n                    E = _ref14.result;\n                  y ? l(y) : h(E);\n                });\n                _context9.next = 16;\n                return a();\n              case 16:\n                return _context9.abrupt(\"return\", _context9.sent);\n              case 17:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9);\n      }));\n      return function (_x8) {\n        return _ref13.apply(this, arguments);\n      };\n    }(), _this.respond = /*#__PURE__*/function () {\n      var _ref15 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee10(e) {\n        var t, s, r;\n        return _regeneratorRuntime().wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                _this.isInitialized();\n                _context10.next = 3;\n                return _this.isValidRespond(e);\n              case 3:\n                t = e.topic, s = e.response, r = s.id;\n                if (!x(s)) {\n                  _context10.next = 9;\n                  break;\n                }\n                _context10.next = 7;\n                return _this.sendResult(r, t, s.result);\n              case 7:\n                _context10.next = 13;\n                break;\n              case 9:\n                _context10.t0 = R(s);\n                if (!_context10.t0) {\n                  _context10.next = 13;\n                  break;\n                }\n                _context10.next = 13;\n                return _this.sendError(r, t, s.error);\n              case 13:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10);\n      }));\n      return function (_x9) {\n        return _ref15.apply(this, arguments);\n      };\n    }(), _this.ping = /*#__PURE__*/function () {\n      var _ref16 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee11(e) {\n        var t, s, _T6, r, n, a, _s, _T7, _r, _n, _a;\n        return _regeneratorRuntime().wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                _this.isInitialized();\n                _context11.next = 3;\n                return _this.isValidPing(e);\n              case 3:\n                t = e.topic;\n                if (!_this.client.session.keys.includes(t)) {\n                  _context11.next = 17;\n                  break;\n                }\n                _context11.next = 7;\n                return _this.sendRequest(t, \"wc_sessionPing\", {});\n              case 7:\n                s = _context11.sent;\n                _T6 = T();\n                r = _T6.done;\n                n = _T6.resolve;\n                a = _T6.reject;\n                _this.events.once(p(\"session_ping\", s), function (_ref17) {\n                  var h = _ref17.error;\n                  h ? a(h) : n();\n                });\n                _context11.next = 15;\n                return r();\n              case 15:\n                _context11.next = 28;\n                break;\n              case 17:\n                if (!_this.client.pairing.keys.includes(t)) {\n                  _context11.next = 28;\n                  break;\n                }\n                _context11.next = 20;\n                return _this.sendRequest(t, \"wc_pairingPing\", {});\n              case 20:\n                _s = _context11.sent;\n                _T7 = T();\n                _r = _T7.done;\n                _n = _T7.resolve;\n                _a = _T7.reject;\n                _this.events.once(p(\"pairing_ping\", _s), function (_ref18) {\n                  var h = _ref18.error;\n                  h ? _a(h) : _n();\n                });\n                _context11.next = 28;\n                return _r();\n              case 28:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11);\n      }));\n      return function (_x10) {\n        return _ref16.apply(this, arguments);\n      };\n    }(), _this.emit = /*#__PURE__*/function () {\n      var _ref19 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee12(e) {\n        var t, s, r;\n        return _regeneratorRuntime().wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                _this.isInitialized();\n                _context12.next = 3;\n                return _this.isValidEmit(e);\n              case 3:\n                t = e.topic, s = e.event, r = e.chainId;\n                _context12.next = 6;\n                return _this.sendRequest(t, \"wc_sessionEvent\", {\n                  event: s,\n                  chainId: r\n                });\n              case 6:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12);\n      }));\n      return function (_x11) {\n        return _ref19.apply(this, arguments);\n      };\n    }(), _this.disconnect = /*#__PURE__*/function () {\n      var _ref20 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee13(e) {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                _this.isInitialized();\n                _context13.next = 3;\n                return _this.isValidDisconnect(e);\n              case 3:\n                t = e.topic;\n                if (!_this.client.session.keys.includes(t)) {\n                  _context13.next = 11;\n                  break;\n                }\n                _context13.next = 7;\n                return _this.sendRequest(t, \"wc_sessionDelete\", v(\"USER_DISCONNECTED\"));\n              case 7:\n                _context13.next = 9;\n                return _this.deleteSession(t);\n              case 9:\n                _context13.next = 17;\n                break;\n              case 11:\n                _context13.t0 = _this.client.pairing.keys.includes(t);\n                if (!_context13.t0) {\n                  _context13.next = 17;\n                  break;\n                }\n                _context13.next = 15;\n                return _this.sendRequest(t, \"wc_pairingDelete\", v(\"USER_DISCONNECTED\"));\n              case 15:\n                _context13.next = 17;\n                return _this.deletePairing(t);\n              case 17:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13);\n      }));\n      return function (_x12) {\n        return _ref20.apply(this, arguments);\n      };\n    }(), _this.find = function (e) {\n      return _this.isInitialized(), _this.client.session.getAll().filter(function (t) {\n        return Re(t, e);\n      });\n    }, _this.activatePairing = /*#__PURE__*/function () {\n      var _ref21 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee14(e) {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                t = f(he);\n                _context14.next = 3;\n                return _this.client.pairing.update(e, {\n                  active: !0,\n                  expiry: t\n                });\n              case 3:\n                _context14.next = 5;\n                return _this.setExpiry(e, t);\n              case 5:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14);\n      }));\n      return function (_x13) {\n        return _ref21.apply(this, arguments);\n      };\n    }(), _this.deleteSession = /*#__PURE__*/function () {\n      var _ref22 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee15(e, t) {\n        var _this$client$session$, s;\n        return _regeneratorRuntime().wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                _this$client$session$ = _this.client.session.get(e), s = _this$client$session$.self;\n                _context15.next = 3;\n                return _this.client.core.relayer.unsubscribe(e);\n              case 3:\n                _context15.next = 5;\n                return Promise.all([_this.client.session.delete(e, v(\"USER_DISCONNECTED\")), _this.client.core.crypto.deleteKeyPair(s.publicKey), _this.client.core.crypto.deleteSymKey(e), t ? Promise.resolve() : _this.client.expirer.del(e)]);\n              case 5:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15);\n      }));\n      return function (_x14, _x15) {\n        return _ref22.apply(this, arguments);\n      };\n    }(), _this.deletePairing = /*#__PURE__*/function () {\n      var _ref23 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee16(e, t) {\n        return _regeneratorRuntime().wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                _context16.next = 2;\n                return _this.client.core.relayer.unsubscribe(e);\n              case 2:\n                _context16.next = 4;\n                return Promise.all([_this.client.pairing.delete(e, v(\"USER_DISCONNECTED\")), _this.client.core.crypto.deleteSymKey(e), t ? Promise.resolve() : _this.client.expirer.del(e)]);\n              case 4:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16);\n      }));\n      return function (_x16, _x17) {\n        return _ref23.apply(this, arguments);\n      };\n    }(), _this.deleteProposal = /*#__PURE__*/function () {\n      var _ref24 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee17(e, t) {\n        return _regeneratorRuntime().wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                _context17.next = 2;\n                return Promise.all([_this.client.proposal.delete(e, v(\"USER_DISCONNECTED\")), t ? Promise.resolve() : _this.client.expirer.del(e)]);\n              case 2:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17);\n      }));\n      return function (_x18, _x19) {\n        return _ref24.apply(this, arguments);\n      };\n    }(), _this.setExpiry = /*#__PURE__*/function () {\n      var _ref25 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee18(e, t) {\n        return _regeneratorRuntime().wrap(function _callee18$(_context18) {\n          while (1) {\n            switch (_context18.prev = _context18.next) {\n              case 0:\n                if (!_this.client.pairing.keys.includes(e)) {\n                  _context18.next = 5;\n                  break;\n                }\n                _context18.next = 3;\n                return _this.client.pairing.update(e, {\n                  expiry: t\n                });\n              case 3:\n                _context18.next = 9;\n                break;\n              case 5:\n                _context18.t0 = _this.client.session.keys.includes(e);\n                if (!_context18.t0) {\n                  _context18.next = 9;\n                  break;\n                }\n                _context18.next = 9;\n                return _this.client.session.update(e, {\n                  expiry: t\n                });\n              case 9:\n                _this.client.expirer.set(e, t);\n              case 10:\n              case \"end\":\n                return _context18.stop();\n            }\n          }\n        }, _callee18);\n      }));\n      return function (_x20, _x21) {\n        return _ref25.apply(this, arguments);\n      };\n    }(), _this.setProposal = /*#__PURE__*/function () {\n      var _ref26 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee19(e, t) {\n        return _regeneratorRuntime().wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                _context19.next = 2;\n                return _this.client.proposal.set(e, t);\n              case 2:\n                _this.client.expirer.set(e, t.expiry);\n              case 3:\n              case \"end\":\n                return _context19.stop();\n            }\n          }\n        }, _callee19);\n      }));\n      return function (_x22, _x23) {\n        return _ref26.apply(this, arguments);\n      };\n    }(), _this.sendRequest = /*#__PURE__*/function () {\n      var _ref27 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee20(e, t, s) {\n        var r, n, a;\n        return _regeneratorRuntime().wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                r = te(t, s);\n                _context20.next = 3;\n                return _this.client.core.crypto.encode(e, r);\n              case 3:\n                n = _context20.sent;\n                a = M[t].req;\n                return _context20.abrupt(\"return\", (_this.client.history.set(e, r), _this.client.core.relayer.publish(e, n, a), r.id));\n              case 6:\n              case \"end\":\n                return _context20.stop();\n            }\n          }\n        }, _callee20);\n      }));\n      return function (_x24, _x25, _x26) {\n        return _ref27.apply(this, arguments);\n      };\n    }(), _this.sendResult = /*#__PURE__*/function () {\n      var _ref28 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee21(e, t, s) {\n        var r, n, a, h;\n        return _regeneratorRuntime().wrap(function _callee21$(_context21) {\n          while (1) {\n            switch (_context21.prev = _context21.next) {\n              case 0:\n                r = Ye(e, s);\n                _context21.next = 3;\n                return _this.client.core.crypto.encode(t, r);\n              case 3:\n                n = _context21.sent;\n                _context21.next = 6;\n                return _this.client.history.get(t, e);\n              case 6:\n                a = _context21.sent;\n                h = M[a.request.method].res;\n                _context21.next = 10;\n                return _this.client.core.relayer.publish(t, n, h);\n              case 10:\n                _context21.next = 12;\n                return _this.client.history.resolve(r);\n              case 12:\n              case \"end\":\n                return _context21.stop();\n            }\n          }\n        }, _callee21);\n      }));\n      return function (_x27, _x28, _x29) {\n        return _ref28.apply(this, arguments);\n      };\n    }(), _this.sendError = /*#__PURE__*/function () {\n      var _ref29 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee22(e, t, s) {\n        var r, n, a, h;\n        return _regeneratorRuntime().wrap(function _callee22$(_context22) {\n          while (1) {\n            switch (_context22.prev = _context22.next) {\n              case 0:\n                r = Xe(e, s);\n                _context22.next = 3;\n                return _this.client.core.crypto.encode(t, r);\n              case 3:\n                n = _context22.sent;\n                _context22.next = 6;\n                return _this.client.history.get(t, e);\n              case 6:\n                a = _context22.sent;\n                h = M[a.request.method].res;\n                _context22.next = 10;\n                return _this.client.core.relayer.publish(t, n, h);\n              case 10:\n                _context22.next = 12;\n                return _this.client.history.resolve(r);\n              case 12:\n              case \"end\":\n                return _context22.stop();\n            }\n          }\n        }, _callee22);\n      }));\n      return function (_x30, _x31, _x32) {\n        return _ref29.apply(this, arguments);\n      };\n    }(), _this.cleanup = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee23() {\n      var e, t, s;\n      return _regeneratorRuntime().wrap(function _callee23$(_context23) {\n        while (1) {\n          switch (_context23.prev = _context23.next) {\n            case 0:\n              e = [], t = [], s = [];\n              _this.client.session.getAll().forEach(function (r) {\n                O(r.expiry) && e.push(r.topic);\n              });\n              _this.client.pairing.getAll().forEach(function (r) {\n                O(r.expiry) && t.push(r.topic);\n              });\n              _this.client.proposal.getAll().forEach(function (r) {\n                O(r.expiry) && s.push(r.id);\n              });\n              _context23.next = 6;\n              return Promise.all([].concat(_toConsumableArray(e.map(function (r) {\n                return _this.deleteSession(r);\n              })), _toConsumableArray(t.map(function (r) {\n                return _this.deletePairing(r);\n              })), _toConsumableArray(s.map(function (r) {\n                return _this.deleteProposal(r);\n              }))));\n            case 6:\n            case \"end\":\n              return _context23.stop();\n          }\n        }\n      }, _callee23);\n    })), _this.onRelayEventRequest = function (e) {\n      var t = e.topic,\n        s = e.payload,\n        r = s.method;\n      switch (r) {\n        case \"wc_sessionPropose\":\n          return _this.onSessionProposeRequest(t, s);\n        case \"wc_sessionSettle\":\n          return _this.onSessionSettleRequest(t, s);\n        case \"wc_sessionUpdate\":\n          return _this.onSessionUpdateRequest(t, s);\n        case \"wc_sessionExtend\":\n          return _this.onSessionExtendRequest(t, s);\n        case \"wc_sessionPing\":\n          return _this.onSessionPingRequest(t, s);\n        case \"wc_pairingPing\":\n          return _this.onPairingPingRequest(t, s);\n        case \"wc_sessionDelete\":\n          return _this.onSessionDeleteRequest(t, s);\n        case \"wc_pairingDelete\":\n          return _this.onPairingDeleteRequest(t, s);\n        case \"wc_sessionRequest\":\n          return _this.onSessionRequest(t, s);\n        case \"wc_sessionEvent\":\n          return _this.onSessionEventRequest(t, s);\n        default:\n          return _this.client.logger.info(\"Unsupported request method \".concat(r));\n      }\n    }, _this.onRelayEventResponse = /*#__PURE__*/function () {\n      var _ref31 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee24(e) {\n        var t, s, r;\n        return _regeneratorRuntime().wrap(function _callee24$(_context24) {\n          while (1) {\n            switch (_context24.prev = _context24.next) {\n              case 0:\n                t = e.topic;\n                s = e.payload;\n                _context24.next = 4;\n                return _this.client.history.get(t, s.id);\n              case 4:\n                r = _context24.sent.request.method;\n                _context24.t0 = r;\n                _context24.next = _context24.t0 === \"wc_sessionPropose\" ? 8 : _context24.t0 === \"wc_sessionSettle\" ? 9 : _context24.t0 === \"wc_sessionUpdate\" ? 10 : _context24.t0 === \"wc_sessionExtend\" ? 11 : _context24.t0 === \"wc_sessionPing\" ? 12 : _context24.t0 === \"wc_pairingPing\" ? 13 : _context24.t0 === \"wc_sessionRequest\" ? 14 : 15;\n                break;\n              case 8:\n                return _context24.abrupt(\"return\", _this.onSessionProposeResponse(t, s));\n              case 9:\n                return _context24.abrupt(\"return\", _this.onSessionSettleResponse(t, s));\n              case 10:\n                return _context24.abrupt(\"return\", _this.onSessionUpdateResponse(t, s));\n              case 11:\n                return _context24.abrupt(\"return\", _this.onSessionExtendResponse(t, s));\n              case 12:\n                return _context24.abrupt(\"return\", _this.onSessionPingResponse(t, s));\n              case 13:\n                return _context24.abrupt(\"return\", _this.onPairingPingResponse(t, s));\n              case 14:\n                return _context24.abrupt(\"return\", _this.onSessionRequestResponse(t, s));\n              case 15:\n                return _context24.abrupt(\"return\", _this.client.logger.info(\"Unsupported response method \".concat(r)));\n              case 16:\n              case \"end\":\n                return _context24.stop();\n            }\n          }\n        }, _callee24);\n      }));\n      return function (_x33) {\n        return _ref31.apply(this, arguments);\n      };\n    }(), _this.onSessionProposeRequest = /*#__PURE__*/function () {\n      var _ref32 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee25(e, t) {\n        var s, r, n, a;\n        return _regeneratorRuntime().wrap(function _callee25$(_context25) {\n          while (1) {\n            switch (_context25.prev = _context25.next) {\n              case 0:\n                s = t.params, r = t.id;\n                _context25.prev = 1;\n                _this.isValidConnect(P({}, t.params));\n                n = f(m), a = P({\n                  id: r,\n                  pairingTopic: e,\n                  expiry: n\n                }, s);\n                _context25.next = 6;\n                return _this.setProposal(r, a);\n              case 6:\n                _this.client.events.emit(\"session_proposal\", {\n                  id: r,\n                  params: a\n                });\n                _context25.next = 14;\n                break;\n              case 9:\n                _context25.prev = 9;\n                _context25.t0 = _context25[\"catch\"](1);\n                _context25.next = 13;\n                return _this.sendError(r, e, _context25.t0);\n              case 13:\n                _this.client.logger.error(_context25.t0);\n              case 14:\n              case \"end\":\n                return _context25.stop();\n            }\n          }\n        }, _callee25, null, [[1, 9]]);\n      }));\n      return function (_x34, _x35) {\n        return _ref32.apply(this, arguments);\n      };\n    }(), _this.onSessionProposeResponse = /*#__PURE__*/function () {\n      var _ref33 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee26(e, t) {\n        var s, r, n, a, h, l, y;\n        return _regeneratorRuntime().wrap(function _callee26$(_context26) {\n          while (1) {\n            switch (_context26.prev = _context26.next) {\n              case 0:\n                s = t.id;\n                if (!x(t)) {\n                  _context26.next = 22;\n                  break;\n                }\n                r = t.result;\n                _this.client.logger.trace({\n                  type: \"method\",\n                  method: \"onSessionProposeResponse\",\n                  result: r\n                });\n                n = _this.client.proposal.get(s);\n                _this.client.logger.trace({\n                  type: \"method\",\n                  method: \"onSessionProposeResponse\",\n                  proposal: n\n                });\n                a = n.proposer.publicKey;\n                _this.client.logger.trace({\n                  type: \"method\",\n                  method: \"onSessionProposeResponse\",\n                  selfPublicKey: a\n                });\n                h = r.responderPublicKey;\n                _this.client.logger.trace({\n                  type: \"method\",\n                  method: \"onSessionProposeResponse\",\n                  peerPublicKey: h\n                });\n                _context26.next = 12;\n                return _this.client.core.crypto.generateSharedKey(a, h);\n              case 12:\n                l = _context26.sent;\n                _this.client.logger.trace({\n                  type: \"method\",\n                  method: \"onSessionProposeResponse\",\n                  sessionTopic: l\n                });\n                _context26.next = 16;\n                return _this.client.core.relayer.subscribe(l);\n              case 16:\n                y = _context26.sent;\n                _this.client.logger.trace({\n                  type: \"method\",\n                  method: \"onSessionProposeResponse\",\n                  subscriptionId: y\n                });\n                _context26.next = 20;\n                return _this.activatePairing(e);\n              case 20:\n                _context26.next = 27;\n                break;\n              case 22:\n                _context26.t0 = R(t);\n                if (!_context26.t0) {\n                  _context26.next = 27;\n                  break;\n                }\n                _context26.next = 26;\n                return _this.client.proposal.delete(s, v(\"USER_DISCONNECTED\"));\n              case 26:\n                _this.events.emit(p(\"session_connect\"), {\n                  error: t.error\n                });\n              case 27:\n              case \"end\":\n                return _context26.stop();\n            }\n          }\n        }, _callee26);\n      }));\n      return function (_x36, _x37) {\n        return _ref33.apply(this, arguments);\n      };\n    }(), _this.onSessionSettleRequest = /*#__PURE__*/function () {\n      var _ref34 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee27(e, t) {\n        var s, r, _t$params, n, a, h, l, y;\n        return _regeneratorRuntime().wrap(function _callee27$(_context27) {\n          while (1) {\n            switch (_context27.prev = _context27.next) {\n              case 0:\n                s = t.id, r = t.params;\n                _context27.prev = 1;\n                _this.isValidSessionSettleRequest(r);\n                _t$params = t.params, n = _t$params.relay, a = _t$params.controller, h = _t$params.expiry, l = _t$params.namespaces, y = {\n                  topic: e,\n                  relay: n,\n                  expiry: h,\n                  namespaces: l,\n                  acknowledged: !0,\n                  controller: a.publicKey,\n                  self: {\n                    publicKey: \"\",\n                    metadata: _this.client.metadata\n                  },\n                  peer: {\n                    publicKey: a.publicKey,\n                    metadata: a.metadata\n                  }\n                };\n                _context27.next = 6;\n                return _this.sendResult(t.id, e, !0);\n              case 6:\n                _this.events.emit(p(\"session_connect\"), {\n                  session: y\n                });\n                _context27.next = 14;\n                break;\n              case 9:\n                _context27.prev = 9;\n                _context27.t0 = _context27[\"catch\"](1);\n                _context27.next = 13;\n                return _this.sendError(s, e, _context27.t0);\n              case 13:\n                _this.client.logger.error(_context27.t0);\n              case 14:\n              case \"end\":\n                return _context27.stop();\n            }\n          }\n        }, _callee27, null, [[1, 9]]);\n      }));\n      return function (_x38, _x39) {\n        return _ref34.apply(this, arguments);\n      };\n    }(), _this.onSessionSettleResponse = /*#__PURE__*/function () {\n      var _ref35 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee28(e, t) {\n        var s;\n        return _regeneratorRuntime().wrap(function _callee28$(_context28) {\n          while (1) {\n            switch (_context28.prev = _context28.next) {\n              case 0:\n                s = t.id;\n                if (!x(t)) {\n                  _context28.next = 7;\n                  break;\n                }\n                _context28.next = 4;\n                return _this.client.session.update(e, {\n                  acknowledged: !0\n                });\n              case 4:\n                _this.events.emit(p(\"session_approve\", s), {});\n                _context28.next = 12;\n                break;\n              case 7:\n                _context28.t0 = R(t);\n                if (!_context28.t0) {\n                  _context28.next = 12;\n                  break;\n                }\n                _context28.next = 11;\n                return _this.client.session.delete(e, v(\"USER_DISCONNECTED\"));\n              case 11:\n                _this.events.emit(p(\"session_approve\", s), {\n                  error: t.error\n                });\n              case 12:\n              case \"end\":\n                return _context28.stop();\n            }\n          }\n        }, _callee28);\n      }));\n      return function (_x40, _x41) {\n        return _ref35.apply(this, arguments);\n      };\n    }(), _this.onSessionUpdateRequest = /*#__PURE__*/function () {\n      var _ref36 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee29(e, t) {\n        var s, r;\n        return _regeneratorRuntime().wrap(function _callee29$(_context29) {\n          while (1) {\n            switch (_context29.prev = _context29.next) {\n              case 0:\n                s = t.params, r = t.id;\n                _context29.prev = 1;\n                _this.isValidUpdate(P({\n                  topic: e\n                }, s));\n                _context29.next = 5;\n                return _this.client.session.update(e, {\n                  namespaces: s.namespaces\n                });\n              case 5:\n                _context29.next = 7;\n                return _this.sendResult(r, e, !0);\n              case 7:\n                _this.client.events.emit(\"session_update\", {\n                  id: r,\n                  topic: e,\n                  params: s\n                });\n                _context29.next = 15;\n                break;\n              case 10:\n                _context29.prev = 10;\n                _context29.t0 = _context29[\"catch\"](1);\n                _context29.next = 14;\n                return _this.sendError(r, e, _context29.t0);\n              case 14:\n                _this.client.logger.error(_context29.t0);\n              case 15:\n              case \"end\":\n                return _context29.stop();\n            }\n          }\n        }, _callee29, null, [[1, 10]]);\n      }));\n      return function (_x42, _x43) {\n        return _ref36.apply(this, arguments);\n      };\n    }(), _this.onSessionUpdateResponse = function (e, t) {\n      var s = t.id;\n      x(t) ? _this.events.emit(p(\"session_update\", s), {}) : R(t) && _this.events.emit(p(\"session_update\", s), {\n        error: t.error\n      });\n    }, _this.onSessionExtendRequest = /*#__PURE__*/function () {\n      var _ref37 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee30(e, t) {\n        var s;\n        return _regeneratorRuntime().wrap(function _callee30$(_context30) {\n          while (1) {\n            switch (_context30.prev = _context30.next) {\n              case 0:\n                s = t.id;\n                _context30.prev = 1;\n                _this.isValidExtend({\n                  topic: e\n                });\n                _context30.next = 5;\n                return _this.setExpiry(e, f(b));\n              case 5:\n                _context30.next = 7;\n                return _this.sendResult(s, e, !0);\n              case 7:\n                _this.client.events.emit(\"session_extend\", {\n                  id: s,\n                  topic: e\n                });\n                _context30.next = 15;\n                break;\n              case 10:\n                _context30.prev = 10;\n                _context30.t0 = _context30[\"catch\"](1);\n                _context30.next = 14;\n                return _this.sendError(s, e, _context30.t0);\n              case 14:\n                _this.client.logger.error(_context30.t0);\n              case 15:\n              case \"end\":\n                return _context30.stop();\n            }\n          }\n        }, _callee30, null, [[1, 10]]);\n      }));\n      return function (_x44, _x45) {\n        return _ref37.apply(this, arguments);\n      };\n    }(), _this.onSessionExtendResponse = function (e, t) {\n      var s = t.id;\n      x(t) ? _this.events.emit(p(\"session_extend\", s), {}) : R(t) && _this.events.emit(p(\"session_extend\", s), {\n        error: t.error\n      });\n    }, _this.onSessionPingRequest = /*#__PURE__*/function () {\n      var _ref38 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee31(e, t) {\n        var s;\n        return _regeneratorRuntime().wrap(function _callee31$(_context31) {\n          while (1) {\n            switch (_context31.prev = _context31.next) {\n              case 0:\n                s = t.id;\n                _context31.prev = 1;\n                _this.isValidPing({\n                  topic: e\n                });\n                _context31.next = 5;\n                return _this.sendResult(s, e, !0);\n              case 5:\n                _this.client.events.emit(\"session_ping\", {\n                  id: s,\n                  topic: e\n                });\n                _context31.next = 13;\n                break;\n              case 8:\n                _context31.prev = 8;\n                _context31.t0 = _context31[\"catch\"](1);\n                _context31.next = 12;\n                return _this.sendError(s, e, _context31.t0);\n              case 12:\n                _this.client.logger.error(_context31.t0);\n              case 13:\n              case \"end\":\n                return _context31.stop();\n            }\n          }\n        }, _callee31, null, [[1, 8]]);\n      }));\n      return function (_x46, _x47) {\n        return _ref38.apply(this, arguments);\n      };\n    }(), _this.onSessionPingResponse = function (e, t) {\n      var s = t.id;\n      setTimeout(function () {\n        x(t) ? _this.events.emit(p(\"session_ping\", s), {}) : R(t) && _this.events.emit(p(\"session_ping\", s), {\n          error: t.error\n        });\n      }, 500);\n    }, _this.onPairingPingRequest = /*#__PURE__*/function () {\n      var _ref39 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee32(e, t) {\n        var s;\n        return _regeneratorRuntime().wrap(function _callee32$(_context32) {\n          while (1) {\n            switch (_context32.prev = _context32.next) {\n              case 0:\n                s = t.id;\n                _context32.prev = 1;\n                _this.isValidPing({\n                  topic: e\n                });\n                _context32.next = 5;\n                return _this.sendResult(s, e, !0);\n              case 5:\n                _this.client.events.emit(\"pairing_ping\", {\n                  id: s,\n                  topic: e\n                });\n                _context32.next = 13;\n                break;\n              case 8:\n                _context32.prev = 8;\n                _context32.t0 = _context32[\"catch\"](1);\n                _context32.next = 12;\n                return _this.sendError(s, e, _context32.t0);\n              case 12:\n                _this.client.logger.error(_context32.t0);\n              case 13:\n              case \"end\":\n                return _context32.stop();\n            }\n          }\n        }, _callee32, null, [[1, 8]]);\n      }));\n      return function (_x48, _x49) {\n        return _ref39.apply(this, arguments);\n      };\n    }(), _this.onPairingPingResponse = function (e, t) {\n      var s = t.id;\n      setTimeout(function () {\n        x(t) ? _this.events.emit(p(\"pairing_ping\", s), {}) : R(t) && _this.events.emit(p(\"pairing_ping\", s), {\n          error: t.error\n        });\n      }, 500);\n    }, _this.onSessionDeleteRequest = /*#__PURE__*/function () {\n      var _ref40 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee33(e, t) {\n        var s;\n        return _regeneratorRuntime().wrap(function _callee33$(_context33) {\n          while (1) {\n            switch (_context33.prev = _context33.next) {\n              case 0:\n                s = t.id;\n                _context33.prev = 1;\n                _this.isValidDisconnect({\n                  topic: e,\n                  reason: t.params\n                });\n                _context33.next = 5;\n                return _this.sendResult(s, e, !0);\n              case 5:\n                _context33.next = 7;\n                return _this.deleteSession(e);\n              case 7:\n                _this.client.events.emit(\"session_delete\", {\n                  id: s,\n                  topic: e\n                });\n                _context33.next = 15;\n                break;\n              case 10:\n                _context33.prev = 10;\n                _context33.t0 = _context33[\"catch\"](1);\n                _context33.next = 14;\n                return _this.sendError(s, e, _context33.t0);\n              case 14:\n                _this.client.logger.error(_context33.t0);\n              case 15:\n              case \"end\":\n                return _context33.stop();\n            }\n          }\n        }, _callee33, null, [[1, 10]]);\n      }));\n      return function (_x50, _x51) {\n        return _ref40.apply(this, arguments);\n      };\n    }(), _this.onPairingDeleteRequest = /*#__PURE__*/function () {\n      var _ref41 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee34(e, t) {\n        var s;\n        return _regeneratorRuntime().wrap(function _callee34$(_context34) {\n          while (1) {\n            switch (_context34.prev = _context34.next) {\n              case 0:\n                s = t.id;\n                _context34.prev = 1;\n                _this.isValidDisconnect({\n                  topic: e,\n                  reason: t.params\n                });\n                _context34.next = 5;\n                return _this.sendResult(s, e, !0);\n              case 5:\n                _context34.next = 7;\n                return _this.deletePairing(e);\n              case 7:\n                _this.client.events.emit(\"pairing_delete\", {\n                  id: s,\n                  topic: e\n                });\n                _context34.next = 15;\n                break;\n              case 10:\n                _context34.prev = 10;\n                _context34.t0 = _context34[\"catch\"](1);\n                _context34.next = 14;\n                return _this.sendError(s, e, _context34.t0);\n              case 14:\n                _this.client.logger.error(_context34.t0);\n              case 15:\n              case \"end\":\n                return _context34.stop();\n            }\n          }\n        }, _callee34, null, [[1, 10]]);\n      }));\n      return function (_x52, _x53) {\n        return _ref41.apply(this, arguments);\n      };\n    }(), _this.onSessionRequest = /*#__PURE__*/function () {\n      var _ref42 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee35(e, t) {\n        var s, r;\n        return _regeneratorRuntime().wrap(function _callee35$(_context35) {\n          while (1) {\n            switch (_context35.prev = _context35.next) {\n              case 0:\n                s = t.id, r = t.params;\n                _context35.prev = 1;\n                _this.isValidRequest(P({\n                  topic: e\n                }, r)), _this.client.events.emit(\"session_request\", {\n                  id: s,\n                  topic: e,\n                  params: r\n                });\n                _context35.next = 10;\n                break;\n              case 5:\n                _context35.prev = 5;\n                _context35.t0 = _context35[\"catch\"](1);\n                _context35.next = 9;\n                return _this.sendError(s, e, _context35.t0);\n              case 9:\n                _this.client.logger.error(_context35.t0);\n              case 10:\n              case \"end\":\n                return _context35.stop();\n            }\n          }\n        }, _callee35, null, [[1, 5]]);\n      }));\n      return function (_x54, _x55) {\n        return _ref42.apply(this, arguments);\n      };\n    }(), _this.onSessionRequestResponse = function (e, t) {\n      var s = t.id;\n      x(t) ? _this.events.emit(p(\"session_request\", s), {\n        result: t.result\n      }) : R(t) && _this.events.emit(p(\"session_request\", s), {\n        error: t.error\n      });\n    }, _this.onSessionEventRequest = /*#__PURE__*/function () {\n      var _ref43 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee36(e, t) {\n        var s, r;\n        return _regeneratorRuntime().wrap(function _callee36$(_context36) {\n          while (1) {\n            switch (_context36.prev = _context36.next) {\n              case 0:\n                s = t.id, r = t.params;\n                _context36.prev = 1;\n                _this.isValidEmit(P({\n                  topic: e\n                }, r)), _this.client.events.emit(\"session_event\", {\n                  id: s,\n                  topic: e,\n                  params: r\n                });\n                _context36.next = 10;\n                break;\n              case 5:\n                _context36.prev = 5;\n                _context36.t0 = _context36[\"catch\"](1);\n                _context36.next = 9;\n                return _this.sendError(s, e, _context36.t0);\n              case 9:\n                _this.client.logger.error(_context36.t0);\n              case 10:\n              case \"end\":\n                return _context36.stop();\n            }\n          }\n        }, _callee36, null, [[1, 5]]);\n      }));\n      return function (_x56, _x57) {\n        return _ref43.apply(this, arguments);\n      };\n    }(), _this.isValidConnect = /*#__PURE__*/function () {\n      var _ref44 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee37(e) {\n        var _c2, a, t, s, r, n, _c3, _a2;\n        return _regeneratorRuntime().wrap(function _callee37$(_context37) {\n          while (1) {\n            switch (_context37.prev = _context37.next) {\n              case 0:\n                if (u(e)) {\n                  _context37.next = 3;\n                  break;\n                }\n                _c2 = c(\"MISSING_OR_INVALID\", \"connect() params: \".concat(JSON.stringify(e))), a = _c2.message;\n                throw new Error(a);\n              case 3:\n                t = e.pairingTopic, s = e.requiredNamespaces, r = e.relays;\n                _context37.t0 = Se(t);\n                if (_context37.t0) {\n                  _context37.next = 8;\n                  break;\n                }\n                _context37.next = 8;\n                return _this.isValidPairingTopic(t);\n              case 8:\n                n = Ne(s, \"connect()\");\n                if (!n) {\n                  _context37.next = 11;\n                  break;\n                }\n                throw new Error(n.message);\n              case 11:\n                if (xe(r, !0)) {\n                  _context37.next = 14;\n                  break;\n                }\n                _c3 = c(\"MISSING_OR_INVALID\", \"connect() relays: \".concat(r)), _a2 = _c3.message;\n                throw new Error(_a2);\n              case 14:\n              case \"end\":\n                return _context37.stop();\n            }\n          }\n        }, _callee37);\n      }));\n      return function (_x58) {\n        return _ref44.apply(this, arguments);\n      };\n    }(), _this.isValidPair = function (e) {\n      if (!u(e)) {\n        var _c4 = c(\"MISSING_OR_INVALID\", \"pair() params: \".concat(e)),\n          t = _c4.message;\n        throw new Error(t);\n      }\n      if (!Pe(e.uri)) {\n        var _c5 = c(\"MISSING_OR_INVALID\", \"pair() uri: \".concat(e.uri)),\n          _t = _c5.message;\n        throw new Error(_t);\n      }\n    }, _this.isValidApprove = /*#__PURE__*/function () {\n      var _ref45 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee38(e) {\n        var t, s, r, n, a, h, _c6, l;\n        return _regeneratorRuntime().wrap(function _callee38$(_context38) {\n          while (1) {\n            switch (_context38.prev = _context38.next) {\n              case 0:\n                if (u(e)) {\n                  _context38.next = 2;\n                  break;\n                }\n                throw new Error(c(\"MISSING_OR_INVALID\", \"approve() params: \".concat(e)).message);\n              case 2:\n                t = e.id, s = e.namespaces, r = e.relayProtocol;\n                _context38.next = 5;\n                return _this.isValidProposalId(t);\n              case 5:\n                n = _this.client.proposal.get(t), a = X(s, \"approve()\");\n                if (!a) {\n                  _context38.next = 8;\n                  break;\n                }\n                throw new Error(a.message);\n              case 8:\n                h = B(n.requiredNamespaces, s, \"update()\");\n                if (!h) {\n                  _context38.next = 11;\n                  break;\n                }\n                throw new Error(h.message);\n              case 11:\n                if (C(r, !0)) {\n                  _context38.next = 14;\n                  break;\n                }\n                _c6 = c(\"MISSING_OR_INVALID\", \"approve() relayProtocol: \".concat(r)), l = _c6.message;\n                throw new Error(l);\n              case 14:\n              case \"end\":\n                return _context38.stop();\n            }\n          }\n        }, _callee38);\n      }));\n      return function (_x59) {\n        return _ref45.apply(this, arguments);\n      };\n    }(), _this.isValidReject = /*#__PURE__*/function () {\n      var _ref46 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee39(e) {\n        var _c7, r, t, s, _c8, _r2;\n        return _regeneratorRuntime().wrap(function _callee39$(_context39) {\n          while (1) {\n            switch (_context39.prev = _context39.next) {\n              case 0:\n                if (u(e)) {\n                  _context39.next = 3;\n                  break;\n                }\n                _c7 = c(\"MISSING_OR_INVALID\", \"reject() params: \".concat(e)), r = _c7.message;\n                throw new Error(r);\n              case 3:\n                t = e.id, s = e.reason;\n                _context39.next = 6;\n                return _this.isValidProposalId(t);\n              case 6:\n                if (Te(s)) {\n                  _context39.next = 9;\n                  break;\n                }\n                _c8 = c(\"MISSING_OR_INVALID\", \"reject() reason: \".concat(JSON.stringify(s))), _r2 = _c8.message;\n                throw new Error(_r2);\n              case 9:\n              case \"end\":\n                return _context39.stop();\n            }\n          }\n        }, _callee39);\n      }));\n      return function (_x60) {\n        return _ref46.apply(this, arguments);\n      };\n    }(), _this.isValidSessionSettleRequest = function (e) {\n      if (!u(e)) {\n        var _c9 = c(\"MISSING_OR_INVALID\", \"onSessionSettleRequest() params: \".concat(e)),\n          l = _c9.message;\n        throw new Error(l);\n      }\n      var t = e.relay,\n        s = e.controller,\n        r = e.namespaces,\n        n = e.expiry;\n      if (!Oe(t)) {\n        var _c10 = c(\"MISSING_OR_INVALID\", \"onSessionSettleRequest() relay protocol should be a string\"),\n          _l = _c10.message;\n        throw new Error(_l);\n      }\n      var a = Ve(s, \"onSessionSettleRequest()\");\n      if (a) throw new Error(a.message);\n      var h = X(r, \"onSessionSettleRequest()\");\n      if (h) throw new Error(h.message);\n      if (O(n)) {\n        var _c11 = c(\"EXPIRED\", \"onSessionSettleRequest()\"),\n          _l2 = _c11.message;\n        throw new Error(_l2);\n      }\n    }, _this.isValidUpdate = /*#__PURE__*/function () {\n      var _ref47 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee40(e) {\n        var _c12, h, t, s, r, n, a;\n        return _regeneratorRuntime().wrap(function _callee40$(_context40) {\n          while (1) {\n            switch (_context40.prev = _context40.next) {\n              case 0:\n                if (u(e)) {\n                  _context40.next = 3;\n                  break;\n                }\n                _c12 = c(\"MISSING_OR_INVALID\", \"update() params: \".concat(e)), h = _c12.message;\n                throw new Error(h);\n              case 3:\n                t = e.topic, s = e.namespaces;\n                _context40.next = 6;\n                return _this.isValidSessionTopic(t);\n              case 6:\n                r = _this.client.session.get(t), n = X(s, \"update()\");\n                if (!n) {\n                  _context40.next = 9;\n                  break;\n                }\n                throw new Error(n.message);\n              case 9:\n                a = B(r.requiredNamespaces, s, \"update()\");\n                if (!a) {\n                  _context40.next = 12;\n                  break;\n                }\n                throw new Error(a.message);\n              case 12:\n              case \"end\":\n                return _context40.stop();\n            }\n          }\n        }, _callee40);\n      }));\n      return function (_x61) {\n        return _ref47.apply(this, arguments);\n      };\n    }(), _this.isValidExtend = /*#__PURE__*/function () {\n      var _ref48 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee41(e) {\n        var _c13, s, t;\n        return _regeneratorRuntime().wrap(function _callee41$(_context41) {\n          while (1) {\n            switch (_context41.prev = _context41.next) {\n              case 0:\n                if (u(e)) {\n                  _context41.next = 3;\n                  break;\n                }\n                _c13 = c(\"MISSING_OR_INVALID\", \"extend() params: \".concat(e)), s = _c13.message;\n                throw new Error(s);\n              case 3:\n                t = e.topic;\n                _context41.next = 6;\n                return _this.isValidSessionTopic(t);\n              case 6:\n              case \"end\":\n                return _context41.stop();\n            }\n          }\n        }, _callee41);\n      }));\n      return function (_x62) {\n        return _ref48.apply(this, arguments);\n      };\n    }(), _this.isValidRequest = /*#__PURE__*/function () {\n      var _ref49 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee42(e) {\n        var _c14, a, t, s, r, _this$client$session$2, n, _c15, _a3, _c16, _a4, _c17, _a5;\n        return _regeneratorRuntime().wrap(function _callee42$(_context42) {\n          while (1) {\n            switch (_context42.prev = _context42.next) {\n              case 0:\n                if (u(e)) {\n                  _context42.next = 3;\n                  break;\n                }\n                _c14 = c(\"MISSING_OR_INVALID\", \"request() params: \".concat(e)), a = _c14.message;\n                throw new Error(a);\n              case 3:\n                t = e.topic, s = e.request, r = e.chainId;\n                _context42.next = 6;\n                return _this.isValidSessionTopic(t);\n              case 6:\n                _this$client$session$2 = _this.client.session.get(t), n = _this$client$session$2.namespaces;\n                if (Q(n, r)) {\n                  _context42.next = 10;\n                  break;\n                }\n                _c15 = c(\"MISSING_OR_INVALID\", \"request() chainId: \".concat(r)), _a3 = _c15.message;\n                throw new Error(_a3);\n              case 10:\n                if (qe(s)) {\n                  _context42.next = 13;\n                  break;\n                }\n                _c16 = c(\"MISSING_OR_INVALID\", \"request() \".concat(JSON.stringify(s))), _a4 = _c16.message;\n                throw new Error(_a4);\n              case 13:\n                if (Le(n, r, s.method)) {\n                  _context42.next = 16;\n                  break;\n                }\n                _c17 = c(\"MISSING_OR_INVALID\", \"request() method: \".concat(s.method)), _a5 = _c17.message;\n                throw new Error(_a5);\n              case 16:\n              case \"end\":\n                return _context42.stop();\n            }\n          }\n        }, _callee42);\n      }));\n      return function (_x63) {\n        return _ref49.apply(this, arguments);\n      };\n    }(), _this.isValidRespond = /*#__PURE__*/function () {\n      var _ref50 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee43(e) {\n        var _c18, r, t, s, _c19, _r3;\n        return _regeneratorRuntime().wrap(function _callee43$(_context43) {\n          while (1) {\n            switch (_context43.prev = _context43.next) {\n              case 0:\n                if (u(e)) {\n                  _context43.next = 3;\n                  break;\n                }\n                _c18 = c(\"MISSING_OR_INVALID\", \"respond() params: \".concat(e)), r = _c18.message;\n                throw new Error(r);\n              case 3:\n                t = e.topic, s = e.response;\n                _context43.next = 6;\n                return _this.isValidSessionTopic(t);\n              case 6:\n                if (De(s)) {\n                  _context43.next = 9;\n                  break;\n                }\n                _c19 = c(\"MISSING_OR_INVALID\", \"respond() response: \".concat(JSON.stringify(s))), _r3 = _c19.message;\n                throw new Error(_r3);\n              case 9:\n              case \"end\":\n                return _context43.stop();\n            }\n          }\n        }, _callee43);\n      }));\n      return function (_x64) {\n        return _ref50.apply(this, arguments);\n      };\n    }(), _this.isValidPing = /*#__PURE__*/function () {\n      var _ref51 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee44(e) {\n        var _c20, s, t;\n        return _regeneratorRuntime().wrap(function _callee44$(_context44) {\n          while (1) {\n            switch (_context44.prev = _context44.next) {\n              case 0:\n                if (u(e)) {\n                  _context44.next = 3;\n                  break;\n                }\n                _c20 = c(\"MISSING_OR_INVALID\", \"ping() params: \".concat(e)), s = _c20.message;\n                throw new Error(s);\n              case 3:\n                t = e.topic;\n                _context44.next = 6;\n                return _this.isValidSessionOrPairingTopic(t);\n              case 6:\n              case \"end\":\n                return _context44.stop();\n            }\n          }\n        }, _callee44);\n      }));\n      return function (_x65) {\n        return _ref51.apply(this, arguments);\n      };\n    }(), _this.isValidEmit = /*#__PURE__*/function () {\n      var _ref52 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee45(e) {\n        var _c21, a, t, s, r, _this$client$session$3, n, _c22, _a6, _c23, _a7, _c24, _a8;\n        return _regeneratorRuntime().wrap(function _callee45$(_context45) {\n          while (1) {\n            switch (_context45.prev = _context45.next) {\n              case 0:\n                if (u(e)) {\n                  _context45.next = 3;\n                  break;\n                }\n                _c21 = c(\"MISSING_OR_INVALID\", \"emit() params: \".concat(e)), a = _c21.message;\n                throw new Error(a);\n              case 3:\n                t = e.topic, s = e.event, r = e.chainId;\n                _context45.next = 6;\n                return _this.isValidSessionTopic(t);\n              case 6:\n                _this$client$session$3 = _this.client.session.get(t), n = _this$client$session$3.namespaces;\n                if (Q(n, r)) {\n                  _context45.next = 10;\n                  break;\n                }\n                _c22 = c(\"MISSING_OR_INVALID\", \"emit() chainId: \".concat(r)), _a6 = _c22.message;\n                throw new Error(_a6);\n              case 10:\n                if (be(s)) {\n                  _context45.next = 13;\n                  break;\n                }\n                _c23 = c(\"MISSING_OR_INVALID\", \"emit() event: \".concat(JSON.stringify(s))), _a7 = _c23.message;\n                throw new Error(_a7);\n              case 13:\n                if (Ae(n, r, s.name)) {\n                  _context45.next = 16;\n                  break;\n                }\n                _c24 = c(\"MISSING_OR_INVALID\", \"emit() event: \".concat(JSON.stringify(s))), _a8 = _c24.message;\n                throw new Error(_a8);\n              case 16:\n              case \"end\":\n                return _context45.stop();\n            }\n          }\n        }, _callee45);\n      }));\n      return function (_x66) {\n        return _ref52.apply(this, arguments);\n      };\n    }(), _this.isValidDisconnect = /*#__PURE__*/function () {\n      var _ref53 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee46(e) {\n        var _c25, s, t;\n        return _regeneratorRuntime().wrap(function _callee46$(_context46) {\n          while (1) {\n            switch (_context46.prev = _context46.next) {\n              case 0:\n                if (u(e)) {\n                  _context46.next = 3;\n                  break;\n                }\n                _c25 = c(\"MISSING_OR_INVALID\", \"disconnect() params: \".concat(e)), s = _c25.message;\n                throw new Error(s);\n              case 3:\n                t = e.topic;\n                _context46.next = 6;\n                return _this.isValidSessionOrPairingTopic(t);\n              case 6:\n              case \"end\":\n                return _context46.stop();\n            }\n          }\n        }, _callee46);\n      }));\n      return function (_x67) {\n        return _ref53.apply(this, arguments);\n      };\n    }();\n    return _this;\n  }\n  _createClass(at, [{\n    key: \"createPairing\",\n    value: function () {\n      var _createPairing = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee47() {\n        var i, e, t, s, r, n;\n        return _regeneratorRuntime().wrap(function _callee47$(_context47) {\n          while (1) {\n            switch (_context47.prev = _context47.next) {\n              case 0:\n                i = Ce();\n                _context47.next = 3;\n                return this.client.core.crypto.setSymKey(i);\n              case 3:\n                e = _context47.sent;\n                t = f(m);\n                s = {\n                  protocol: Z\n                };\n                r = {\n                  topic: e,\n                  expiry: t,\n                  relay: s,\n                  active: !1\n                };\n                n = $e({\n                  protocol: this.client.protocol,\n                  version: this.client.version,\n                  topic: e,\n                  symKey: i,\n                  relay: s\n                });\n                _context47.next = 10;\n                return this.client.pairing.set(e, r);\n              case 10:\n                _context47.next = 12;\n                return this.client.core.relayer.subscribe(e);\n              case 12:\n                _context47.next = 14;\n                return this.setExpiry(e, t);\n              case 14:\n                return _context47.abrupt(\"return\", {\n                  topic: e,\n                  uri: n\n                });\n              case 15:\n              case \"end\":\n                return _context47.stop();\n            }\n          }\n        }, _callee47, this);\n      }));\n      function createPairing() {\n        return _createPairing.apply(this, arguments);\n      }\n      return createPairing;\n    }()\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c26 = c(\"NOT_INITIALIZED\", this.name),\n          i = _c26.message;\n        throw new Error(i);\n      }\n    }\n  }, {\n    key: \"registerRelayerEvents\",\n    value: function registerRelayerEvents() {\n      var _this2 = this;\n      this.client.core.relayer.on(me.message, /*#__PURE__*/function () {\n        var _ref54 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee48(i) {\n          var e, t, s;\n          return _regeneratorRuntime().wrap(function _callee48$(_context48) {\n            while (1) {\n              switch (_context48.prev = _context48.next) {\n                case 0:\n                  e = i.topic;\n                  t = i.message;\n                  _context48.next = 4;\n                  return _this2.client.core.crypto.decode(e, t);\n                case 4:\n                  s = _context48.sent;\n                  if (!He(s)) {\n                    _context48.next = 9;\n                    break;\n                  }\n                  _this2.client.history.set(e, s), _this2.onRelayEventRequest({\n                    topic: e,\n                    payload: s\n                  });\n                  _context48.next = 14;\n                  break;\n                case 9:\n                  _context48.t0 = Fe(s);\n                  if (!_context48.t0) {\n                    _context48.next = 14;\n                    break;\n                  }\n                  _context48.next = 13;\n                  return _this2.client.history.resolve(s);\n                case 13:\n                  _this2.onRelayEventResponse({\n                    topic: e,\n                    payload: s\n                  });\n                case 14:\n                case \"end\":\n                  return _context48.stop();\n              }\n            }\n          }, _callee48);\n        }));\n        return function (_x68) {\n          return _ref54.apply(this, arguments);\n        };\n      }());\n    }\n  }, {\n    key: \"registerExpirerEvents\",\n    value: function registerExpirerEvents() {\n      var _this3 = this;\n      this.client.expirer.on(w.expired, /*#__PURE__*/function () {\n        var _ref55 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee49(i) {\n          var _Ge, e, t;\n          return _regeneratorRuntime().wrap(function _callee49$(_context49) {\n            while (1) {\n              switch (_context49.prev = _context49.next) {\n                case 0:\n                  _Ge = Ge(i.target), e = _Ge.topic, t = _Ge.id;\n                  if (!e) {\n                    _context49.next = 15;\n                    break;\n                  }\n                  if (!_this3.client.session.keys.includes(e)) {\n                    _context49.next = 8;\n                    break;\n                  }\n                  _context49.next = 5;\n                  return _this3.deleteSession(e, !0);\n                case 5:\n                  _this3.client.events.emit(\"session_expire\", {\n                    topic: e\n                  });\n                  _context49.next = 13;\n                  break;\n                case 8:\n                  _context49.t0 = _this3.client.pairing.keys.includes(e);\n                  if (!_context49.t0) {\n                    _context49.next = 13;\n                    break;\n                  }\n                  _context49.next = 12;\n                  return _this3.deletePairing(e, !0);\n                case 12:\n                  _this3.client.events.emit(\"pairing_expire\", {\n                    topic: e\n                  });\n                case 13:\n                  _context49.next = 19;\n                  break;\n                case 15:\n                  _context49.t1 = t;\n                  if (!_context49.t1) {\n                    _context49.next = 19;\n                    break;\n                  }\n                  _context49.next = 19;\n                  return _this3.deleteProposal(t, !0);\n                case 19:\n                case \"end\":\n                  return _context49.stop();\n              }\n            }\n          }, _callee49);\n        }));\n        return function (_x69) {\n          return _ref55.apply(this, arguments);\n        };\n      }());\n    }\n  }, {\n    key: \"isValidPairingTopic\",\n    value: function () {\n      var _isValidPairingTopic = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee50(i) {\n        var _c27, e, _c28, _e2, _c29, _e3;\n        return _regeneratorRuntime().wrap(function _callee50$(_context50) {\n          while (1) {\n            switch (_context50.prev = _context50.next) {\n              case 0:\n                if (C(i, !1)) {\n                  _context50.next = 3;\n                  break;\n                }\n                _c27 = c(\"MISSING_OR_INVALID\", \"pairing topic should be a string: \".concat(i)), e = _c27.message;\n                throw new Error(e);\n              case 3:\n                if (this.client.pairing.keys.includes(i)) {\n                  _context50.next = 6;\n                  break;\n                }\n                _c28 = c(\"NO_MATCHING_KEY\", \"pairing topic doesn't exist: \".concat(i)), _e2 = _c28.message;\n                throw new Error(_e2);\n              case 6:\n                if (!O(this.client.pairing.get(i).expiry)) {\n                  _context50.next = 11;\n                  break;\n                }\n                _context50.next = 9;\n                return this.deletePairing(i);\n              case 9:\n                _c29 = c(\"EXPIRED\", \"pairing topic: \".concat(i)), _e3 = _c29.message;\n                throw new Error(_e3);\n              case 11:\n              case \"end\":\n                return _context50.stop();\n            }\n          }\n        }, _callee50, this);\n      }));\n      function isValidPairingTopic(_x70) {\n        return _isValidPairingTopic.apply(this, arguments);\n      }\n      return isValidPairingTopic;\n    }()\n  }, {\n    key: \"isValidSessionTopic\",\n    value: function () {\n      var _isValidSessionTopic = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee51(i) {\n        var _c30, e, _c31, _e4, _c32, _e5;\n        return _regeneratorRuntime().wrap(function _callee51$(_context51) {\n          while (1) {\n            switch (_context51.prev = _context51.next) {\n              case 0:\n                if (C(i, !1)) {\n                  _context51.next = 3;\n                  break;\n                }\n                _c30 = c(\"MISSING_OR_INVALID\", \"session topic should be a string: \".concat(i)), e = _c30.message;\n                throw new Error(e);\n              case 3:\n                if (this.client.session.keys.includes(i)) {\n                  _context51.next = 6;\n                  break;\n                }\n                _c31 = c(\"NO_MATCHING_KEY\", \"session topic doesn't exist: \".concat(i)), _e4 = _c31.message;\n                throw new Error(_e4);\n              case 6:\n                if (!O(this.client.session.get(i).expiry)) {\n                  _context51.next = 11;\n                  break;\n                }\n                _context51.next = 9;\n                return this.deleteSession(i);\n              case 9:\n                _c32 = c(\"EXPIRED\", \"session topic: \".concat(i)), _e5 = _c32.message;\n                throw new Error(_e5);\n              case 11:\n              case \"end\":\n                return _context51.stop();\n            }\n          }\n        }, _callee51, this);\n      }));\n      function isValidSessionTopic(_x71) {\n        return _isValidSessionTopic.apply(this, arguments);\n      }\n      return isValidSessionTopic;\n    }()\n  }, {\n    key: \"isValidSessionOrPairingTopic\",\n    value: function () {\n      var _isValidSessionOrPairingTopic = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee52(i) {\n        var _c33, e, _c34, _e6;\n        return _regeneratorRuntime().wrap(function _callee52$(_context52) {\n          while (1) {\n            switch (_context52.prev = _context52.next) {\n              case 0:\n                if (!this.client.session.keys.includes(i)) {\n                  _context52.next = 5;\n                  break;\n                }\n                _context52.next = 3;\n                return this.isValidSessionTopic(i);\n              case 3:\n                _context52.next = 17;\n                break;\n              case 5:\n                if (!this.client.pairing.keys.includes(i)) {\n                  _context52.next = 10;\n                  break;\n                }\n                _context52.next = 8;\n                return this.isValidPairingTopic(i);\n              case 8:\n                _context52.next = 17;\n                break;\n              case 10:\n                if (!C(i, !1)) {\n                  _context52.next = 15;\n                  break;\n                }\n                _c33 = c(\"NO_MATCHING_KEY\", \"session or pairing topic doesn't exist: \".concat(i)), e = _c33.message;\n                throw new Error(e);\n              case 15:\n                _c34 = c(\"MISSING_OR_INVALID\", \"session or pairing topic should be a string: \".concat(i)), _e6 = _c34.message;\n                throw new Error(_e6);\n              case 17:\n              case \"end\":\n                return _context52.stop();\n            }\n          }\n        }, _callee52, this);\n      }));\n      function isValidSessionOrPairingTopic(_x72) {\n        return _isValidSessionOrPairingTopic.apply(this, arguments);\n      }\n      return isValidSessionOrPairingTopic;\n    }()\n  }, {\n    key: \"isValidProposalId\",\n    value: function () {\n      var _isValidProposalId = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee53(i) {\n        var _c35, e, _c36, _e7, _c37, _e8;\n        return _regeneratorRuntime().wrap(function _callee53$(_context53) {\n          while (1) {\n            switch (_context53.prev = _context53.next) {\n              case 0:\n                if (ze(i)) {\n                  _context53.next = 3;\n                  break;\n                }\n                _c35 = c(\"MISSING_OR_INVALID\", \"proposal id should be a number: \".concat(i)), e = _c35.message;\n                throw new Error(e);\n              case 3:\n                if (this.client.proposal.keys.includes(i)) {\n                  _context53.next = 6;\n                  break;\n                }\n                _c36 = c(\"NO_MATCHING_KEY\", \"proposal id doesn't exist: \".concat(i)), _e7 = _c36.message;\n                throw new Error(_e7);\n              case 6:\n                if (!O(this.client.proposal.get(i).expiry)) {\n                  _context53.next = 11;\n                  break;\n                }\n                _context53.next = 9;\n                return this.deleteProposal(i);\n              case 9:\n                _c37 = c(\"EXPIRED\", \"proposal id: \".concat(i)), _e8 = _c37.message;\n                throw new Error(_e8);\n              case 11:\n              case \"end\":\n                return _context53.stop();\n            }\n          }\n        }, _callee53, this);\n      }));\n      function isValidProposalId(_x73) {\n        return _isValidProposalId.apply(this, arguments);\n      }\n      return isValidProposalId;\n    }()\n  }]);\n  return at;\n}(Ee);\nvar ct = /*#__PURE__*/function (_e9) {\n  _inherits(ct, _e9);\n  var _super2 = _createSuper(ct);\n  function ct(i, e) {\n    var _this4;\n    _classCallCheck(this, ct);\n    _this4 = _super2.call(this, i, e), _this4.core = i, _this4.logger = e, _this4.expirations = new Map(), _this4.events = new G.EventEmitter(), _this4.name = ie, _this4.version = re, _this4.cached = [], _this4.initialized = !1, _this4.storagePrefix = V, _this4.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee54() {\n      return _regeneratorRuntime().wrap(function _callee54$(_context54) {\n        while (1) {\n          switch (_context54.prev = _context54.next) {\n            case 0:\n              _context54.t0 = _this4.initialized;\n              if (_context54.t0) {\n                _context54.next = 9;\n                break;\n              }\n              _this4.logger.trace(\"Initialized\");\n              _context54.next = 5;\n              return _this4.restore();\n            case 5:\n              _this4.cached.forEach(function (t) {\n                return _this4.expirations.set(t.target, t);\n              });\n              _this4.cached = [];\n              _this4.registerEventListeners();\n              _this4.initialized = !0;\n            case 9:\n            case \"end\":\n              return _context54.stop();\n          }\n        }\n      }, _callee54);\n    })), _this4.has = function (t) {\n      try {\n        var s = _this4.formatTarget(t);\n        return typeof _this4.getExpiration(s) < \"u\";\n      } catch (_unused) {\n        return !1;\n      }\n    }, _this4.set = function (t, s) {\n      _this4.isInitialized();\n      var r = _this4.formatTarget(t),\n        n = {\n          target: r,\n          expiry: s\n        };\n      _this4.expirations.set(r, n), _this4.checkExpiry(r, n), _this4.events.emit(w.created, {\n        target: r,\n        expiration: n\n      });\n    }, _this4.get = function (t) {\n      _this4.isInitialized();\n      var s = _this4.formatTarget(t);\n      return _this4.getExpiration(s);\n    }, _this4.del = function (t) {\n      _this4.isInitialized();\n      var s = _this4.formatTarget(t);\n      if (_this4.has(s)) {\n        var r = _this4.getExpiration(s);\n        _this4.expirations.delete(s), _this4.events.emit(w.deleted, {\n          target: s,\n          expiration: r\n        });\n      }\n    }, _this4.on = function (t, s) {\n      _this4.events.on(t, s);\n    }, _this4.once = function (t, s) {\n      _this4.events.once(t, s);\n    }, _this4.off = function (t, s) {\n      _this4.events.off(t, s);\n    }, _this4.removeListener = function (t, s) {\n      _this4.events.removeListener(t, s);\n    }, _this4.logger = J(e, _this4.name);\n    return _this4;\n  }\n  _createClass(ct, [{\n    key: \"context\",\n    get: function get() {\n      return Y(this.logger);\n    }\n  }, {\n    key: \"storageKey\",\n    get: function get() {\n      return this.storagePrefix + this.version + \"//\" + this.name;\n    }\n  }, {\n    key: \"length\",\n    get: function get() {\n      return this.expirations.size;\n    }\n  }, {\n    key: \"keys\",\n    get: function get() {\n      return Array.from(this.expirations.keys());\n    }\n  }, {\n    key: \"values\",\n    get: function get() {\n      return Array.from(this.expirations.values());\n    }\n  }, {\n    key: \"formatTarget\",\n    value: function formatTarget(i) {\n      if (typeof i == \"string\") return Me(i);\n      if (typeof i == \"number\") return Ke(i);\n      var _c38 = c(\"UNKNOWN_TYPE\", \"Target type: \".concat(typeof i)),\n        e = _c38.message;\n      throw new Error(e);\n    }\n  }, {\n    key: \"setExpirations\",\n    value: function () {\n      var _setExpirations = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee55(i) {\n        return _regeneratorRuntime().wrap(function _callee55$(_context55) {\n          while (1) {\n            switch (_context55.prev = _context55.next) {\n              case 0:\n                _context55.next = 2;\n                return this.core.storage.setItem(this.storageKey, i);\n              case 2:\n              case \"end\":\n                return _context55.stop();\n            }\n          }\n        }, _callee55, this);\n      }));\n      function setExpirations(_x74) {\n        return _setExpirations.apply(this, arguments);\n      }\n      return setExpirations;\n    }()\n  }, {\n    key: \"getExpirations\",\n    value: function () {\n      var _getExpirations = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee56() {\n        return _regeneratorRuntime().wrap(function _callee56$(_context56) {\n          while (1) {\n            switch (_context56.prev = _context56.next) {\n              case 0:\n                _context56.next = 2;\n                return this.core.storage.getItem(this.storageKey);\n              case 2:\n                return _context56.abrupt(\"return\", _context56.sent);\n              case 3:\n              case \"end\":\n                return _context56.stop();\n            }\n          }\n        }, _callee56, this);\n      }));\n      function getExpirations() {\n        return _getExpirations.apply(this, arguments);\n      }\n      return getExpirations;\n    }()\n  }, {\n    key: \"persist\",\n    value: function () {\n      var _persist = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee57() {\n        return _regeneratorRuntime().wrap(function _callee57$(_context57) {\n          while (1) {\n            switch (_context57.prev = _context57.next) {\n              case 0:\n                _context57.next = 2;\n                return this.setExpirations(this.values);\n              case 2:\n                this.events.emit(w.sync);\n              case 3:\n              case \"end\":\n                return _context57.stop();\n            }\n          }\n        }, _callee57, this);\n      }));\n      function persist() {\n        return _persist.apply(this, arguments);\n      }\n      return persist;\n    }()\n  }, {\n    key: \"restore\",\n    value: function () {\n      var _restore = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee58() {\n        var i, _c39, e;\n        return _regeneratorRuntime().wrap(function _callee58$(_context58) {\n          while (1) {\n            switch (_context58.prev = _context58.next) {\n              case 0:\n                _context58.prev = 0;\n                _context58.next = 3;\n                return this.getExpirations();\n              case 3:\n                i = _context58.sent;\n                if (!(typeof i > \"u\" || !i.length)) {\n                  _context58.next = 6;\n                  break;\n                }\n                return _context58.abrupt(\"return\");\n              case 6:\n                if (!this.expirations.size) {\n                  _context58.next = 9;\n                  break;\n                }\n                _c39 = c(\"RESTORE_WILL_OVERRIDE\", this.name), e = _c39.message;\n                throw this.logger.error(e), new Error(e);\n              case 9:\n                this.cached = i, this.logger.debug(\"Successfully Restored expirations for \".concat(this.name)), this.logger.trace({\n                  type: \"method\",\n                  method: \"restore\",\n                  expirations: this.values\n                });\n                _context58.next = 15;\n                break;\n              case 12:\n                _context58.prev = 12;\n                _context58.t0 = _context58[\"catch\"](0);\n                this.logger.debug(\"Failed to Restore expirations for \".concat(this.name)), this.logger.error(_context58.t0);\n              case 15:\n              case \"end\":\n                return _context58.stop();\n            }\n          }\n        }, _callee58, this, [[0, 12]]);\n      }));\n      function restore() {\n        return _restore.apply(this, arguments);\n      }\n      return restore;\n    }()\n  }, {\n    key: \"getExpiration\",\n    value: function getExpiration(i) {\n      var e = this.expirations.get(i);\n      if (!e) {\n        var _c40 = c(\"NO_MATCHING_KEY\", \"\".concat(this.name, \": \").concat(i)),\n          t = _c40.message;\n        throw this.logger.error(t), new Error(t);\n      }\n      return e;\n    }\n  }, {\n    key: \"checkExpiry\",\n    value: function checkExpiry(i, e) {\n      var t = e.expiry;\n      Je(t) - Date.now() <= 0 && this.expire(i, e);\n    }\n  }, {\n    key: \"expire\",\n    value: function expire(i, e) {\n      this.expirations.delete(i), this.events.emit(w.expired, {\n        target: i,\n        expiration: e\n      });\n    }\n  }, {\n    key: \"checkExpirations\",\n    value: function checkExpirations() {\n      var _this5 = this;\n      this.expirations.forEach(function (i, e) {\n        return _this5.checkExpiry(e, i);\n      });\n    }\n  }, {\n    key: \"registerEventListeners\",\n    value: function registerEventListeners() {\n      var _this6 = this;\n      this.core.heartbeat.on(We.pulse, function () {\n        return _this6.checkExpirations();\n      }), this.events.on(w.created, function (i) {\n        var e = w.created;\n        _this6.logger.info(\"Emitting \".concat(e)), _this6.logger.debug({\n          type: \"event\",\n          event: e,\n          data: i\n        }), _this6.persist();\n      }), this.events.on(w.expired, function (i) {\n        var e = w.expired;\n        _this6.logger.info(\"Emitting \".concat(e)), _this6.logger.debug({\n          type: \"event\",\n          event: e,\n          data: i\n        }), _this6.persist();\n      }), this.events.on(w.deleted, function (i) {\n        var e = w.deleted;\n        _this6.logger.info(\"Emitting \".concat(e)), _this6.logger.debug({\n          type: \"event\",\n          event: e,\n          data: i\n        }), _this6.persist();\n      });\n    }\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c41 = c(\"NOT_INITIALIZED\", this.name),\n          i = _c41.message;\n        throw new Error(i);\n      }\n    }\n  }]);\n  return ct;\n}(_e);\nvar ht = /*#__PURE__*/function (_fe) {\n  _inherits(ht, _fe);\n  var _super3 = _createSuper(ht);\n  function ht(i, e) {\n    var _this7;\n    _classCallCheck(this, ht);\n    _this7 = _super3.call(this, i, e), _this7.core = i, _this7.logger = e, _this7.records = new Map(), _this7.events = new G.EventEmitter(), _this7.name = ne, _this7.version = oe, _this7.cached = [], _this7.initialized = !1, _this7.storagePrefix = V, _this7.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee59() {\n      return _regeneratorRuntime().wrap(function _callee59$(_context59) {\n        while (1) {\n          switch (_context59.prev = _context59.next) {\n            case 0:\n              _context59.t0 = _this7.initialized;\n              if (_context59.t0) {\n                _context59.next = 9;\n                break;\n              }\n              _this7.logger.trace(\"Initialized\");\n              _context59.next = 5;\n              return _this7.restore();\n            case 5:\n              _this7.cached.forEach(function (t) {\n                return _this7.records.set(t.id, t);\n              });\n              _this7.cached = [];\n              _this7.registerEventListeners();\n              _this7.initialized = !0;\n            case 9:\n            case \"end\":\n              return _context59.stop();\n          }\n        }\n      }, _callee59);\n    })), _this7.set = function (t, s, r) {\n      if (_this7.isInitialized(), _this7.logger.debug(\"Setting JSON-RPC request history record\"), _this7.logger.trace({\n        type: \"method\",\n        method: \"set\",\n        topic: t,\n        request: s,\n        chainId: r\n      }), _this7.records.has(s.id)) return;\n      var n = {\n        id: s.id,\n        topic: t,\n        request: {\n          method: s.method,\n          params: s.params || null\n        },\n        chainId: r\n      };\n      _this7.records.set(n.id, n), _this7.events.emit(_.created, n);\n    }, _this7.resolve = /*#__PURE__*/function () {\n      var _ref58 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee60(t) {\n        var s;\n        return _regeneratorRuntime().wrap(function _callee60$(_context60) {\n          while (1) {\n            switch (_context60.prev = _context60.next) {\n              case 0:\n                if (!(_this7.isInitialized(), _this7.logger.debug(\"Updating JSON-RPC response history record\"), _this7.logger.trace({\n                  type: \"method\",\n                  method: \"update\",\n                  response: t\n                }), !_this7.records.has(t.id))) {\n                  _context60.next = 2;\n                  break;\n                }\n                return _context60.abrupt(\"return\");\n              case 2:\n                _context60.next = 4;\n                return _this7.getRecord(t.id);\n              case 4:\n                s = _context60.sent;\n                typeof s.response > \"u\" && (s.response = R(t) ? {\n                  error: t.error\n                } : {\n                  result: t.result\n                }, _this7.records.set(s.id, s), _this7.events.emit(_.updated, s));\n              case 6:\n              case \"end\":\n                return _context60.stop();\n            }\n          }\n        }, _callee60);\n      }));\n      return function (_x75) {\n        return _ref58.apply(this, arguments);\n      };\n    }(), _this7.get = /*#__PURE__*/function () {\n      var _ref59 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee61(t, s) {\n        var r, _c42, n;\n        return _regeneratorRuntime().wrap(function _callee61$(_context61) {\n          while (1) {\n            switch (_context61.prev = _context61.next) {\n              case 0:\n                _this7.isInitialized(), _this7.logger.debug(\"Getting record\"), _this7.logger.trace({\n                  type: \"method\",\n                  method: \"get\",\n                  topic: t,\n                  id: s\n                });\n                _context61.next = 3;\n                return _this7.getRecord(s);\n              case 3:\n                r = _context61.sent;\n                if (!(r.topic !== t)) {\n                  _context61.next = 7;\n                  break;\n                }\n                _c42 = c(\"MISMATCHED_TOPIC\", \"\".concat(_this7.name, \", \").concat(s)), n = _c42.message;\n                throw _this7.logger.error(n), new Error(n);\n              case 7:\n                return _context61.abrupt(\"return\", r);\n              case 8:\n              case \"end\":\n                return _context61.stop();\n            }\n          }\n        }, _callee61);\n      }));\n      return function (_x76, _x77) {\n        return _ref59.apply(this, arguments);\n      };\n    }(), _this7.delete = function (t, s) {\n      _this7.isInitialized(), _this7.logger.debug(\"Deleting record\"), _this7.logger.trace({\n        type: \"method\",\n        method: \"delete\",\n        id: s\n      }), _this7.values.forEach(function (r) {\n        if (r.topic === t) {\n          if (typeof s < \"u\" && r.id !== s) return;\n          _this7.records.delete(r.id), _this7.events.emit(_.deleted, r);\n        }\n      });\n    }, _this7.exists = /*#__PURE__*/function () {\n      var _ref60 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee62(t, s) {\n        return _regeneratorRuntime().wrap(function _callee62$(_context62) {\n          while (1) {\n            switch (_context62.prev = _context62.next) {\n              case 0:\n                _this7.isInitialized();\n                if (!_this7.records.has(s)) {\n                  _context62.next = 9;\n                  break;\n                }\n                _context62.next = 4;\n                return _this7.getRecord(s);\n              case 4:\n                _context62.t1 = _context62.sent.topic;\n                _context62.t2 = t;\n                _context62.t0 = _context62.t1 === _context62.t2;\n                _context62.next = 10;\n                break;\n              case 9:\n                _context62.t0 = !1;\n              case 10:\n                return _context62.abrupt(\"return\", _context62.t0);\n              case 11:\n              case \"end\":\n                return _context62.stop();\n            }\n          }\n        }, _callee62);\n      }));\n      return function (_x78, _x79) {\n        return _ref60.apply(this, arguments);\n      };\n    }(), _this7.on = function (t, s) {\n      _this7.events.on(t, s);\n    }, _this7.once = function (t, s) {\n      _this7.events.once(t, s);\n    }, _this7.off = function (t, s) {\n      _this7.events.off(t, s);\n    }, _this7.removeListener = function (t, s) {\n      _this7.events.removeListener(t, s);\n    }, _this7.logger = J(e, _this7.name);\n    return _this7;\n  }\n  _createClass(ht, [{\n    key: \"context\",\n    get: function get() {\n      return Y(this.logger);\n    }\n  }, {\n    key: \"storageKey\",\n    get: function get() {\n      return this.storagePrefix + this.version + \"//\" + this.name;\n    }\n  }, {\n    key: \"size\",\n    get: function get() {\n      return this.records.size;\n    }\n  }, {\n    key: \"keys\",\n    get: function get() {\n      return Array.from(this.records.keys());\n    }\n  }, {\n    key: \"values\",\n    get: function get() {\n      return Array.from(this.records.values());\n    }\n  }, {\n    key: \"pending\",\n    get: function get() {\n      var i = [];\n      return this.values.forEach(function (e) {\n        if (typeof e.response < \"u\") return;\n        var t = {\n          topic: e.topic,\n          request: te(e.request.method, e.request.params, e.id),\n          chainId: e.chainId\n        };\n        return i.push(t);\n      }), i;\n    }\n  }, {\n    key: \"setJsonRpcRecords\",\n    value: function () {\n      var _setJsonRpcRecords = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee63(i) {\n        return _regeneratorRuntime().wrap(function _callee63$(_context63) {\n          while (1) {\n            switch (_context63.prev = _context63.next) {\n              case 0:\n                _context63.next = 2;\n                return this.core.storage.setItem(this.storageKey, i);\n              case 2:\n              case \"end\":\n                return _context63.stop();\n            }\n          }\n        }, _callee63, this);\n      }));\n      function setJsonRpcRecords(_x80) {\n        return _setJsonRpcRecords.apply(this, arguments);\n      }\n      return setJsonRpcRecords;\n    }()\n  }, {\n    key: \"getJsonRpcRecords\",\n    value: function () {\n      var _getJsonRpcRecords = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee64() {\n        return _regeneratorRuntime().wrap(function _callee64$(_context64) {\n          while (1) {\n            switch (_context64.prev = _context64.next) {\n              case 0:\n                _context64.next = 2;\n                return this.core.storage.getItem(this.storageKey);\n              case 2:\n                return _context64.abrupt(\"return\", _context64.sent);\n              case 3:\n              case \"end\":\n                return _context64.stop();\n            }\n          }\n        }, _callee64, this);\n      }));\n      function getJsonRpcRecords() {\n        return _getJsonRpcRecords.apply(this, arguments);\n      }\n      return getJsonRpcRecords;\n    }()\n  }, {\n    key: \"getRecord\",\n    value: function getRecord(i) {\n      this.isInitialized();\n      var e = this.records.get(i);\n      if (!e) {\n        var _c43 = c(\"NO_MATCHING_KEY\", \"\".concat(this.name, \": \").concat(i)),\n          t = _c43.message;\n        throw new Error(t);\n      }\n      return e;\n    }\n  }, {\n    key: \"persist\",\n    value: function () {\n      var _persist2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee65() {\n        return _regeneratorRuntime().wrap(function _callee65$(_context65) {\n          while (1) {\n            switch (_context65.prev = _context65.next) {\n              case 0:\n                _context65.next = 2;\n                return this.setJsonRpcRecords(this.values);\n              case 2:\n                this.events.emit(_.sync);\n              case 3:\n              case \"end\":\n                return _context65.stop();\n            }\n          }\n        }, _callee65, this);\n      }));\n      function persist() {\n        return _persist2.apply(this, arguments);\n      }\n      return persist;\n    }()\n  }, {\n    key: \"restore\",\n    value: function () {\n      var _restore2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee66() {\n        var i, _c44, e;\n        return _regeneratorRuntime().wrap(function _callee66$(_context66) {\n          while (1) {\n            switch (_context66.prev = _context66.next) {\n              case 0:\n                _context66.prev = 0;\n                _context66.next = 3;\n                return this.getJsonRpcRecords();\n              case 3:\n                i = _context66.sent;\n                if (!(typeof i > \"u\" || !i.length)) {\n                  _context66.next = 6;\n                  break;\n                }\n                return _context66.abrupt(\"return\");\n              case 6:\n                if (!this.records.size) {\n                  _context66.next = 9;\n                  break;\n                }\n                _c44 = c(\"RESTORE_WILL_OVERRIDE\", this.name), e = _c44.message;\n                throw this.logger.error(e), new Error(e);\n              case 9:\n                this.cached = i, this.logger.debug(\"Successfully Restored records for \".concat(this.name)), this.logger.trace({\n                  type: \"method\",\n                  method: \"restore\",\n                  records: this.values\n                });\n                _context66.next = 15;\n                break;\n              case 12:\n                _context66.prev = 12;\n                _context66.t0 = _context66[\"catch\"](0);\n                this.logger.debug(\"Failed to Restore records for \".concat(this.name)), this.logger.error(_context66.t0);\n              case 15:\n              case \"end\":\n                return _context66.stop();\n            }\n          }\n        }, _callee66, this, [[0, 12]]);\n      }));\n      function restore() {\n        return _restore2.apply(this, arguments);\n      }\n      return restore;\n    }()\n  }, {\n    key: \"registerEventListeners\",\n    value: function registerEventListeners() {\n      var _this8 = this;\n      this.events.on(_.created, function (i) {\n        var e = _.created;\n        _this8.logger.info(\"Emitting \".concat(e)), _this8.logger.debug({\n          type: \"event\",\n          event: e,\n          record: i\n        }), _this8.persist();\n      }), this.events.on(_.updated, function (i) {\n        var e = _.updated;\n        _this8.logger.info(\"Emitting \".concat(e)), _this8.logger.debug({\n          type: \"event\",\n          event: e,\n          record: i\n        }), _this8.persist();\n      }), this.events.on(_.deleted, function (i) {\n        var e = _.deleted;\n        _this8.logger.info(\"Emitting \".concat(e)), _this8.logger.debug({\n          type: \"event\",\n          event: e,\n          record: i\n        }), _this8.persist();\n      });\n    }\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c45 = c(\"NOT_INITIALIZED\", this.name),\n          i = _c45.message;\n        throw new Error(i);\n      }\n    }\n  }]);\n  return ht;\n}(fe);\nvar lt = /*#__PURE__*/function (_j) {\n  _inherits(lt, _j);\n  var _super4 = _createSuper(lt);\n  function lt(i, e) {\n    var _this9;\n    _classCallCheck(this, lt);\n    _this9 = _super4.call(this, i, e, ae, V), _this9.core = i, _this9.logger = e;\n    return _this9;\n  }\n  return _createClass(lt);\n}(j);\nvar pt = /*#__PURE__*/function (_j2) {\n  _inherits(pt, _j2);\n  var _super5 = _createSuper(pt);\n  function pt(i, e) {\n    var _this10;\n    _classCallCheck(this, pt);\n    _this10 = _super5.call(this, i, e, ce, V), _this10.core = i, _this10.logger = e;\n    return _this10;\n  }\n  return _createClass(pt);\n}(j);\nvar dt = /*#__PURE__*/function (_j3) {\n  _inherits(dt, _j3);\n  var _super6 = _createSuper(dt);\n  function dt(i, e) {\n    var _this11;\n    _classCallCheck(this, dt);\n    _this11 = _super6.call(this, i, e, le, V), _this11.core = i, _this11.logger = e;\n    return _this11;\n  }\n  return _createClass(dt);\n}(j);\nvar K = /*#__PURE__*/function (_ve) {\n  _inherits(K, _ve);\n  var _super7 = _createSuper(K);\n  function K(i) {\n    var _this12;\n    _classCallCheck(this, K);\n    _this12 = _super7.call(this, i), _this12.protocol = H, _this12.version = F, _this12.name = z.name, _this12.events = new G.EventEmitter(), _this12.on = function (t, s) {\n      return _this12.events.on(t, s);\n    }, _this12.once = function (t, s) {\n      return _this12.events.once(t, s);\n    }, _this12.off = function (t, s) {\n      return _this12.events.off(t, s);\n    }, _this12.removeListener = function (t, s) {\n      return _this12.events.removeListener(t, s);\n    }, _this12.connect = /*#__PURE__*/function () {\n      var _ref61 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee67(t) {\n        return _regeneratorRuntime().wrap(function _callee67$(_context67) {\n          while (1) {\n            switch (_context67.prev = _context67.next) {\n              case 0:\n                _context67.prev = 0;\n                _context67.next = 3;\n                return _this12.engine.connect(t);\n              case 3:\n                return _context67.abrupt(\"return\", _context67.sent);\n              case 6:\n                _context67.prev = 6;\n                _context67.t0 = _context67[\"catch\"](0);\n                throw _this12.logger.error(_context67.t0.message), _context67.t0;\n              case 9:\n              case \"end\":\n                return _context67.stop();\n            }\n          }\n        }, _callee67, null, [[0, 6]]);\n      }));\n      return function (_x81) {\n        return _ref61.apply(this, arguments);\n      };\n    }(), _this12.pair = /*#__PURE__*/function () {\n      var _ref62 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee68(t) {\n        return _regeneratorRuntime().wrap(function _callee68$(_context68) {\n          while (1) {\n            switch (_context68.prev = _context68.next) {\n              case 0:\n                _context68.prev = 0;\n                _context68.next = 3;\n                return _this12.engine.pair(t);\n              case 3:\n                return _context68.abrupt(\"return\", _context68.sent);\n              case 6:\n                _context68.prev = 6;\n                _context68.t0 = _context68[\"catch\"](0);\n                throw _this12.logger.error(_context68.t0.message), _context68.t0;\n              case 9:\n              case \"end\":\n                return _context68.stop();\n            }\n          }\n        }, _callee68, null, [[0, 6]]);\n      }));\n      return function (_x82) {\n        return _ref62.apply(this, arguments);\n      };\n    }(), _this12.approve = /*#__PURE__*/function () {\n      var _ref63 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee69(t) {\n        return _regeneratorRuntime().wrap(function _callee69$(_context69) {\n          while (1) {\n            switch (_context69.prev = _context69.next) {\n              case 0:\n                _context69.prev = 0;\n                _context69.next = 3;\n                return _this12.engine.approve(t);\n              case 3:\n                return _context69.abrupt(\"return\", _context69.sent);\n              case 6:\n                _context69.prev = 6;\n                _context69.t0 = _context69[\"catch\"](0);\n                throw _this12.logger.error(_context69.t0.message), _context69.t0;\n              case 9:\n              case \"end\":\n                return _context69.stop();\n            }\n          }\n        }, _callee69, null, [[0, 6]]);\n      }));\n      return function (_x83) {\n        return _ref63.apply(this, arguments);\n      };\n    }(), _this12.reject = /*#__PURE__*/function () {\n      var _ref64 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee70(t) {\n        return _regeneratorRuntime().wrap(function _callee70$(_context70) {\n          while (1) {\n            switch (_context70.prev = _context70.next) {\n              case 0:\n                _context70.prev = 0;\n                _context70.next = 3;\n                return _this12.engine.reject(t);\n              case 3:\n                return _context70.abrupt(\"return\", _context70.sent);\n              case 6:\n                _context70.prev = 6;\n                _context70.t0 = _context70[\"catch\"](0);\n                throw _this12.logger.error(_context70.t0.message), _context70.t0;\n              case 9:\n              case \"end\":\n                return _context70.stop();\n            }\n          }\n        }, _callee70, null, [[0, 6]]);\n      }));\n      return function (_x84) {\n        return _ref64.apply(this, arguments);\n      };\n    }(), _this12.update = /*#__PURE__*/function () {\n      var _ref65 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee71(t) {\n        return _regeneratorRuntime().wrap(function _callee71$(_context71) {\n          while (1) {\n            switch (_context71.prev = _context71.next) {\n              case 0:\n                _context71.prev = 0;\n                _context71.next = 3;\n                return _this12.engine.update(t);\n              case 3:\n                return _context71.abrupt(\"return\", _context71.sent);\n              case 6:\n                _context71.prev = 6;\n                _context71.t0 = _context71[\"catch\"](0);\n                throw _this12.logger.error(_context71.t0.message), _context71.t0;\n              case 9:\n              case \"end\":\n                return _context71.stop();\n            }\n          }\n        }, _callee71, null, [[0, 6]]);\n      }));\n      return function (_x85) {\n        return _ref65.apply(this, arguments);\n      };\n    }(), _this12.extend = /*#__PURE__*/function () {\n      var _ref66 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee72(t) {\n        return _regeneratorRuntime().wrap(function _callee72$(_context72) {\n          while (1) {\n            switch (_context72.prev = _context72.next) {\n              case 0:\n                _context72.prev = 0;\n                _context72.next = 3;\n                return _this12.engine.extend(t);\n              case 3:\n                return _context72.abrupt(\"return\", _context72.sent);\n              case 6:\n                _context72.prev = 6;\n                _context72.t0 = _context72[\"catch\"](0);\n                throw _this12.logger.error(_context72.t0.message), _context72.t0;\n              case 9:\n              case \"end\":\n                return _context72.stop();\n            }\n          }\n        }, _callee72, null, [[0, 6]]);\n      }));\n      return function (_x86) {\n        return _ref66.apply(this, arguments);\n      };\n    }(), _this12.request = /*#__PURE__*/function () {\n      var _ref67 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee73(t) {\n        return _regeneratorRuntime().wrap(function _callee73$(_context73) {\n          while (1) {\n            switch (_context73.prev = _context73.next) {\n              case 0:\n                _context73.prev = 0;\n                _context73.next = 3;\n                return _this12.engine.request(t);\n              case 3:\n                return _context73.abrupt(\"return\", _context73.sent);\n              case 6:\n                _context73.prev = 6;\n                _context73.t0 = _context73[\"catch\"](0);\n                throw _this12.logger.error(_context73.t0.message), _context73.t0;\n              case 9:\n              case \"end\":\n                return _context73.stop();\n            }\n          }\n        }, _callee73, null, [[0, 6]]);\n      }));\n      return function (_x87) {\n        return _ref67.apply(this, arguments);\n      };\n    }(), _this12.respond = /*#__PURE__*/function () {\n      var _ref68 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee74(t) {\n        return _regeneratorRuntime().wrap(function _callee74$(_context74) {\n          while (1) {\n            switch (_context74.prev = _context74.next) {\n              case 0:\n                _context74.prev = 0;\n                _context74.next = 3;\n                return _this12.engine.respond(t);\n              case 3:\n                return _context74.abrupt(\"return\", _context74.sent);\n              case 6:\n                _context74.prev = 6;\n                _context74.t0 = _context74[\"catch\"](0);\n                throw _this12.logger.error(_context74.t0.message), _context74.t0;\n              case 9:\n              case \"end\":\n                return _context74.stop();\n            }\n          }\n        }, _callee74, null, [[0, 6]]);\n      }));\n      return function (_x88) {\n        return _ref68.apply(this, arguments);\n      };\n    }(), _this12.ping = /*#__PURE__*/function () {\n      var _ref69 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee75(t) {\n        return _regeneratorRuntime().wrap(function _callee75$(_context75) {\n          while (1) {\n            switch (_context75.prev = _context75.next) {\n              case 0:\n                _context75.prev = 0;\n                _context75.next = 3;\n                return _this12.engine.ping(t);\n              case 3:\n                return _context75.abrupt(\"return\", _context75.sent);\n              case 6:\n                _context75.prev = 6;\n                _context75.t0 = _context75[\"catch\"](0);\n                throw _this12.logger.error(_context75.t0.message), _context75.t0;\n              case 9:\n              case \"end\":\n                return _context75.stop();\n            }\n          }\n        }, _callee75, null, [[0, 6]]);\n      }));\n      return function (_x89) {\n        return _ref69.apply(this, arguments);\n      };\n    }(), _this12.emit = /*#__PURE__*/function () {\n      var _ref70 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee76(t) {\n        return _regeneratorRuntime().wrap(function _callee76$(_context76) {\n          while (1) {\n            switch (_context76.prev = _context76.next) {\n              case 0:\n                _context76.prev = 0;\n                _context76.next = 3;\n                return _this12.engine.emit(t);\n              case 3:\n                return _context76.abrupt(\"return\", _context76.sent);\n              case 6:\n                _context76.prev = 6;\n                _context76.t0 = _context76[\"catch\"](0);\n                throw _this12.logger.error(_context76.t0.message), _context76.t0;\n              case 9:\n              case \"end\":\n                return _context76.stop();\n            }\n          }\n        }, _callee76, null, [[0, 6]]);\n      }));\n      return function (_x90) {\n        return _ref70.apply(this, arguments);\n      };\n    }(), _this12.disconnect = /*#__PURE__*/function () {\n      var _ref71 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee77(t) {\n        return _regeneratorRuntime().wrap(function _callee77$(_context77) {\n          while (1) {\n            switch (_context77.prev = _context77.next) {\n              case 0:\n                _context77.prev = 0;\n                _context77.next = 3;\n                return _this12.engine.disconnect(t);\n              case 3:\n                return _context77.abrupt(\"return\", _context77.sent);\n              case 6:\n                _context77.prev = 6;\n                _context77.t0 = _context77[\"catch\"](0);\n                throw _this12.logger.error(_context77.t0.message), _context77.t0;\n              case 9:\n              case \"end\":\n                return _context77.stop();\n            }\n          }\n        }, _callee77, null, [[0, 6]]);\n      }));\n      return function (_x91) {\n        return _ref71.apply(this, arguments);\n      };\n    }(), _this12.find = function (t) {\n      try {\n        return _this12.engine.find(t);\n      } catch (s) {\n        throw _this12.logger.error(s.message), s;\n      }\n    }, _this12.name = (i === null || i === void 0 ? void 0 : i.name) || z.name, _this12.metadata = (i === null || i === void 0 ? void 0 : i.metadata) || Ue();\n    var e = typeof (i === null || i === void 0 ? void 0 : i.logger) < \"u\" && typeof (i === null || i === void 0 ? void 0 : i.logger) != \"string\" ? i.logger : ke(ye({\n      level: (i === null || i === void 0 ? void 0 : i.logger) || z.logger\n    }));\n    _this12.core = (i === null || i === void 0 ? void 0 : i.core) || new we(i), _this12.logger = J(e, _this12.name), _this12.pairing = new lt(_this12.core, _this12.logger), _this12.session = new dt(_this12.core, _this12.logger), _this12.proposal = new pt(_this12.core, _this12.logger), _this12.history = new ht(_this12.core, _this12.logger), _this12.expirer = new ct(_this12.core, _this12.logger), _this12.engine = new at(_assertThisInitialized(_this12));\n    return _this12;\n  }\n  _createClass(K, [{\n    key: \"context\",\n    get: function get() {\n      return Y(this.logger);\n    }\n  }, {\n    key: \"initialize\",\n    value: function () {\n      var _initialize = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee78() {\n        return _regeneratorRuntime().wrap(function _callee78$(_context78) {\n          while (1) {\n            switch (_context78.prev = _context78.next) {\n              case 0:\n                this.logger.trace(\"Initialized\");\n                _context78.prev = 1;\n                _context78.next = 4;\n                return this.core.start();\n              case 4:\n                _context78.next = 6;\n                return this.pairing.init();\n              case 6:\n                _context78.next = 8;\n                return this.session.init();\n              case 8:\n                _context78.next = 10;\n                return this.proposal.init();\n              case 10:\n                _context78.next = 12;\n                return this.history.init();\n              case 12:\n                _context78.next = 14;\n                return this.expirer.init();\n              case 14:\n                _context78.next = 16;\n                return this.engine.init();\n              case 16:\n                this.logger.info(\"SignClient Initilization Success\");\n                _context78.next = 22;\n                break;\n              case 19:\n                _context78.prev = 19;\n                _context78.t0 = _context78[\"catch\"](1);\n                throw this.logger.info(\"SignClient Initilization Failure\"), this.logger.error(_context78.t0.message), _context78.t0;\n              case 22:\n              case \"end\":\n                return _context78.stop();\n            }\n          }\n        }, _callee78, this, [[1, 19]]);\n      }));\n      function initialize() {\n        return _initialize.apply(this, arguments);\n      }\n      return initialize;\n    }()\n  }], [{\n    key: \"init\",\n    value: function () {\n      var _init = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee79(i) {\n        var e;\n        return _regeneratorRuntime().wrap(function _callee79$(_context79) {\n          while (1) {\n            switch (_context79.prev = _context79.next) {\n              case 0:\n                e = new K(i);\n                _context79.next = 3;\n                return e.initialize();\n              case 3:\n                return _context79.abrupt(\"return\", e);\n              case 4:\n              case \"end\":\n                return _context79.stop();\n            }\n          }\n        }, _callee79);\n      }));\n      function init(_x92) {\n        return _init.apply(this, arguments);\n      }\n      return init;\n    }()\n  }]);\n  return K;\n}(ve);\nvar gt = K;\nexport { pe as ENGINE_CONTEXT, M as ENGINE_RPC_OPTS, ie as EXPIRER_CONTEXT, et as EXPIRER_DEFAULT_TTL, w as EXPIRER_EVENTS, re as EXPIRER_STORAGE_VERSION, ne as HISTORY_CONTEXT, _ as HISTORY_EVENTS, oe as HISTORY_STORAGE_VERSION, ae as PAIRING_CONTEXT, tt as PAIRING_DEFAULT_TTL, ce as PROPOSAL_CONTEXT, he as PROPOSAL_EXPIRY, le as SESSION_CONTEXT, b as SESSION_EXPIRY, W as SIGN_CLIENT_CONTEXT, z as SIGN_CLIENT_DEFAULT, Be as SIGN_CLIENT_EVENTS, H as SIGN_CLIENT_PROTOCOL, Qe as SIGN_CLIENT_STORAGE_OPTIONS, V as SIGN_CLIENT_STORAGE_PREFIX, F as SIGN_CLIENT_VERSION, gt as SignClient, K as default };","map":{"version":3,"sources":[],"names":[],"mappings":"","sourcesContent":["import{RELAYER_DEFAULT_PROTOCOL as Z,RELAYER_EVENTS as me,Store as j,Core as we}from\"@walletconnect/core\";import{generateChildLogger as J,getLoggerContext as Y,getDefaultLoggerOptions as ye}from\"@walletconnect/logger\";import{IEngine as Ee,IExpirer as _e,IJsonRpcHistory as fe,ISignClient as ve}from\"@walletconnect/types\";import{createDelayedPromise as T,engineEvent as p,getInternalError as c,calcExpiry as f,parseUri as Ie,getSdkError as v,isSessionCompatible as Re,isExpired as O,isValidParams as u,isUndefined as Se,isValidRequiredNamespaces as Ne,isValidRelays as xe,isValidUrl as Pe,isValidNamespaces as X,isConformingNamespaces as B,isValidString as C,isValidErrorReason as Te,isValidRelay as Oe,isValidController as Ve,isValidNamespacesChainId as Q,isValidRequest as qe,isValidNamespacesRequest as Le,isValidResponse as De,isValidEvent as be,isValidNamespacesEvent as Ae,generateRandomBytes32 as Ce,formatUri as $e,parseExpirerTarget as Ge,isValidId as ze,formatTopicTarget as Me,formatIdTarget as Ke,getAppMetadata as Ue}from\"@walletconnect/utils\";import ke from\"pino\";import{ONE_DAY as I,THIRTY_DAYS as ee,SEVEN_DAYS as je,THIRTY_SECONDS as $,FIVE_MINUTES as m,toMiliseconds as Je}from\"@walletconnect/time\";import{isJsonRpcResult as x,isJsonRpcError as R,formatJsonRpcRequest as te,formatJsonRpcResult as Ye,formatJsonRpcError as Xe,isJsonRpcRequest as He,isJsonRpcResponse as Fe}from\"@walletconnect/jsonrpc-utils\";import{HEARTBEAT_EVENTS as We}from\"@walletconnect/heartbeat\";function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}var G=d;d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(o){if(!Ze(o)||o<0||isNaN(o))throw TypeError(\"n must be a positive number\");return this._maxListeners=o,this},d.prototype.emit=function(o){var i,e,t,s,r,n;if(this._events||(this._events={}),o===\"error\"&&(!this._events.error||D(this._events.error)&&!this._events.error.length)){if(i=arguments[1],i instanceof Error)throw i;var a=new Error('Uncaught, unspecified \"error\" event. ('+i+\")\");throw a.context=i,a}if(e=this._events[o],se(e))return!1;if(S(e))switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),e.apply(this,s)}else if(D(e))for(s=Array.prototype.slice.call(arguments,1),n=e.slice(),t=n.length,r=0;r<t;r++)n[r].apply(this,s);return!0},d.prototype.addListener=function(o,i){var e;if(!S(i))throw TypeError(\"listener must be a function\");return this._events||(this._events={}),this._events.newListener&&this.emit(\"newListener\",o,S(i.listener)?i.listener:i),this._events[o]?D(this._events[o])?this._events[o].push(i):this._events[o]=[this._events[o],i]:this._events[o]=i,D(this._events[o])&&!this._events[o].warned&&(se(this._maxListeners)?e=d.defaultMaxListeners:e=this._maxListeners,e&&e>0&&this._events[o].length>e&&(this._events[o].warned=!0,console.error(\"(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.\",this._events[o].length),typeof console.trace==\"function\"&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(o,i){if(!S(i))throw TypeError(\"listener must be a function\");var e=!1;function t(){this.removeListener(o,t),e||(e=!0,i.apply(this,arguments))}return t.listener=i,this.on(o,t),this},d.prototype.removeListener=function(o,i){var e,t,s,r;if(!S(i))throw TypeError(\"listener must be a function\");if(!this._events||!this._events[o])return this;if(e=this._events[o],s=e.length,t=-1,e===i||S(e.listener)&&e.listener===i)delete this._events[o],this._events.removeListener&&this.emit(\"removeListener\",o,i);else if(D(e)){for(r=s;r-- >0;)if(e[r]===i||e[r].listener&&e[r].listener===i){t=r;break}if(t<0)return this;e.length===1?(e.length=0,delete this._events[o]):e.splice(t,1),this._events.removeListener&&this.emit(\"removeListener\",o,i)}return this},d.prototype.removeAllListeners=function(o){var i,e;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[o]&&delete this._events[o],this;if(arguments.length===0){for(i in this._events)i!==\"removeListener\"&&this.removeAllListeners(i);return this.removeAllListeners(\"removeListener\"),this._events={},this}if(e=this._events[o],S(e))this.removeListener(o,e);else if(e)for(;e.length;)this.removeListener(o,e[e.length-1]);return delete this._events[o],this},d.prototype.listeners=function(o){var i;return!this._events||!this._events[o]?i=[]:S(this._events[o])?i=[this._events[o]]:i=this._events[o].slice(),i},d.prototype.listenerCount=function(o){if(this._events){var i=this._events[o];if(S(i))return 1;if(i)return i.length}return 0},d.listenerCount=function(o,i){return o.listenerCount(i)};function S(o){return typeof o==\"function\"}function Ze(o){return typeof o==\"number\"}function D(o){return typeof o==\"object\"&&o!==null}function se(o){return o===void 0}const H=\"wc\",F=2,W=\"client\",V=`${H}@${F}:${W}:`,z={name:W,logger:\"error\",controller:!1,relayUrl:\"wss://relay.walletconnect.com\"},Be={session_proposal:\"session_proposal\",session_update:\"session_update\",session_extend:\"session_extend\",session_ping:\"session_ping\",pairing_ping:\"pairing_ping\",session_delete:\"session_delete\",session_expire:\"session_expire\",pairing_delete:\"pairing_delete\",pairing_expire:\"pairing_expire\",session_request:\"session_request\",session_event:\"session_event\",proposal_expire:\"proposal_expire\"},Qe={database:\":memory:\"},ie=\"expirer\",w={created:\"expirer_created\",deleted:\"expirer_deleted\",expired:\"expirer_expired\",sync:\"expirer_sync\"},re=\"0.3\",et=I,_={created:\"history_created\",updated:\"history_updated\",deleted:\"history_deleted\",sync:\"history_sync\"},ne=\"history\",oe=\"0.3\",ae=\"pairing\",tt=ee,ce=\"proposal\",he=ee,le=\"session\",b=je,pe=\"engine\",M={wc_pairingDelete:{req:{ttl:I,prompt:!1,tag:1e3},res:{ttl:I,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:$,prompt:!1,tag:1002},res:{ttl:$,prompt:!1,tag:1003}},wc_sessionPropose:{req:{ttl:m,prompt:!0,tag:1100},res:{ttl:m,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:m,prompt:!1,tag:1102},res:{ttl:m,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:I,prompt:!1,tag:1104},res:{ttl:I,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:I,prompt:!1,tag:1106},res:{ttl:I,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:m,prompt:!0,tag:1108},res:{ttl:m,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:m,prompt:!0,tag:1110},res:{ttl:m,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:I,prompt:!1,tag:1112},res:{ttl:I,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:$,prompt:!1,tag:1114},res:{ttl:$,prompt:!1,tag:1115}}};var st=Object.defineProperty,it=Object.defineProperties,rt=Object.getOwnPropertyDescriptors,de=Object.getOwnPropertySymbols,nt=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable,ge=(o,i,e)=>i in o?st(o,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[i]=e,P=(o,i)=>{for(var e in i||(i={}))nt.call(i,e)&&ge(o,e,i[e]);if(de)for(var e of de(i))ot.call(i,e)&&ge(o,e,i[e]);return o},ue=(o,i)=>it(o,rt(i));class at extends Ee{constructor(i){super(i),this.events=new G,this.initialized=!1,this.name=pe,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0)},this.connect=async e=>{this.isInitialized(),await this.isValidConnect(e);const{pairingTopic:t,requiredNamespaces:s,relays:r}=e;let n=t,a,h=!1;if(n&&(h=this.client.pairing.get(n).active),!n||!h){const{topic:N,uri:g}=await this.createPairing();n=N,a=g}const l=await this.client.core.crypto.generateKeyPair(),y={requiredNamespaces:s,relays:r??[{protocol:Z}],proposer:{publicKey:l,metadata:this.client.metadata}},{reject:E,resolve:q,done:U}=T();if(this.events.once(p(\"session_connect\"),async({error:N,session:g})=>{if(N)E(N);else if(g){g.self.publicKey=l;const L=ue(P({},g),{requiredNamespaces:s});await this.client.session.set(g.topic,L),await this.setExpiry(g.topic,g.expiry),n&&await this.client.pairing.update(n,{peerMetadata:g.peer.metadata}),q(L)}}),!n){const{message:N}=c(\"NO_MATCHING_KEY\",`connect() pairing topic: ${n}`);throw new Error(N)}const A=await this.sendRequest(n,\"wc_sessionPropose\",y),k=f(m);return await this.setProposal(A,P({id:A,expiry:k},y)),{uri:a,approval:U}},this.pair=async e=>{this.isInitialized(),this.isValidPair(e);const{topic:t,symKey:s,relay:r}=Ie(e.uri),n=f(m),a={topic:t,relay:r,expiry:n,active:!1};return await this.client.pairing.set(t,a),await this.client.core.crypto.setSymKey(s,t),await this.client.core.relayer.subscribe(t,{relay:r}),await this.setExpiry(t,n),a},this.approve=async e=>{this.isInitialized(),await this.isValidApprove(e);const{id:t,relayProtocol:s,namespaces:r}=e,{pairingTopic:n,proposer:a,requiredNamespaces:h}=this.client.proposal.get(t),l=await this.client.core.crypto.generateKeyPair(),y=a.publicKey,E=await this.client.core.crypto.generateSharedKey(l,y),q={relay:{protocol:s??\"irn\"},namespaces:r,requiredNamespaces:h,controller:{publicKey:l,metadata:this.client.metadata},expiry:f(b)};await this.client.core.relayer.subscribe(E);const U=await this.sendRequest(E,\"wc_sessionSettle\",q),{done:A,resolve:k,reject:N}=T();this.events.once(p(\"session_approve\",U),({error:L})=>{L?N(L):k(this.client.session.get(E))});const g=ue(P({},q),{topic:E,acknowledged:!1,self:q.controller,peer:{publicKey:a.publicKey,metadata:a.metadata},controller:l});return await this.client.session.set(E,g),await this.setExpiry(E,f(b)),n&&await this.client.pairing.update(n,{peerMetadata:g.peer.metadata}),n&&t&&(await this.sendResult(t,n,{relay:{protocol:s??\"irn\"},responderPublicKey:l}),await this.client.proposal.delete(t,v(\"USER_DISCONNECTED\")),await this.activatePairing(n)),{topic:E,acknowledged:A}},this.reject=async e=>{this.isInitialized(),await this.isValidReject(e);const{id:t,reason:s}=e,{pairingTopic:r}=this.client.proposal.get(t);r&&(await this.sendError(t,r,s),await this.client.proposal.delete(t,v(\"USER_DISCONNECTED\")))},this.update=async e=>{this.isInitialized(),await this.isValidUpdate(e);const{topic:t,namespaces:s}=e,r=await this.sendRequest(t,\"wc_sessionUpdate\",{namespaces:s}),{done:n,resolve:a,reject:h}=T();return this.events.once(p(\"session_update\",r),({error:l})=>{l?h(l):a()}),await this.client.session.update(t,{namespaces:s}),{acknowledged:n}},this.extend=async e=>{this.isInitialized(),await this.isValidExtend(e);const{topic:t}=e,s=await this.sendRequest(t,\"wc_sessionExtend\",{}),{done:r,resolve:n,reject:a}=T();return this.events.once(p(\"session_extend\",s),({error:h})=>{h?a(h):n()}),await this.setExpiry(t,f(b)),{acknowledged:r}},this.request=async e=>{this.isInitialized(),await this.isValidRequest(e);const{chainId:t,request:s,topic:r}=e,n=await this.sendRequest(r,\"wc_sessionRequest\",{request:s,chainId:t}),{done:a,resolve:h,reject:l}=T();return this.events.once(p(\"session_request\",n),({error:y,result:E})=>{y?l(y):h(E)}),await a()},this.respond=async e=>{this.isInitialized(),await this.isValidRespond(e);const{topic:t,response:s}=e,{id:r}=s;x(s)?await this.sendResult(r,t,s.result):R(s)&&await this.sendError(r,t,s.error)},this.ping=async e=>{this.isInitialized(),await this.isValidPing(e);const{topic:t}=e;if(this.client.session.keys.includes(t)){const s=await this.sendRequest(t,\"wc_sessionPing\",{}),{done:r,resolve:n,reject:a}=T();this.events.once(p(\"session_ping\",s),({error:h})=>{h?a(h):n()}),await r()}else if(this.client.pairing.keys.includes(t)){const s=await this.sendRequest(t,\"wc_pairingPing\",{}),{done:r,resolve:n,reject:a}=T();this.events.once(p(\"pairing_ping\",s),({error:h})=>{h?a(h):n()}),await r()}},this.emit=async e=>{this.isInitialized(),await this.isValidEmit(e);const{topic:t,event:s,chainId:r}=e;await this.sendRequest(t,\"wc_sessionEvent\",{event:s,chainId:r})},this.disconnect=async e=>{this.isInitialized(),await this.isValidDisconnect(e);const{topic:t}=e;this.client.session.keys.includes(t)?(await this.sendRequest(t,\"wc_sessionDelete\",v(\"USER_DISCONNECTED\")),await this.deleteSession(t)):this.client.pairing.keys.includes(t)&&(await this.sendRequest(t,\"wc_pairingDelete\",v(\"USER_DISCONNECTED\")),await this.deletePairing(t))},this.find=e=>(this.isInitialized(),this.client.session.getAll().filter(t=>Re(t,e))),this.activatePairing=async e=>{const t=f(he);await this.client.pairing.update(e,{active:!0,expiry:t}),await this.setExpiry(e,t)},this.deleteSession=async(e,t)=>{const{self:s}=this.client.session.get(e);await this.client.core.relayer.unsubscribe(e),await Promise.all([this.client.session.delete(e,v(\"USER_DISCONNECTED\")),this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.deleteSymKey(e),t?Promise.resolve():this.client.expirer.del(e)])},this.deletePairing=async(e,t)=>{await this.client.core.relayer.unsubscribe(e),await Promise.all([this.client.pairing.delete(e,v(\"USER_DISCONNECTED\")),this.client.core.crypto.deleteSymKey(e),t?Promise.resolve():this.client.expirer.del(e)])},this.deleteProposal=async(e,t)=>{await Promise.all([this.client.proposal.delete(e,v(\"USER_DISCONNECTED\")),t?Promise.resolve():this.client.expirer.del(e)])},this.setExpiry=async(e,t)=>{this.client.pairing.keys.includes(e)?await this.client.pairing.update(e,{expiry:t}):this.client.session.keys.includes(e)&&await this.client.session.update(e,{expiry:t}),this.client.expirer.set(e,t)},this.setProposal=async(e,t)=>{await this.client.proposal.set(e,t),this.client.expirer.set(e,t.expiry)},this.sendRequest=async(e,t,s)=>{const r=te(t,s),n=await this.client.core.crypto.encode(e,r),a=M[t].req;return this.client.history.set(e,r),this.client.core.relayer.publish(e,n,a),r.id},this.sendResult=async(e,t,s)=>{const r=Ye(e,s),n=await this.client.core.crypto.encode(t,r),a=await this.client.history.get(t,e),h=M[a.request.method].res;await this.client.core.relayer.publish(t,n,h),await this.client.history.resolve(r)},this.sendError=async(e,t,s)=>{const r=Xe(e,s),n=await this.client.core.crypto.encode(t,r),a=await this.client.history.get(t,e),h=M[a.request.method].res;await this.client.core.relayer.publish(t,n,h),await this.client.history.resolve(r)},this.cleanup=async()=>{const e=[],t=[],s=[];this.client.session.getAll().forEach(r=>{O(r.expiry)&&e.push(r.topic)}),this.client.pairing.getAll().forEach(r=>{O(r.expiry)&&t.push(r.topic)}),this.client.proposal.getAll().forEach(r=>{O(r.expiry)&&s.push(r.id)}),await Promise.all([...e.map(r=>this.deleteSession(r)),...t.map(r=>this.deletePairing(r)),...s.map(r=>this.deleteProposal(r))])},this.onRelayEventRequest=e=>{const{topic:t,payload:s}=e,r=s.method;switch(r){case\"wc_sessionPropose\":return this.onSessionProposeRequest(t,s);case\"wc_sessionSettle\":return this.onSessionSettleRequest(t,s);case\"wc_sessionUpdate\":return this.onSessionUpdateRequest(t,s);case\"wc_sessionExtend\":return this.onSessionExtendRequest(t,s);case\"wc_sessionPing\":return this.onSessionPingRequest(t,s);case\"wc_pairingPing\":return this.onPairingPingRequest(t,s);case\"wc_sessionDelete\":return this.onSessionDeleteRequest(t,s);case\"wc_pairingDelete\":return this.onPairingDeleteRequest(t,s);case\"wc_sessionRequest\":return this.onSessionRequest(t,s);case\"wc_sessionEvent\":return this.onSessionEventRequest(t,s);default:return this.client.logger.info(`Unsupported request method ${r}`)}},this.onRelayEventResponse=async e=>{const{topic:t,payload:s}=e,r=(await this.client.history.get(t,s.id)).request.method;switch(r){case\"wc_sessionPropose\":return this.onSessionProposeResponse(t,s);case\"wc_sessionSettle\":return this.onSessionSettleResponse(t,s);case\"wc_sessionUpdate\":return this.onSessionUpdateResponse(t,s);case\"wc_sessionExtend\":return this.onSessionExtendResponse(t,s);case\"wc_sessionPing\":return this.onSessionPingResponse(t,s);case\"wc_pairingPing\":return this.onPairingPingResponse(t,s);case\"wc_sessionRequest\":return this.onSessionRequestResponse(t,s);default:return this.client.logger.info(`Unsupported response method ${r}`)}},this.onSessionProposeRequest=async(e,t)=>{const{params:s,id:r}=t;try{this.isValidConnect(P({},t.params));const n=f(m),a=P({id:r,pairingTopic:e,expiry:n},s);await this.setProposal(r,a),this.client.events.emit(\"session_proposal\",{id:r,params:a})}catch(n){await this.sendError(r,e,n),this.client.logger.error(n)}},this.onSessionProposeResponse=async(e,t)=>{const{id:s}=t;if(x(t)){const{result:r}=t;this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",result:r});const n=this.client.proposal.get(s);this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",proposal:n});const a=n.proposer.publicKey;this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",selfPublicKey:a});const h=r.responderPublicKey;this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",peerPublicKey:h});const l=await this.client.core.crypto.generateSharedKey(a,h);this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",sessionTopic:l});const y=await this.client.core.relayer.subscribe(l);this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",subscriptionId:y}),await this.activatePairing(e)}else R(t)&&(await this.client.proposal.delete(s,v(\"USER_DISCONNECTED\")),this.events.emit(p(\"session_connect\"),{error:t.error}))},this.onSessionSettleRequest=async(e,t)=>{const{id:s,params:r}=t;try{this.isValidSessionSettleRequest(r);const{relay:n,controller:a,expiry:h,namespaces:l}=t.params,y={topic:e,relay:n,expiry:h,namespaces:l,acknowledged:!0,controller:a.publicKey,self:{publicKey:\"\",metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}};await this.sendResult(t.id,e,!0),this.events.emit(p(\"session_connect\"),{session:y})}catch(n){await this.sendError(s,e,n),this.client.logger.error(n)}},this.onSessionSettleResponse=async(e,t)=>{const{id:s}=t;x(t)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(p(\"session_approve\",s),{})):R(t)&&(await this.client.session.delete(e,v(\"USER_DISCONNECTED\")),this.events.emit(p(\"session_approve\",s),{error:t.error}))},this.onSessionUpdateRequest=async(e,t)=>{const{params:s,id:r}=t;try{this.isValidUpdate(P({topic:e},s)),await this.client.session.update(e,{namespaces:s.namespaces}),await this.sendResult(r,e,!0),this.client.events.emit(\"session_update\",{id:r,topic:e,params:s})}catch(n){await this.sendError(r,e,n),this.client.logger.error(n)}},this.onSessionUpdateResponse=(e,t)=>{const{id:s}=t;x(t)?this.events.emit(p(\"session_update\",s),{}):R(t)&&this.events.emit(p(\"session_update\",s),{error:t.error})},this.onSessionExtendRequest=async(e,t)=>{const{id:s}=t;try{this.isValidExtend({topic:e}),await this.setExpiry(e,f(b)),await this.sendResult(s,e,!0),this.client.events.emit(\"session_extend\",{id:s,topic:e})}catch(r){await this.sendError(s,e,r),this.client.logger.error(r)}},this.onSessionExtendResponse=(e,t)=>{const{id:s}=t;x(t)?this.events.emit(p(\"session_extend\",s),{}):R(t)&&this.events.emit(p(\"session_extend\",s),{error:t.error})},this.onSessionPingRequest=async(e,t)=>{const{id:s}=t;try{this.isValidPing({topic:e}),await this.sendResult(s,e,!0),this.client.events.emit(\"session_ping\",{id:s,topic:e})}catch(r){await this.sendError(s,e,r),this.client.logger.error(r)}},this.onSessionPingResponse=(e,t)=>{const{id:s}=t;setTimeout(()=>{x(t)?this.events.emit(p(\"session_ping\",s),{}):R(t)&&this.events.emit(p(\"session_ping\",s),{error:t.error})},500)},this.onPairingPingRequest=async(e,t)=>{const{id:s}=t;try{this.isValidPing({topic:e}),await this.sendResult(s,e,!0),this.client.events.emit(\"pairing_ping\",{id:s,topic:e})}catch(r){await this.sendError(s,e,r),this.client.logger.error(r)}},this.onPairingPingResponse=(e,t)=>{const{id:s}=t;setTimeout(()=>{x(t)?this.events.emit(p(\"pairing_ping\",s),{}):R(t)&&this.events.emit(p(\"pairing_ping\",s),{error:t.error})},500)},this.onSessionDeleteRequest=async(e,t)=>{const{id:s}=t;try{this.isValidDisconnect({topic:e,reason:t.params}),await this.sendResult(s,e,!0),await this.deleteSession(e),this.client.events.emit(\"session_delete\",{id:s,topic:e})}catch(r){await this.sendError(s,e,r),this.client.logger.error(r)}},this.onPairingDeleteRequest=async(e,t)=>{const{id:s}=t;try{this.isValidDisconnect({topic:e,reason:t.params}),await this.sendResult(s,e,!0),await this.deletePairing(e),this.client.events.emit(\"pairing_delete\",{id:s,topic:e})}catch(r){await this.sendError(s,e,r),this.client.logger.error(r)}},this.onSessionRequest=async(e,t)=>{const{id:s,params:r}=t;try{this.isValidRequest(P({topic:e},r)),this.client.events.emit(\"session_request\",{id:s,topic:e,params:r})}catch(n){await this.sendError(s,e,n),this.client.logger.error(n)}},this.onSessionRequestResponse=(e,t)=>{const{id:s}=t;x(t)?this.events.emit(p(\"session_request\",s),{result:t.result}):R(t)&&this.events.emit(p(\"session_request\",s),{error:t.error})},this.onSessionEventRequest=async(e,t)=>{const{id:s,params:r}=t;try{this.isValidEmit(P({topic:e},r)),this.client.events.emit(\"session_event\",{id:s,topic:e,params:r})}catch(n){await this.sendError(s,e,n),this.client.logger.error(n)}},this.isValidConnect=async e=>{if(!u(e)){const{message:a}=c(\"MISSING_OR_INVALID\",`connect() params: ${JSON.stringify(e)}`);throw new Error(a)}const{pairingTopic:t,requiredNamespaces:s,relays:r}=e;Se(t)||await this.isValidPairingTopic(t);const n=Ne(s,\"connect()\");if(n)throw new Error(n.message);if(!xe(r,!0)){const{message:a}=c(\"MISSING_OR_INVALID\",`connect() relays: ${r}`);throw new Error(a)}},this.isValidPair=e=>{if(!u(e)){const{message:t}=c(\"MISSING_OR_INVALID\",`pair() params: ${e}`);throw new Error(t)}if(!Pe(e.uri)){const{message:t}=c(\"MISSING_OR_INVALID\",`pair() uri: ${e.uri}`);throw new Error(t)}},this.isValidApprove=async e=>{if(!u(e))throw new Error(c(\"MISSING_OR_INVALID\",`approve() params: ${e}`).message);const{id:t,namespaces:s,relayProtocol:r}=e;await this.isValidProposalId(t);const n=this.client.proposal.get(t),a=X(s,\"approve()\");if(a)throw new Error(a.message);const h=B(n.requiredNamespaces,s,\"update()\");if(h)throw new Error(h.message);if(!C(r,!0)){const{message:l}=c(\"MISSING_OR_INVALID\",`approve() relayProtocol: ${r}`);throw new Error(l)}},this.isValidReject=async e=>{if(!u(e)){const{message:r}=c(\"MISSING_OR_INVALID\",`reject() params: ${e}`);throw new Error(r)}const{id:t,reason:s}=e;if(await this.isValidProposalId(t),!Te(s)){const{message:r}=c(\"MISSING_OR_INVALID\",`reject() reason: ${JSON.stringify(s)}`);throw new Error(r)}},this.isValidSessionSettleRequest=e=>{if(!u(e)){const{message:l}=c(\"MISSING_OR_INVALID\",`onSessionSettleRequest() params: ${e}`);throw new Error(l)}const{relay:t,controller:s,namespaces:r,expiry:n}=e;if(!Oe(t)){const{message:l}=c(\"MISSING_OR_INVALID\",\"onSessionSettleRequest() relay protocol should be a string\");throw new Error(l)}const a=Ve(s,\"onSessionSettleRequest()\");if(a)throw new Error(a.message);const h=X(r,\"onSessionSettleRequest()\");if(h)throw new Error(h.message);if(O(n)){const{message:l}=c(\"EXPIRED\",\"onSessionSettleRequest()\");throw new Error(l)}},this.isValidUpdate=async e=>{if(!u(e)){const{message:h}=c(\"MISSING_OR_INVALID\",`update() params: ${e}`);throw new Error(h)}const{topic:t,namespaces:s}=e;await this.isValidSessionTopic(t);const r=this.client.session.get(t),n=X(s,\"update()\");if(n)throw new Error(n.message);const a=B(r.requiredNamespaces,s,\"update()\");if(a)throw new Error(a.message)},this.isValidExtend=async e=>{if(!u(e)){const{message:s}=c(\"MISSING_OR_INVALID\",`extend() params: ${e}`);throw new Error(s)}const{topic:t}=e;await this.isValidSessionTopic(t)},this.isValidRequest=async e=>{if(!u(e)){const{message:a}=c(\"MISSING_OR_INVALID\",`request() params: ${e}`);throw new Error(a)}const{topic:t,request:s,chainId:r}=e;await this.isValidSessionTopic(t);const{namespaces:n}=this.client.session.get(t);if(!Q(n,r)){const{message:a}=c(\"MISSING_OR_INVALID\",`request() chainId: ${r}`);throw new Error(a)}if(!qe(s)){const{message:a}=c(\"MISSING_OR_INVALID\",`request() ${JSON.stringify(s)}`);throw new Error(a)}if(!Le(n,r,s.method)){const{message:a}=c(\"MISSING_OR_INVALID\",`request() method: ${s.method}`);throw new Error(a)}},this.isValidRespond=async e=>{if(!u(e)){const{message:r}=c(\"MISSING_OR_INVALID\",`respond() params: ${e}`);throw new Error(r)}const{topic:t,response:s}=e;if(await this.isValidSessionTopic(t),!De(s)){const{message:r}=c(\"MISSING_OR_INVALID\",`respond() response: ${JSON.stringify(s)}`);throw new Error(r)}},this.isValidPing=async e=>{if(!u(e)){const{message:s}=c(\"MISSING_OR_INVALID\",`ping() params: ${e}`);throw new Error(s)}const{topic:t}=e;await this.isValidSessionOrPairingTopic(t)},this.isValidEmit=async e=>{if(!u(e)){const{message:a}=c(\"MISSING_OR_INVALID\",`emit() params: ${e}`);throw new Error(a)}const{topic:t,event:s,chainId:r}=e;await this.isValidSessionTopic(t);const{namespaces:n}=this.client.session.get(t);if(!Q(n,r)){const{message:a}=c(\"MISSING_OR_INVALID\",`emit() chainId: ${r}`);throw new Error(a)}if(!be(s)){const{message:a}=c(\"MISSING_OR_INVALID\",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!Ae(n,r,s.name)){const{message:a}=c(\"MISSING_OR_INVALID\",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}},this.isValidDisconnect=async e=>{if(!u(e)){const{message:s}=c(\"MISSING_OR_INVALID\",`disconnect() params: ${e}`);throw new Error(s)}const{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}}async createPairing(){const i=Ce(),e=await this.client.core.crypto.setSymKey(i),t=f(m),s={protocol:Z},r={topic:e,expiry:t,relay:s,active:!1},n=$e({protocol:this.client.protocol,version:this.client.version,topic:e,symKey:i,relay:s});return await this.client.pairing.set(e,r),await this.client.core.relayer.subscribe(e),await this.setExpiry(e,t),{topic:e,uri:n}}isInitialized(){if(!this.initialized){const{message:i}=c(\"NOT_INITIALIZED\",this.name);throw new Error(i)}}registerRelayerEvents(){this.client.core.relayer.on(me.message,async i=>{const{topic:e,message:t}=i,s=await this.client.core.crypto.decode(e,t);He(s)?(this.client.history.set(e,s),this.onRelayEventRequest({topic:e,payload:s})):Fe(s)&&(await this.client.history.resolve(s),this.onRelayEventResponse({topic:e,payload:s}))})}registerExpirerEvents(){this.client.expirer.on(w.expired,async i=>{const{topic:e,id:t}=Ge(i.target);e?this.client.session.keys.includes(e)?(await this.deleteSession(e,!0),this.client.events.emit(\"session_expire\",{topic:e})):this.client.pairing.keys.includes(e)&&(await this.deletePairing(e,!0),this.client.events.emit(\"pairing_expire\",{topic:e})):t&&await this.deleteProposal(t,!0)})}async isValidPairingTopic(i){if(!C(i,!1)){const{message:e}=c(\"MISSING_OR_INVALID\",`pairing topic should be a string: ${i}`);throw new Error(e)}if(!this.client.pairing.keys.includes(i)){const{message:e}=c(\"NO_MATCHING_KEY\",`pairing topic doesn't exist: ${i}`);throw new Error(e)}if(O(this.client.pairing.get(i).expiry)){await this.deletePairing(i);const{message:e}=c(\"EXPIRED\",`pairing topic: ${i}`);throw new Error(e)}}async isValidSessionTopic(i){if(!C(i,!1)){const{message:e}=c(\"MISSING_OR_INVALID\",`session topic should be a string: ${i}`);throw new Error(e)}if(!this.client.session.keys.includes(i)){const{message:e}=c(\"NO_MATCHING_KEY\",`session topic doesn't exist: ${i}`);throw new Error(e)}if(O(this.client.session.get(i).expiry)){await this.deleteSession(i);const{message:e}=c(\"EXPIRED\",`session topic: ${i}`);throw new Error(e)}}async isValidSessionOrPairingTopic(i){if(this.client.session.keys.includes(i))await this.isValidSessionTopic(i);else if(this.client.pairing.keys.includes(i))await this.isValidPairingTopic(i);else if(C(i,!1)){const{message:e}=c(\"NO_MATCHING_KEY\",`session or pairing topic doesn't exist: ${i}`);throw new Error(e)}else{const{message:e}=c(\"MISSING_OR_INVALID\",`session or pairing topic should be a string: ${i}`);throw new Error(e)}}async isValidProposalId(i){if(!ze(i)){const{message:e}=c(\"MISSING_OR_INVALID\",`proposal id should be a number: ${i}`);throw new Error(e)}if(!this.client.proposal.keys.includes(i)){const{message:e}=c(\"NO_MATCHING_KEY\",`proposal id doesn't exist: ${i}`);throw new Error(e)}if(O(this.client.proposal.get(i).expiry)){await this.deleteProposal(i);const{message:e}=c(\"EXPIRED\",`proposal id: ${i}`);throw new Error(e)}}}class ct extends _e{constructor(i,e){super(i,e),this.core=i,this.logger=e,this.expirations=new Map,this.events=new G.EventEmitter,this.name=ie,this.version=re,this.cached=[],this.initialized=!1,this.storagePrefix=V,this.init=async()=>{this.initialized||(this.logger.trace(\"Initialized\"),await this.restore(),this.cached.forEach(t=>this.expirations.set(t.target,t)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=t=>{try{const s=this.formatTarget(t);return typeof this.getExpiration(s)<\"u\"}catch{return!1}},this.set=(t,s)=>{this.isInitialized();const r=this.formatTarget(t),n={target:r,expiry:s};this.expirations.set(r,n),this.checkExpiry(r,n),this.events.emit(w.created,{target:r,expiration:n})},this.get=t=>{this.isInitialized();const s=this.formatTarget(t);return this.getExpiration(s)},this.del=t=>{this.isInitialized();const s=this.formatTarget(t);if(this.has(s)){const r=this.getExpiration(s);this.expirations.delete(s),this.events.emit(w.deleted,{target:s,expiration:r})}},this.on=(t,s)=>{this.events.on(t,s)},this.once=(t,s)=>{this.events.once(t,s)},this.off=(t,s)=>{this.events.off(t,s)},this.removeListener=(t,s)=>{this.events.removeListener(t,s)},this.logger=J(e,this.name)}get context(){return Y(this.logger)}get storageKey(){return this.storagePrefix+this.version+\"//\"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(i){if(typeof i==\"string\")return Me(i);if(typeof i==\"number\")return Ke(i);const{message:e}=c(\"UNKNOWN_TYPE\",`Target type: ${typeof i}`);throw new Error(e)}async setExpirations(i){await this.core.storage.setItem(this.storageKey,i)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(w.sync)}async restore(){try{const i=await this.getExpirations();if(typeof i>\"u\"||!i.length)return;if(this.expirations.size){const{message:e}=c(\"RESTORE_WILL_OVERRIDE\",this.name);throw this.logger.error(e),new Error(e)}this.cached=i,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:\"method\",method:\"restore\",expirations:this.values})}catch(i){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(i)}}getExpiration(i){const e=this.expirations.get(i);if(!e){const{message:t}=c(\"NO_MATCHING_KEY\",`${this.name}: ${i}`);throw this.logger.error(t),new Error(t)}return e}checkExpiry(i,e){const{expiry:t}=e;Je(t)-Date.now()<=0&&this.expire(i,e)}expire(i,e){this.expirations.delete(i),this.events.emit(w.expired,{target:i,expiration:e})}checkExpirations(){this.expirations.forEach((i,e)=>this.checkExpiry(e,i))}registerEventListeners(){this.core.heartbeat.on(We.pulse,()=>this.checkExpirations()),this.events.on(w.created,i=>{const e=w.created;this.logger.info(`Emitting ${e}`),this.logger.debug({type:\"event\",event:e,data:i}),this.persist()}),this.events.on(w.expired,i=>{const e=w.expired;this.logger.info(`Emitting ${e}`),this.logger.debug({type:\"event\",event:e,data:i}),this.persist()}),this.events.on(w.deleted,i=>{const e=w.deleted;this.logger.info(`Emitting ${e}`),this.logger.debug({type:\"event\",event:e,data:i}),this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=c(\"NOT_INITIALIZED\",this.name);throw new Error(i)}}}class ht extends fe{constructor(i,e){super(i,e),this.core=i,this.logger=e,this.records=new Map,this.events=new G.EventEmitter,this.name=ne,this.version=oe,this.cached=[],this.initialized=!1,this.storagePrefix=V,this.init=async()=>{this.initialized||(this.logger.trace(\"Initialized\"),await this.restore(),this.cached.forEach(t=>this.records.set(t.id,t)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(t,s,r)=>{if(this.isInitialized(),this.logger.debug(\"Setting JSON-RPC request history record\"),this.logger.trace({type:\"method\",method:\"set\",topic:t,request:s,chainId:r}),this.records.has(s.id))return;const n={id:s.id,topic:t,request:{method:s.method,params:s.params||null},chainId:r};this.records.set(n.id,n),this.events.emit(_.created,n)},this.resolve=async t=>{if(this.isInitialized(),this.logger.debug(\"Updating JSON-RPC response history record\"),this.logger.trace({type:\"method\",method:\"update\",response:t}),!this.records.has(t.id))return;const s=await this.getRecord(t.id);typeof s.response>\"u\"&&(s.response=R(t)?{error:t.error}:{result:t.result},this.records.set(s.id,s),this.events.emit(_.updated,s))},this.get=async(t,s)=>{this.isInitialized(),this.logger.debug(\"Getting record\"),this.logger.trace({type:\"method\",method:\"get\",topic:t,id:s});const r=await this.getRecord(s);if(r.topic!==t){const{message:n}=c(\"MISMATCHED_TOPIC\",`${this.name}, ${s}`);throw this.logger.error(n),new Error(n)}return r},this.delete=(t,s)=>{this.isInitialized(),this.logger.debug(\"Deleting record\"),this.logger.trace({type:\"method\",method:\"delete\",id:s}),this.values.forEach(r=>{if(r.topic===t){if(typeof s<\"u\"&&r.id!==s)return;this.records.delete(r.id),this.events.emit(_.deleted,r)}})},this.exists=async(t,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===t:!1),this.on=(t,s)=>{this.events.on(t,s)},this.once=(t,s)=>{this.events.once(t,s)},this.off=(t,s)=>{this.events.off(t,s)},this.removeListener=(t,s)=>{this.events.removeListener(t,s)},this.logger=J(e,this.name)}get context(){return Y(this.logger)}get storageKey(){return this.storagePrefix+this.version+\"//\"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const i=[];return this.values.forEach(e=>{if(typeof e.response<\"u\")return;const t={topic:e.topic,request:te(e.request.method,e.request.params,e.id),chainId:e.chainId};return i.push(t)}),i}async setJsonRpcRecords(i){await this.core.storage.setItem(this.storageKey,i)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(i){this.isInitialized();const e=this.records.get(i);if(!e){const{message:t}=c(\"NO_MATCHING_KEY\",`${this.name}: ${i}`);throw new Error(t)}return e}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(_.sync)}async restore(){try{const i=await this.getJsonRpcRecords();if(typeof i>\"u\"||!i.length)return;if(this.records.size){const{message:e}=c(\"RESTORE_WILL_OVERRIDE\",this.name);throw this.logger.error(e),new Error(e)}this.cached=i,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:\"method\",method:\"restore\",records:this.values})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}}registerEventListeners(){this.events.on(_.created,i=>{const e=_.created;this.logger.info(`Emitting ${e}`),this.logger.debug({type:\"event\",event:e,record:i}),this.persist()}),this.events.on(_.updated,i=>{const e=_.updated;this.logger.info(`Emitting ${e}`),this.logger.debug({type:\"event\",event:e,record:i}),this.persist()}),this.events.on(_.deleted,i=>{const e=_.deleted;this.logger.info(`Emitting ${e}`),this.logger.debug({type:\"event\",event:e,record:i}),this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=c(\"NOT_INITIALIZED\",this.name);throw new Error(i)}}}class lt extends j{constructor(i,e){super(i,e,ae,V),this.core=i,this.logger=e}}class pt extends j{constructor(i,e){super(i,e,ce,V),this.core=i,this.logger=e}}class dt extends j{constructor(i,e){super(i,e,le,V),this.core=i,this.logger=e}}class K extends ve{constructor(i){super(i),this.protocol=H,this.version=F,this.name=z.name,this.events=new G.EventEmitter,this.on=(t,s)=>this.events.on(t,s),this.once=(t,s)=>this.events.once(t,s),this.off=(t,s)=>this.events.off(t,s),this.removeListener=(t,s)=>this.events.removeListener(t,s),this.connect=async t=>{try{return await this.engine.connect(t)}catch(s){throw this.logger.error(s.message),s}},this.pair=async t=>{try{return await this.engine.pair(t)}catch(s){throw this.logger.error(s.message),s}},this.approve=async t=>{try{return await this.engine.approve(t)}catch(s){throw this.logger.error(s.message),s}},this.reject=async t=>{try{return await this.engine.reject(t)}catch(s){throw this.logger.error(s.message),s}},this.update=async t=>{try{return await this.engine.update(t)}catch(s){throw this.logger.error(s.message),s}},this.extend=async t=>{try{return await this.engine.extend(t)}catch(s){throw this.logger.error(s.message),s}},this.request=async t=>{try{return await this.engine.request(t)}catch(s){throw this.logger.error(s.message),s}},this.respond=async t=>{try{return await this.engine.respond(t)}catch(s){throw this.logger.error(s.message),s}},this.ping=async t=>{try{return await this.engine.ping(t)}catch(s){throw this.logger.error(s.message),s}},this.emit=async t=>{try{return await this.engine.emit(t)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async t=>{try{return await this.engine.disconnect(t)}catch(s){throw this.logger.error(s.message),s}},this.find=t=>{try{return this.engine.find(t)}catch(s){throw this.logger.error(s.message),s}},this.name=i?.name||z.name,this.metadata=i?.metadata||Ue();const e=typeof i?.logger<\"u\"&&typeof i?.logger!=\"string\"?i.logger:ke(ye({level:i?.logger||z.logger}));this.core=i?.core||new we(i),this.logger=J(e,this.name),this.pairing=new lt(this.core,this.logger),this.session=new dt(this.core,this.logger),this.proposal=new pt(this.core,this.logger),this.history=new ht(this.core,this.logger),this.expirer=new ct(this.core,this.logger),this.engine=new at(this)}static async init(i){const e=new K(i);return await e.initialize(),e}get context(){return Y(this.logger)}async initialize(){this.logger.trace(\"Initialized\");try{await this.core.start(),await this.pairing.init(),await this.session.init(),await this.proposal.init(),await this.history.init(),await this.expirer.init(),await this.engine.init(),this.logger.info(\"SignClient Initilization Success\")}catch(i){throw this.logger.info(\"SignClient Initilization Failure\"),this.logger.error(i.message),i}}}const gt=K;export{pe as ENGINE_CONTEXT,M as ENGINE_RPC_OPTS,ie as EXPIRER_CONTEXT,et as EXPIRER_DEFAULT_TTL,w as EXPIRER_EVENTS,re as EXPIRER_STORAGE_VERSION,ne as HISTORY_CONTEXT,_ as HISTORY_EVENTS,oe as HISTORY_STORAGE_VERSION,ae as PAIRING_CONTEXT,tt as PAIRING_DEFAULT_TTL,ce as PROPOSAL_CONTEXT,he as PROPOSAL_EXPIRY,le as SESSION_CONTEXT,b as SESSION_EXPIRY,W as SIGN_CLIENT_CONTEXT,z as SIGN_CLIENT_DEFAULT,Be as SIGN_CLIENT_EVENTS,H as SIGN_CLIENT_PROTOCOL,Qe as SIGN_CLIENT_STORAGE_OPTIONS,V as SIGN_CLIENT_STORAGE_PREFIX,F as SIGN_CLIENT_VERSION,gt as SignClient,K as default};\n//# sourceMappingURL=index.es.js.map\n"]},"metadata":{},"sourceType":"module"}