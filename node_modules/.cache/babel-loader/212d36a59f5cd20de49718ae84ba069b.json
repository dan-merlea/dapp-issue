{"ast":null,"code":"import _regeneratorRuntime from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import CircleSprite from'../util/CircleSprite';import{MIPMAP_MODES,Texture}from'pixi.js';import{TextSprite}from'..';import{Constants}from'@krogan/common';import{Geometry,Maths}from'@krogan/common';import BeamSprite from'./BeamSprite';import{getSpaceshipImage}from'images/textures';import ShieldSprite from'./ShieldSprite';var NAME_OFFSET=8;/**\n * A sprite representing a player with circle bounds.\n */var SpaceshipSprite=/*#__PURE__*/function(_CircleSprite){_inherits(SpaceshipSprite,_CircleSprite);var _super=_createSuper(SpaceshipSprite);// Components\n// Computed\n// Data\n// Init\nfunction SpaceshipSprite(spaceship,texture,isGhost,player){var _this;_classCallCheck(this,SpaceshipSprite);_this=_super.call(this,spaceship.info.specs,spaceship.position,spaceship.radius,texture);// Data\n_this._playerId='';_this._nonce=void 0;_this._beam=void 0;_this._nameTextSprite=void 0;_this._shield=void 0;_this._moving=void 0;_this._mining=void 0;_this._lastShoot=void 0;_this.spaceship=void 0;_this.ack=void 0;_this.player=void 0;_this.playerId=spaceship.playerId;_this.spaceship=spaceship;_this.player=player;_this._moving=false;_this._nonce=spaceship.nonce;_this._lastShoot=0;// Name\n_this._nameTextSprite=new TextSprite(_this.username,8,0.5,1);_this._nameTextSprite.position.set(0,-(_this.half+NAME_OFFSET));_this._nameTextSprite.zIndex=2;_this.addChild(_this._nameTextSprite);// Shield\n_this._shield=new ShieldSprite(spaceship.stats.shield,spaceship.radius*1.2);_this._shield.zIndex=3;_this.addChild(_this._shield);// Ghost\nif(isGhost){_this.visible=Constants.DEBUG;_this._nameTextSprite.visible=Constants.DEBUG;_this._shield.visible=false;}// Listeners\nspaceship.stats.listen('health',function(){_this.updateHud();});_this.updateHud();return _this;}// Static\n_createClass(SpaceshipSprite,[{key:\"canShoot\",value:// Helpers\nfunction canShoot(){return Date.now()-this._lastShoot>this.spaceship.info.specs.fireRate;}},{key:\"shoot\",value:function shoot(){this._lastShoot=Date.now();}},{key:\"updateHud\",value:function updateHud(){this.username=\"\".concat(this.username,\" HP: \").concat(this.spaceship.stats.health);}// Prepare spaceship to be left in space without control\n},{key:\"resetSpaceship\",value:function resetSpaceship(){if(this.destination){this.destination=undefined;}}},{key:\"updatePlayer\",value:function updatePlayer(isGhost,player){var _player$username;// Name\nthis._nameTextSprite.text=(_player$username=player===null||player===void 0?void 0:player.username)!==null&&_player$username!==void 0?_player$username:this.spaceship.team;// Ghost\nif(isGhost){this._sprite.visible=Constants.DEBUG;this._nameTextSprite.visible=Constants.DEBUG;this._shield.visible=false;}}},{key:\"selfControl\",value:function selfControl(){if(!this._destination)return;var position=new Geometry.Vector2(this.position.x,this.position.y);if(position.closeBy(this._destination)){this._destination=undefined;}else{// Accelerate towards the destination\nvar direction=this._destination.minus(position).normalize();var velocity=this.move(direction,undefined,false);return{dir:direction,velocity:velocity};}}// Call this function to animate the spaceship inner components\n},{key:\"animate\",value:function animate(){var _this$_beam;(_this$_beam=this._beam)===null||_this$_beam===void 0?void 0:_this$_beam.animate();this.updateMining();}// MINING\n},{key:\"updateMining\",value:function updateMining(){// Turn until angle with asteroid is reached\n// Then attach the beam\nif(this.spaceship.mining){if(this._mining){// Asteroid changed\nif(this._beam&&this._beam.asteroid.nonce!=this.spaceship.mining.nonce){this.removeChild(this._beam);this._beam=undefined;this.mineAsteroid(this.spaceship.mining);}// Turn to position then attach beam\nif(this.angle!=this.toAngle){this.turnIfNeeded();}else if(!this._beam){this._beam=new BeamSprite(this._sprite.angle,this.spaceship.mining,this.spaceship.position);this.addChild(this._beam);}}else{this.mineAsteroid(this.spaceship.mining);}}else{this.resetMining();}}// Duplicated code in BE\n},{key:\"mineAsteroid\",value:function mineAsteroid(asteroid){var distance=Maths.getDistance(this.position.x,this.position.y,asteroid.position.x,asteroid.position.y);console.log(\"[Asteroid] Distance \".concat(distance));if(distance>1000)return console.log('Too far');var angle=Maths.getDegrees(Maths.calculateAngle(asteroid.position.x,asteroid.position.y,this.position.x,this.position.y));this.toAngle=angle;this._mining=asteroid;console.log(\"Asteroid angle: \".concat(angle));}},{key:\"resetMining\",value:function resetMining(){if(this._beam){this.removeChild(this._beam);this._beam=undefined;this._mining=undefined;}}// Setters\n},{key:\"playerId\",get:function get(){return this._playerId;},set:function set(playerId){this._playerId=playerId;}},{key:\"username\",get:function get(){var _this$player$username,_this$player;return(_this$player$username=(_this$player=this.player)===null||_this$player===void 0?void 0:_this$player.username)!==null&&_this$player$username!==void 0?_this$player$username:this.spaceship.team;},set:function set(username){this._nameTextSprite.text=username;}},{key:\"moving\",set:function set(moving){if(moving==this._moving)return;this._moving=moving;if(moving){this._sprite.addThrusters(this.spaceship.info.level,this.spaceship.info.thrusters);}else{this._sprite.removeThrusters();}}// Getters\n},{key:\"angle\",get:function get(){return this._sprite.angle;}},{key:\"nonce\",get:function get(){return this._nonce;}},{key:\"half\",get:function get(){return this.body.radius;}},{key:\"toPosition\",get:function get(){return{toX:this.toX,toY:this.toY};}},{key:\"nameTextSprite\",get:function get(){return this._nameTextSprite;}}],[{key:\"loadSpaceshipTexture\",value:function(){var _loadSpaceshipTexture=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(spaceship){var texture;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Texture.fromURL(getSpaceshipImage(spaceship.info.level,spaceship.info.image));case 2:texture=_context.sent;texture.baseTexture.mipmap=MIPMAP_MODES.POW2;return _context.abrupt(\"return\",texture);case 5:case\"end\":return _context.stop();}}},_callee);}));function loadSpaceshipTexture(_x){return _loadSpaceshipTexture.apply(this,arguments);}return loadSpaceshipTexture;}()}]);return SpaceshipSprite;}(CircleSprite);export{SpaceshipSprite as default};","map":null,"metadata":{},"sourceType":"module"}