{"ast":null,"code":"\"use strict\";\n\nvar _slicedToArray = require(\"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/slicedToArray.js\").default;\nvar _classCallCheck = require(\"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n  __setModuleDefault(result, mod);\n  return result;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.BinaryCodecConstraints = exports.BinaryCodec = void 0;\nvar errors = __importStar(require(\"../../errors\"));\nvar typesystem_1 = require(\"../typesystem\");\nvar utils_1 = require(\"../../utils\");\nvar option_1 = require(\"./option\");\nvar primitive_1 = require(\"./primitive\");\nvar list_1 = require(\"./list\");\nvar struct_1 = require(\"./struct\");\nvar enum_1 = require(\"./enum\");\nvar tuple_1 = require(\"./tuple\");\nvar arrayVec_1 = require(\"./arrayVec\");\nvar BinaryCodec = /*#__PURE__*/function () {\n  function BinaryCodec() {\n    var constraints = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    _classCallCheck(this, BinaryCodec);\n    this.constraints = constraints || new BinaryCodecConstraints();\n    this.optionCodec = new option_1.OptionValueBinaryCodec(this);\n    this.listCodec = new list_1.ListBinaryCodec(this);\n    this.arrayCodec = new arrayVec_1.ArrayVecBinaryCodec(this);\n    this.primitiveCodec = new primitive_1.PrimitiveBinaryCodec(this);\n    this.structCodec = new struct_1.StructBinaryCodec(this);\n    this.tupleCodec = new tuple_1.TupleBinaryCodec(this);\n    this.enumCodec = new enum_1.EnumBinaryCodec(this);\n  }\n  _createClass(BinaryCodec, [{\n    key: \"decodeTopLevel\",\n    value: function decodeTopLevel(buffer, type) {\n      var _this = this;\n      this.constraints.checkBufferLength(buffer);\n      var typedValue = typesystem_1.onTypeSelect(type, {\n        onOption: function onOption() {\n          return _this.optionCodec.decodeTopLevel(buffer, type.getFirstTypeParameter());\n        },\n        onList: function onList() {\n          return _this.listCodec.decodeTopLevel(buffer, type);\n        },\n        onArray: function onArray() {\n          return _this.arrayCodec.decodeTopLevel(buffer, type);\n        },\n        onPrimitive: function onPrimitive() {\n          return _this.primitiveCodec.decodeTopLevel(buffer, type);\n        },\n        onStruct: function onStruct() {\n          return _this.structCodec.decodeTopLevel(buffer, type);\n        },\n        onTuple: function onTuple() {\n          return _this.tupleCodec.decodeTopLevel(buffer, type);\n        },\n        onEnum: function onEnum() {\n          return _this.enumCodec.decodeTopLevel(buffer, type);\n        }\n      });\n      return typedValue;\n    }\n  }, {\n    key: \"decodeNested\",\n    value: function decodeNested(buffer, type) {\n      var _this2 = this;\n      this.constraints.checkBufferLength(buffer);\n      var _typesystem_1$onTypeS = typesystem_1.onTypeSelect(type, {\n          onOption: function onOption() {\n            return _this2.optionCodec.decodeNested(buffer, type.getFirstTypeParameter());\n          },\n          onList: function onList() {\n            return _this2.listCodec.decodeNested(buffer, type);\n          },\n          onArray: function onArray() {\n            return _this2.arrayCodec.decodeNested(buffer, type);\n          },\n          onPrimitive: function onPrimitive() {\n            return _this2.primitiveCodec.decodeNested(buffer, type);\n          },\n          onStruct: function onStruct() {\n            return _this2.structCodec.decodeNested(buffer, type);\n          },\n          onTuple: function onTuple() {\n            return _this2.tupleCodec.decodeNested(buffer, type);\n          },\n          onEnum: function onEnum() {\n            return _this2.enumCodec.decodeNested(buffer, type);\n          }\n        }),\n        _typesystem_1$onTypeS2 = _slicedToArray(_typesystem_1$onTypeS, 2),\n        typedResult = _typesystem_1$onTypeS2[0],\n        decodedLength = _typesystem_1$onTypeS2[1];\n      return [typedResult, decodedLength];\n    }\n  }, {\n    key: \"encodeNested\",\n    value: function encodeNested(typedValue) {\n      var _this3 = this;\n      utils_1.guardTrue(typedValue.getType().getCardinality().isSingular(), \"singular cardinality, thus encodable type\");\n      return typesystem_1.onTypedValueSelect(typedValue, {\n        onPrimitive: function onPrimitive() {\n          return _this3.primitiveCodec.encodeNested(typedValue);\n        },\n        onOption: function onOption() {\n          return _this3.optionCodec.encodeNested(typedValue);\n        },\n        onList: function onList() {\n          return _this3.listCodec.encodeNested(typedValue);\n        },\n        onArray: function onArray() {\n          return _this3.arrayCodec.encodeNested(typedValue);\n        },\n        onStruct: function onStruct() {\n          return _this3.structCodec.encodeNested(typedValue);\n        },\n        onTuple: function onTuple() {\n          return _this3.tupleCodec.encodeNested(typedValue);\n        },\n        onEnum: function onEnum() {\n          return _this3.enumCodec.encodeNested(typedValue);\n        }\n      });\n    }\n  }, {\n    key: \"encodeTopLevel\",\n    value: function encodeTopLevel(typedValue) {\n      var _this4 = this;\n      utils_1.guardTrue(typedValue.getType().getCardinality().isSingular(), \"singular cardinality, thus encodable type\");\n      return typesystem_1.onTypedValueSelect(typedValue, {\n        onPrimitive: function onPrimitive() {\n          return _this4.primitiveCodec.encodeTopLevel(typedValue);\n        },\n        onOption: function onOption() {\n          return _this4.optionCodec.encodeTopLevel(typedValue);\n        },\n        onList: function onList() {\n          return _this4.listCodec.encodeTopLevel(typedValue);\n        },\n        onArray: function onArray() {\n          return _this4.arrayCodec.encodeTopLevel(typedValue);\n        },\n        onStruct: function onStruct() {\n          return _this4.structCodec.encodeTopLevel(typedValue);\n        },\n        onTuple: function onTuple() {\n          return _this4.tupleCodec.encodeTopLevel(typedValue);\n        },\n        onEnum: function onEnum() {\n          return _this4.enumCodec.encodeTopLevel(typedValue);\n        }\n      });\n    }\n  }]);\n  return BinaryCodec;\n}();\nexports.BinaryCodec = BinaryCodec;\nvar BinaryCodecConstraints = /*#__PURE__*/function () {\n  function BinaryCodecConstraints(init) {\n    _classCallCheck(this, BinaryCodecConstraints);\n    this.maxBufferLength = (init === null || init === void 0 ? void 0 : init.maxBufferLength) || 4096;\n    this.maxListLength = (init === null || init === void 0 ? void 0 : init.maxListLength) || 1024;\n  }\n  _createClass(BinaryCodecConstraints, [{\n    key: \"checkBufferLength\",\n    value: function checkBufferLength(buffer) {\n      if (buffer.length > this.maxBufferLength) {\n        throw new errors.ErrCodec(\"Buffer too large: \".concat(buffer.length, \" > \").concat(this.maxBufferLength));\n      }\n    }\n    /**\n     * This constraint avoids computer-freezing decode bugs (e.g. due to invalid ABI or struct definitions).\n     */\n  }, {\n    key: \"checkListLength\",\n    value: function checkListLength(length) {\n      if (length > this.maxListLength) {\n        throw new errors.ErrCodec(\"List too large: \".concat(length, \" > \").concat(this.maxListLength));\n      }\n    }\n  }]);\n  return BinaryCodecConstraints;\n}();\nexports.BinaryCodecConstraints = BinaryCodecConstraints;","map":{"version":3,"mappings":"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","names":["BinaryCodec","constraints","BinaryCodecConstraints","optionCodec","option_1","listCodec","list_1","arrayCodec","arrayVec_1","primitiveCodec","primitive_1","structCodec","struct_1","tupleCodec","tuple_1","enumCodec","enum_1","buffer","type","checkBufferLength","typedValue","typesystem_1","onOption","decodeTopLevel","getFirstTypeParameter","onList","onArray","onPrimitive","onStruct","onTuple","onEnum","decodeNested","typedResult","decodedLength","utils_1","getType","getCardinality","isSingular","encodeNested","encodeTopLevel","exports","init","maxBufferLength","maxListLength","length","errors","ErrCodec"],"sourceRoot":"","sources":["../../../src/smartcontracts/codec/binary.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}