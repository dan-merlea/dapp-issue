{"ast":null,"code":"import _classCallCheck from \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport { Constants, Entities, EventHandler } from '@krogan/common';\nimport { Asset, getCacheAsset, loadMapAssets } from 'images/textures';\nimport * as PIXI from 'pixi.js';\nimport { aspectFillScale } from 'utils/scaling';\nimport { GameManager } from './GameManager';\nimport { MapManager, MapZINDEX } from './MapManager';\n\n// We don't want to scale textures linearly because they would appear blurry.\nPIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;\nexport var AppManager = /*#__PURE__*/function () {\n  // Application\n\n  // Sprites\n\n  // Assets\n\n  // Game Events\n\n  // Map Data\n\n  // LIFECYCLE\n  function AppManager() {\n    var _this = this;\n    _classCallCheck(this, AppManager);\n    this._app = void 0;\n    this._mapManager = void 0;\n    this._gameManager = void 0;\n    this._background = void 0;\n    this._assetsLoaded = false;\n    this.eventHandler = new EventHandler();\n    this.map = new Entities.Map(Constants.MAP_SIZE, Constants.MAP_SIZE);\n    this.start = function (renderView) {\n      return new Promise(function (resolve, reject) {\n        if (_this._assetsLoaded) return reject(new Error('Already loaded'));\n        _this._assetsLoaded = true;\n        console.log('Loading assets');\n        loadMapAssets(function () {\n          renderView.oncontextmenu = function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n          };\n          renderView.appendChild(_this.app.view);\n          _this.app.start();\n          _this.loadMapBackground();\n          _this.mapManager.start();\n          _this.gameManager.assetsLoaded();\n          resolve();\n        });\n      });\n    };\n    this.stop = function () {\n      _this.app.ticker.stop();\n      _this.app.stop();\n    };\n    this.setScreenSize = function () {\n      _this.app.renderer.resize(window.innerWidth, window.innerHeight);\n      _this.mapManager.setScreenSize(window.innerWidth, window.innerHeight);\n      _this.gameManager.setScreenSize(window.innerWidth, window.innerHeight);\n    };\n    this.loadMapBackground = function () {\n      var screenWidth = window.innerWidth;\n      var screenHeight = window.innerHeight;\n      var background = new PIXI.Sprite(getCacheAsset(Asset.MapBackground));\n      aspectFillScale(background, screenWidth, screenHeight);\n      _this.app.stage.addChild(background);\n      background.zIndex = MapZINDEX.BACKGROUND;\n      _this._background = background;\n    };\n    var _screenWidth = window.innerWidth;\n    var _screenHeight = window.innerHeight;\n\n    // App\n    this._app = new PIXI.Application({\n      width: _screenWidth,\n      height: _screenHeight,\n      antialias: false,\n      backgroundColor: PIXI.utils.string2hex(Constants.BACKGROUND_COLOR),\n      autoDensity: true,\n      resolution: window.devicePixelRatio\n    });\n    this.app.stage.sortableChildren = true;\n    this.app.stage.interactive = true;\n    this.app.stage.hitArea = new PIXI.Rectangle(0, 0, Constants.ZOOM_MAP_RADIUS * 2, Constants.ZOOM_MAP_RADIUS * 2);\n\n    // Managers\n    this._mapManager = new MapManager(this.app, this.map, this.eventHandler);\n    this._gameManager = new GameManager(this.app, this.map, this.eventHandler);\n    this._gameManager.hideAll();\n\n    // Resize listener\n    window.addEventListener('resize', this.setScreenSize.bind(this));\n  }\n  _createClass(AppManager, [{\n    key: \"app\",\n    get:\n    // GETTERS & SETTERS\n\n    function get() {\n      return this._app;\n    }\n  }, {\n    key: \"mapManager\",\n    get: function get() {\n      return this._mapManager;\n    }\n  }, {\n    key: \"gameManager\",\n    get: function get() {\n      return this._gameManager;\n    }\n  }, {\n    key: \"startSpaceshipControl\",\n    value:\n    // IAPPManager\n\n    function startSpaceshipControl() {\n      this._mapManager.hideAll();\n      this._gameManager.showAll();\n      if (this._background) this._background.visible = false;\n    }\n  }, {\n    key: \"stopSpaceshipControl\",\n    value: function stopSpaceshipControl() {\n      this._gameManager.leaveGameRoom();\n      if (this._background) this._background.visible = true;\n    }\n  }, {\n    key: \"setZoomLevel\",\n    value: function setZoomLevel(level) {\n      if (this._background) {\n        this._background.visible = [0, 1].includes(level);\n      }\n      if (level == 0) {\n        this._mapManager.hideAll();\n        this._gameManager.hideAll();\n        this._mapManager.show(MapZINDEX.MAP);\n      }\n      if (level == 1) {\n        this._mapManager.hideAll();\n        this._gameManager.hideAll();\n        this._mapManager.show(MapZINDEX.HEX);\n      }\n      if (level == 2) {\n        this.startSpaceshipControl();\n      }\n    }\n  }]);\n  return AppManager;\n}();","map":{"version":3,"names":["Constants","Entities","EventHandler","Asset","getCacheAsset","loadMapAssets","PIXI","aspectFillScale","GameManager","MapManager","MapZINDEX","settings","SCALE_MODE","SCALE_MODES","NEAREST","AppManager","_app","_mapManager","_gameManager","_background","_assetsLoaded","eventHandler","map","Map","MAP_SIZE","start","renderView","Promise","resolve","reject","Error","console","log","oncontextmenu","e","preventDefault","stopPropagation","appendChild","app","view","loadMapBackground","mapManager","gameManager","assetsLoaded","stop","ticker","setScreenSize","renderer","resize","window","innerWidth","innerHeight","screenWidth","screenHeight","background","Sprite","MapBackground","stage","addChild","zIndex","BACKGROUND","Application","width","height","antialias","backgroundColor","utils","string2hex","BACKGROUND_COLOR","autoDensity","resolution","devicePixelRatio","sortableChildren","interactive","hitArea","Rectangle","ZOOM_MAP_RADIUS","hideAll","addEventListener","bind","showAll","visible","leaveGameRoom","level","includes","show","MAP","HEX","startSpaceshipControl"],"sources":["/Users/merlea/Development/Crypto/Krogan/kroganverse-com/packages/client/src/managers/AppManager.ts"],"sourcesContent":["import { Constants, Entities, EventHandler } from '@krogan/common';\nimport { Asset, getCacheAsset, loadMapAssets } from 'images/textures';\nimport * as PIXI from 'pixi.js';\nimport { aspectFillScale } from 'utils/scaling';\nimport { GameManager } from './GameManager';\nimport { MapManager, MapZINDEX } from './MapManager';\n\n// We don't want to scale textures linearly because they would appear blurry.\nPIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;\n\nexport interface IAppManager {\n\t/**\n\t * Hides map components and shows game components\n\t */\n\tstartSpaceshipControl(): void\n\t\n\t/**\n\t * Hides the game components and shows map components\n\t */\n\tstopSpaceshipControl(): void\n\t\n\t/**\n\t * Only shows a certail level of zoom\n\t */\n\tsetZoomLevel(level: number): void\n}\n\n\nexport class AppManager implements IAppManager {\n\n    // Application\n    private _app: PIXI.Application\n\tprivate _mapManager: MapManager\n\tprivate _gameManager: GameManager\n\n\t// Sprites\n\tprivate _background?: PIXI.Sprite\n\n\t// Assets\n\tprivate _assetsLoaded = false\n\t\n\t// Game Events\n    public eventHandler = new EventHandler()\n\n\t// Map Data\n\tprivate map = new Entities.Map(Constants.MAP_SIZE, Constants.MAP_SIZE)\n\n    // LIFECYCLE\n    constructor() {\n\t\tconst screenWidth = window.innerWidth\n        const screenHeight = window.innerHeight\n        \n        // App\n        this._app = new PIXI.Application({\n            width: screenWidth,\n            height: screenHeight,\n            antialias: false,\n            backgroundColor: PIXI.utils.string2hex(Constants.BACKGROUND_COLOR),\n            autoDensity: true,\n            resolution: window.devicePixelRatio,\n        });\n\n\t\tthis.app.stage.sortableChildren = true\n        this.app.stage.interactive = true\n        this.app.stage.hitArea = new PIXI.Rectangle(0, 0, Constants.ZOOM_MAP_RADIUS * 2, Constants.ZOOM_MAP_RADIUS * 2)\n\n\t\t// Managers\n\t\tthis._mapManager = new MapManager(this.app, this.map, this.eventHandler)\n\t\tthis._gameManager = new GameManager(this.app, this.map, this.eventHandler)\n\t\tthis._gameManager.hideAll()\n\n\n\t\t// Resize listener\n        window.addEventListener('resize', this.setScreenSize.bind(this))\n    }\n\n    start = (renderView: any): Promise<void> => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (this._assetsLoaded) return reject(new Error('Already loaded'))\n\t\t\t\n\t\t\tthis._assetsLoaded = true\n\t\t\tconsole.log('Loading assets')\n\n\t\t\tloadMapAssets(() => {\n\t\t\t\trenderView.oncontextmenu = function(e) { e.preventDefault(); e.stopPropagation(); }\n\t\t\t\trenderView.appendChild(this.app.view)\n\t\t\t\tthis.app.start()\n\t\n\t\t\t\tthis.loadMapBackground()\n\t\t\t\tthis.mapManager.start()\n\t\t\t\tthis.gameManager.assetsLoaded()\n\n\t\t\t\tresolve()\n\t\t\t})\n\t\t})\n    }\n\n    stop = () => {\n        this.app.ticker.stop()\n        this.app.stop()\n    };\n\n\t// GETTERS & SETTERS\n\n\tget app(): PIXI.Application {\n\t\treturn this._app\n\t}\n\n\tget mapManager(): MapManager {\n\t\treturn this._mapManager\n\t}\n\n\tget gameManager(): GameManager {\n\t\treturn this._gameManager\n\t}\n\n\tsetScreenSize = () => {\n        this.app.renderer.resize(window.innerWidth, window.innerHeight)\n\t\tthis.mapManager.setScreenSize(window.innerWidth, window.innerHeight)\n\t\tthis.gameManager.setScreenSize(window.innerWidth, window.innerHeight)\n    };\n\n\t// PUBLIC\n\n\tloadMapBackground = () => {\n\t\tconst screenWidth = window.innerWidth\n        const screenHeight = window.innerHeight\n\n\t\tconst background = new PIXI.Sprite(getCacheAsset(Asset.MapBackground))\n        aspectFillScale(background, screenWidth, screenHeight)\n        this.app.stage.addChild(background)\n\t\tbackground.zIndex = MapZINDEX.BACKGROUND\n\t\t\n\t\tthis._background = background\n\t}\n\n\t// IAPPManager\n\n\tstartSpaceshipControl() {\n\t\tthis._mapManager.hideAll()\n\t\tthis._gameManager.showAll()\n\n\t\tif (this._background) this._background.visible = false\n\t}\n\n\tstopSpaceshipControl(): void {\n\t\tthis._gameManager.leaveGameRoom()\n\n\t\tif (this._background) this._background.visible = true\n\t}\n\n\tsetZoomLevel(level: number) {\n\t\tif (this._background) {\n\t\t\tthis._background.visible = [0,1].includes(level)\n\t\t}\n\n\t\tif (level == 0) {\n\t\t\tthis._mapManager.hideAll()\n\t\t\tthis._gameManager.hideAll()\n\n\t\t\tthis._mapManager.show(MapZINDEX.MAP)\n\t\t}\n\t\tif (level == 1) {\n\t\t\tthis._mapManager.hideAll()\n\t\t\tthis._gameManager.hideAll()\n\n\t\t\tthis._mapManager.show(MapZINDEX.HEX)\n\t\t}\n\t\tif (level == 2) {\n\t\t\tthis.startSpaceshipControl()\n\t\t}\n\t}\n\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}