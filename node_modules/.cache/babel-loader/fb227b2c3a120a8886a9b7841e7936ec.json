{"ast":null,"code":"import _regeneratorRuntime from \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _jsxFileName = \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/packages/client/src/scenes/Game.tsx\",\n  _this = this,\n  _s = $RefreshSig$();\nimport { HUD } from '../gui/hud';\nimport React, { useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Helmet } from 'react-helmet';\nimport { View } from 'gui/uielements';\nimport { useGameManager, useMapManager } from 'rooms';\nimport { useRoomContext } from 'context/room';\nimport { useCoreContext } from 'core';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar Game = function Game(_ref) {\n  _s();\n  var _hud$stats, _hud$stats2;\n  var appManager = _ref.appManager;\n  var _useRoomContext = useRoomContext(),\n    hud = _useRoomContext.hud,\n    mapRoom = _useRoomContext.mapRoom;\n  var _useCoreContext = useCoreContext(),\n    isLoggedIn = _useCoreContext.isLoggedIn;\n  var navigate = useNavigate();\n  var map = useMapManager(appManager, appManager.mapManager, appManager.eventHandler);\n  var game = useGameManager(appManager, appManager.gameManager, appManager.eventHandler);\n  var gameCanvas = React.useRef(null);\n\n  // LIFECYCLE\n  useEffect(function () {\n    init();\n    return function cleanup() {\n      deinit();\n    };\n  }, []);\n  var init = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (isLoggedIn) {\n                _context.next = 3;\n                break;\n              }\n              navigate('/');\n              return _context.abrupt(\"return\");\n            case 3:\n              appManager.start(gameCanvas.current).then(function () {\n                if (!mapRoom) map.joinMapRoom();\n              }).catch(function (e) {\n                return console.warn;\n              });\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return function init() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var deinit = function deinit() {\n    map.leave();\n    game.leave();\n  };\n\n  // RENDER\n  return /*#__PURE__*/_jsxDEV(View, {\n    children: [/*#__PURE__*/_jsxDEV(Helmet, {\n      children: /*#__PURE__*/_jsxDEV(\"title\", {\n        children: \"\".concat((_hud$stats = hud.stats) === null || _hud$stats === void 0 ? void 0 : _hud$stats.roomName, \" [\").concat((_hud$stats2 = hud.stats) === null || _hud$stats2 === void 0 ? void 0 : _hud$stats2.playersCount, \"]\")\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 60,\n        columnNumber: 17\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 13\n    }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"canvas-container\",\n      ref: gameCanvas\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 13\n    }, _this), /*#__PURE__*/_jsxDEV(HUD, {\n      eventHandler: appManager.eventHandler\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 13\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 57,\n    columnNumber: 9\n  }, _this);\n};\n_s(Game, \"Y5uwqpS9DLi4pU+GVjl08W9HsUE=\", false, function () {\n  return [useRoomContext, useCoreContext, useNavigate, useMapManager, useGameManager];\n});\n_c = Game;\nexport default Game;\nvar _c;\n$RefreshReg$(_c, \"Game\");","map":{"version":3,"names":["HUD","React","useEffect","useNavigate","Helmet","View","useGameManager","useMapManager","useRoomContext","useCoreContext","Game","appManager","hud","mapRoom","isLoggedIn","navigate","map","mapManager","eventHandler","game","gameManager","gameCanvas","useRef","init","cleanup","deinit","start","current","then","joinMapRoom","catch","e","console","warn","leave","stats","roomName","playersCount"],"sources":["/Users/merlea/Development/Crypto/Krogan/kroganverse-com/packages/client/src/scenes/Game.tsx"],"sourcesContent":["import { HUD } from '../gui/hud'\nimport React, { useEffect } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport { Helmet } from 'react-helmet'\nimport { View } from 'gui/uielements'\nimport { isMobile } from 'react-device-detect'\nimport { AppManager } from 'managers'\nimport { useGameManager, useMapManager } from 'rooms'\nimport { useRoomContext } from 'context/room'\nimport { useCoreContext } from 'core'\n\n\nconst Game = ({\n    appManager,\n}: {\n    appManager: AppManager\n}): React.ReactElement => {\n\n    const { hud, mapRoom } = useRoomContext()\n    const { isLoggedIn } = useCoreContext()\n\n    const navigate = useNavigate()\n    const map = useMapManager(appManager, appManager.mapManager, appManager.eventHandler)\n    const game = useGameManager(appManager, appManager.gameManager, appManager.eventHandler)\n\n    const gameCanvas = React.useRef<HTMLDivElement>(null)\n    \n    // LIFECYCLE\n    useEffect(() => {\n        init()\n        return function cleanup() {\n            deinit()\n        }\n    }, [])\n\n    const init = async () => {\n        if (!isLoggedIn) {\n            navigate('/')\n            return\n        }\n\n        appManager\n            .start(gameCanvas.current)\n            .then(() => {\n                if (!mapRoom) map.joinMapRoom()\n            })\n            .catch((e) => console.warn)\n    }\n\n    const deinit = () => {\n        map.leave()\n        game.leave()\n    }\n\n    // RENDER\n    return (\n        <View>\n            {/* Set page's title */}\n            <Helmet>\n                <title>{`${hud.stats?.roomName} [${hud.stats?.playersCount}]`}</title>\n            </Helmet>\n\n            {/* Where PIXI is injected */}\n            <div className=\"canvas-container\" ref={gameCanvas} />\n\n            {/* Joysticks */}\n            {/* {isMobile && this.renderJoySticks()} */}\n\n            {/* HUD: GUI, menu */}\n            <HUD eventHandler={appManager.eventHandler} />\n        </View>\n    );\n}\n\nexport default Game;"],"mappings":";;;;;AAAA,SAASA,GAAG,QAAQ,YAAY;AAChC,OAAOC,KAAK,IAAIC,SAAS,QAAQ,OAAO;AACxC,SAASC,WAAW,QAAQ,kBAAkB;AAC9C,SAASC,MAAM,QAAQ,cAAc;AACrC,SAASC,IAAI,QAAQ,gBAAgB;AAGrC,SAASC,cAAc,EAAEC,aAAa,QAAQ,OAAO;AACrD,SAASC,cAAc,QAAQ,cAAc;AAC7C,SAASC,cAAc,QAAQ,MAAM;AAAA;AAGrC,IAAMC,IAAI,GAAG,SAAPA,IAAI,OAIgB;EAAA;EAAA;EAAA,IAHtBC,UAAU,QAAVA,UAAU;EAKV,sBAAyBH,cAAc,EAAE;IAAjCI,GAAG,mBAAHA,GAAG;IAAEC,OAAO,mBAAPA,OAAO;EACpB,sBAAuBJ,cAAc,EAAE;IAA/BK,UAAU,mBAAVA,UAAU;EAElB,IAAMC,QAAQ,GAAGZ,WAAW,EAAE;EAC9B,IAAMa,GAAG,GAAGT,aAAa,CAACI,UAAU,EAAEA,UAAU,CAACM,UAAU,EAAEN,UAAU,CAACO,YAAY,CAAC;EACrF,IAAMC,IAAI,GAAGb,cAAc,CAACK,UAAU,EAAEA,UAAU,CAACS,WAAW,EAAET,UAAU,CAACO,YAAY,CAAC;EAExF,IAAMG,UAAU,GAAGpB,KAAK,CAACqB,MAAM,CAAiB,IAAI,CAAC;;EAErD;EACApB,SAAS,CAAC,YAAM;IACZqB,IAAI,EAAE;IACN,OAAO,SAASC,OAAO,GAAG;MACtBC,MAAM,EAAE;IACZ,CAAC;EACL,CAAC,EAAE,EAAE,CAAC;EAEN,IAAMF,IAAI;IAAA,uEAAG;MAAA;QAAA;UAAA;YAAA;cAAA,IACJT,UAAU;gBAAA;gBAAA;cAAA;cACXC,QAAQ,CAAC,GAAG,CAAC;cAAA;YAAA;cAIjBJ,UAAU,CACLe,KAAK,CAACL,UAAU,CAACM,OAAO,CAAC,CACzBC,IAAI,CAAC,YAAM;gBACR,IAAI,CAACf,OAAO,EAAEG,GAAG,CAACa,WAAW,EAAE;cACnC,CAAC,CAAC,CACDC,KAAK,CAAC,UAACC,CAAC;gBAAA,OAAKC,OAAO,CAACC,IAAI;cAAA,EAAC;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAClC;IAAA,gBAZKV,IAAI;MAAA;IAAA;EAAA,GAYT;EAED,IAAME,MAAM,GAAG,SAATA,MAAM,GAAS;IACjBT,GAAG,CAACkB,KAAK,EAAE;IACXf,IAAI,CAACe,KAAK,EAAE;EAChB,CAAC;;EAED;EACA,oBACI,QAAC,IAAI;IAAA,wBAED,QAAC,MAAM;MAAA,uBACH;QAAA,kCAAWtB,GAAG,CAACuB,KAAK,+CAAT,WAAWC,QAAQ,8BAAKxB,GAAG,CAACuB,KAAK,gDAAT,YAAWE,YAAY;MAAA;QAAA;QAAA;QAAA;MAAA;IAAY;MAAA;MAAA;MAAA;IAAA,SACjE,eAGT;MAAK,SAAS,EAAC,kBAAkB;MAAC,GAAG,EAAEhB;IAAW;MAAA;MAAA;MAAA;IAAA,SAAG,eAMrD,QAAC,GAAG;MAAC,YAAY,EAAEV,UAAU,CAACO;IAAa;MAAA;MAAA;MAAA;IAAA,SAAG;EAAA;IAAA;IAAA;IAAA;EAAA,SAC3C;AAEf,CAAC;AAAA,GA5DKR,IAAI;EAAA,QAMmBF,cAAc,EAChBC,cAAc,EAEpBN,WAAW,EAChBI,aAAa,EACZD,cAAc;AAAA;AAAA,KAXzBI,IAAI;AA8DV,eAAeA,IAAI;AAAC;AAAA"},"metadata":{},"sourceType":"module"}