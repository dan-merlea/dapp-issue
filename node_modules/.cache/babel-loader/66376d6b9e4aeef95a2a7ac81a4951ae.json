{"ast":null,"code":"import _classCallCheck from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{Asset,getCacheAsset,HiddenTexture}from'images/textures';import{Circle,Container,MIPMAP_MODES,Point,Sprite,Texture}from'pixi.js';import{TextSprite}from'..';import{IconCounterType}from'sprites/ui/IconText';import{Maths,Constants}from'@krogan/common';import HexagonSprite from'./HexagonSprite';import StatsStack from'sprites/ui/StatsStack';import SolarSystem from'./SolarSystem';import{MapZINDEX}from'managers/MapManager';import{playerManager}from'managers';var TileContainer=/*#__PURE__*/function(_Container){_inherits(TileContainer,_Container);var _super=_createSuper(TileContainer);// Sprites\n// Data\n// Positioning\n// Actions\n// External callback\nfunction TileContainer(x,y,radius,coordinate,onHover,onClick){var _this;_classCallCheck(this,TileContainer);_this=_super.call(this);_this._hex=void 0;_this._noGoZone=void 0;_this._hidden=void 0;_this._statsStack=void 0;_this._solarSystem=void 0;_this._hexagon=void 0;_this._coordinate=void 0;_this._touchPoint=new Point();_this._drag=false;_this.onSpaceshipAdd=void 0;_this.onSpaceshipRemove=void 0;_this.x=x;_this.y=y;if(coordinate.base!=undefined){_this._hex=new HexagonSprite(0,0,radius,Constants.TileColor.DEFAULT,Constants.TEAMS[coordinate.base].color,0.2);}else{_this._hex=new HexagonSprite(0,0,radius,Constants.TileColor.DEFAULT,0x000000,0.2);}_this._coordinate=coordinate;_this.addChild(_this._hex);_this.zIndex=MapZINDEX.HEX;_this._hex.interactive=true;_this._hex.cursor='pointer';_this._hex.hitArea=new Circle(0,0,radius);_this._hex.on('pointerover',function(){_this.zIndex=MapZINDEX.HEX_HOVER;_this.setHover(true);onHover(_assertThisInitialized(_this));});_this._hex.on('pointerout',function(){_this.zIndex=MapZINDEX.HEX;_this.setHover(false);});_this._hex.on('pointerdown',function(e){_this._touchPoint=e.data.getLocalPosition(_this.parent);_this._drag=false;});_this._hex.on('pointermove',function(e){var point=e.data.getLocalPosition(_this.parent);if(Maths.getDistance(_this._touchPoint.x,_this._touchPoint.y,point.x,point.y)>5){_this._drag=true;}});_this._hex.on('pointerup',function(){if(!_this._drag)onClick(_assertThisInitialized(_this));});// Debug coordinates\nif(Constants.DEBUG){var nameTextSprite=new TextSprite(_this.coordinate.toString(),6,0.5,0.5);nameTextSprite.y=80;nameTextSprite.zIndex=3;_this.addChild(nameTextSprite);}playerManager.onUpdate(function(){_this.hexagonWasUpdated();});return _this;}// HELPERS\n_createClass(TileContainer,[{key:\"toggleNoGoZone\",value:function toggleNoGoZone(){if(this._noGoZone){this.removeChild(this._noGoZone);this._noGoZone.destroy();this._noGoZone=undefined;}else{var image=new Sprite(getCacheAsset(Asset.NoGoZone));image.angle=30;image.anchor.x=0.5;image.anchor.y=0.5;image.zIndex=1;this._noGoZone=image;this._hex.addChild(this._noGoZone);}}},{key:\"updatePlanets\",value:function updatePlanets(){if(!this.hexagon)return;if(this._solarSystem){this.removeChild(this._solarSystem);this._solarSystem=undefined;}this._solarSystem=new SolarSystem(this._hex.radius);this._solarSystem.addPlanets(this.hexagon.planets);this._solarSystem.zIndex=0;this.addChild(this._solarSystem);}},{key:\"hexagonWasUpdated\",value:function hexagonWasUpdated(){if(!this._hexagon)return;// Planets\nthis.updatePlanets();// Stats\nvar user=0;var team=0;var stats=[];this._hexagon.spaceships.forEach(function(value){if(value.address==playerManager.address()){user++;}else{team++;}});if(user>0){stats.push({preIcon:IconCounterType.USER,text:\"\".concat(user,\"x\"),icon:IconCounterType.SPACESHIP});}if(team>0){stats.push({preIcon:IconCounterType.TEAM,text:\"\".concat(team,\"x\"),icon:IconCounterType.SPACESHIP});}if(this._hexagon.starbases.length>0){stats.push({preIcon:IconCounterType.TEAM,text:\"\".concat(this._hexagon.starbases.length,\"x\"),icon:IconCounterType.STARBASE});}this.stats=stats;}},{key:\"setupListeners\",value:function setupListeners(){var _this2=this;if(!this._hexagon)return;this._hexagon.spaceships.onAdd=function(spaceship,nonce){var _this2$onSpaceshipAdd;console.log('Spaceship added');_this2.hexagonWasUpdated();(_this2$onSpaceshipAdd=_this2.onSpaceshipAdd)===null||_this2$onSpaceshipAdd===void 0?void 0:_this2$onSpaceshipAdd.call(_this2,spaceship,nonce);};this._hexagon.spaceships.onRemove=function(spaceship,nonce){var _this2$onSpaceshipRem;console.log('Spaceship removed');_this2.hexagonWasUpdated();(_this2$onSpaceshipRem=_this2.onSpaceshipRemove)===null||_this2$onSpaceshipRem===void 0?void 0:_this2$onSpaceshipRem.call(_this2,spaceship,nonce);};this.hexagonWasUpdated();}// GETTERS & SETTERS\n},{key:\"hexagon\",get:function get(){return this._hexagon;},set:function set(hexagon){this._hexagon=hexagon;this.setupListeners();}},{key:\"stats\",set:function set(stats){if(this._statsStack){this.removeChild(this._statsStack);this._statsStack=undefined;}if(stats.length>0){this._statsStack=new StatsStack(stats);this._statsStack.y=-90;this.addChild(this._statsStack);}}// TODO: remove? doesn't make sense to hide the map\n},{key:\"toggleHidden\",value:function toggleHidden(){if(this._hidden){this._hex.redraw(Constants.TileColor.DEFAULT);this.removeChild(this._hidden);this._hidden.destroy();this._hidden=undefined;}else{this._hex.redraw(Constants.TileColor.DEFAULT,Constants.TileColor.HIDDEN,0.75);var texture=Texture.from(HiddenTexture);texture.baseTexture.mipmap=MIPMAP_MODES.POW2;var image=new Sprite(texture);image.anchor.x=0.5;image.anchor.y=0.5;image.width=24;image.height=24;image.zIndex=1;this._hidden=image;this._hex.addChild(this._hidden);}}},{key:\"setHover\",value:function setHover(hover){var color=hover?Constants.TileColor.HIGHLIGHT:Constants.TileColor.DEFAULT;if(this._hidden){this._hex.redraw(color,Constants.TileColor.HIDDEN,0.75);}if(this._coordinate.base!=undefined){this._hex.redraw(color,Constants.TEAMS[this._coordinate.base].color,0.2);}else{this._hex.redraw(color,0x000000,0.2);}}},{key:\"noGoZone\",get:function get(){return this._noGoZone?true:false;}},{key:\"coordinate\",get:function get(){return this._coordinate;}},{key:\"teamColor\",value:function teamColor(team){switch(team){case'team_1':return Constants.TeamColor.RED;case'team_2':return Constants.TeamColor.BLUE;case'team_3':return Constants.TeamColor.GREEN;}}}]);return TileContainer;}(Container);export{TileContainer as default};","map":null,"metadata":{},"sourceType":"module"}