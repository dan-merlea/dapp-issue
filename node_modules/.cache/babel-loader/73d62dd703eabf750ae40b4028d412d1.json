{"ast":null,"code":"import _classCallCheck from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import ManagerContainer from'../containers/ManagerContainer';import{TileContainer}from'sprites';import{Constants}from'@krogan/common';import{MapPathContainer}from'sprites';var MapController=/*#__PURE__*/function(_ManagerContainer){_inherits(MapController,_ManagerContainer);var _super=_createSuper(MapController);// Callbacks\n// Sprites\nfunction MapController(map,eventHandler){var _this;_classCallCheck(this,MapController);_this=_super.call(this,'MAP');_this.map=void 0;_this.eventHandler=void 0;_this.tempPath=void 0;_this.paths=[];_this.selectedSpaceship=void 0;_this.eventHandler=eventHandler;_this.sortableChildren=true;var width=Constants.HEX_RADIUS*Math.sqrt(3);var height=Constants.HEX_RADIUS*2;_this.map=map;var leftPadding=50+Constants.HEX_RADIUS;var topPadding=50+Constants.HEX_RADIUS;_this.map.coordinateList.forEach(function(coordinate){var tile=coordinate.toTile();var y=tile.y*(height*3/4)+topPadding;var x=tile.x*width+leftPadding;if(tile.y%2==0)x=x+width/2;var tileContainer=new TileContainer(x,y,Constants.HEX_RADIUS,coordinate,_this.onTileHover.bind(_assertThisInitialized(_this)),_this.onTileClick.bind(_assertThisInitialized(_this)));_this.add(coordinate.toString(),tileContainer);if(coordinate.noGo)tileContainer.toggleNoGoZone();});return _this;}_createClass(MapController,[{key:\"onTileHover\",value:function onTileHover(tile){if(this.tempPath)this.tempPath.destroy();if(!this.selectedSpaceship||tile.noGoZone)return;var coordinate=this.map.getCoordinate(this.selectedSpaceship.coordinate.x,this.selectedSpaceship.coordinate.y,this.selectedSpaceship.coordinate.z);var result=this.map.pathFinding(coordinate,tile.coordinate);var path=this.createPath(result.path,result.references);this.tempPath=path;}},{key:\"onTileClick\",value:function onTileClick(tile){if(this.selectedSpaceship){this.eventHandler.send('warpSpaceship',{nonce:this.selectedSpaceship.nonce,coordinate:this.selectedSpaceship.coordinate.toJSON(),destination:tile.coordinate.toJSON()});this.selectedSpaceship=undefined;if(this.tempPath){this.removeChild(this.tempPath);this.tempPath=undefined;}return;}this.eventHandler.send('hexClick',tile);}},{key:\"setSelectedSpaceship\",value:function setSelectedSpaceship(spaceship){this.selectedSpaceship=spaceship;}// GETTERS\n},{key:\"getBaseFor\",value:function getBaseFor(team){var index=Constants.TEAMS.findIndex(function(value){return value.id==team;});return this.getAll().filter(function(tileContailer){return tileContailer.coordinate.base==index;}).first();}// DATA\n},{key:\"setHexagonBinding\",value:function setHexagonBinding(coordinateKey,hexagon){var tile=this.get(coordinateKey);if(tile)tile.hexagon=hexagon;}// PATH\n},{key:\"createPath\",value:function createPath(coordinates,references,travel){var _this2=this;var tileContainers=coordinates.map(function(coordinate){var tileContainer=_this2.get(coordinate.toString());return tileContainer;});var path=new MapPathContainer(tileContainers,travel);this.addChild(path);references.forEach(function(node){return node.reset();});return path;}},{key:\"resetPaths\",value:function resetPaths(){var _this3=this;this.paths.forEach(function(path){_this3.removeChild(path);path.destroy();});this.paths=[];}},{key:\"createSpaceshipWarp\",value:function createSpaceshipWarp(spaceship){var _this4=this;console.log(\"Create path: \".concat(JSON.stringify(spaceship.coordinate.toJSON())));var path=spaceship.travel.path.map(function(c){return _this4.map.getCoordinate(c.x,c.y,c.z);});var pathSprite=this.createPath(path,[],spaceship.travel);this.paths.push(pathSprite);}}]);return MapController;}(ManagerContainer);export{MapController as default};","map":null,"metadata":{},"sourceType":"module"}