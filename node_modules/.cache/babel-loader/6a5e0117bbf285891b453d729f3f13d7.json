{"ast":null,"code":"import _assertThisInitialized from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _toConsumableArray from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _regeneratorRuntime from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _createForOfIteratorHelper from \"/Users/merlea/Development/Crypto/Krogan/dapp-issue/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport { RELAYER_DEFAULT_PROTOCOL as te, RELAYER_EVENTS as ie, EXPIRER_EVENTS as ne, Store as j, Core as re } from \"@walletconnect/core\";\nimport { getDefaultLoggerOptions as oe, generateChildLogger as ae, getLoggerContext as ce } from \"@walletconnect/logger\";\nimport { IEngine as le, ISignClient as he } from \"@walletconnect/types\";\nimport { TYPE_1 as pe, createDelayedPromise as R, engineEvent as p, getInternalError as c, calcExpiry as N, getSdkError as I, isSessionCompatible as de, isExpired as V, isValidParams as w, isUndefined as ge, isValidRequiredNamespaces as ue, isValidRelays as me, isValidNamespaces as $, isConformingNamespaces as Y, isValidString as b, isValidErrorReason as we, isValidRelay as _e, isValidController as ye, isValidNamespacesChainId as J, isValidRequest as Ee, isValidNamespacesRequest as Se, isValidResponse as Ie, isValidEvent as fe, isValidNamespacesEvent as ve, parseExpirerTarget as Re, isValidId as Ne, getAppMetadata as Ve } from \"@walletconnect/utils\";\nimport Oe from \"pino\";\nimport { THIRTY_DAYS as qe, SEVEN_DAYS as Pe, FIVE_MINUTES as _, ONE_DAY as O, THIRTY_SECONDS as X } from \"@walletconnect/time\";\nimport { isJsonRpcResult as f, isJsonRpcError as v, formatJsonRpcRequest as Te, formatJsonRpcResult as xe, formatJsonRpcError as Le, isJsonRpcRequest as De, isJsonRpcResponse as be } from \"@walletconnect/jsonrpc-utils\";\nfunction d() {\n  this._events = this._events || {}, this._maxListeners = this._maxListeners || void 0;\n}\nvar H = d;\nd.EventEmitter = d, d.prototype._events = void 0, d.prototype._maxListeners = void 0, d.defaultMaxListeners = 10, d.prototype.setMaxListeners = function (o) {\n  if (!Ae(o) || o < 0 || isNaN(o)) throw TypeError(\"n must be a positive number\");\n  return this._maxListeners = o, this;\n}, d.prototype.emit = function (o) {\n  var i, e, s, t, n, r;\n  if (this._events || (this._events = {}), o === \"error\" && (!this._events.error || T(this._events.error) && !this._events.error.length)) {\n    if (i = arguments[1], i instanceof Error) throw i;\n    var a = new Error('Uncaught, unspecified \"error\" event. (' + i + \")\");\n    throw a.context = i, a;\n  }\n  if (e = this._events[o], F(e)) return !1;\n  if (y(e)) switch (arguments.length) {\n    case 1:\n      e.call(this);\n      break;\n    case 2:\n      e.call(this, arguments[1]);\n      break;\n    case 3:\n      e.call(this, arguments[1], arguments[2]);\n      break;\n    default:\n      t = Array.prototype.slice.call(arguments, 1), e.apply(this, t);\n  } else if (T(e)) for (t = Array.prototype.slice.call(arguments, 1), r = e.slice(), s = r.length, n = 0; n < s; n++) {\n    r[n].apply(this, t);\n  }\n  return !0;\n}, d.prototype.addListener = function (o, i) {\n  var e;\n  if (!y(i)) throw TypeError(\"listener must be a function\");\n  return this._events || (this._events = {}), this._events.newListener && this.emit(\"newListener\", o, y(i.listener) ? i.listener : i), this._events[o] ? T(this._events[o]) ? this._events[o].push(i) : this._events[o] = [this._events[o], i] : this._events[o] = i, T(this._events[o]) && !this._events[o].warned && (F(this._maxListeners) ? e = d.defaultMaxListeners : e = this._maxListeners, e && e > 0 && this._events[o].length > e && (this._events[o].warned = !0, console.error(\"(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.\", this._events[o].length), typeof console.trace == \"function\" && console.trace())), this;\n}, d.prototype.on = d.prototype.addListener, d.prototype.once = function (o, i) {\n  if (!y(i)) throw TypeError(\"listener must be a function\");\n  var e = !1;\n  function s() {\n    this.removeListener(o, s), e || (e = !0, i.apply(this, arguments));\n  }\n  return s.listener = i, this.on(o, s), this;\n}, d.prototype.removeListener = function (o, i) {\n  var e, s, t, n;\n  if (!y(i)) throw TypeError(\"listener must be a function\");\n  if (!this._events || !this._events[o]) return this;\n  if (e = this._events[o], t = e.length, s = -1, e === i || y(e.listener) && e.listener === i) delete this._events[o], this._events.removeListener && this.emit(\"removeListener\", o, i);else if (T(e)) {\n    for (n = t; n-- > 0;) {\n      if (e[n] === i || e[n].listener && e[n].listener === i) {\n        s = n;\n        break;\n      }\n    }\n    if (s < 0) return this;\n    e.length === 1 ? (e.length = 0, delete this._events[o]) : e.splice(s, 1), this._events.removeListener && this.emit(\"removeListener\", o, i);\n  }\n  return this;\n}, d.prototype.removeAllListeners = function (o) {\n  var i, e;\n  if (!this._events) return this;\n  if (!this._events.removeListener) return arguments.length === 0 ? this._events = {} : this._events[o] && delete this._events[o], this;\n  if (arguments.length === 0) {\n    for (i in this._events) {\n      i !== \"removeListener\" && this.removeAllListeners(i);\n    }\n    return this.removeAllListeners(\"removeListener\"), this._events = {}, this;\n  }\n  if (e = this._events[o], y(e)) this.removeListener(o, e);else if (e) for (; e.length;) {\n    this.removeListener(o, e[e.length - 1]);\n  }\n  return delete this._events[o], this;\n}, d.prototype.listeners = function (o) {\n  var i;\n  return !this._events || !this._events[o] ? i = [] : y(this._events[o]) ? i = [this._events[o]] : i = this._events[o].slice(), i;\n}, d.prototype.listenerCount = function (o) {\n  if (this._events) {\n    var i = this._events[o];\n    if (y(i)) return 1;\n    if (i) return i.length;\n  }\n  return 0;\n}, d.listenerCount = function (o, i) {\n  return o.listenerCount(i);\n};\nfunction y(o) {\n  return typeof o == \"function\";\n}\nfunction Ae(o) {\n  return typeof o == \"number\";\n}\nfunction T(o) {\n  return typeof o == \"object\" && o !== null;\n}\nfunction F(o) {\n  return o === void 0;\n}\nvar U = \"wc\",\n  K = 2,\n  k = \"client\",\n  z = \"\".concat(U, \"@\").concat(K, \":\").concat(k, \":\"),\n  A = {\n    name: k,\n    logger: \"error\",\n    controller: !1,\n    relayUrl: \"wss://relay.walletconnect.com\"\n  },\n  Ce = {\n    session_proposal: \"session_proposal\",\n    session_update: \"session_update\",\n    session_extend: \"session_extend\",\n    session_ping: \"session_ping\",\n    session_delete: \"session_delete\",\n    session_expire: \"session_expire\",\n    session_request: \"session_request\",\n    session_event: \"session_event\",\n    proposal_expire: \"proposal_expire\"\n  },\n  Ge = {\n    database: \":memory:\"\n  },\n  Me = {\n    created: \"history_created\",\n    updated: \"history_updated\",\n    deleted: \"history_deleted\",\n    sync: \"history_sync\"\n  },\n  $e = \"history\",\n  Ue = \"0.3\",\n  Z = \"proposal\",\n  Ke = qe,\n  B = \"session\",\n  x = Pe,\n  Q = \"engine\",\n  L = {\n    wc_sessionPropose: {\n      req: {\n        ttl: _,\n        prompt: !0,\n        tag: 1100\n      },\n      res: {\n        ttl: _,\n        prompt: !1,\n        tag: 1101\n      }\n    },\n    wc_sessionSettle: {\n      req: {\n        ttl: _,\n        prompt: !1,\n        tag: 1102\n      },\n      res: {\n        ttl: _,\n        prompt: !1,\n        tag: 1103\n      }\n    },\n    wc_sessionUpdate: {\n      req: {\n        ttl: O,\n        prompt: !1,\n        tag: 1104\n      },\n      res: {\n        ttl: O,\n        prompt: !1,\n        tag: 1105\n      }\n    },\n    wc_sessionExtend: {\n      req: {\n        ttl: O,\n        prompt: !1,\n        tag: 1106\n      },\n      res: {\n        ttl: O,\n        prompt: !1,\n        tag: 1107\n      }\n    },\n    wc_sessionRequest: {\n      req: {\n        ttl: _,\n        prompt: !0,\n        tag: 1108\n      },\n      res: {\n        ttl: _,\n        prompt: !1,\n        tag: 1109\n      }\n    },\n    wc_sessionEvent: {\n      req: {\n        ttl: _,\n        prompt: !0,\n        tag: 1110\n      },\n      res: {\n        ttl: _,\n        prompt: !1,\n        tag: 1111\n      }\n    },\n    wc_sessionDelete: {\n      req: {\n        ttl: O,\n        prompt: !1,\n        tag: 1112\n      },\n      res: {\n        ttl: O,\n        prompt: !1,\n        tag: 1113\n      }\n    },\n    wc_sessionPing: {\n      req: {\n        ttl: X,\n        prompt: !1,\n        tag: 1114\n      },\n      res: {\n        ttl: X,\n        prompt: !1,\n        tag: 1115\n      }\n    }\n  };\nvar ke = Object.defineProperty,\n  ze = Object.defineProperties,\n  je = Object.getOwnPropertyDescriptors,\n  W = Object.getOwnPropertySymbols,\n  Ye = Object.prototype.hasOwnProperty,\n  Je = Object.prototype.propertyIsEnumerable,\n  ee = function ee(o, i, e) {\n    return i in o ? ke(o, i, {\n      enumerable: !0,\n      configurable: !0,\n      writable: !0,\n      value: e\n    }) : o[i] = e;\n  },\n  S = function S(o, i) {\n    for (var e in i || (i = {})) {\n      Ye.call(i, e) && ee(o, e, i[e]);\n    }\n    if (W) {\n      var _iterator = _createForOfIteratorHelper(W(i)),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var e = _step.value;\n          Je.call(i, e) && ee(o, e, i[e]);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    }\n    return o;\n  },\n  se = function se(o, i) {\n    return ze(o, je(i));\n  };\nvar Xe = /*#__PURE__*/function (_le) {\n  _inherits(Xe, _le);\n  var _super = _createSuper(Xe);\n  function Xe(i) {\n    var _this;\n    _classCallCheck(this, Xe);\n    _this = _super.call(this, i), _this.name = Q, _this.events = new H(), _this.initialized = !1, _this.ignoredPayloadTypes = [pe], _this.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.t0 = _this.initialized;\n              if (_context.t0) {\n                _context.next = 8;\n                break;\n              }\n              _context.next = 4;\n              return _this.cleanup();\n            case 4:\n              _this.registerRelayerEvents();\n              _this.registerExpirerEvents();\n              _this.client.core.pairing.register({\n                methods: Object.keys(L)\n              });\n              _this.initialized = !0;\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })), _this.connect = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(e) {\n        var s, t, n, r, a, l, _yield$_this$client$c, E, g, h, u, _R, m, q, G, _c, _E, D, M;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _this.isInitialized();\n                _context3.next = 3;\n                return _this.isValidConnect(e);\n              case 3:\n                s = e.pairingTopic, t = e.requiredNamespaces, n = e.relays;\n                r = s, l = !1;\n                if (!(r && (l = _this.client.core.pairing.pairings.get(r).active), !r || !l)) {\n                  _context3.next = 12;\n                  break;\n                }\n                _context3.next = 8;\n                return _this.client.core.pairing.create();\n              case 8:\n                _yield$_this$client$c = _context3.sent;\n                E = _yield$_this$client$c.topic;\n                g = _yield$_this$client$c.uri;\n                r = E, a = g;\n              case 12:\n                _context3.next = 14;\n                return _this.client.core.crypto.generateKeyPair();\n              case 14:\n                h = _context3.sent;\n                u = {\n                  requiredNamespaces: t,\n                  relays: n !== null && n !== void 0 ? n : [{\n                    protocol: te\n                  }],\n                  proposer: {\n                    publicKey: h,\n                    metadata: _this.client.metadata\n                  }\n                };\n                _R = R();\n                m = _R.reject;\n                q = _R.resolve;\n                G = _R.done;\n                if (!(_this.events.once(p(\"session_connect\"), /*#__PURE__*/function () {\n                  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(_ref3) {\n                    var E, g, P;\n                    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n                      while (1) {\n                        switch (_context2.prev = _context2.next) {\n                          case 0:\n                            E = _ref3.error, g = _ref3.session;\n                            if (!E) {\n                              _context2.next = 5;\n                              break;\n                            }\n                            m(E);\n                            _context2.next = 17;\n                            break;\n                          case 5:\n                            if (!g) {\n                              _context2.next = 17;\n                              break;\n                            }\n                            g.self.publicKey = h;\n                            P = se(S({}, g), {\n                              requiredNamespaces: t\n                            });\n                            _context2.next = 10;\n                            return _this.client.session.set(g.topic, P);\n                          case 10:\n                            _context2.next = 12;\n                            return _this.setExpiry(g.topic, g.expiry);\n                          case 12:\n                            _context2.t0 = r;\n                            if (!_context2.t0) {\n                              _context2.next = 16;\n                              break;\n                            }\n                            _context2.next = 16;\n                            return _this.client.core.pairing.updateMetadata({\n                              topic: r,\n                              metadata: g.peer.metadata\n                            });\n                          case 16:\n                            q(P);\n                          case 17:\n                          case \"end\":\n                            return _context2.stop();\n                        }\n                      }\n                    }, _callee2);\n                  }));\n                  return function (_x2) {\n                    return _ref4.apply(this, arguments);\n                  };\n                }()), !r)) {\n                  _context3.next = 23;\n                  break;\n                }\n                _c = c(\"NO_MATCHING_KEY\", \"connect() pairing topic: \".concat(r)), _E = _c.message;\n                throw new Error(_E);\n              case 23:\n                _context3.next = 25;\n                return _this.sendRequest(r, \"wc_sessionPropose\", u);\n              case 25:\n                D = _context3.sent;\n                M = N(_);\n                _context3.next = 29;\n                return _this.setProposal(D, S({\n                  id: D,\n                  expiry: M\n                }, u));\n              case 29:\n                return _context3.abrupt(\"return\", {\n                  uri: a,\n                  approval: G\n                });\n              case 30:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }(), _this.pair = /*#__PURE__*/function () {\n      var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(e) {\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _this.isInitialized();\n                _context4.next = 3;\n                return _this.client.core.pairing.pair(e);\n              case 3:\n                return _context4.abrupt(\"return\", _context4.sent);\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n      return function (_x3) {\n        return _ref5.apply(this, arguments);\n      };\n    }(), _this.approve = /*#__PURE__*/function () {\n      var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5(e) {\n        var s, t, n, _this$client$proposal, r, a, l, h, u, m, q, G, _R2, D, M, E, g;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _this.isInitialized();\n                _context5.next = 3;\n                return _this.isValidApprove(e);\n              case 3:\n                s = e.id;\n                t = e.relayProtocol;\n                n = e.namespaces;\n                _this$client$proposal = _this.client.proposal.get(s);\n                r = _this$client$proposal.pairingTopic;\n                a = _this$client$proposal.proposer;\n                l = _this$client$proposal.requiredNamespaces;\n                _context5.next = 12;\n                return _this.client.core.crypto.generateKeyPair();\n              case 12:\n                h = _context5.sent;\n                u = a.publicKey;\n                _context5.next = 16;\n                return _this.client.core.crypto.generateSharedKey(h, u);\n              case 16:\n                m = _context5.sent;\n                q = {\n                  relay: {\n                    protocol: t !== null && t !== void 0 ? t : \"irn\"\n                  },\n                  namespaces: n,\n                  requiredNamespaces: l,\n                  controller: {\n                    publicKey: h,\n                    metadata: _this.client.metadata\n                  },\n                  expiry: N(x)\n                };\n                _context5.next = 20;\n                return _this.client.core.relayer.subscribe(m);\n              case 20:\n                _context5.next = 22;\n                return _this.sendRequest(m, \"wc_sessionSettle\", q);\n              case 22:\n                G = _context5.sent;\n                _R2 = R();\n                D = _R2.done;\n                M = _R2.resolve;\n                E = _R2.reject;\n                _this.events.once(p(\"session_approve\", G), function (_ref7) {\n                  var P = _ref7.error;\n                  P ? E(P) : M(_this.client.session.get(m));\n                });\n                g = se(S({}, q), {\n                  topic: m,\n                  acknowledged: !1,\n                  self: q.controller,\n                  peer: {\n                    publicKey: a.publicKey,\n                    metadata: a.metadata\n                  },\n                  controller: h\n                });\n                _context5.next = 31;\n                return _this.client.session.set(m, g);\n              case 31:\n                _context5.next = 33;\n                return _this.setExpiry(m, N(x));\n              case 33:\n                _context5.t0 = r;\n                if (!_context5.t0) {\n                  _context5.next = 37;\n                  break;\n                }\n                _context5.next = 37;\n                return _this.client.core.pairing.updateMetadata({\n                  topic: r,\n                  metadata: g.peer.metadata\n                });\n              case 37:\n                _context5.t1 = r && s;\n                if (!_context5.t1) {\n                  _context5.next = 45;\n                  break;\n                }\n                _context5.next = 41;\n                return _this.sendResult(s, r, {\n                  relay: {\n                    protocol: t !== null && t !== void 0 ? t : \"irn\"\n                  },\n                  responderPublicKey: h\n                });\n              case 41:\n                _context5.next = 43;\n                return _this.client.proposal.delete(s, I(\"USER_DISCONNECTED\"));\n              case 43:\n                _context5.next = 45;\n                return _this.client.core.pairing.activate({\n                  topic: r\n                });\n              case 45:\n                return _context5.abrupt(\"return\", {\n                  topic: m,\n                  acknowledged: D\n                });\n              case 46:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }));\n      return function (_x4) {\n        return _ref6.apply(this, arguments);\n      };\n    }(), _this.reject = /*#__PURE__*/function () {\n      var _ref8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6(e) {\n        var s, t, _this$client$proposal2, n;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _this.isInitialized();\n                _context6.next = 3;\n                return _this.isValidReject(e);\n              case 3:\n                s = e.id, t = e.reason, _this$client$proposal2 = _this.client.proposal.get(s), n = _this$client$proposal2.pairingTopic;\n                _context6.t0 = n;\n                if (!_context6.t0) {\n                  _context6.next = 10;\n                  break;\n                }\n                _context6.next = 8;\n                return _this.sendError(s, n, t);\n              case 8:\n                _context6.next = 10;\n                return _this.client.proposal.delete(s, I(\"USER_DISCONNECTED\"));\n              case 10:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6);\n      }));\n      return function (_x5) {\n        return _ref8.apply(this, arguments);\n      };\n    }(), _this.update = /*#__PURE__*/function () {\n      var _ref9 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7(e) {\n        var s, t, n, _R3, r, a, l;\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _this.isInitialized();\n                _context7.next = 3;\n                return _this.isValidUpdate(e);\n              case 3:\n                s = e.topic;\n                t = e.namespaces;\n                _context7.next = 7;\n                return _this.sendRequest(s, \"wc_sessionUpdate\", {\n                  namespaces: t\n                });\n              case 7:\n                n = _context7.sent;\n                _R3 = R();\n                r = _R3.done;\n                a = _R3.resolve;\n                l = _R3.reject;\n                _this.events.once(p(\"session_update\", n), function (_ref10) {\n                  var h = _ref10.error;\n                  h ? l(h) : a();\n                });\n                _context7.next = 15;\n                return _this.client.session.update(s, {\n                  namespaces: t\n                });\n              case 15:\n                return _context7.abrupt(\"return\", {\n                  acknowledged: r\n                });\n              case 16:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7);\n      }));\n      return function (_x6) {\n        return _ref9.apply(this, arguments);\n      };\n    }(), _this.extend = /*#__PURE__*/function () {\n      var _ref11 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8(e) {\n        var s, t, _R4, n, r, a;\n        return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _this.isInitialized();\n                _context8.next = 3;\n                return _this.isValidExtend(e);\n              case 3:\n                s = e.topic;\n                _context8.next = 6;\n                return _this.sendRequest(s, \"wc_sessionExtend\", {});\n              case 6:\n                t = _context8.sent;\n                _R4 = R();\n                n = _R4.done;\n                r = _R4.resolve;\n                a = _R4.reject;\n                _this.events.once(p(\"session_extend\", t), function (_ref12) {\n                  var l = _ref12.error;\n                  l ? a(l) : r();\n                });\n                _context8.next = 14;\n                return _this.setExpiry(s, N(x));\n              case 14:\n                return _context8.abrupt(\"return\", {\n                  acknowledged: n\n                });\n              case 15:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8);\n      }));\n      return function (_x7) {\n        return _ref11.apply(this, arguments);\n      };\n    }(), _this.request = /*#__PURE__*/function () {\n      var _ref13 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee9(e) {\n        var s, t, n, r, _R5, a, l, h;\n        return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _this.isInitialized();\n                _context9.next = 3;\n                return _this.isValidRequest(e);\n              case 3:\n                s = e.chainId;\n                t = e.request;\n                n = e.topic;\n                _context9.next = 8;\n                return _this.sendRequest(n, \"wc_sessionRequest\", {\n                  request: t,\n                  chainId: s\n                });\n              case 8:\n                r = _context9.sent;\n                _R5 = R();\n                a = _R5.done;\n                l = _R5.resolve;\n                h = _R5.reject;\n                _this.events.once(p(\"session_request\", r), function (_ref14) {\n                  var u = _ref14.error,\n                    m = _ref14.result;\n                  u ? h(u) : l(m);\n                });\n                _context9.next = 16;\n                return a();\n              case 16:\n                return _context9.abrupt(\"return\", _context9.sent);\n              case 17:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9);\n      }));\n      return function (_x8) {\n        return _ref13.apply(this, arguments);\n      };\n    }(), _this.respond = /*#__PURE__*/function () {\n      var _ref15 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee10(e) {\n        var s, t, n;\n        return _regeneratorRuntime().wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                _this.isInitialized();\n                _context10.next = 3;\n                return _this.isValidRespond(e);\n              case 3:\n                s = e.topic, t = e.response, n = t.id;\n                if (!f(t)) {\n                  _context10.next = 9;\n                  break;\n                }\n                _context10.next = 7;\n                return _this.sendResult(n, s, t.result);\n              case 7:\n                _context10.next = 13;\n                break;\n              case 9:\n                _context10.t0 = v(t);\n                if (!_context10.t0) {\n                  _context10.next = 13;\n                  break;\n                }\n                _context10.next = 13;\n                return _this.sendError(n, s, t.error);\n              case 13:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10);\n      }));\n      return function (_x9) {\n        return _ref15.apply(this, arguments);\n      };\n    }(), _this.ping = /*#__PURE__*/function () {\n      var _ref16 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee11(e) {\n        var s, t, _R6, n, r, a;\n        return _regeneratorRuntime().wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                _this.isInitialized();\n                _context11.next = 3;\n                return _this.isValidPing(e);\n              case 3:\n                s = e.topic;\n                if (!_this.client.session.keys.includes(s)) {\n                  _context11.next = 17;\n                  break;\n                }\n                _context11.next = 7;\n                return _this.sendRequest(s, \"wc_sessionPing\", {});\n              case 7:\n                t = _context11.sent;\n                _R6 = R();\n                n = _R6.done;\n                r = _R6.resolve;\n                a = _R6.reject;\n                _this.events.once(p(\"session_ping\", t), function (_ref17) {\n                  var l = _ref17.error;\n                  l ? a(l) : r();\n                });\n                _context11.next = 15;\n                return n();\n              case 15:\n                _context11.next = 21;\n                break;\n              case 17:\n                _context11.t0 = _this.client.core.pairing.pairings.keys.includes(s);\n                if (!_context11.t0) {\n                  _context11.next = 21;\n                  break;\n                }\n                _context11.next = 21;\n                return _this.client.core.pairing.ping({\n                  topic: s\n                });\n              case 21:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11);\n      }));\n      return function (_x10) {\n        return _ref16.apply(this, arguments);\n      };\n    }(), _this.emit = /*#__PURE__*/function () {\n      var _ref18 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee12(e) {\n        var s, t, n;\n        return _regeneratorRuntime().wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                _this.isInitialized();\n                _context12.next = 3;\n                return _this.isValidEmit(e);\n              case 3:\n                s = e.topic, t = e.event, n = e.chainId;\n                _context12.next = 6;\n                return _this.sendRequest(s, \"wc_sessionEvent\", {\n                  event: t,\n                  chainId: n\n                });\n              case 6:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12);\n      }));\n      return function (_x11) {\n        return _ref18.apply(this, arguments);\n      };\n    }(), _this.disconnect = /*#__PURE__*/function () {\n      var _ref19 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee13(e) {\n        var s;\n        return _regeneratorRuntime().wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                _this.isInitialized();\n                _context13.next = 3;\n                return _this.isValidDisconnect(e);\n              case 3:\n                s = e.topic;\n                if (!_this.client.session.keys.includes(s)) {\n                  _context13.next = 11;\n                  break;\n                }\n                _context13.next = 7;\n                return _this.sendRequest(s, \"wc_sessionDelete\", I(\"USER_DISCONNECTED\"));\n              case 7:\n                _context13.next = 9;\n                return _this.deleteSession(s);\n              case 9:\n                _context13.next = 13;\n                break;\n              case 11:\n                _context13.next = 13;\n                return _this.client.core.pairing.disconnect({\n                  topic: s\n                });\n              case 13:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13);\n      }));\n      return function (_x12) {\n        return _ref19.apply(this, arguments);\n      };\n    }(), _this.find = function (e) {\n      return _this.isInitialized(), _this.client.session.getAll().filter(function (s) {\n        return de(s, e);\n      });\n    }, _this.deleteSession = /*#__PURE__*/function () {\n      var _ref20 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee14(e, s) {\n        var _this$client$session$, t;\n        return _regeneratorRuntime().wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                _this$client$session$ = _this.client.session.get(e), t = _this$client$session$.self;\n                _context14.next = 3;\n                return _this.client.core.relayer.unsubscribe(e);\n              case 3:\n                _context14.next = 5;\n                return Promise.all([_this.client.session.delete(e, I(\"USER_DISCONNECTED\")), _this.client.core.crypto.deleteKeyPair(t.publicKey), _this.client.core.crypto.deleteSymKey(e), s ? Promise.resolve() : _this.client.core.expirer.del(e)]);\n              case 5:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14);\n      }));\n      return function (_x13, _x14) {\n        return _ref20.apply(this, arguments);\n      };\n    }(), _this.deleteProposal = /*#__PURE__*/function () {\n      var _ref21 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee15(e, s) {\n        return _regeneratorRuntime().wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                _context15.next = 2;\n                return Promise.all([_this.client.proposal.delete(e, I(\"USER_DISCONNECTED\")), s ? Promise.resolve() : _this.client.core.expirer.del(e)]);\n              case 2:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15);\n      }));\n      return function (_x15, _x16) {\n        return _ref21.apply(this, arguments);\n      };\n    }(), _this.setExpiry = /*#__PURE__*/function () {\n      var _ref22 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee16(e, s) {\n        return _regeneratorRuntime().wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                _context16.t0 = _this.client.session.keys.includes(e);\n                if (!_context16.t0) {\n                  _context16.next = 4;\n                  break;\n                }\n                _context16.next = 4;\n                return _this.client.session.update(e, {\n                  expiry: s\n                });\n              case 4:\n                _this.client.core.expirer.set(e, s);\n              case 5:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16);\n      }));\n      return function (_x17, _x18) {\n        return _ref22.apply(this, arguments);\n      };\n    }(), _this.setProposal = /*#__PURE__*/function () {\n      var _ref23 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee17(e, s) {\n        return _regeneratorRuntime().wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                _context17.next = 2;\n                return _this.client.proposal.set(e, s);\n              case 2:\n                _this.client.core.expirer.set(e, s.expiry);\n              case 3:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17);\n      }));\n      return function (_x19, _x20) {\n        return _ref23.apply(this, arguments);\n      };\n    }(), _this.sendRequest = /*#__PURE__*/function () {\n      var _ref24 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee18(e, s, t) {\n        var n, r, a;\n        return _regeneratorRuntime().wrap(function _callee18$(_context18) {\n          while (1) {\n            switch (_context18.prev = _context18.next) {\n              case 0:\n                n = Te(s, t);\n                _context18.next = 3;\n                return _this.client.core.crypto.encode(e, n);\n              case 3:\n                r = _context18.sent;\n                a = L[s].req;\n                return _context18.abrupt(\"return\", (_this.client.core.history.set(e, n), _this.client.core.relayer.publish(e, r, a), n.id));\n              case 6:\n              case \"end\":\n                return _context18.stop();\n            }\n          }\n        }, _callee18);\n      }));\n      return function (_x21, _x22, _x23) {\n        return _ref24.apply(this, arguments);\n      };\n    }(), _this.sendResult = /*#__PURE__*/function () {\n      var _ref25 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee19(e, s, t) {\n        var n, r, a, l;\n        return _regeneratorRuntime().wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                n = xe(e, t);\n                _context19.next = 3;\n                return _this.client.core.crypto.encode(s, n);\n              case 3:\n                r = _context19.sent;\n                _context19.next = 6;\n                return _this.client.core.history.get(s, e);\n              case 6:\n                a = _context19.sent;\n                l = L[a.request.method].res;\n                _context19.next = 10;\n                return _this.client.core.relayer.publish(s, r, l);\n              case 10:\n                _context19.next = 12;\n                return _this.client.core.history.resolve(n);\n              case 12:\n              case \"end\":\n                return _context19.stop();\n            }\n          }\n        }, _callee19);\n      }));\n      return function (_x24, _x25, _x26) {\n        return _ref25.apply(this, arguments);\n      };\n    }(), _this.sendError = /*#__PURE__*/function () {\n      var _ref26 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee20(e, s, t) {\n        var n, r, a, l;\n        return _regeneratorRuntime().wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                n = Le(e, t);\n                _context20.next = 3;\n                return _this.client.core.crypto.encode(s, n);\n              case 3:\n                r = _context20.sent;\n                _context20.next = 6;\n                return _this.client.core.history.get(s, e);\n              case 6:\n                a = _context20.sent;\n                l = L[a.request.method].res;\n                _context20.next = 10;\n                return _this.client.core.relayer.publish(s, r, l);\n              case 10:\n                _context20.next = 12;\n                return _this.client.core.history.resolve(n);\n              case 12:\n              case \"end\":\n                return _context20.stop();\n            }\n          }\n        }, _callee20);\n      }));\n      return function (_x27, _x28, _x29) {\n        return _ref26.apply(this, arguments);\n      };\n    }(), _this.cleanup = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee21() {\n      var e, s;\n      return _regeneratorRuntime().wrap(function _callee21$(_context21) {\n        while (1) {\n          switch (_context21.prev = _context21.next) {\n            case 0:\n              e = [], s = [];\n              _this.client.session.getAll().forEach(function (t) {\n                V(t.expiry) && e.push(t.topic);\n              });\n              _this.client.proposal.getAll().forEach(function (t) {\n                V(t.expiry) && s.push(t.id);\n              });\n              _context21.next = 5;\n              return Promise.all([].concat(_toConsumableArray(e.map(function (t) {\n                return _this.deleteSession(t);\n              })), _toConsumableArray(s.map(function (t) {\n                return _this.deleteProposal(t);\n              }))));\n            case 5:\n            case \"end\":\n              return _context21.stop();\n          }\n        }\n      }, _callee21);\n    })), _this.onRelayEventRequest = function (e) {\n      var s = e.topic,\n        t = e.payload,\n        n = t.method;\n      switch (n) {\n        case \"wc_sessionPropose\":\n          return _this.onSessionProposeRequest(s, t);\n        case \"wc_sessionSettle\":\n          return _this.onSessionSettleRequest(s, t);\n        case \"wc_sessionUpdate\":\n          return _this.onSessionUpdateRequest(s, t);\n        case \"wc_sessionExtend\":\n          return _this.onSessionExtendRequest(s, t);\n        case \"wc_sessionPing\":\n          return _this.onSessionPingRequest(s, t);\n        case \"wc_sessionDelete\":\n          return _this.onSessionDeleteRequest(s, t);\n        case \"wc_sessionRequest\":\n          return _this.onSessionRequest(s, t);\n        case \"wc_sessionEvent\":\n          return _this.onSessionEventRequest(s, t);\n        default:\n          return _this.client.logger.info(\"Unsupported request method \".concat(n));\n      }\n    }, _this.onRelayEventResponse = /*#__PURE__*/function () {\n      var _ref28 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee22(e) {\n        var s, t, n;\n        return _regeneratorRuntime().wrap(function _callee22$(_context22) {\n          while (1) {\n            switch (_context22.prev = _context22.next) {\n              case 0:\n                s = e.topic;\n                t = e.payload;\n                _context22.next = 4;\n                return _this.client.core.history.get(s, t.id);\n              case 4:\n                n = _context22.sent.request.method;\n                _context22.t0 = n;\n                _context22.next = _context22.t0 === \"wc_sessionPropose\" ? 8 : _context22.t0 === \"wc_sessionSettle\" ? 9 : _context22.t0 === \"wc_sessionUpdate\" ? 10 : _context22.t0 === \"wc_sessionExtend\" ? 11 : _context22.t0 === \"wc_sessionPing\" ? 12 : _context22.t0 === \"wc_sessionRequest\" ? 13 : 14;\n                break;\n              case 8:\n                return _context22.abrupt(\"return\", _this.onSessionProposeResponse(s, t));\n              case 9:\n                return _context22.abrupt(\"return\", _this.onSessionSettleResponse(s, t));\n              case 10:\n                return _context22.abrupt(\"return\", _this.onSessionUpdateResponse(s, t));\n              case 11:\n                return _context22.abrupt(\"return\", _this.onSessionExtendResponse(s, t));\n              case 12:\n                return _context22.abrupt(\"return\", _this.onSessionPingResponse(s, t));\n              case 13:\n                return _context22.abrupt(\"return\", _this.onSessionRequestResponse(s, t));\n              case 14:\n                return _context22.abrupt(\"return\", _this.client.logger.info(\"Unsupported response method \".concat(n)));\n              case 15:\n              case \"end\":\n                return _context22.stop();\n            }\n          }\n        }, _callee22);\n      }));\n      return function (_x30) {\n        return _ref28.apply(this, arguments);\n      };\n    }(), _this.onSessionProposeRequest = /*#__PURE__*/function () {\n      var _ref29 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee23(e, s) {\n        var t, n, r, a;\n        return _regeneratorRuntime().wrap(function _callee23$(_context23) {\n          while (1) {\n            switch (_context23.prev = _context23.next) {\n              case 0:\n                t = s.params, n = s.id;\n                _context23.prev = 1;\n                _this.isValidConnect(S({}, s.params));\n                r = N(_), a = S({\n                  id: n,\n                  pairingTopic: e,\n                  expiry: r\n                }, t);\n                _context23.next = 6;\n                return _this.setProposal(n, a);\n              case 6:\n                _this.client.events.emit(\"session_proposal\", {\n                  id: n,\n                  params: a\n                });\n                _context23.next = 14;\n                break;\n              case 9:\n                _context23.prev = 9;\n                _context23.t0 = _context23[\"catch\"](1);\n                _context23.next = 13;\n                return _this.sendError(n, e, _context23.t0);\n              case 13:\n                _this.client.logger.error(_context23.t0);\n              case 14:\n              case \"end\":\n                return _context23.stop();\n            }\n          }\n        }, _callee23, null, [[1, 9]]);\n      }));\n      return function (_x31, _x32) {\n        return _ref29.apply(this, arguments);\n      };\n    }(), _this.onSessionProposeResponse = /*#__PURE__*/function () {\n      var _ref30 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee24(e, s) {\n        var t, n, r, a, l, h, u;\n        return _regeneratorRuntime().wrap(function _callee24$(_context24) {\n          while (1) {\n            switch (_context24.prev = _context24.next) {\n              case 0:\n                t = s.id;\n                if (!f(s)) {\n                  _context24.next = 22;\n                  break;\n                }\n                n = s.result;\n                _this.client.logger.trace({\n                  type: \"method\",\n                  method: \"onSessionProposeResponse\",\n                  result: n\n                });\n                r = _this.client.proposal.get(t);\n                _this.client.logger.trace({\n                  type: \"method\",\n                  method: \"onSessionProposeResponse\",\n                  proposal: r\n                });\n                a = r.proposer.publicKey;\n                _this.client.logger.trace({\n                  type: \"method\",\n                  method: \"onSessionProposeResponse\",\n                  selfPublicKey: a\n                });\n                l = n.responderPublicKey;\n                _this.client.logger.trace({\n                  type: \"method\",\n                  method: \"onSessionProposeResponse\",\n                  peerPublicKey: l\n                });\n                _context24.next = 12;\n                return _this.client.core.crypto.generateSharedKey(a, l);\n              case 12:\n                h = _context24.sent;\n                _this.client.logger.trace({\n                  type: \"method\",\n                  method: \"onSessionProposeResponse\",\n                  sessionTopic: h\n                });\n                _context24.next = 16;\n                return _this.client.core.relayer.subscribe(h);\n              case 16:\n                u = _context24.sent;\n                _this.client.logger.trace({\n                  type: \"method\",\n                  method: \"onSessionProposeResponse\",\n                  subscriptionId: u\n                });\n                _context24.next = 20;\n                return _this.client.core.pairing.activate({\n                  topic: e\n                });\n              case 20:\n                _context24.next = 27;\n                break;\n              case 22:\n                _context24.t0 = v(s);\n                if (!_context24.t0) {\n                  _context24.next = 27;\n                  break;\n                }\n                _context24.next = 26;\n                return _this.client.proposal.delete(t, I(\"USER_DISCONNECTED\"));\n              case 26:\n                _this.events.emit(p(\"session_connect\"), {\n                  error: s.error\n                });\n              case 27:\n              case \"end\":\n                return _context24.stop();\n            }\n          }\n        }, _callee24);\n      }));\n      return function (_x33, _x34) {\n        return _ref30.apply(this, arguments);\n      };\n    }(), _this.onSessionSettleRequest = /*#__PURE__*/function () {\n      var _ref31 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee25(e, s) {\n        var t, n, _s$params, r, a, l, h, u;\n        return _regeneratorRuntime().wrap(function _callee25$(_context25) {\n          while (1) {\n            switch (_context25.prev = _context25.next) {\n              case 0:\n                t = s.id, n = s.params;\n                _context25.prev = 1;\n                _this.isValidSessionSettleRequest(n);\n                _s$params = s.params, r = _s$params.relay, a = _s$params.controller, l = _s$params.expiry, h = _s$params.namespaces, u = {\n                  topic: e,\n                  relay: r,\n                  expiry: l,\n                  namespaces: h,\n                  acknowledged: !0,\n                  controller: a.publicKey,\n                  self: {\n                    publicKey: \"\",\n                    metadata: _this.client.metadata\n                  },\n                  peer: {\n                    publicKey: a.publicKey,\n                    metadata: a.metadata\n                  }\n                };\n                _context25.next = 6;\n                return _this.sendResult(s.id, e, !0);\n              case 6:\n                _this.events.emit(p(\"session_connect\"), {\n                  session: u\n                });\n                _context25.next = 14;\n                break;\n              case 9:\n                _context25.prev = 9;\n                _context25.t0 = _context25[\"catch\"](1);\n                _context25.next = 13;\n                return _this.sendError(t, e, _context25.t0);\n              case 13:\n                _this.client.logger.error(_context25.t0);\n              case 14:\n              case \"end\":\n                return _context25.stop();\n            }\n          }\n        }, _callee25, null, [[1, 9]]);\n      }));\n      return function (_x35, _x36) {\n        return _ref31.apply(this, arguments);\n      };\n    }(), _this.onSessionSettleResponse = /*#__PURE__*/function () {\n      var _ref32 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee26(e, s) {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee26$(_context26) {\n          while (1) {\n            switch (_context26.prev = _context26.next) {\n              case 0:\n                t = s.id;\n                if (!f(s)) {\n                  _context26.next = 7;\n                  break;\n                }\n                _context26.next = 4;\n                return _this.client.session.update(e, {\n                  acknowledged: !0\n                });\n              case 4:\n                _this.events.emit(p(\"session_approve\", t), {});\n                _context26.next = 12;\n                break;\n              case 7:\n                _context26.t0 = v(s);\n                if (!_context26.t0) {\n                  _context26.next = 12;\n                  break;\n                }\n                _context26.next = 11;\n                return _this.client.session.delete(e, I(\"USER_DISCONNECTED\"));\n              case 11:\n                _this.events.emit(p(\"session_approve\", t), {\n                  error: s.error\n                });\n              case 12:\n              case \"end\":\n                return _context26.stop();\n            }\n          }\n        }, _callee26);\n      }));\n      return function (_x37, _x38) {\n        return _ref32.apply(this, arguments);\n      };\n    }(), _this.onSessionUpdateRequest = /*#__PURE__*/function () {\n      var _ref33 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee27(e, s) {\n        var t, n;\n        return _regeneratorRuntime().wrap(function _callee27$(_context27) {\n          while (1) {\n            switch (_context27.prev = _context27.next) {\n              case 0:\n                t = s.params, n = s.id;\n                _context27.prev = 1;\n                _this.isValidUpdate(S({\n                  topic: e\n                }, t));\n                _context27.next = 5;\n                return _this.client.session.update(e, {\n                  namespaces: t.namespaces\n                });\n              case 5:\n                _context27.next = 7;\n                return _this.sendResult(n, e, !0);\n              case 7:\n                _this.client.events.emit(\"session_update\", {\n                  id: n,\n                  topic: e,\n                  params: t\n                });\n                _context27.next = 15;\n                break;\n              case 10:\n                _context27.prev = 10;\n                _context27.t0 = _context27[\"catch\"](1);\n                _context27.next = 14;\n                return _this.sendError(n, e, _context27.t0);\n              case 14:\n                _this.client.logger.error(_context27.t0);\n              case 15:\n              case \"end\":\n                return _context27.stop();\n            }\n          }\n        }, _callee27, null, [[1, 10]]);\n      }));\n      return function (_x39, _x40) {\n        return _ref33.apply(this, arguments);\n      };\n    }(), _this.onSessionUpdateResponse = function (e, s) {\n      var t = s.id;\n      f(s) ? _this.events.emit(p(\"session_update\", t), {}) : v(s) && _this.events.emit(p(\"session_update\", t), {\n        error: s.error\n      });\n    }, _this.onSessionExtendRequest = /*#__PURE__*/function () {\n      var _ref34 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee28(e, s) {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee28$(_context28) {\n          while (1) {\n            switch (_context28.prev = _context28.next) {\n              case 0:\n                t = s.id;\n                _context28.prev = 1;\n                _this.isValidExtend({\n                  topic: e\n                });\n                _context28.next = 5;\n                return _this.setExpiry(e, N(x));\n              case 5:\n                _context28.next = 7;\n                return _this.sendResult(t, e, !0);\n              case 7:\n                _this.client.events.emit(\"session_extend\", {\n                  id: t,\n                  topic: e\n                });\n                _context28.next = 15;\n                break;\n              case 10:\n                _context28.prev = 10;\n                _context28.t0 = _context28[\"catch\"](1);\n                _context28.next = 14;\n                return _this.sendError(t, e, _context28.t0);\n              case 14:\n                _this.client.logger.error(_context28.t0);\n              case 15:\n              case \"end\":\n                return _context28.stop();\n            }\n          }\n        }, _callee28, null, [[1, 10]]);\n      }));\n      return function (_x41, _x42) {\n        return _ref34.apply(this, arguments);\n      };\n    }(), _this.onSessionExtendResponse = function (e, s) {\n      var t = s.id;\n      f(s) ? _this.events.emit(p(\"session_extend\", t), {}) : v(s) && _this.events.emit(p(\"session_extend\", t), {\n        error: s.error\n      });\n    }, _this.onSessionPingRequest = /*#__PURE__*/function () {\n      var _ref35 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee29(e, s) {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee29$(_context29) {\n          while (1) {\n            switch (_context29.prev = _context29.next) {\n              case 0:\n                t = s.id;\n                _context29.prev = 1;\n                _this.isValidPing({\n                  topic: e\n                });\n                _context29.next = 5;\n                return _this.sendResult(t, e, !0);\n              case 5:\n                _this.client.events.emit(\"session_ping\", {\n                  id: t,\n                  topic: e\n                });\n                _context29.next = 13;\n                break;\n              case 8:\n                _context29.prev = 8;\n                _context29.t0 = _context29[\"catch\"](1);\n                _context29.next = 12;\n                return _this.sendError(t, e, _context29.t0);\n              case 12:\n                _this.client.logger.error(_context29.t0);\n              case 13:\n              case \"end\":\n                return _context29.stop();\n            }\n          }\n        }, _callee29, null, [[1, 8]]);\n      }));\n      return function (_x43, _x44) {\n        return _ref35.apply(this, arguments);\n      };\n    }(), _this.onSessionPingResponse = function (e, s) {\n      var t = s.id;\n      setTimeout(function () {\n        f(s) ? _this.events.emit(p(\"session_ping\", t), {}) : v(s) && _this.events.emit(p(\"session_ping\", t), {\n          error: s.error\n        });\n      }, 500);\n    }, _this.onSessionDeleteRequest = /*#__PURE__*/function () {\n      var _ref36 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee30(e, s) {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee30$(_context30) {\n          while (1) {\n            switch (_context30.prev = _context30.next) {\n              case 0:\n                t = s.id;\n                _context30.prev = 1;\n                _this.isValidDisconnect({\n                  topic: e,\n                  reason: s.params\n                });\n                _context30.next = 5;\n                return _this.sendResult(t, e, !0);\n              case 5:\n                _context30.next = 7;\n                return _this.deleteSession(e);\n              case 7:\n                _this.client.events.emit(\"session_delete\", {\n                  id: t,\n                  topic: e\n                });\n                _context30.next = 15;\n                break;\n              case 10:\n                _context30.prev = 10;\n                _context30.t0 = _context30[\"catch\"](1);\n                _context30.next = 14;\n                return _this.sendError(t, e, _context30.t0);\n              case 14:\n                _this.client.logger.error(_context30.t0);\n              case 15:\n              case \"end\":\n                return _context30.stop();\n            }\n          }\n        }, _callee30, null, [[1, 10]]);\n      }));\n      return function (_x45, _x46) {\n        return _ref36.apply(this, arguments);\n      };\n    }(), _this.onSessionRequest = /*#__PURE__*/function () {\n      var _ref37 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee31(e, s) {\n        var t, n;\n        return _regeneratorRuntime().wrap(function _callee31$(_context31) {\n          while (1) {\n            switch (_context31.prev = _context31.next) {\n              case 0:\n                t = s.id, n = s.params;\n                _context31.prev = 1;\n                _this.isValidRequest(S({\n                  topic: e\n                }, n)), _this.client.events.emit(\"session_request\", {\n                  id: t,\n                  topic: e,\n                  params: n\n                });\n                _context31.next = 10;\n                break;\n              case 5:\n                _context31.prev = 5;\n                _context31.t0 = _context31[\"catch\"](1);\n                _context31.next = 9;\n                return _this.sendError(t, e, _context31.t0);\n              case 9:\n                _this.client.logger.error(_context31.t0);\n              case 10:\n              case \"end\":\n                return _context31.stop();\n            }\n          }\n        }, _callee31, null, [[1, 5]]);\n      }));\n      return function (_x47, _x48) {\n        return _ref37.apply(this, arguments);\n      };\n    }(), _this.onSessionRequestResponse = function (e, s) {\n      var t = s.id;\n      f(s) ? _this.events.emit(p(\"session_request\", t), {\n        result: s.result\n      }) : v(s) && _this.events.emit(p(\"session_request\", t), {\n        error: s.error\n      });\n    }, _this.onSessionEventRequest = /*#__PURE__*/function () {\n      var _ref38 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee32(e, s) {\n        var t, n;\n        return _regeneratorRuntime().wrap(function _callee32$(_context32) {\n          while (1) {\n            switch (_context32.prev = _context32.next) {\n              case 0:\n                t = s.id, n = s.params;\n                _context32.prev = 1;\n                _this.isValidEmit(S({\n                  topic: e\n                }, n)), _this.client.events.emit(\"session_event\", {\n                  id: t,\n                  topic: e,\n                  params: n\n                });\n                _context32.next = 10;\n                break;\n              case 5:\n                _context32.prev = 5;\n                _context32.t0 = _context32[\"catch\"](1);\n                _context32.next = 9;\n                return _this.sendError(t, e, _context32.t0);\n              case 9:\n                _this.client.logger.error(_context32.t0);\n              case 10:\n              case \"end\":\n                return _context32.stop();\n            }\n          }\n        }, _callee32, null, [[1, 5]]);\n      }));\n      return function (_x49, _x50) {\n        return _ref38.apply(this, arguments);\n      };\n    }(), _this.isValidConnect = /*#__PURE__*/function () {\n      var _ref39 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee33(e) {\n        var _c2, a, s, t, n, r, _c3, _a;\n        return _regeneratorRuntime().wrap(function _callee33$(_context33) {\n          while (1) {\n            switch (_context33.prev = _context33.next) {\n              case 0:\n                if (w(e)) {\n                  _context33.next = 3;\n                  break;\n                }\n                _c2 = c(\"MISSING_OR_INVALID\", \"connect() params: \".concat(JSON.stringify(e))), a = _c2.message;\n                throw new Error(a);\n              case 3:\n                s = e.pairingTopic, t = e.requiredNamespaces, n = e.relays;\n                _context33.t0 = ge(s);\n                if (_context33.t0) {\n                  _context33.next = 8;\n                  break;\n                }\n                _context33.next = 8;\n                return _this.isValidPairingTopic(s);\n              case 8:\n                r = ue(t, \"connect()\");\n                if (!r) {\n                  _context33.next = 11;\n                  break;\n                }\n                throw new Error(r.message);\n              case 11:\n                if (me(n, !0)) {\n                  _context33.next = 14;\n                  break;\n                }\n                _c3 = c(\"MISSING_OR_INVALID\", \"connect() relays: \".concat(n)), _a = _c3.message;\n                throw new Error(_a);\n              case 14:\n              case \"end\":\n                return _context33.stop();\n            }\n          }\n        }, _callee33);\n      }));\n      return function (_x51) {\n        return _ref39.apply(this, arguments);\n      };\n    }(), _this.isValidApprove = /*#__PURE__*/function () {\n      var _ref40 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee34(e) {\n        var s, t, n, r, a, l, _c4, h;\n        return _regeneratorRuntime().wrap(function _callee34$(_context34) {\n          while (1) {\n            switch (_context34.prev = _context34.next) {\n              case 0:\n                if (w(e)) {\n                  _context34.next = 2;\n                  break;\n                }\n                throw new Error(c(\"MISSING_OR_INVALID\", \"approve() params: \".concat(e)).message);\n              case 2:\n                s = e.id, t = e.namespaces, n = e.relayProtocol;\n                _context34.next = 5;\n                return _this.isValidProposalId(s);\n              case 5:\n                r = _this.client.proposal.get(s), a = $(t, \"approve()\");\n                if (!a) {\n                  _context34.next = 8;\n                  break;\n                }\n                throw new Error(a.message);\n              case 8:\n                l = Y(r.requiredNamespaces, t, \"update()\");\n                if (!l) {\n                  _context34.next = 11;\n                  break;\n                }\n                throw new Error(l.message);\n              case 11:\n                if (b(n, !0)) {\n                  _context34.next = 14;\n                  break;\n                }\n                _c4 = c(\"MISSING_OR_INVALID\", \"approve() relayProtocol: \".concat(n)), h = _c4.message;\n                throw new Error(h);\n              case 14:\n              case \"end\":\n                return _context34.stop();\n            }\n          }\n        }, _callee34);\n      }));\n      return function (_x52) {\n        return _ref40.apply(this, arguments);\n      };\n    }(), _this.isValidReject = /*#__PURE__*/function () {\n      var _ref41 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee35(e) {\n        var _c5, n, s, t, _c6, _n;\n        return _regeneratorRuntime().wrap(function _callee35$(_context35) {\n          while (1) {\n            switch (_context35.prev = _context35.next) {\n              case 0:\n                if (w(e)) {\n                  _context35.next = 3;\n                  break;\n                }\n                _c5 = c(\"MISSING_OR_INVALID\", \"reject() params: \".concat(e)), n = _c5.message;\n                throw new Error(n);\n              case 3:\n                s = e.id, t = e.reason;\n                _context35.next = 6;\n                return _this.isValidProposalId(s);\n              case 6:\n                if (we(t)) {\n                  _context35.next = 9;\n                  break;\n                }\n                _c6 = c(\"MISSING_OR_INVALID\", \"reject() reason: \".concat(JSON.stringify(t))), _n = _c6.message;\n                throw new Error(_n);\n              case 9:\n              case \"end\":\n                return _context35.stop();\n            }\n          }\n        }, _callee35);\n      }));\n      return function (_x53) {\n        return _ref41.apply(this, arguments);\n      };\n    }(), _this.isValidSessionSettleRequest = function (e) {\n      if (!w(e)) {\n        var _c7 = c(\"MISSING_OR_INVALID\", \"onSessionSettleRequest() params: \".concat(e)),\n          h = _c7.message;\n        throw new Error(h);\n      }\n      var s = e.relay,\n        t = e.controller,\n        n = e.namespaces,\n        r = e.expiry;\n      if (!_e(s)) {\n        var _c8 = c(\"MISSING_OR_INVALID\", \"onSessionSettleRequest() relay protocol should be a string\"),\n          _h = _c8.message;\n        throw new Error(_h);\n      }\n      var a = ye(t, \"onSessionSettleRequest()\");\n      if (a) throw new Error(a.message);\n      var l = $(n, \"onSessionSettleRequest()\");\n      if (l) throw new Error(l.message);\n      if (V(r)) {\n        var _c9 = c(\"EXPIRED\", \"onSessionSettleRequest()\"),\n          _h2 = _c9.message;\n        throw new Error(_h2);\n      }\n    }, _this.isValidUpdate = /*#__PURE__*/function () {\n      var _ref42 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee36(e) {\n        var _c10, l, s, t, n, r, a;\n        return _regeneratorRuntime().wrap(function _callee36$(_context36) {\n          while (1) {\n            switch (_context36.prev = _context36.next) {\n              case 0:\n                if (w(e)) {\n                  _context36.next = 3;\n                  break;\n                }\n                _c10 = c(\"MISSING_OR_INVALID\", \"update() params: \".concat(e)), l = _c10.message;\n                throw new Error(l);\n              case 3:\n                s = e.topic, t = e.namespaces;\n                _context36.next = 6;\n                return _this.isValidSessionTopic(s);\n              case 6:\n                n = _this.client.session.get(s), r = $(t, \"update()\");\n                if (!r) {\n                  _context36.next = 9;\n                  break;\n                }\n                throw new Error(r.message);\n              case 9:\n                a = Y(n.requiredNamespaces, t, \"update()\");\n                if (!a) {\n                  _context36.next = 12;\n                  break;\n                }\n                throw new Error(a.message);\n              case 12:\n              case \"end\":\n                return _context36.stop();\n            }\n          }\n        }, _callee36);\n      }));\n      return function (_x54) {\n        return _ref42.apply(this, arguments);\n      };\n    }(), _this.isValidExtend = /*#__PURE__*/function () {\n      var _ref43 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee37(e) {\n        var _c11, t, s;\n        return _regeneratorRuntime().wrap(function _callee37$(_context37) {\n          while (1) {\n            switch (_context37.prev = _context37.next) {\n              case 0:\n                if (w(e)) {\n                  _context37.next = 3;\n                  break;\n                }\n                _c11 = c(\"MISSING_OR_INVALID\", \"extend() params: \".concat(e)), t = _c11.message;\n                throw new Error(t);\n              case 3:\n                s = e.topic;\n                _context37.next = 6;\n                return _this.isValidSessionTopic(s);\n              case 6:\n              case \"end\":\n                return _context37.stop();\n            }\n          }\n        }, _callee37);\n      }));\n      return function (_x55) {\n        return _ref43.apply(this, arguments);\n      };\n    }(), _this.isValidRequest = /*#__PURE__*/function () {\n      var _ref44 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee38(e) {\n        var _c12, a, s, t, n, _this$client$session$2, r, _c13, _a2, _c14, _a3, _c15, _a4;\n        return _regeneratorRuntime().wrap(function _callee38$(_context38) {\n          while (1) {\n            switch (_context38.prev = _context38.next) {\n              case 0:\n                if (w(e)) {\n                  _context38.next = 3;\n                  break;\n                }\n                _c12 = c(\"MISSING_OR_INVALID\", \"request() params: \".concat(e)), a = _c12.message;\n                throw new Error(a);\n              case 3:\n                s = e.topic, t = e.request, n = e.chainId;\n                _context38.next = 6;\n                return _this.isValidSessionTopic(s);\n              case 6:\n                _this$client$session$2 = _this.client.session.get(s), r = _this$client$session$2.namespaces;\n                if (J(r, n)) {\n                  _context38.next = 10;\n                  break;\n                }\n                _c13 = c(\"MISSING_OR_INVALID\", \"request() chainId: \".concat(n)), _a2 = _c13.message;\n                throw new Error(_a2);\n              case 10:\n                if (Ee(t)) {\n                  _context38.next = 13;\n                  break;\n                }\n                _c14 = c(\"MISSING_OR_INVALID\", \"request() \".concat(JSON.stringify(t))), _a3 = _c14.message;\n                throw new Error(_a3);\n              case 13:\n                if (Se(r, n, t.method)) {\n                  _context38.next = 16;\n                  break;\n                }\n                _c15 = c(\"MISSING_OR_INVALID\", \"request() method: \".concat(t.method)), _a4 = _c15.message;\n                throw new Error(_a4);\n              case 16:\n              case \"end\":\n                return _context38.stop();\n            }\n          }\n        }, _callee38);\n      }));\n      return function (_x56) {\n        return _ref44.apply(this, arguments);\n      };\n    }(), _this.isValidRespond = /*#__PURE__*/function () {\n      var _ref45 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee39(e) {\n        var _c16, n, s, t, _c17, _n2;\n        return _regeneratorRuntime().wrap(function _callee39$(_context39) {\n          while (1) {\n            switch (_context39.prev = _context39.next) {\n              case 0:\n                if (w(e)) {\n                  _context39.next = 3;\n                  break;\n                }\n                _c16 = c(\"MISSING_OR_INVALID\", \"respond() params: \".concat(e)), n = _c16.message;\n                throw new Error(n);\n              case 3:\n                s = e.topic, t = e.response;\n                _context39.next = 6;\n                return _this.isValidSessionTopic(s);\n              case 6:\n                if (Ie(t)) {\n                  _context39.next = 9;\n                  break;\n                }\n                _c17 = c(\"MISSING_OR_INVALID\", \"respond() response: \".concat(JSON.stringify(t))), _n2 = _c17.message;\n                throw new Error(_n2);\n              case 9:\n              case \"end\":\n                return _context39.stop();\n            }\n          }\n        }, _callee39);\n      }));\n      return function (_x57) {\n        return _ref45.apply(this, arguments);\n      };\n    }(), _this.isValidPing = /*#__PURE__*/function () {\n      var _ref46 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee40(e) {\n        var _c18, t, s;\n        return _regeneratorRuntime().wrap(function _callee40$(_context40) {\n          while (1) {\n            switch (_context40.prev = _context40.next) {\n              case 0:\n                if (w(e)) {\n                  _context40.next = 3;\n                  break;\n                }\n                _c18 = c(\"MISSING_OR_INVALID\", \"ping() params: \".concat(e)), t = _c18.message;\n                throw new Error(t);\n              case 3:\n                s = e.topic;\n                _context40.next = 6;\n                return _this.isValidSessionOrPairingTopic(s);\n              case 6:\n              case \"end\":\n                return _context40.stop();\n            }\n          }\n        }, _callee40);\n      }));\n      return function (_x58) {\n        return _ref46.apply(this, arguments);\n      };\n    }(), _this.isValidEmit = /*#__PURE__*/function () {\n      var _ref47 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee41(e) {\n        var _c19, a, s, t, n, _this$client$session$3, r, _c20, _a5, _c21, _a6, _c22, _a7;\n        return _regeneratorRuntime().wrap(function _callee41$(_context41) {\n          while (1) {\n            switch (_context41.prev = _context41.next) {\n              case 0:\n                if (w(e)) {\n                  _context41.next = 3;\n                  break;\n                }\n                _c19 = c(\"MISSING_OR_INVALID\", \"emit() params: \".concat(e)), a = _c19.message;\n                throw new Error(a);\n              case 3:\n                s = e.topic, t = e.event, n = e.chainId;\n                _context41.next = 6;\n                return _this.isValidSessionTopic(s);\n              case 6:\n                _this$client$session$3 = _this.client.session.get(s), r = _this$client$session$3.namespaces;\n                if (J(r, n)) {\n                  _context41.next = 10;\n                  break;\n                }\n                _c20 = c(\"MISSING_OR_INVALID\", \"emit() chainId: \".concat(n)), _a5 = _c20.message;\n                throw new Error(_a5);\n              case 10:\n                if (fe(t)) {\n                  _context41.next = 13;\n                  break;\n                }\n                _c21 = c(\"MISSING_OR_INVALID\", \"emit() event: \".concat(JSON.stringify(t))), _a6 = _c21.message;\n                throw new Error(_a6);\n              case 13:\n                if (ve(r, n, t.name)) {\n                  _context41.next = 16;\n                  break;\n                }\n                _c22 = c(\"MISSING_OR_INVALID\", \"emit() event: \".concat(JSON.stringify(t))), _a7 = _c22.message;\n                throw new Error(_a7);\n              case 16:\n              case \"end\":\n                return _context41.stop();\n            }\n          }\n        }, _callee41);\n      }));\n      return function (_x59) {\n        return _ref47.apply(this, arguments);\n      };\n    }(), _this.isValidDisconnect = /*#__PURE__*/function () {\n      var _ref48 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee42(e) {\n        var _c23, t, s;\n        return _regeneratorRuntime().wrap(function _callee42$(_context42) {\n          while (1) {\n            switch (_context42.prev = _context42.next) {\n              case 0:\n                if (w(e)) {\n                  _context42.next = 3;\n                  break;\n                }\n                _c23 = c(\"MISSING_OR_INVALID\", \"disconnect() params: \".concat(e)), t = _c23.message;\n                throw new Error(t);\n              case 3:\n                s = e.topic;\n                _context42.next = 6;\n                return _this.isValidSessionOrPairingTopic(s);\n              case 6:\n              case \"end\":\n                return _context42.stop();\n            }\n          }\n        }, _callee42);\n      }));\n      return function (_x60) {\n        return _ref48.apply(this, arguments);\n      };\n    }();\n    return _this;\n  }\n  _createClass(Xe, [{\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c24 = c(\"NOT_INITIALIZED\", this.name),\n          i = _c24.message;\n        throw new Error(i);\n      }\n    }\n  }, {\n    key: \"registerRelayerEvents\",\n    value: function registerRelayerEvents() {\n      var _this2 = this;\n      this.client.core.relayer.on(ie.message, /*#__PURE__*/function () {\n        var _ref49 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee43(i) {\n          var e, s, t;\n          return _regeneratorRuntime().wrap(function _callee43$(_context43) {\n            while (1) {\n              switch (_context43.prev = _context43.next) {\n                case 0:\n                  e = i.topic, s = i.message;\n                  if (!_this2.ignoredPayloadTypes.includes(_this2.client.core.crypto.getPayloadType(s))) {\n                    _context43.next = 3;\n                    break;\n                  }\n                  return _context43.abrupt(\"return\");\n                case 3:\n                  _context43.next = 5;\n                  return _this2.client.core.crypto.decode(e, s);\n                case 5:\n                  t = _context43.sent;\n                  if (!De(t)) {\n                    _context43.next = 10;\n                    break;\n                  }\n                  _this2.client.core.history.set(e, t), _this2.onRelayEventRequest({\n                    topic: e,\n                    payload: t\n                  });\n                  _context43.next = 15;\n                  break;\n                case 10:\n                  _context43.t0 = be(t);\n                  if (!_context43.t0) {\n                    _context43.next = 15;\n                    break;\n                  }\n                  _context43.next = 14;\n                  return _this2.client.core.history.resolve(t);\n                case 14:\n                  _this2.onRelayEventResponse({\n                    topic: e,\n                    payload: t\n                  });\n                case 15:\n                case \"end\":\n                  return _context43.stop();\n              }\n            }\n          }, _callee43);\n        }));\n        return function (_x61) {\n          return _ref49.apply(this, arguments);\n        };\n      }());\n    }\n  }, {\n    key: \"registerExpirerEvents\",\n    value: function registerExpirerEvents() {\n      var _this3 = this;\n      this.client.core.expirer.on(ne.expired, /*#__PURE__*/function () {\n        var _ref50 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee44(i) {\n          var _Re, e, s;\n          return _regeneratorRuntime().wrap(function _callee44$(_context44) {\n            while (1) {\n              switch (_context44.prev = _context44.next) {\n                case 0:\n                  _Re = Re(i.target), e = _Re.topic, s = _Re.id;\n                  if (!e) {\n                    _context44.next = 9;\n                    break;\n                  }\n                  _context44.t0 = _this3.client.session.keys.includes(e);\n                  if (!_context44.t0) {\n                    _context44.next = 7;\n                    break;\n                  }\n                  _context44.next = 6;\n                  return _this3.deleteSession(e, !0);\n                case 6:\n                  _this3.client.events.emit(\"session_expire\", {\n                    topic: e\n                  });\n                case 7:\n                  _context44.next = 13;\n                  break;\n                case 9:\n                  _context44.t1 = s;\n                  if (!_context44.t1) {\n                    _context44.next = 13;\n                    break;\n                  }\n                  _context44.next = 13;\n                  return _this3.deleteProposal(s, !0);\n                case 13:\n                case \"end\":\n                  return _context44.stop();\n              }\n            }\n          }, _callee44);\n        }));\n        return function (_x62) {\n          return _ref50.apply(this, arguments);\n        };\n      }());\n    }\n  }, {\n    key: \"isValidPairingTopic\",\n    value: function isValidPairingTopic(i) {\n      if (!b(i, !1)) {\n        var _c25 = c(\"MISSING_OR_INVALID\", \"pairing topic should be a string: \".concat(i)),\n          e = _c25.message;\n        throw new Error(e);\n      }\n      if (!this.client.core.pairing.pairings.keys.includes(i)) {\n        var _c26 = c(\"NO_MATCHING_KEY\", \"pairing topic doesn't exist: \".concat(i)),\n          _e2 = _c26.message;\n        throw new Error(_e2);\n      }\n      if (V(this.client.core.pairing.pairings.get(i).expiry)) {\n        var _c27 = c(\"EXPIRED\", \"pairing topic: \".concat(i)),\n          _e3 = _c27.message;\n        throw new Error(_e3);\n      }\n    }\n  }, {\n    key: \"isValidSessionTopic\",\n    value: function () {\n      var _isValidSessionTopic = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee45(i) {\n        var _c28, e, _c29, _e4, _c30, _e5;\n        return _regeneratorRuntime().wrap(function _callee45$(_context45) {\n          while (1) {\n            switch (_context45.prev = _context45.next) {\n              case 0:\n                if (b(i, !1)) {\n                  _context45.next = 3;\n                  break;\n                }\n                _c28 = c(\"MISSING_OR_INVALID\", \"session topic should be a string: \".concat(i)), e = _c28.message;\n                throw new Error(e);\n              case 3:\n                if (this.client.session.keys.includes(i)) {\n                  _context45.next = 6;\n                  break;\n                }\n                _c29 = c(\"NO_MATCHING_KEY\", \"session topic doesn't exist: \".concat(i)), _e4 = _c29.message;\n                throw new Error(_e4);\n              case 6:\n                if (!V(this.client.session.get(i).expiry)) {\n                  _context45.next = 11;\n                  break;\n                }\n                _context45.next = 9;\n                return this.deleteSession(i);\n              case 9:\n                _c30 = c(\"EXPIRED\", \"session topic: \".concat(i)), _e5 = _c30.message;\n                throw new Error(_e5);\n              case 11:\n              case \"end\":\n                return _context45.stop();\n            }\n          }\n        }, _callee45, this);\n      }));\n      function isValidSessionTopic(_x63) {\n        return _isValidSessionTopic.apply(this, arguments);\n      }\n      return isValidSessionTopic;\n    }()\n  }, {\n    key: \"isValidSessionOrPairingTopic\",\n    value: function () {\n      var _isValidSessionOrPairingTopic = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee46(i) {\n        var _c31, e, _c32, _e6;\n        return _regeneratorRuntime().wrap(function _callee46$(_context46) {\n          while (1) {\n            switch (_context46.prev = _context46.next) {\n              case 0:\n                if (!this.client.session.keys.includes(i)) {\n                  _context46.next = 5;\n                  break;\n                }\n                _context46.next = 3;\n                return this.isValidSessionTopic(i);\n              case 3:\n                _context46.next = 16;\n                break;\n              case 5:\n                if (!this.client.core.pairing.pairings.keys.includes(i)) {\n                  _context46.next = 9;\n                  break;\n                }\n                this.isValidPairingTopic(i);\n                _context46.next = 16;\n                break;\n              case 9:\n                if (!b(i, !1)) {\n                  _context46.next = 14;\n                  break;\n                }\n                _c31 = c(\"NO_MATCHING_KEY\", \"session or pairing topic doesn't exist: \".concat(i)), e = _c31.message;\n                throw new Error(e);\n              case 14:\n                _c32 = c(\"MISSING_OR_INVALID\", \"session or pairing topic should be a string: \".concat(i)), _e6 = _c32.message;\n                throw new Error(_e6);\n              case 16:\n              case \"end\":\n                return _context46.stop();\n            }\n          }\n        }, _callee46, this);\n      }));\n      function isValidSessionOrPairingTopic(_x64) {\n        return _isValidSessionOrPairingTopic.apply(this, arguments);\n      }\n      return isValidSessionOrPairingTopic;\n    }()\n  }, {\n    key: \"isValidProposalId\",\n    value: function () {\n      var _isValidProposalId = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee47(i) {\n        var _c33, e, _c34, _e7, _c35, _e8;\n        return _regeneratorRuntime().wrap(function _callee47$(_context47) {\n          while (1) {\n            switch (_context47.prev = _context47.next) {\n              case 0:\n                if (Ne(i)) {\n                  _context47.next = 3;\n                  break;\n                }\n                _c33 = c(\"MISSING_OR_INVALID\", \"proposal id should be a number: \".concat(i)), e = _c33.message;\n                throw new Error(e);\n              case 3:\n                if (this.client.proposal.keys.includes(i)) {\n                  _context47.next = 6;\n                  break;\n                }\n                _c34 = c(\"NO_MATCHING_KEY\", \"proposal id doesn't exist: \".concat(i)), _e7 = _c34.message;\n                throw new Error(_e7);\n              case 6:\n                if (!V(this.client.proposal.get(i).expiry)) {\n                  _context47.next = 11;\n                  break;\n                }\n                _context47.next = 9;\n                return this.deleteProposal(i);\n              case 9:\n                _c35 = c(\"EXPIRED\", \"proposal id: \".concat(i)), _e8 = _c35.message;\n                throw new Error(_e8);\n              case 11:\n              case \"end\":\n                return _context47.stop();\n            }\n          }\n        }, _callee47, this);\n      }));\n      function isValidProposalId(_x65) {\n        return _isValidProposalId.apply(this, arguments);\n      }\n      return isValidProposalId;\n    }()\n  }]);\n  return Xe;\n}(le);\nvar He = /*#__PURE__*/function (_j) {\n  _inherits(He, _j);\n  var _super2 = _createSuper(He);\n  function He(i, e) {\n    var _this4;\n    _classCallCheck(this, He);\n    _this4 = _super2.call(this, i, e, Z, z), _this4.core = i, _this4.logger = e;\n    return _this4;\n  }\n  return _createClass(He);\n}(j);\nvar Fe = /*#__PURE__*/function (_j2) {\n  _inherits(Fe, _j2);\n  var _super3 = _createSuper(Fe);\n  function Fe(i, e) {\n    var _this5;\n    _classCallCheck(this, Fe);\n    _this5 = _super3.call(this, i, e, B, z), _this5.core = i, _this5.logger = e;\n    return _this5;\n  }\n  return _createClass(Fe);\n}(j);\nvar C = /*#__PURE__*/function (_he) {\n  _inherits(C, _he);\n  var _super4 = _createSuper(C);\n  function C(i) {\n    var _this6;\n    _classCallCheck(this, C);\n    _this6 = _super4.call(this, i), _this6.protocol = U, _this6.version = K, _this6.name = A.name, _this6.events = new H.EventEmitter(), _this6.on = function (s, t) {\n      return _this6.events.on(s, t);\n    }, _this6.once = function (s, t) {\n      return _this6.events.once(s, t);\n    }, _this6.off = function (s, t) {\n      return _this6.events.off(s, t);\n    }, _this6.removeListener = function (s, t) {\n      return _this6.events.removeListener(s, t);\n    }, _this6.connect = /*#__PURE__*/function () {\n      var _ref51 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee48(s) {\n        return _regeneratorRuntime().wrap(function _callee48$(_context48) {\n          while (1) {\n            switch (_context48.prev = _context48.next) {\n              case 0:\n                _context48.prev = 0;\n                _context48.next = 3;\n                return _this6.engine.connect(s);\n              case 3:\n                return _context48.abrupt(\"return\", _context48.sent);\n              case 6:\n                _context48.prev = 6;\n                _context48.t0 = _context48[\"catch\"](0);\n                throw _this6.logger.error(_context48.t0.message), _context48.t0;\n              case 9:\n              case \"end\":\n                return _context48.stop();\n            }\n          }\n        }, _callee48, null, [[0, 6]]);\n      }));\n      return function (_x66) {\n        return _ref51.apply(this, arguments);\n      };\n    }(), _this6.pair = /*#__PURE__*/function () {\n      var _ref52 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee49(s) {\n        return _regeneratorRuntime().wrap(function _callee49$(_context49) {\n          while (1) {\n            switch (_context49.prev = _context49.next) {\n              case 0:\n                _context49.prev = 0;\n                _context49.next = 3;\n                return _this6.engine.pair(s);\n              case 3:\n                return _context49.abrupt(\"return\", _context49.sent);\n              case 6:\n                _context49.prev = 6;\n                _context49.t0 = _context49[\"catch\"](0);\n                throw _this6.logger.error(_context49.t0.message), _context49.t0;\n              case 9:\n              case \"end\":\n                return _context49.stop();\n            }\n          }\n        }, _callee49, null, [[0, 6]]);\n      }));\n      return function (_x67) {\n        return _ref52.apply(this, arguments);\n      };\n    }(), _this6.approve = /*#__PURE__*/function () {\n      var _ref53 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee50(s) {\n        return _regeneratorRuntime().wrap(function _callee50$(_context50) {\n          while (1) {\n            switch (_context50.prev = _context50.next) {\n              case 0:\n                _context50.prev = 0;\n                _context50.next = 3;\n                return _this6.engine.approve(s);\n              case 3:\n                return _context50.abrupt(\"return\", _context50.sent);\n              case 6:\n                _context50.prev = 6;\n                _context50.t0 = _context50[\"catch\"](0);\n                throw _this6.logger.error(_context50.t0.message), _context50.t0;\n              case 9:\n              case \"end\":\n                return _context50.stop();\n            }\n          }\n        }, _callee50, null, [[0, 6]]);\n      }));\n      return function (_x68) {\n        return _ref53.apply(this, arguments);\n      };\n    }(), _this6.reject = /*#__PURE__*/function () {\n      var _ref54 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee51(s) {\n        return _regeneratorRuntime().wrap(function _callee51$(_context51) {\n          while (1) {\n            switch (_context51.prev = _context51.next) {\n              case 0:\n                _context51.prev = 0;\n                _context51.next = 3;\n                return _this6.engine.reject(s);\n              case 3:\n                return _context51.abrupt(\"return\", _context51.sent);\n              case 6:\n                _context51.prev = 6;\n                _context51.t0 = _context51[\"catch\"](0);\n                throw _this6.logger.error(_context51.t0.message), _context51.t0;\n              case 9:\n              case \"end\":\n                return _context51.stop();\n            }\n          }\n        }, _callee51, null, [[0, 6]]);\n      }));\n      return function (_x69) {\n        return _ref54.apply(this, arguments);\n      };\n    }(), _this6.update = /*#__PURE__*/function () {\n      var _ref55 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee52(s) {\n        return _regeneratorRuntime().wrap(function _callee52$(_context52) {\n          while (1) {\n            switch (_context52.prev = _context52.next) {\n              case 0:\n                _context52.prev = 0;\n                _context52.next = 3;\n                return _this6.engine.update(s);\n              case 3:\n                return _context52.abrupt(\"return\", _context52.sent);\n              case 6:\n                _context52.prev = 6;\n                _context52.t0 = _context52[\"catch\"](0);\n                throw _this6.logger.error(_context52.t0.message), _context52.t0;\n              case 9:\n              case \"end\":\n                return _context52.stop();\n            }\n          }\n        }, _callee52, null, [[0, 6]]);\n      }));\n      return function (_x70) {\n        return _ref55.apply(this, arguments);\n      };\n    }(), _this6.extend = /*#__PURE__*/function () {\n      var _ref56 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee53(s) {\n        return _regeneratorRuntime().wrap(function _callee53$(_context53) {\n          while (1) {\n            switch (_context53.prev = _context53.next) {\n              case 0:\n                _context53.prev = 0;\n                _context53.next = 3;\n                return _this6.engine.extend(s);\n              case 3:\n                return _context53.abrupt(\"return\", _context53.sent);\n              case 6:\n                _context53.prev = 6;\n                _context53.t0 = _context53[\"catch\"](0);\n                throw _this6.logger.error(_context53.t0.message), _context53.t0;\n              case 9:\n              case \"end\":\n                return _context53.stop();\n            }\n          }\n        }, _callee53, null, [[0, 6]]);\n      }));\n      return function (_x71) {\n        return _ref56.apply(this, arguments);\n      };\n    }(), _this6.request = /*#__PURE__*/function () {\n      var _ref57 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee54(s) {\n        return _regeneratorRuntime().wrap(function _callee54$(_context54) {\n          while (1) {\n            switch (_context54.prev = _context54.next) {\n              case 0:\n                _context54.prev = 0;\n                _context54.next = 3;\n                return _this6.engine.request(s);\n              case 3:\n                return _context54.abrupt(\"return\", _context54.sent);\n              case 6:\n                _context54.prev = 6;\n                _context54.t0 = _context54[\"catch\"](0);\n                throw _this6.logger.error(_context54.t0.message), _context54.t0;\n              case 9:\n              case \"end\":\n                return _context54.stop();\n            }\n          }\n        }, _callee54, null, [[0, 6]]);\n      }));\n      return function (_x72) {\n        return _ref57.apply(this, arguments);\n      };\n    }(), _this6.respond = /*#__PURE__*/function () {\n      var _ref58 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee55(s) {\n        return _regeneratorRuntime().wrap(function _callee55$(_context55) {\n          while (1) {\n            switch (_context55.prev = _context55.next) {\n              case 0:\n                _context55.prev = 0;\n                _context55.next = 3;\n                return _this6.engine.respond(s);\n              case 3:\n                return _context55.abrupt(\"return\", _context55.sent);\n              case 6:\n                _context55.prev = 6;\n                _context55.t0 = _context55[\"catch\"](0);\n                throw _this6.logger.error(_context55.t0.message), _context55.t0;\n              case 9:\n              case \"end\":\n                return _context55.stop();\n            }\n          }\n        }, _callee55, null, [[0, 6]]);\n      }));\n      return function (_x73) {\n        return _ref58.apply(this, arguments);\n      };\n    }(), _this6.ping = /*#__PURE__*/function () {\n      var _ref59 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee56(s) {\n        return _regeneratorRuntime().wrap(function _callee56$(_context56) {\n          while (1) {\n            switch (_context56.prev = _context56.next) {\n              case 0:\n                _context56.prev = 0;\n                _context56.next = 3;\n                return _this6.engine.ping(s);\n              case 3:\n                return _context56.abrupt(\"return\", _context56.sent);\n              case 6:\n                _context56.prev = 6;\n                _context56.t0 = _context56[\"catch\"](0);\n                throw _this6.logger.error(_context56.t0.message), _context56.t0;\n              case 9:\n              case \"end\":\n                return _context56.stop();\n            }\n          }\n        }, _callee56, null, [[0, 6]]);\n      }));\n      return function (_x74) {\n        return _ref59.apply(this, arguments);\n      };\n    }(), _this6.emit = /*#__PURE__*/function () {\n      var _ref60 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee57(s) {\n        return _regeneratorRuntime().wrap(function _callee57$(_context57) {\n          while (1) {\n            switch (_context57.prev = _context57.next) {\n              case 0:\n                _context57.prev = 0;\n                _context57.next = 3;\n                return _this6.engine.emit(s);\n              case 3:\n                return _context57.abrupt(\"return\", _context57.sent);\n              case 6:\n                _context57.prev = 6;\n                _context57.t0 = _context57[\"catch\"](0);\n                throw _this6.logger.error(_context57.t0.message), _context57.t0;\n              case 9:\n              case \"end\":\n                return _context57.stop();\n            }\n          }\n        }, _callee57, null, [[0, 6]]);\n      }));\n      return function (_x75) {\n        return _ref60.apply(this, arguments);\n      };\n    }(), _this6.disconnect = /*#__PURE__*/function () {\n      var _ref61 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee58(s) {\n        return _regeneratorRuntime().wrap(function _callee58$(_context58) {\n          while (1) {\n            switch (_context58.prev = _context58.next) {\n              case 0:\n                _context58.prev = 0;\n                _context58.next = 3;\n                return _this6.engine.disconnect(s);\n              case 3:\n                return _context58.abrupt(\"return\", _context58.sent);\n              case 6:\n                _context58.prev = 6;\n                _context58.t0 = _context58[\"catch\"](0);\n                throw _this6.logger.error(_context58.t0.message), _context58.t0;\n              case 9:\n              case \"end\":\n                return _context58.stop();\n            }\n          }\n        }, _callee58, null, [[0, 6]]);\n      }));\n      return function (_x76) {\n        return _ref61.apply(this, arguments);\n      };\n    }(), _this6.find = function (s) {\n      try {\n        return _this6.engine.find(s);\n      } catch (t) {\n        throw _this6.logger.error(t.message), t;\n      }\n    }, _this6.name = (i === null || i === void 0 ? void 0 : i.name) || A.name, _this6.metadata = (i === null || i === void 0 ? void 0 : i.metadata) || Ve();\n    var e = typeof (i === null || i === void 0 ? void 0 : i.logger) < \"u\" && typeof (i === null || i === void 0 ? void 0 : i.logger) != \"string\" ? i.logger : Oe(oe({\n      level: (i === null || i === void 0 ? void 0 : i.logger) || A.logger\n    }));\n    _this6.core = (i === null || i === void 0 ? void 0 : i.core) || new re(i), _this6.logger = ae(e, _this6.name), _this6.session = new Fe(_this6.core, _this6.logger), _this6.proposal = new He(_this6.core, _this6.logger), _this6.engine = new Xe(_assertThisInitialized(_this6));\n    return _this6;\n  }\n  _createClass(C, [{\n    key: \"context\",\n    get: function get() {\n      return ce(this.logger);\n    }\n  }, {\n    key: \"pairing\",\n    get: function get() {\n      return this.core.pairing.pairings;\n    }\n  }, {\n    key: \"initialize\",\n    value: function () {\n      var _initialize = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee59() {\n        return _regeneratorRuntime().wrap(function _callee59$(_context59) {\n          while (1) {\n            switch (_context59.prev = _context59.next) {\n              case 0:\n                this.logger.trace(\"Initialized\");\n                _context59.prev = 1;\n                _context59.next = 4;\n                return this.core.start();\n              case 4:\n                _context59.next = 6;\n                return this.session.init();\n              case 6:\n                _context59.next = 8;\n                return this.proposal.init();\n              case 8:\n                _context59.next = 10;\n                return this.engine.init();\n              case 10:\n                this.logger.info(\"SignClient Initilization Success\");\n                _context59.next = 16;\n                break;\n              case 13:\n                _context59.prev = 13;\n                _context59.t0 = _context59[\"catch\"](1);\n                throw this.logger.info(\"SignClient Initilization Failure\"), this.logger.error(_context59.t0.message), _context59.t0;\n              case 16:\n              case \"end\":\n                return _context59.stop();\n            }\n          }\n        }, _callee59, this, [[1, 13]]);\n      }));\n      function initialize() {\n        return _initialize.apply(this, arguments);\n      }\n      return initialize;\n    }()\n  }], [{\n    key: \"init\",\n    value: function () {\n      var _init = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee60(i) {\n        var e;\n        return _regeneratorRuntime().wrap(function _callee60$(_context60) {\n          while (1) {\n            switch (_context60.prev = _context60.next) {\n              case 0:\n                e = new C(i);\n                _context60.next = 3;\n                return e.initialize();\n              case 3:\n                return _context60.abrupt(\"return\", e);\n              case 4:\n              case \"end\":\n                return _context60.stop();\n            }\n          }\n        }, _callee60);\n      }));\n      function init(_x77) {\n        return _init.apply(this, arguments);\n      }\n      return init;\n    }()\n  }]);\n  return C;\n}(he);\nvar Ze = C;\nexport { Q as ENGINE_CONTEXT, L as ENGINE_RPC_OPTS, $e as HISTORY_CONTEXT, Me as HISTORY_EVENTS, Ue as HISTORY_STORAGE_VERSION, Z as PROPOSAL_CONTEXT, Ke as PROPOSAL_EXPIRY, B as SESSION_CONTEXT, x as SESSION_EXPIRY, k as SIGN_CLIENT_CONTEXT, A as SIGN_CLIENT_DEFAULT, Ce as SIGN_CLIENT_EVENTS, U as SIGN_CLIENT_PROTOCOL, Ge as SIGN_CLIENT_STORAGE_OPTIONS, z as SIGN_CLIENT_STORAGE_PREFIX, K as SIGN_CLIENT_VERSION, Ze as SignClient, C as default };","map":{"version":3,"mappings":"","names":[],"sources":[],"sourcesContent":["import{RELAYER_DEFAULT_PROTOCOL as te,RELAYER_EVENTS as ie,EXPIRER_EVENTS as ne,Store as j,Core as re}from\"@walletconnect/core\";import{getDefaultLoggerOptions as oe,generateChildLogger as ae,getLoggerContext as ce}from\"@walletconnect/logger\";import{IEngine as le,ISignClient as he}from\"@walletconnect/types\";import{TYPE_1 as pe,createDelayedPromise as R,engineEvent as p,getInternalError as c,calcExpiry as N,getSdkError as I,isSessionCompatible as de,isExpired as V,isValidParams as w,isUndefined as ge,isValidRequiredNamespaces as ue,isValidRelays as me,isValidNamespaces as $,isConformingNamespaces as Y,isValidString as b,isValidErrorReason as we,isValidRelay as _e,isValidController as ye,isValidNamespacesChainId as J,isValidRequest as Ee,isValidNamespacesRequest as Se,isValidResponse as Ie,isValidEvent as fe,isValidNamespacesEvent as ve,parseExpirerTarget as Re,isValidId as Ne,getAppMetadata as Ve}from\"@walletconnect/utils\";import Oe from\"pino\";import{THIRTY_DAYS as qe,SEVEN_DAYS as Pe,FIVE_MINUTES as _,ONE_DAY as O,THIRTY_SECONDS as X}from\"@walletconnect/time\";import{isJsonRpcResult as f,isJsonRpcError as v,formatJsonRpcRequest as Te,formatJsonRpcResult as xe,formatJsonRpcError as Le,isJsonRpcRequest as De,isJsonRpcResponse as be}from\"@walletconnect/jsonrpc-utils\";function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}var H=d;d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(o){if(!Ae(o)||o<0||isNaN(o))throw TypeError(\"n must be a positive number\");return this._maxListeners=o,this},d.prototype.emit=function(o){var i,e,s,t,n,r;if(this._events||(this._events={}),o===\"error\"&&(!this._events.error||T(this._events.error)&&!this._events.error.length)){if(i=arguments[1],i instanceof Error)throw i;var a=new Error('Uncaught, unspecified \"error\" event. ('+i+\")\");throw a.context=i,a}if(e=this._events[o],F(e))return!1;if(y(e))switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:t=Array.prototype.slice.call(arguments,1),e.apply(this,t)}else if(T(e))for(t=Array.prototype.slice.call(arguments,1),r=e.slice(),s=r.length,n=0;n<s;n++)r[n].apply(this,t);return!0},d.prototype.addListener=function(o,i){var e;if(!y(i))throw TypeError(\"listener must be a function\");return this._events||(this._events={}),this._events.newListener&&this.emit(\"newListener\",o,y(i.listener)?i.listener:i),this._events[o]?T(this._events[o])?this._events[o].push(i):this._events[o]=[this._events[o],i]:this._events[o]=i,T(this._events[o])&&!this._events[o].warned&&(F(this._maxListeners)?e=d.defaultMaxListeners:e=this._maxListeners,e&&e>0&&this._events[o].length>e&&(this._events[o].warned=!0,console.error(\"(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.\",this._events[o].length),typeof console.trace==\"function\"&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(o,i){if(!y(i))throw TypeError(\"listener must be a function\");var e=!1;function s(){this.removeListener(o,s),e||(e=!0,i.apply(this,arguments))}return s.listener=i,this.on(o,s),this},d.prototype.removeListener=function(o,i){var e,s,t,n;if(!y(i))throw TypeError(\"listener must be a function\");if(!this._events||!this._events[o])return this;if(e=this._events[o],t=e.length,s=-1,e===i||y(e.listener)&&e.listener===i)delete this._events[o],this._events.removeListener&&this.emit(\"removeListener\",o,i);else if(T(e)){for(n=t;n-- >0;)if(e[n]===i||e[n].listener&&e[n].listener===i){s=n;break}if(s<0)return this;e.length===1?(e.length=0,delete this._events[o]):e.splice(s,1),this._events.removeListener&&this.emit(\"removeListener\",o,i)}return this},d.prototype.removeAllListeners=function(o){var i,e;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[o]&&delete this._events[o],this;if(arguments.length===0){for(i in this._events)i!==\"removeListener\"&&this.removeAllListeners(i);return this.removeAllListeners(\"removeListener\"),this._events={},this}if(e=this._events[o],y(e))this.removeListener(o,e);else if(e)for(;e.length;)this.removeListener(o,e[e.length-1]);return delete this._events[o],this},d.prototype.listeners=function(o){var i;return!this._events||!this._events[o]?i=[]:y(this._events[o])?i=[this._events[o]]:i=this._events[o].slice(),i},d.prototype.listenerCount=function(o){if(this._events){var i=this._events[o];if(y(i))return 1;if(i)return i.length}return 0},d.listenerCount=function(o,i){return o.listenerCount(i)};function y(o){return typeof o==\"function\"}function Ae(o){return typeof o==\"number\"}function T(o){return typeof o==\"object\"&&o!==null}function F(o){return o===void 0}const U=\"wc\",K=2,k=\"client\",z=`${U}@${K}:${k}:`,A={name:k,logger:\"error\",controller:!1,relayUrl:\"wss://relay.walletconnect.com\"},Ce={session_proposal:\"session_proposal\",session_update:\"session_update\",session_extend:\"session_extend\",session_ping:\"session_ping\",session_delete:\"session_delete\",session_expire:\"session_expire\",session_request:\"session_request\",session_event:\"session_event\",proposal_expire:\"proposal_expire\"},Ge={database:\":memory:\"},Me={created:\"history_created\",updated:\"history_updated\",deleted:\"history_deleted\",sync:\"history_sync\"},$e=\"history\",Ue=\"0.3\",Z=\"proposal\",Ke=qe,B=\"session\",x=Pe,Q=\"engine\",L={wc_sessionPropose:{req:{ttl:_,prompt:!0,tag:1100},res:{ttl:_,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:_,prompt:!1,tag:1102},res:{ttl:_,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:O,prompt:!1,tag:1104},res:{ttl:O,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:O,prompt:!1,tag:1106},res:{ttl:O,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:_,prompt:!0,tag:1108},res:{ttl:_,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:_,prompt:!0,tag:1110},res:{ttl:_,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:O,prompt:!1,tag:1112},res:{ttl:O,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:X,prompt:!1,tag:1114},res:{ttl:X,prompt:!1,tag:1115}}};var ke=Object.defineProperty,ze=Object.defineProperties,je=Object.getOwnPropertyDescriptors,W=Object.getOwnPropertySymbols,Ye=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable,ee=(o,i,e)=>i in o?ke(o,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[i]=e,S=(o,i)=>{for(var e in i||(i={}))Ye.call(i,e)&&ee(o,e,i[e]);if(W)for(var e of W(i))Je.call(i,e)&&ee(o,e,i[e]);return o},se=(o,i)=>ze(o,je(i));class Xe extends le{constructor(i){super(i),this.name=Q,this.events=new H,this.initialized=!1,this.ignoredPayloadTypes=[pe],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(L)}),this.initialized=!0)},this.connect=async e=>{this.isInitialized(),await this.isValidConnect(e);const{pairingTopic:s,requiredNamespaces:t,relays:n}=e;let r=s,a,l=!1;if(r&&(l=this.client.core.pairing.pairings.get(r).active),!r||!l){const{topic:E,uri:g}=await this.client.core.pairing.create();r=E,a=g}const h=await this.client.core.crypto.generateKeyPair(),u={requiredNamespaces:t,relays:n??[{protocol:te}],proposer:{publicKey:h,metadata:this.client.metadata}},{reject:m,resolve:q,done:G}=R();if(this.events.once(p(\"session_connect\"),async({error:E,session:g})=>{if(E)m(E);else if(g){g.self.publicKey=h;const P=se(S({},g),{requiredNamespaces:t});await this.client.session.set(g.topic,P),await this.setExpiry(g.topic,g.expiry),r&&await this.client.core.pairing.updateMetadata({topic:r,metadata:g.peer.metadata}),q(P)}}),!r){const{message:E}=c(\"NO_MATCHING_KEY\",`connect() pairing topic: ${r}`);throw new Error(E)}const D=await this.sendRequest(r,\"wc_sessionPropose\",u),M=N(_);return await this.setProposal(D,S({id:D,expiry:M},u)),{uri:a,approval:G}},this.pair=async e=>(this.isInitialized(),await this.client.core.pairing.pair(e)),this.approve=async e=>{this.isInitialized(),await this.isValidApprove(e);const{id:s,relayProtocol:t,namespaces:n}=e,{pairingTopic:r,proposer:a,requiredNamespaces:l}=this.client.proposal.get(s),h=await this.client.core.crypto.generateKeyPair(),u=a.publicKey,m=await this.client.core.crypto.generateSharedKey(h,u),q={relay:{protocol:t??\"irn\"},namespaces:n,requiredNamespaces:l,controller:{publicKey:h,metadata:this.client.metadata},expiry:N(x)};await this.client.core.relayer.subscribe(m);const G=await this.sendRequest(m,\"wc_sessionSettle\",q),{done:D,resolve:M,reject:E}=R();this.events.once(p(\"session_approve\",G),({error:P})=>{P?E(P):M(this.client.session.get(m))});const g=se(S({},q),{topic:m,acknowledged:!1,self:q.controller,peer:{publicKey:a.publicKey,metadata:a.metadata},controller:h});return await this.client.session.set(m,g),await this.setExpiry(m,N(x)),r&&await this.client.core.pairing.updateMetadata({topic:r,metadata:g.peer.metadata}),r&&s&&(await this.sendResult(s,r,{relay:{protocol:t??\"irn\"},responderPublicKey:h}),await this.client.proposal.delete(s,I(\"USER_DISCONNECTED\")),await this.client.core.pairing.activate({topic:r})),{topic:m,acknowledged:D}},this.reject=async e=>{this.isInitialized(),await this.isValidReject(e);const{id:s,reason:t}=e,{pairingTopic:n}=this.client.proposal.get(s);n&&(await this.sendError(s,n,t),await this.client.proposal.delete(s,I(\"USER_DISCONNECTED\")))},this.update=async e=>{this.isInitialized(),await this.isValidUpdate(e);const{topic:s,namespaces:t}=e,n=await this.sendRequest(s,\"wc_sessionUpdate\",{namespaces:t}),{done:r,resolve:a,reject:l}=R();return this.events.once(p(\"session_update\",n),({error:h})=>{h?l(h):a()}),await this.client.session.update(s,{namespaces:t}),{acknowledged:r}},this.extend=async e=>{this.isInitialized(),await this.isValidExtend(e);const{topic:s}=e,t=await this.sendRequest(s,\"wc_sessionExtend\",{}),{done:n,resolve:r,reject:a}=R();return this.events.once(p(\"session_extend\",t),({error:l})=>{l?a(l):r()}),await this.setExpiry(s,N(x)),{acknowledged:n}},this.request=async e=>{this.isInitialized(),await this.isValidRequest(e);const{chainId:s,request:t,topic:n}=e,r=await this.sendRequest(n,\"wc_sessionRequest\",{request:t,chainId:s}),{done:a,resolve:l,reject:h}=R();return this.events.once(p(\"session_request\",r),({error:u,result:m})=>{u?h(u):l(m)}),await a()},this.respond=async e=>{this.isInitialized(),await this.isValidRespond(e);const{topic:s,response:t}=e,{id:n}=t;f(t)?await this.sendResult(n,s,t.result):v(t)&&await this.sendError(n,s,t.error)},this.ping=async e=>{this.isInitialized(),await this.isValidPing(e);const{topic:s}=e;if(this.client.session.keys.includes(s)){const t=await this.sendRequest(s,\"wc_sessionPing\",{}),{done:n,resolve:r,reject:a}=R();this.events.once(p(\"session_ping\",t),({error:l})=>{l?a(l):r()}),await n()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async e=>{this.isInitialized(),await this.isValidEmit(e);const{topic:s,event:t,chainId:n}=e;await this.sendRequest(s,\"wc_sessionEvent\",{event:t,chainId:n})},this.disconnect=async e=>{this.isInitialized(),await this.isValidDisconnect(e);const{topic:s}=e;this.client.session.keys.includes(s)?(await this.sendRequest(s,\"wc_sessionDelete\",I(\"USER_DISCONNECTED\")),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=e=>(this.isInitialized(),this.client.session.getAll().filter(s=>de(s,e))),this.deleteSession=async(e,s)=>{const{self:t}=this.client.session.get(e);await this.client.core.relayer.unsubscribe(e),await Promise.all([this.client.session.delete(e,I(\"USER_DISCONNECTED\")),this.client.core.crypto.deleteKeyPair(t.publicKey),this.client.core.crypto.deleteSymKey(e),s?Promise.resolve():this.client.core.expirer.del(e)])},this.deleteProposal=async(e,s)=>{await Promise.all([this.client.proposal.delete(e,I(\"USER_DISCONNECTED\")),s?Promise.resolve():this.client.core.expirer.del(e)])},this.setExpiry=async(e,s)=>{this.client.session.keys.includes(e)&&await this.client.session.update(e,{expiry:s}),this.client.core.expirer.set(e,s)},this.setProposal=async(e,s)=>{await this.client.proposal.set(e,s),this.client.core.expirer.set(e,s.expiry)},this.sendRequest=async(e,s,t)=>{const n=Te(s,t),r=await this.client.core.crypto.encode(e,n),a=L[s].req;return this.client.core.history.set(e,n),this.client.core.relayer.publish(e,r,a),n.id},this.sendResult=async(e,s,t)=>{const n=xe(e,t),r=await this.client.core.crypto.encode(s,n),a=await this.client.core.history.get(s,e),l=L[a.request.method].res;await this.client.core.relayer.publish(s,r,l),await this.client.core.history.resolve(n)},this.sendError=async(e,s,t)=>{const n=Le(e,t),r=await this.client.core.crypto.encode(s,n),a=await this.client.core.history.get(s,e),l=L[a.request.method].res;await this.client.core.relayer.publish(s,r,l),await this.client.core.history.resolve(n)},this.cleanup=async()=>{const e=[],s=[];this.client.session.getAll().forEach(t=>{V(t.expiry)&&e.push(t.topic)}),this.client.proposal.getAll().forEach(t=>{V(t.expiry)&&s.push(t.id)}),await Promise.all([...e.map(t=>this.deleteSession(t)),...s.map(t=>this.deleteProposal(t))])},this.onRelayEventRequest=e=>{const{topic:s,payload:t}=e,n=t.method;switch(n){case\"wc_sessionPropose\":return this.onSessionProposeRequest(s,t);case\"wc_sessionSettle\":return this.onSessionSettleRequest(s,t);case\"wc_sessionUpdate\":return this.onSessionUpdateRequest(s,t);case\"wc_sessionExtend\":return this.onSessionExtendRequest(s,t);case\"wc_sessionPing\":return this.onSessionPingRequest(s,t);case\"wc_sessionDelete\":return this.onSessionDeleteRequest(s,t);case\"wc_sessionRequest\":return this.onSessionRequest(s,t);case\"wc_sessionEvent\":return this.onSessionEventRequest(s,t);default:return this.client.logger.info(`Unsupported request method ${n}`)}},this.onRelayEventResponse=async e=>{const{topic:s,payload:t}=e,n=(await this.client.core.history.get(s,t.id)).request.method;switch(n){case\"wc_sessionPropose\":return this.onSessionProposeResponse(s,t);case\"wc_sessionSettle\":return this.onSessionSettleResponse(s,t);case\"wc_sessionUpdate\":return this.onSessionUpdateResponse(s,t);case\"wc_sessionExtend\":return this.onSessionExtendResponse(s,t);case\"wc_sessionPing\":return this.onSessionPingResponse(s,t);case\"wc_sessionRequest\":return this.onSessionRequestResponse(s,t);default:return this.client.logger.info(`Unsupported response method ${n}`)}},this.onSessionProposeRequest=async(e,s)=>{const{params:t,id:n}=s;try{this.isValidConnect(S({},s.params));const r=N(_),a=S({id:n,pairingTopic:e,expiry:r},t);await this.setProposal(n,a),this.client.events.emit(\"session_proposal\",{id:n,params:a})}catch(r){await this.sendError(n,e,r),this.client.logger.error(r)}},this.onSessionProposeResponse=async(e,s)=>{const{id:t}=s;if(f(s)){const{result:n}=s;this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",result:n});const r=this.client.proposal.get(t);this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",proposal:r});const a=r.proposer.publicKey;this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",selfPublicKey:a});const l=n.responderPublicKey;this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",peerPublicKey:l});const h=await this.client.core.crypto.generateSharedKey(a,l);this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",sessionTopic:h});const u=await this.client.core.relayer.subscribe(h);this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",subscriptionId:u}),await this.client.core.pairing.activate({topic:e})}else v(s)&&(await this.client.proposal.delete(t,I(\"USER_DISCONNECTED\")),this.events.emit(p(\"session_connect\"),{error:s.error}))},this.onSessionSettleRequest=async(e,s)=>{const{id:t,params:n}=s;try{this.isValidSessionSettleRequest(n);const{relay:r,controller:a,expiry:l,namespaces:h}=s.params,u={topic:e,relay:r,expiry:l,namespaces:h,acknowledged:!0,controller:a.publicKey,self:{publicKey:\"\",metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}};await this.sendResult(s.id,e,!0),this.events.emit(p(\"session_connect\"),{session:u})}catch(r){await this.sendError(t,e,r),this.client.logger.error(r)}},this.onSessionSettleResponse=async(e,s)=>{const{id:t}=s;f(s)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(p(\"session_approve\",t),{})):v(s)&&(await this.client.session.delete(e,I(\"USER_DISCONNECTED\")),this.events.emit(p(\"session_approve\",t),{error:s.error}))},this.onSessionUpdateRequest=async(e,s)=>{const{params:t,id:n}=s;try{this.isValidUpdate(S({topic:e},t)),await this.client.session.update(e,{namespaces:t.namespaces}),await this.sendResult(n,e,!0),this.client.events.emit(\"session_update\",{id:n,topic:e,params:t})}catch(r){await this.sendError(n,e,r),this.client.logger.error(r)}},this.onSessionUpdateResponse=(e,s)=>{const{id:t}=s;f(s)?this.events.emit(p(\"session_update\",t),{}):v(s)&&this.events.emit(p(\"session_update\",t),{error:s.error})},this.onSessionExtendRequest=async(e,s)=>{const{id:t}=s;try{this.isValidExtend({topic:e}),await this.setExpiry(e,N(x)),await this.sendResult(t,e,!0),this.client.events.emit(\"session_extend\",{id:t,topic:e})}catch(n){await this.sendError(t,e,n),this.client.logger.error(n)}},this.onSessionExtendResponse=(e,s)=>{const{id:t}=s;f(s)?this.events.emit(p(\"session_extend\",t),{}):v(s)&&this.events.emit(p(\"session_extend\",t),{error:s.error})},this.onSessionPingRequest=async(e,s)=>{const{id:t}=s;try{this.isValidPing({topic:e}),await this.sendResult(t,e,!0),this.client.events.emit(\"session_ping\",{id:t,topic:e})}catch(n){await this.sendError(t,e,n),this.client.logger.error(n)}},this.onSessionPingResponse=(e,s)=>{const{id:t}=s;setTimeout(()=>{f(s)?this.events.emit(p(\"session_ping\",t),{}):v(s)&&this.events.emit(p(\"session_ping\",t),{error:s.error})},500)},this.onSessionDeleteRequest=async(e,s)=>{const{id:t}=s;try{this.isValidDisconnect({topic:e,reason:s.params}),await this.sendResult(t,e,!0),await this.deleteSession(e),this.client.events.emit(\"session_delete\",{id:t,topic:e})}catch(n){await this.sendError(t,e,n),this.client.logger.error(n)}},this.onSessionRequest=async(e,s)=>{const{id:t,params:n}=s;try{this.isValidRequest(S({topic:e},n)),this.client.events.emit(\"session_request\",{id:t,topic:e,params:n})}catch(r){await this.sendError(t,e,r),this.client.logger.error(r)}},this.onSessionRequestResponse=(e,s)=>{const{id:t}=s;f(s)?this.events.emit(p(\"session_request\",t),{result:s.result}):v(s)&&this.events.emit(p(\"session_request\",t),{error:s.error})},this.onSessionEventRequest=async(e,s)=>{const{id:t,params:n}=s;try{this.isValidEmit(S({topic:e},n)),this.client.events.emit(\"session_event\",{id:t,topic:e,params:n})}catch(r){await this.sendError(t,e,r),this.client.logger.error(r)}},this.isValidConnect=async e=>{if(!w(e)){const{message:a}=c(\"MISSING_OR_INVALID\",`connect() params: ${JSON.stringify(e)}`);throw new Error(a)}const{pairingTopic:s,requiredNamespaces:t,relays:n}=e;ge(s)||await this.isValidPairingTopic(s);const r=ue(t,\"connect()\");if(r)throw new Error(r.message);if(!me(n,!0)){const{message:a}=c(\"MISSING_OR_INVALID\",`connect() relays: ${n}`);throw new Error(a)}},this.isValidApprove=async e=>{if(!w(e))throw new Error(c(\"MISSING_OR_INVALID\",`approve() params: ${e}`).message);const{id:s,namespaces:t,relayProtocol:n}=e;await this.isValidProposalId(s);const r=this.client.proposal.get(s),a=$(t,\"approve()\");if(a)throw new Error(a.message);const l=Y(r.requiredNamespaces,t,\"update()\");if(l)throw new Error(l.message);if(!b(n,!0)){const{message:h}=c(\"MISSING_OR_INVALID\",`approve() relayProtocol: ${n}`);throw new Error(h)}},this.isValidReject=async e=>{if(!w(e)){const{message:n}=c(\"MISSING_OR_INVALID\",`reject() params: ${e}`);throw new Error(n)}const{id:s,reason:t}=e;if(await this.isValidProposalId(s),!we(t)){const{message:n}=c(\"MISSING_OR_INVALID\",`reject() reason: ${JSON.stringify(t)}`);throw new Error(n)}},this.isValidSessionSettleRequest=e=>{if(!w(e)){const{message:h}=c(\"MISSING_OR_INVALID\",`onSessionSettleRequest() params: ${e}`);throw new Error(h)}const{relay:s,controller:t,namespaces:n,expiry:r}=e;if(!_e(s)){const{message:h}=c(\"MISSING_OR_INVALID\",\"onSessionSettleRequest() relay protocol should be a string\");throw new Error(h)}const a=ye(t,\"onSessionSettleRequest()\");if(a)throw new Error(a.message);const l=$(n,\"onSessionSettleRequest()\");if(l)throw new Error(l.message);if(V(r)){const{message:h}=c(\"EXPIRED\",\"onSessionSettleRequest()\");throw new Error(h)}},this.isValidUpdate=async e=>{if(!w(e)){const{message:l}=c(\"MISSING_OR_INVALID\",`update() params: ${e}`);throw new Error(l)}const{topic:s,namespaces:t}=e;await this.isValidSessionTopic(s);const n=this.client.session.get(s),r=$(t,\"update()\");if(r)throw new Error(r.message);const a=Y(n.requiredNamespaces,t,\"update()\");if(a)throw new Error(a.message)},this.isValidExtend=async e=>{if(!w(e)){const{message:t}=c(\"MISSING_OR_INVALID\",`extend() params: ${e}`);throw new Error(t)}const{topic:s}=e;await this.isValidSessionTopic(s)},this.isValidRequest=async e=>{if(!w(e)){const{message:a}=c(\"MISSING_OR_INVALID\",`request() params: ${e}`);throw new Error(a)}const{topic:s,request:t,chainId:n}=e;await this.isValidSessionTopic(s);const{namespaces:r}=this.client.session.get(s);if(!J(r,n)){const{message:a}=c(\"MISSING_OR_INVALID\",`request() chainId: ${n}`);throw new Error(a)}if(!Ee(t)){const{message:a}=c(\"MISSING_OR_INVALID\",`request() ${JSON.stringify(t)}`);throw new Error(a)}if(!Se(r,n,t.method)){const{message:a}=c(\"MISSING_OR_INVALID\",`request() method: ${t.method}`);throw new Error(a)}},this.isValidRespond=async e=>{if(!w(e)){const{message:n}=c(\"MISSING_OR_INVALID\",`respond() params: ${e}`);throw new Error(n)}const{topic:s,response:t}=e;if(await this.isValidSessionTopic(s),!Ie(t)){const{message:n}=c(\"MISSING_OR_INVALID\",`respond() response: ${JSON.stringify(t)}`);throw new Error(n)}},this.isValidPing=async e=>{if(!w(e)){const{message:t}=c(\"MISSING_OR_INVALID\",`ping() params: ${e}`);throw new Error(t)}const{topic:s}=e;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async e=>{if(!w(e)){const{message:a}=c(\"MISSING_OR_INVALID\",`emit() params: ${e}`);throw new Error(a)}const{topic:s,event:t,chainId:n}=e;await this.isValidSessionTopic(s);const{namespaces:r}=this.client.session.get(s);if(!J(r,n)){const{message:a}=c(\"MISSING_OR_INVALID\",`emit() chainId: ${n}`);throw new Error(a)}if(!fe(t)){const{message:a}=c(\"MISSING_OR_INVALID\",`emit() event: ${JSON.stringify(t)}`);throw new Error(a)}if(!ve(r,n,t.name)){const{message:a}=c(\"MISSING_OR_INVALID\",`emit() event: ${JSON.stringify(t)}`);throw new Error(a)}},this.isValidDisconnect=async e=>{if(!w(e)){const{message:t}=c(\"MISSING_OR_INVALID\",`disconnect() params: ${e}`);throw new Error(t)}const{topic:s}=e;await this.isValidSessionOrPairingTopic(s)}}isInitialized(){if(!this.initialized){const{message:i}=c(\"NOT_INITIALIZED\",this.name);throw new Error(i)}}registerRelayerEvents(){this.client.core.relayer.on(ie.message,async i=>{const{topic:e,message:s}=i;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const t=await this.client.core.crypto.decode(e,s);De(t)?(this.client.core.history.set(e,t),this.onRelayEventRequest({topic:e,payload:t})):be(t)&&(await this.client.core.history.resolve(t),this.onRelayEventResponse({topic:e,payload:t}))})}registerExpirerEvents(){this.client.core.expirer.on(ne.expired,async i=>{const{topic:e,id:s}=Re(i.target);e?this.client.session.keys.includes(e)&&(await this.deleteSession(e,!0),this.client.events.emit(\"session_expire\",{topic:e})):s&&await this.deleteProposal(s,!0)})}isValidPairingTopic(i){if(!b(i,!1)){const{message:e}=c(\"MISSING_OR_INVALID\",`pairing topic should be a string: ${i}`);throw new Error(e)}if(!this.client.core.pairing.pairings.keys.includes(i)){const{message:e}=c(\"NO_MATCHING_KEY\",`pairing topic doesn't exist: ${i}`);throw new Error(e)}if(V(this.client.core.pairing.pairings.get(i).expiry)){const{message:e}=c(\"EXPIRED\",`pairing topic: ${i}`);throw new Error(e)}}async isValidSessionTopic(i){if(!b(i,!1)){const{message:e}=c(\"MISSING_OR_INVALID\",`session topic should be a string: ${i}`);throw new Error(e)}if(!this.client.session.keys.includes(i)){const{message:e}=c(\"NO_MATCHING_KEY\",`session topic doesn't exist: ${i}`);throw new Error(e)}if(V(this.client.session.get(i).expiry)){await this.deleteSession(i);const{message:e}=c(\"EXPIRED\",`session topic: ${i}`);throw new Error(e)}}async isValidSessionOrPairingTopic(i){if(this.client.session.keys.includes(i))await this.isValidSessionTopic(i);else if(this.client.core.pairing.pairings.keys.includes(i))this.isValidPairingTopic(i);else if(b(i,!1)){const{message:e}=c(\"NO_MATCHING_KEY\",`session or pairing topic doesn't exist: ${i}`);throw new Error(e)}else{const{message:e}=c(\"MISSING_OR_INVALID\",`session or pairing topic should be a string: ${i}`);throw new Error(e)}}async isValidProposalId(i){if(!Ne(i)){const{message:e}=c(\"MISSING_OR_INVALID\",`proposal id should be a number: ${i}`);throw new Error(e)}if(!this.client.proposal.keys.includes(i)){const{message:e}=c(\"NO_MATCHING_KEY\",`proposal id doesn't exist: ${i}`);throw new Error(e)}if(V(this.client.proposal.get(i).expiry)){await this.deleteProposal(i);const{message:e}=c(\"EXPIRED\",`proposal id: ${i}`);throw new Error(e)}}}class He extends j{constructor(i,e){super(i,e,Z,z),this.core=i,this.logger=e}}class Fe extends j{constructor(i,e){super(i,e,B,z),this.core=i,this.logger=e}}class C extends he{constructor(i){super(i),this.protocol=U,this.version=K,this.name=A.name,this.events=new H.EventEmitter,this.on=(s,t)=>this.events.on(s,t),this.once=(s,t)=>this.events.once(s,t),this.off=(s,t)=>this.events.off(s,t),this.removeListener=(s,t)=>this.events.removeListener(s,t),this.connect=async s=>{try{return await this.engine.connect(s)}catch(t){throw this.logger.error(t.message),t}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(t){throw this.logger.error(t.message),t}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(t){throw this.logger.error(t.message),t}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(t){throw this.logger.error(t.message),t}},this.update=async s=>{try{return await this.engine.update(s)}catch(t){throw this.logger.error(t.message),t}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(t){throw this.logger.error(t.message),t}},this.request=async s=>{try{return await this.engine.request(s)}catch(t){throw this.logger.error(t.message),t}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(t){throw this.logger.error(t.message),t}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(t){throw this.logger.error(t.message),t}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(t){throw this.logger.error(t.message),t}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(t){throw this.logger.error(t.message),t}},this.find=s=>{try{return this.engine.find(s)}catch(t){throw this.logger.error(t.message),t}},this.name=i?.name||A.name,this.metadata=i?.metadata||Ve();const e=typeof i?.logger<\"u\"&&typeof i?.logger!=\"string\"?i.logger:Oe(oe({level:i?.logger||A.logger}));this.core=i?.core||new re(i),this.logger=ae(e,this.name),this.session=new Fe(this.core,this.logger),this.proposal=new He(this.core,this.logger),this.engine=new Xe(this)}static async init(i){const e=new C(i);return await e.initialize(),e}get context(){return ce(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace(\"Initialized\");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.engine.init(),this.logger.info(\"SignClient Initilization Success\")}catch(i){throw this.logger.info(\"SignClient Initilization Failure\"),this.logger.error(i.message),i}}}const Ze=C;export{Q as ENGINE_CONTEXT,L as ENGINE_RPC_OPTS,$e as HISTORY_CONTEXT,Me as HISTORY_EVENTS,Ue as HISTORY_STORAGE_VERSION,Z as PROPOSAL_CONTEXT,Ke as PROPOSAL_EXPIRY,B as SESSION_CONTEXT,x as SESSION_EXPIRY,k as SIGN_CLIENT_CONTEXT,A as SIGN_CLIENT_DEFAULT,Ce as SIGN_CLIENT_EVENTS,U as SIGN_CLIENT_PROTOCOL,Ge as SIGN_CLIENT_STORAGE_OPTIONS,z as SIGN_CLIENT_STORAGE_PREFIX,K as SIGN_CLIENT_VERSION,Ze as SignClient,C as default};\n//# sourceMappingURL=index.es.js.map\n"]},"metadata":{},"sourceType":"module"}