{"ast":null,"code":"import _regeneratorRuntime from \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _classCallCheck from \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar Locker = /*#__PURE__*/function () {\n  function Locker() {\n    _classCallCheck(this, Locker);\n  }\n  _createClass(Locker, null, [{\n    key: \"lock\",\n    value: function lock(key, func) {\n      var log = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var result, index;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!Locker.lockArray.includes(key)) {\n                  _context.next = 3;\n                  break;\n                }\n                if (log) console.log(\"\".concat(key, \" is already running\"));\n                return _context.abrupt(\"return\");\n              case 3:\n                Locker.lockArray.push(key);\n                result = undefined;\n                _context.prev = 5;\n                _context.next = 8;\n                return func();\n              case 8:\n                result = _context.sent;\n                _context.next = 15;\n                break;\n              case 11:\n                _context.prev = 11;\n                _context.t0 = _context[\"catch\"](5);\n                if (log) console.error(\"Error running \".concat(key));\n                if (log) console.error(_context.t0, _context.t0.stack);\n              case 15:\n                _context.prev = 15;\n                index = Locker.lockArray.indexOf(key);\n                if (index >= 0) {\n                  Locker.lockArray.splice(index, 1);\n                }\n                return _context.finish(15);\n              case 19:\n                return _context.abrupt(\"return\", result);\n              case 20:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[5, 11, 15, 19]]);\n      }));\n    }\n  }]);\n  return Locker;\n}();\nexport { Locker as default };\nLocker.lockArray = [];","map":{"version":3,"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","Locker","key","func","log","lockArray","includes","console","push","undefined","error","stack","index","indexOf","splice"],"sources":["/Users/merlea/Development/Crypto/Krogan/kroganverse-com/packages/common/build/locker.js"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nexport default class Locker {\n    static lock(key, func, log = false) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (Locker.lockArray.includes(key)) {\n                if (log)\n                    console.log(`${key} is already running`);\n                return;\n            }\n            Locker.lockArray.push(key);\n            let result = undefined;\n            try {\n                result = yield func();\n            }\n            catch (error) {\n                if (log)\n                    console.error(`Error running ${key}`);\n                if (log)\n                    console.error(error, error.stack);\n            }\n            finally {\n                const index = Locker.lockArray.indexOf(key);\n                if (index >= 0) {\n                    Locker.lockArray.splice(index, 1);\n                }\n            }\n            return result;\n        });\n    }\n}\nLocker.lockArray = [];\n"],"mappings":";;;AAAA,IAAIA,SAAS,GAAI,IAAI,IAAI,IAAI,CAACA,SAAS,IAAK,UAAUC,OAAO,EAAEC,UAAU,EAAEC,CAAC,EAAEC,SAAS,EAAE;EACrF,SAASC,KAAK,CAACC,KAAK,EAAE;IAAE,OAAOA,KAAK,YAAYH,CAAC,GAAGG,KAAK,GAAG,IAAIH,CAAC,CAAC,UAAUI,OAAO,EAAE;MAAEA,OAAO,CAACD,KAAK,CAAC;IAAE,CAAC,CAAC;EAAE;EAC3G,OAAO,KAAKH,CAAC,KAAKA,CAAC,GAAGK,OAAO,CAAC,EAAE,UAAUD,OAAO,EAAEE,MAAM,EAAE;IACvD,SAASC,SAAS,CAACJ,KAAK,EAAE;MAAE,IAAI;QAAEK,IAAI,CAACP,SAAS,CAACQ,IAAI,CAACN,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC,OAAOO,CAAC,EAAE;QAAEJ,MAAM,CAACI,CAAC,CAAC;MAAE;IAAE;IAC1F,SAASC,QAAQ,CAACR,KAAK,EAAE;MAAE,IAAI;QAAEK,IAAI,CAACP,SAAS,CAAC,OAAO,CAAC,CAACE,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC,OAAOO,CAAC,EAAE;QAAEJ,MAAM,CAACI,CAAC,CAAC;MAAE;IAAE;IAC7F,SAASF,IAAI,CAACI,MAAM,EAAE;MAAEA,MAAM,CAACC,IAAI,GAAGT,OAAO,CAACQ,MAAM,CAACT,KAAK,CAAC,GAAGD,KAAK,CAACU,MAAM,CAACT,KAAK,CAAC,CAACW,IAAI,CAACP,SAAS,EAAEI,QAAQ,CAAC;IAAE;IAC7GH,IAAI,CAAC,CAACP,SAAS,GAAGA,SAAS,CAACc,KAAK,CAACjB,OAAO,EAAEC,UAAU,IAAI,EAAE,CAAC,EAAEU,IAAI,EAAE,CAAC;EACzE,CAAC,CAAC;AACN,CAAC;AAAC,IACmBO,MAAM;EAAA;IAAA;EAAA;EAAA;IAAA;IAAA,OACvB,cAAYC,GAAG,EAAEC,IAAI,EAAe;MAAA,IAAbC,GAAG,uEAAG,KAAK;MAC9B,OAAOtB,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,0CAAE;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,KAC/BmB,MAAM,CAACI,SAAS,CAACC,QAAQ,CAACJ,GAAG,CAAC;kBAAA;kBAAA;gBAAA;gBAC9B,IAAIE,GAAG,EACHG,OAAO,CAACH,GAAG,WAAIF,GAAG,yBAAsB;gBAAC;cAAA;gBAGjDD,MAAM,CAACI,SAAS,CAACG,IAAI,CAACN,GAAG,CAAC;gBACtBL,MAAM,GAAGY,SAAS;gBAAA;gBAAA;gBAET,OAAMN,IAAI,EAAE;cAAA;gBAArBN,MAAM;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAGN,IAAIO,GAAG,EACHG,OAAO,CAACG,KAAK,yBAAkBR,GAAG,EAAG;gBACzC,IAAIE,GAAG,EACHG,OAAO,CAACG,KAAK,cAAQ,YAAMC,KAAK,CAAC;cAAC;gBAAA;gBAGhCC,KAAK,GAAGX,MAAM,CAACI,SAAS,CAACQ,OAAO,CAACX,GAAG,CAAC;gBAC3C,IAAIU,KAAK,IAAI,CAAC,EAAE;kBACZX,MAAM,CAACI,SAAS,CAACS,MAAM,CAACF,KAAK,EAAE,CAAC,CAAC;gBACrC;gBAAC;cAAA;gBAAA,iCAEEf,MAAM;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CAChB,EAAC;IACN;EAAC;EAAA;AAAA;AAAA,SA3BgBI,MAAM;AA6B3BA,MAAM,CAACI,SAAS,GAAG,EAAE"},"metadata":{},"sourceType":"module"}