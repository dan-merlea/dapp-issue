{"ast":null,"code":"import _toConsumableArray from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/merlea/Development/Crypto/Krogan/kroganverse-com/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect}from'react';import moment from'moment';import{Address}from'@elrondnetwork/erdjs/out';import{DelegationTransactionType,nominateNumberToHex,nominateStringToHex}from'../helpers';import{b64ToBn,denominate}from'../helpers/denominate/formatters';import{useGetAccountInfo,useTrackTransactionStatus}from'@elrondnetwork/dapp-core/hooks';import{getCleanApiAddress}from'@elrondnetwork/dapp-core/apiCalls/utils';import{useCoreContext,useCoreDispatch}from'core/context/context';import{accountService}from'core/services/account.service';import{useTransactions}from'core/hooks';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var kroTicker='KRO-df97ec';export var lkkroTicker='LKKRO-e6ef92';export var TokensView=function TokensView(){var dispatch=useCoreDispatch();var _useCoreContext=useCoreContext(),tokens=_useCoreContext.tokens;var _useGetAccountInfo=useGetAccountInfo(),address=_useGetAccountInfo.address;var _useTransactions=useTransactions(),sendTransaction=_useTransactions.sendTransaction;/**** Transaction Handler ****/var _React$useState=React.useState(null),_React$useState2=_slicedToArray(_React$useState,2),sessionId=_React$useState2[0],setSessionId=_React$useState2[1];var _=useTrackTransactionStatus({transactionId:sessionId,onSuccess:function onSuccess(transactionId){if(sessionId==transactionId){// nothing\n}},onFail:function onFail(){},onCancelled:function onCancelled(){}});/**** Transaction Handler ****/var unlock=function unlock(token){var _ref;var tokenId=nominateStringToHex(token.ticker);var tokenNonce=nominateNumberToHex((_ref=''+token.nonce)!==null&&_ref!==void 0?_ref:0);var amount=nominateNumberToHex(token.balance);var receiver=new Address('erd1qqqqqqqqqqqqqpgqyq5g6uvx0hzwdl0864sxpdtquv0hhaa5we0s5hpa90').hex();var func=nominateStringToHex('claimTokens');var data=tokenId+'@'+tokenNonce+'@'+amount+'@'+receiver+'@'+func;var txArguments=new DelegationTransactionType(address,'0','ESDTNFTTransfer',data);sendTransaction([txArguments],'claimRewards','Claim Rewards').then(function(id){return setSessionId(id);});};var fetchAccount=function fetchAccount(){if(address){var _tokens=accountService.fetchAccountTokens(getCleanApiAddress(),address,kroTicker);var metaTokens=accountService.fetchAccountMetaTokens(getCleanApiAddress(),address,lkkroTicker);Promise.all([_tokens,metaTokens]).then(function(tokens){dispatch({type:'setTokens',tokens:[].concat(_toConsumableArray(tokens[0]),_toConsumableArray(tokens[1]))});});}};useEffect(function(){fetchAccount();},[address]);var tokenView=function tokenView(token,index){var vesting;if(token.attributes){var timestamp=parseInt(b64ToBn(token.attributes).toString())*1000;if(new Date().getTime()>timestamp){vesting=/*#__PURE__*/_jsx(\"div\",{className:\"ms-3\",children:/*#__PURE__*/_jsx(\"button\",{className:\"link-button text-medium px-0\",onClick:function onClick(){return unlock(token);},children:\"Unlock now\"})});}else{vesting=/*#__PURE__*/_jsxs(\"p\",{children:[\"\\xA0- Vesting \",moment(timestamp).from(moment())]});}}return/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center justify-content-center\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-action\",children:denominate({input:token.balance,denomination:token.decimals,decimals:4})}),\"\\xA0\",token.identifier==kroTicker?/*#__PURE__*/_jsx(\"img\",{src:\"/images/\".concat(kroTicker,\".gif\"),width:20,alt:\"KRO Token\"}):/*#__PURE__*/_jsx(\"span\",{children:token.ticker.split('-').first()}),vesting]},index);};return/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"d-flex flex-column align-items-center justify-content-center mb-3\",children:tokens.map(function(token,i){return tokenView(token,i);})})});};","map":null,"metadata":{},"sourceType":"module"}